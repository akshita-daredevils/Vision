var SV=Object.defineProperty;var IV=(t,e,n)=>e in t?SV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var re=(t,e,n)=>IV(t,typeof e!="symbol"?e+"":e,n);function kV(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function $V(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var EA={exports:{}},Jm={},SA={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fh=Symbol.for("react.element"),CV=Symbol.for("react.portal"),AV=Symbol.for("react.fragment"),RV=Symbol.for("react.strict_mode"),PV=Symbol.for("react.profiler"),NV=Symbol.for("react.provider"),OV=Symbol.for("react.context"),DV=Symbol.for("react.forward_ref"),MV=Symbol.for("react.suspense"),LV=Symbol.for("react.memo"),zV=Symbol.for("react.lazy"),w2=Symbol.iterator;function VV(t){return t===null||typeof t!="object"?null:(t=w2&&t[w2]||t["@@iterator"],typeof t=="function"?t:null)}var IA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},kA=Object.assign,$A={};function ku(t,e,n){this.props=t,this.context=e,this.refs=$A,this.updater=n||IA}ku.prototype.isReactComponent={};ku.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ku.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function CA(){}CA.prototype=ku.prototype;function yv(t,e,n){this.props=t,this.context=e,this.refs=$A,this.updater=n||IA}var _v=yv.prototype=new CA;_v.constructor=yv;kA(_v,ku.prototype);_v.isPureReactComponent=!0;var v2=Array.isArray,AA=Object.prototype.hasOwnProperty,wv={current:null},RA={key:!0,ref:!0,__self:!0,__source:!0};function PA(t,e,n){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)AA.call(e,r)&&!RA.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:fh,type:t,key:s,ref:a,props:i,_owner:wv.current}}function FV(t,e){return{$$typeof:fh,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vv(t){return typeof t=="object"&&t!==null&&t.$$typeof===fh}function BV(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var b2=/\/+/g;function py(t,e){return typeof t=="object"&&t!==null&&t.key!=null?BV(""+t.key):e.toString(36)}function fp(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case fh:case CV:a=!0}}if(a)return a=t,i=i(a),t=r===""?"."+py(a,0):r,v2(i)?(n="",t!=null&&(n=t.replace(b2,"$&/")+"/"),fp(i,e,n,"",function(u){return u})):i!=null&&(vv(i)&&(i=FV(i,n+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(b2,"$&/")+"/")+t)),e.push(i)),1;if(a=0,r=r===""?".":r+":",v2(t))for(var o=0;o<t.length;o++){s=t[o];var l=r+py(s,o);a+=fp(s,e,n,l,i)}else if(l=VV(t),typeof l=="function")for(t=l.call(t),o=0;!(s=t.next()).done;)s=s.value,l=r+py(s,o++),a+=fp(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function pf(t,e,n){if(t==null)return t;var r=[],i=0;return fp(t,r,"","",function(s){return e.call(n,s,i++)}),r}function UV(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Dn={current:null},pp={transition:null},jV={ReactCurrentDispatcher:Dn,ReactCurrentBatchConfig:pp,ReactCurrentOwner:wv};function NA(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:pf,forEach:function(t,e,n){pf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return pf(t,function(){e++}),e},toArray:function(t){return pf(t,function(e){return e})||[]},only:function(t){if(!vv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Me.Component=ku;Me.Fragment=AV;Me.Profiler=PV;Me.PureComponent=yv;Me.StrictMode=RV;Me.Suspense=MV;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jV;Me.act=NA;Me.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=kA({},t.props),i=t.key,s=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=wv.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(l in e)AA.call(e,l)&&!RA.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:fh,type:t.type,key:i,ref:s,props:r,_owner:a}};Me.createContext=function(t){return t={$$typeof:OV,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:NV,_context:t},t.Consumer=t};Me.createElement=PA;Me.createFactory=function(t){var e=PA.bind(null,t);return e.type=t,e};Me.createRef=function(){return{current:null}};Me.forwardRef=function(t){return{$$typeof:DV,render:t}};Me.isValidElement=vv;Me.lazy=function(t){return{$$typeof:zV,_payload:{_status:-1,_result:t},_init:UV}};Me.memo=function(t,e){return{$$typeof:LV,type:t,compare:e===void 0?null:e}};Me.startTransition=function(t){var e=pp.transition;pp.transition={};try{t()}finally{pp.transition=e}};Me.unstable_act=NA;Me.useCallback=function(t,e){return Dn.current.useCallback(t,e)};Me.useContext=function(t){return Dn.current.useContext(t)};Me.useDebugValue=function(){};Me.useDeferredValue=function(t){return Dn.current.useDeferredValue(t)};Me.useEffect=function(t,e){return Dn.current.useEffect(t,e)};Me.useId=function(){return Dn.current.useId()};Me.useImperativeHandle=function(t,e,n){return Dn.current.useImperativeHandle(t,e,n)};Me.useInsertionEffect=function(t,e){return Dn.current.useInsertionEffect(t,e)};Me.useLayoutEffect=function(t,e){return Dn.current.useLayoutEffect(t,e)};Me.useMemo=function(t,e){return Dn.current.useMemo(t,e)};Me.useReducer=function(t,e,n){return Dn.current.useReducer(t,e,n)};Me.useRef=function(t){return Dn.current.useRef(t)};Me.useState=function(t){return Dn.current.useState(t)};Me.useSyncExternalStore=function(t,e,n){return Dn.current.useSyncExternalStore(t,e,n)};Me.useTransition=function(){return Dn.current.useTransition()};Me.version="18.3.1";SA.exports=Me;var j=SA.exports;const OA=$V(j),WV=kV({__proto__:null,default:OA},[j]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HV=j,qV=Symbol.for("react.element"),GV=Symbol.for("react.fragment"),KV=Object.prototype.hasOwnProperty,YV=HV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,QV={key:!0,ref:!0,__self:!0,__source:!0};function DA(t,e,n){var r,i={},s=null,a=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)KV.call(e,r)&&!QV.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:qV,type:t,key:s,ref:a,props:i,_owner:YV.current}}Jm.Fragment=GV;Jm.jsx=DA;Jm.jsxs=DA;EA.exports=Jm;var P=EA.exports,h0={},MA={exports:{}},lr={},LA={exports:{}},zA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ee,Y){var J=ee.length;ee.push(Y);e:for(;0<J;){var G=J-1>>>1,H=ee[G];if(0<i(H,Y))ee[G]=Y,ee[J]=H,J=G;else break e}}function n(ee){return ee.length===0?null:ee[0]}function r(ee){if(ee.length===0)return null;var Y=ee[0],J=ee.pop();if(J!==Y){ee[0]=J;e:for(var G=0,H=ee.length,oe=H>>>1;G<oe;){var ue=2*(G+1)-1,Ne=ee[ue],rt=ue+1,rn=ee[rt];if(0>i(Ne,J))rt<H&&0>i(rn,Ne)?(ee[G]=rn,ee[rt]=J,G=rt):(ee[G]=Ne,ee[ue]=J,G=ue);else if(rt<H&&0>i(rn,J))ee[G]=rn,ee[rt]=J,G=rt;else break e}}return Y}function i(ee,Y){var J=ee.sortIndex-Y.sortIndex;return J!==0?J:ee.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,m=!1,g=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(ee){for(var Y=n(u);Y!==null;){if(Y.callback===null)r(u);else if(Y.startTime<=ee)r(u),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(u)}}function $(ee){if(w=!1,E(ee),!g)if(n(l)!==null)g=!0,ie(R);else{var Y=n(u);Y!==null&&de($,Y.startTime-ee)}}function R(ee,Y){g=!1,w&&(w=!1,v(_),_=-1),m=!0;var J=h;try{for(E(Y),d=n(l);d!==null&&(!(d.expirationTime>Y)||ee&&!L());){var G=d.callback;if(typeof G=="function"){d.callback=null,h=d.priorityLevel;var H=G(d.expirationTime<=Y);Y=t.unstable_now(),typeof H=="function"?d.callback=H:d===n(l)&&r(l),E(Y)}else r(l);d=n(l)}if(d!==null)var oe=!0;else{var ue=n(u);ue!==null&&de($,ue.startTime-Y),oe=!1}return oe}finally{d=null,h=J,m=!1}}var D=!1,k=null,_=-1,A=5,N=-1;function L(){return!(t.unstable_now()-N<A)}function V(){if(k!==null){var ee=t.unstable_now();N=ee;var Y=!0;try{Y=k(!0,ee)}finally{Y?M():(D=!1,k=null)}}else D=!1}var M;if(typeof y=="function")M=function(){y(V)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,Z=B.port2;B.port1.onmessage=V,M=function(){Z.postMessage(null)}}else M=function(){x(V,0)};function ie(ee){k=ee,D||(D=!0,M())}function de(ee,Y){_=x(function(){ee(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ee){ee.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,ie(R))},t.unstable_forceFrameRate=function(ee){0>ee||125<ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<ee?Math.floor(1e3/ee):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(ee){switch(h){case 1:case 2:case 3:var Y=3;break;default:Y=h}var J=h;h=Y;try{return ee()}finally{h=J}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ee,Y){switch(ee){case 1:case 2:case 3:case 4:case 5:break;default:ee=3}var J=h;h=ee;try{return Y()}finally{h=J}},t.unstable_scheduleCallback=function(ee,Y,J){var G=t.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?G+J:G):J=G,ee){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=J+H,ee={id:c++,callback:Y,priorityLevel:ee,startTime:J,expirationTime:H,sortIndex:-1},J>G?(ee.sortIndex=J,e(u,ee),n(l)===null&&ee===n(u)&&(w?(v(_),_=-1):w=!0,de($,J-G))):(ee.sortIndex=H,e(l,ee),g||m||(g=!0,ie(R))),ee},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(ee){var Y=h;return function(){var J=h;h=Y;try{return ee.apply(this,arguments)}finally{h=J}}}})(zA);LA.exports=zA;var XV=LA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JV=j,or=XV;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VA=new Set,$d={};function Ho(t,e){ou(t,e),ou(t+"Capture",e)}function ou(t,e){for($d[t]=e,t=0;t<e.length;t++)VA.add(e[t])}var cs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f0=Object.prototype.hasOwnProperty,ZV=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,x2={},T2={};function eF(t){return f0.call(T2,t)?!0:f0.call(x2,t)?!1:ZV.test(t)?T2[t]=!0:(x2[t]=!0,!1)}function tF(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function nF(t,e,n,r){if(e===null||typeof e>"u"||tF(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mn(t,e,n,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var cn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){cn[t]=new Mn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];cn[e]=new Mn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){cn[t]=new Mn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){cn[t]=new Mn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){cn[t]=new Mn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){cn[t]=new Mn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){cn[t]=new Mn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){cn[t]=new Mn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){cn[t]=new Mn(t,5,!1,t.toLowerCase(),null,!1,!1)});var bv=/[\-:]([a-z])/g;function xv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(bv,xv);cn[e]=new Mn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(bv,xv);cn[e]=new Mn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(bv,xv);cn[e]=new Mn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){cn[t]=new Mn(t,1,!1,t.toLowerCase(),null,!1,!1)});cn.xlinkHref=new Mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){cn[t]=new Mn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Tv(t,e,n,r){var i=cn.hasOwnProperty(e)?cn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nF(e,n,i,r)&&(n=null),r||i===null?eF(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ws=JV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mf=Symbol.for("react.element"),Rl=Symbol.for("react.portal"),Pl=Symbol.for("react.fragment"),Ev=Symbol.for("react.strict_mode"),p0=Symbol.for("react.profiler"),FA=Symbol.for("react.provider"),BA=Symbol.for("react.context"),Sv=Symbol.for("react.forward_ref"),m0=Symbol.for("react.suspense"),g0=Symbol.for("react.suspense_list"),Iv=Symbol.for("react.memo"),Us=Symbol.for("react.lazy"),UA=Symbol.for("react.offscreen"),E2=Symbol.iterator;function hc(t){return t===null||typeof t!="object"?null:(t=E2&&t[E2]||t["@@iterator"],typeof t=="function"?t:null)}var Et=Object.assign,my;function Bc(t){if(my===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);my=e&&e[1]||""}return`
`+my+t}var gy=!1;function yy(t,e){if(!t||gy)return"";gy=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var l=`
`+i[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=a&&0<=o);break}}}finally{gy=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Bc(t):""}function rF(t){switch(t.tag){case 5:return Bc(t.type);case 16:return Bc("Lazy");case 13:return Bc("Suspense");case 19:return Bc("SuspenseList");case 0:case 2:case 15:return t=yy(t.type,!1),t;case 11:return t=yy(t.type.render,!1),t;case 1:return t=yy(t.type,!0),t;default:return""}}function y0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Pl:return"Fragment";case Rl:return"Portal";case p0:return"Profiler";case Ev:return"StrictMode";case m0:return"Suspense";case g0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case BA:return(t.displayName||"Context")+".Consumer";case FA:return(t._context.displayName||"Context")+".Provider";case Sv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Iv:return e=t.displayName||null,e!==null?e:y0(t.type)||"Memo";case Us:e=t._payload,t=t._init;try{return y0(t(e))}catch{}}return null}function iF(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return y0(e);case 8:return e===Ev?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function va(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function jA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function sF(t){var e=jA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function gf(t){t._valueTracker||(t._valueTracker=sF(t))}function WA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=jA(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Up(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _0(t,e){var n=e.checked;return Et({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function S2(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=va(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function HA(t,e){e=e.checked,e!=null&&Tv(t,"checked",e,!1)}function w0(t,e){HA(t,e);var n=va(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?v0(t,e.type,n):e.hasOwnProperty("defaultValue")&&v0(t,e.type,va(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function I2(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function v0(t,e,n){(e!=="number"||Up(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Uc=Array.isArray;function Gl(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+va(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function b0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return Et({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function k2(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ae(92));if(Uc(n)){if(1<n.length)throw Error(ae(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:va(n)}}function qA(t,e){var n=va(e.value),r=va(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function $2(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function GA(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function x0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?GA(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var yf,KA=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(yf=yf||document.createElement("div"),yf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Cd(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var rd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},aF=["Webkit","ms","Moz","O"];Object.keys(rd).forEach(function(t){aF.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),rd[e]=rd[t]})});function YA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||rd.hasOwnProperty(t)&&rd[t]?(""+e).trim():e+"px"}function QA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=YA(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var oF=Et({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function T0(t,e){if(e){if(oF[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function E0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var S0=null;function kv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var I0=null,Kl=null,Yl=null;function C2(t){if(t=gh(t)){if(typeof I0!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=rg(e),I0(t.stateNode,t.type,e))}}function XA(t){Kl?Yl?Yl.push(t):Yl=[t]:Kl=t}function JA(){if(Kl){var t=Kl,e=Yl;if(Yl=Kl=null,C2(t),e)for(t=0;t<e.length;t++)C2(e[t])}}function ZA(t,e){return t(e)}function eR(){}var _y=!1;function tR(t,e,n){if(_y)return t(e,n);_y=!0;try{return ZA(t,e,n)}finally{_y=!1,(Kl!==null||Yl!==null)&&(eR(),JA())}}function Ad(t,e){var n=t.stateNode;if(n===null)return null;var r=rg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ae(231,e,typeof n));return n}var k0=!1;if(cs)try{var fc={};Object.defineProperty(fc,"passive",{get:function(){k0=!0}}),window.addEventListener("test",fc,fc),window.removeEventListener("test",fc,fc)}catch{k0=!1}function lF(t,e,n,r,i,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var id=!1,jp=null,Wp=!1,$0=null,uF={onError:function(t){id=!0,jp=t}};function cF(t,e,n,r,i,s,a,o,l){id=!1,jp=null,lF.apply(uF,arguments)}function dF(t,e,n,r,i,s,a,o,l){if(cF.apply(this,arguments),id){if(id){var u=jp;id=!1,jp=null}else throw Error(ae(198));Wp||(Wp=!0,$0=u)}}function qo(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function nR(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function A2(t){if(qo(t)!==t)throw Error(ae(188))}function hF(t){var e=t.alternate;if(!e){if(e=qo(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return A2(i),t;if(s===r)return A2(i),e;s=s.sibling}throw Error(ae(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===n){a=!0,n=i,r=s;break}if(o===r){a=!0,r=i,n=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===n){a=!0,n=s,r=i;break}if(o===r){a=!0,r=s,n=i;break}o=o.sibling}if(!a)throw Error(ae(189))}}if(n.alternate!==r)throw Error(ae(190))}if(n.tag!==3)throw Error(ae(188));return n.stateNode.current===n?t:e}function rR(t){return t=hF(t),t!==null?iR(t):null}function iR(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=iR(t);if(e!==null)return e;t=t.sibling}return null}var sR=or.unstable_scheduleCallback,R2=or.unstable_cancelCallback,fF=or.unstable_shouldYield,pF=or.unstable_requestPaint,Dt=or.unstable_now,mF=or.unstable_getCurrentPriorityLevel,$v=or.unstable_ImmediatePriority,aR=or.unstable_UserBlockingPriority,Hp=or.unstable_NormalPriority,gF=or.unstable_LowPriority,oR=or.unstable_IdlePriority,Zm=null,Si=null;function yF(t){if(Si&&typeof Si.onCommitFiberRoot=="function")try{Si.onCommitFiberRoot(Zm,t,void 0,(t.current.flags&128)===128)}catch{}}var Hr=Math.clz32?Math.clz32:vF,_F=Math.log,wF=Math.LN2;function vF(t){return t>>>=0,t===0?32:31-(_F(t)/wF|0)|0}var _f=64,wf=4194304;function jc(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function qp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,a=n&268435455;if(a!==0){var o=a&~i;o!==0?r=jc(o):(s&=a,s!==0&&(r=jc(s)))}else a=n&~i,a!==0?r=jc(a):s!==0&&(r=jc(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Hr(e),i=1<<n,r|=t[n],e&=~i;return r}function bF(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xF(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-Hr(s),o=1<<a,l=i[a];l===-1?(!(o&n)||o&r)&&(i[a]=bF(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}}function C0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function lR(){var t=_f;return _f<<=1,!(_f&4194240)&&(_f=64),t}function wy(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ph(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Hr(e),t[e]=n}function TF(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Hr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Cv(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Hr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var nt=0;function uR(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var cR,Av,dR,hR,fR,A0=!1,vf=[],sa=null,aa=null,oa=null,Rd=new Map,Pd=new Map,Ws=[],EF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function P2(t,e){switch(t){case"focusin":case"focusout":sa=null;break;case"dragenter":case"dragleave":aa=null;break;case"mouseover":case"mouseout":oa=null;break;case"pointerover":case"pointerout":Rd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pd.delete(e.pointerId)}}function pc(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=gh(e),e!==null&&Av(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function SF(t,e,n,r,i){switch(e){case"focusin":return sa=pc(sa,t,e,n,r,i),!0;case"dragenter":return aa=pc(aa,t,e,n,r,i),!0;case"mouseover":return oa=pc(oa,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Rd.set(s,pc(Rd.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Pd.set(s,pc(Pd.get(s)||null,t,e,n,r,i)),!0}return!1}function pR(t){var e=yo(t.target);if(e!==null){var n=qo(e);if(n!==null){if(e=n.tag,e===13){if(e=nR(n),e!==null){t.blockedOn=e,fR(t.priority,function(){dR(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function mp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=R0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);S0=r,n.target.dispatchEvent(r),S0=null}else return e=gh(n),e!==null&&Av(e),t.blockedOn=n,!1;e.shift()}return!0}function N2(t,e,n){mp(t)&&n.delete(e)}function IF(){A0=!1,sa!==null&&mp(sa)&&(sa=null),aa!==null&&mp(aa)&&(aa=null),oa!==null&&mp(oa)&&(oa=null),Rd.forEach(N2),Pd.forEach(N2)}function mc(t,e){t.blockedOn===e&&(t.blockedOn=null,A0||(A0=!0,or.unstable_scheduleCallback(or.unstable_NormalPriority,IF)))}function Nd(t){function e(i){return mc(i,t)}if(0<vf.length){mc(vf[0],t);for(var n=1;n<vf.length;n++){var r=vf[n];r.blockedOn===t&&(r.blockedOn=null)}}for(sa!==null&&mc(sa,t),aa!==null&&mc(aa,t),oa!==null&&mc(oa,t),Rd.forEach(e),Pd.forEach(e),n=0;n<Ws.length;n++)r=Ws[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ws.length&&(n=Ws[0],n.blockedOn===null);)pR(n),n.blockedOn===null&&Ws.shift()}var Ql=ws.ReactCurrentBatchConfig,Gp=!0;function kF(t,e,n,r){var i=nt,s=Ql.transition;Ql.transition=null;try{nt=1,Rv(t,e,n,r)}finally{nt=i,Ql.transition=s}}function $F(t,e,n,r){var i=nt,s=Ql.transition;Ql.transition=null;try{nt=4,Rv(t,e,n,r)}finally{nt=i,Ql.transition=s}}function Rv(t,e,n,r){if(Gp){var i=R0(t,e,n,r);if(i===null)Cy(t,e,r,Kp,n),P2(t,r);else if(SF(i,t,e,n,r))r.stopPropagation();else if(P2(t,r),e&4&&-1<EF.indexOf(t)){for(;i!==null;){var s=gh(i);if(s!==null&&cR(s),s=R0(t,e,n,r),s===null&&Cy(t,e,r,Kp,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Cy(t,e,r,null,n)}}var Kp=null;function R0(t,e,n,r){if(Kp=null,t=kv(r),t=yo(t),t!==null)if(e=qo(t),e===null)t=null;else if(n=e.tag,n===13){if(t=nR(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Kp=t,null}function mR(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mF()){case $v:return 1;case aR:return 4;case Hp:case gF:return 16;case oR:return 536870912;default:return 16}default:return 16}}var Xs=null,Pv=null,gp=null;function gR(){if(gp)return gp;var t,e=Pv,n=e.length,r,i="value"in Xs?Xs.value:Xs.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===i[s-r];r++);return gp=i.slice(t,1<r?1-r:void 0)}function yp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function bf(){return!0}function O2(){return!1}function ur(t){function e(n,r,i,s,a){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bf:O2,this.isPropagationStopped=O2,this}return Et(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=bf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=bf)},persist:function(){},isPersistent:bf}),e}var $u={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nv=ur($u),mh=Et({},$u,{view:0,detail:0}),CF=ur(mh),vy,by,gc,eg=Et({},mh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ov,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==gc&&(gc&&t.type==="mousemove"?(vy=t.screenX-gc.screenX,by=t.screenY-gc.screenY):by=vy=0,gc=t),vy)},movementY:function(t){return"movementY"in t?t.movementY:by}}),D2=ur(eg),AF=Et({},eg,{dataTransfer:0}),RF=ur(AF),PF=Et({},mh,{relatedTarget:0}),xy=ur(PF),NF=Et({},$u,{animationName:0,elapsedTime:0,pseudoElement:0}),OF=ur(NF),DF=Et({},$u,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),MF=ur(DF),LF=Et({},$u,{data:0}),M2=ur(LF),zF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function BF(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=FF[t])?!!e[t]:!1}function Ov(){return BF}var UF=Et({},mh,{key:function(t){if(t.key){var e=zF[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=yp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?VF[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ov,charCode:function(t){return t.type==="keypress"?yp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?yp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),jF=ur(UF),WF=Et({},eg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),L2=ur(WF),HF=Et({},mh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ov}),qF=ur(HF),GF=Et({},$u,{propertyName:0,elapsedTime:0,pseudoElement:0}),KF=ur(GF),YF=Et({},eg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),QF=ur(YF),XF=[9,13,27,32],Dv=cs&&"CompositionEvent"in window,sd=null;cs&&"documentMode"in document&&(sd=document.documentMode);var JF=cs&&"TextEvent"in window&&!sd,yR=cs&&(!Dv||sd&&8<sd&&11>=sd),z2=" ",V2=!1;function _R(t,e){switch(t){case"keyup":return XF.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wR(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Nl=!1;function ZF(t,e){switch(t){case"compositionend":return wR(e);case"keypress":return e.which!==32?null:(V2=!0,z2);case"textInput":return t=e.data,t===z2&&V2?null:t;default:return null}}function eB(t,e){if(Nl)return t==="compositionend"||!Dv&&_R(t,e)?(t=gR(),gp=Pv=Xs=null,Nl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yR&&e.locale!=="ko"?null:e.data;default:return null}}var tB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function F2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tB[t.type]:e==="textarea"}function vR(t,e,n,r){XA(r),e=Yp(e,"onChange"),0<e.length&&(n=new Nv("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var ad=null,Od=null;function nB(t){RR(t,0)}function tg(t){var e=Ml(t);if(WA(e))return t}function rB(t,e){if(t==="change")return e}var bR=!1;if(cs){var Ty;if(cs){var Ey="oninput"in document;if(!Ey){var B2=document.createElement("div");B2.setAttribute("oninput","return;"),Ey=typeof B2.oninput=="function"}Ty=Ey}else Ty=!1;bR=Ty&&(!document.documentMode||9<document.documentMode)}function U2(){ad&&(ad.detachEvent("onpropertychange",xR),Od=ad=null)}function xR(t){if(t.propertyName==="value"&&tg(Od)){var e=[];vR(e,Od,t,kv(t)),tR(nB,e)}}function iB(t,e,n){t==="focusin"?(U2(),ad=e,Od=n,ad.attachEvent("onpropertychange",xR)):t==="focusout"&&U2()}function sB(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return tg(Od)}function aB(t,e){if(t==="click")return tg(e)}function oB(t,e){if(t==="input"||t==="change")return tg(e)}function lB(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Qr=typeof Object.is=="function"?Object.is:lB;function Dd(t,e){if(Qr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!f0.call(e,i)||!Qr(t[i],e[i]))return!1}return!0}function j2(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function W2(t,e){var n=j2(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=j2(n)}}function TR(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?TR(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function ER(){for(var t=window,e=Up();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Up(t.document)}return e}function Mv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function uB(t){var e=ER(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&TR(n.ownerDocument.documentElement,n)){if(r!==null&&Mv(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=W2(n,s);var a=W2(n,r);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var cB=cs&&"documentMode"in document&&11>=document.documentMode,Ol=null,P0=null,od=null,N0=!1;function H2(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;N0||Ol==null||Ol!==Up(r)||(r=Ol,"selectionStart"in r&&Mv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),od&&Dd(od,r)||(od=r,r=Yp(P0,"onSelect"),0<r.length&&(e=new Nv("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ol)))}function xf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Dl={animationend:xf("Animation","AnimationEnd"),animationiteration:xf("Animation","AnimationIteration"),animationstart:xf("Animation","AnimationStart"),transitionend:xf("Transition","TransitionEnd")},Sy={},SR={};cs&&(SR=document.createElement("div").style,"AnimationEvent"in window||(delete Dl.animationend.animation,delete Dl.animationiteration.animation,delete Dl.animationstart.animation),"TransitionEvent"in window||delete Dl.transitionend.transition);function ng(t){if(Sy[t])return Sy[t];if(!Dl[t])return t;var e=Dl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in SR)return Sy[t]=e[n];return t}var IR=ng("animationend"),kR=ng("animationiteration"),$R=ng("animationstart"),CR=ng("transitionend"),AR=new Map,q2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pa(t,e){AR.set(t,e),Ho(e,[t])}for(var Iy=0;Iy<q2.length;Iy++){var ky=q2[Iy],dB=ky.toLowerCase(),hB=ky[0].toUpperCase()+ky.slice(1);Pa(dB,"on"+hB)}Pa(IR,"onAnimationEnd");Pa(kR,"onAnimationIteration");Pa($R,"onAnimationStart");Pa("dblclick","onDoubleClick");Pa("focusin","onFocus");Pa("focusout","onBlur");Pa(CR,"onTransitionEnd");ou("onMouseEnter",["mouseout","mouseover"]);ou("onMouseLeave",["mouseout","mouseover"]);ou("onPointerEnter",["pointerout","pointerover"]);ou("onPointerLeave",["pointerout","pointerover"]);Ho("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ho("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ho("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ho("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ho("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ho("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fB=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wc));function G2(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,dF(r,e,void 0,t),t.currentTarget=null}function RR(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;G2(i,o,u),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;G2(i,o,u),s=l}}}if(Wp)throw t=$0,Wp=!1,$0=null,t}function ht(t,e){var n=e[z0];n===void 0&&(n=e[z0]=new Set);var r=t+"__bubble";n.has(r)||(PR(e,t,2,!1),n.add(r))}function $y(t,e,n){var r=0;e&&(r|=4),PR(n,t,r,e)}var Tf="_reactListening"+Math.random().toString(36).slice(2);function Md(t){if(!t[Tf]){t[Tf]=!0,VA.forEach(function(n){n!=="selectionchange"&&(fB.has(n)||$y(n,!1,t),$y(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Tf]||(e[Tf]=!0,$y("selectionchange",!1,e))}}function PR(t,e,n,r){switch(mR(e)){case 1:var i=kF;break;case 4:i=$F;break;default:i=Rv}n=i.bind(null,e,n,t),i=void 0,!k0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Cy(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;a=a.return}for(;o!==null;){if(a=yo(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}tR(function(){var u=s,c=kv(n),d=[];e:{var h=AR.get(t);if(h!==void 0){var m=Nv,g=t;switch(t){case"keypress":if(yp(n)===0)break e;case"keydown":case"keyup":m=jF;break;case"focusin":g="focus",m=xy;break;case"focusout":g="blur",m=xy;break;case"beforeblur":case"afterblur":m=xy;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=D2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=RF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=qF;break;case IR:case kR:case $R:m=OF;break;case CR:m=KF;break;case"scroll":m=CF;break;case"wheel":m=QF;break;case"copy":case"cut":case"paste":m=MF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=L2}var w=(e&4)!==0,x=!w&&t==="scroll",v=w?h!==null?h+"Capture":null:h;w=[];for(var y=u,E;y!==null;){E=y;var $=E.stateNode;if(E.tag===5&&$!==null&&(E=$,v!==null&&($=Ad(y,v),$!=null&&w.push(Ld(y,$,E)))),x)break;y=y.return}0<w.length&&(h=new m(h,g,null,n,c),d.push({event:h,listeners:w}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",h&&n!==S0&&(g=n.relatedTarget||n.fromElement)&&(yo(g)||g[ds]))break e;if((m||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,m?(g=n.relatedTarget||n.toElement,m=u,g=g?yo(g):null,g!==null&&(x=qo(g),g!==x||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=u),m!==g)){if(w=D2,$="onMouseLeave",v="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(w=L2,$="onPointerLeave",v="onPointerEnter",y="pointer"),x=m==null?h:Ml(m),E=g==null?h:Ml(g),h=new w($,y+"leave",m,n,c),h.target=x,h.relatedTarget=E,$=null,yo(c)===u&&(w=new w(v,y+"enter",g,n,c),w.target=E,w.relatedTarget=x,$=w),x=$,m&&g)t:{for(w=m,v=g,y=0,E=w;E;E=bl(E))y++;for(E=0,$=v;$;$=bl($))E++;for(;0<y-E;)w=bl(w),y--;for(;0<E-y;)v=bl(v),E--;for(;y--;){if(w===v||v!==null&&w===v.alternate)break t;w=bl(w),v=bl(v)}w=null}else w=null;m!==null&&K2(d,h,m,w,!1),g!==null&&x!==null&&K2(d,x,g,w,!0)}}e:{if(h=u?Ml(u):window,m=h.nodeName&&h.nodeName.toLowerCase(),m==="select"||m==="input"&&h.type==="file")var R=rB;else if(F2(h))if(bR)R=oB;else{R=sB;var D=iB}else(m=h.nodeName)&&m.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(R=aB);if(R&&(R=R(t,u))){vR(d,R,n,c);break e}D&&D(t,h,u),t==="focusout"&&(D=h._wrapperState)&&D.controlled&&h.type==="number"&&v0(h,"number",h.value)}switch(D=u?Ml(u):window,t){case"focusin":(F2(D)||D.contentEditable==="true")&&(Ol=D,P0=u,od=null);break;case"focusout":od=P0=Ol=null;break;case"mousedown":N0=!0;break;case"contextmenu":case"mouseup":case"dragend":N0=!1,H2(d,n,c);break;case"selectionchange":if(cB)break;case"keydown":case"keyup":H2(d,n,c)}var k;if(Dv)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Nl?_R(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(yR&&n.locale!=="ko"&&(Nl||_!=="onCompositionStart"?_==="onCompositionEnd"&&Nl&&(k=gR()):(Xs=c,Pv="value"in Xs?Xs.value:Xs.textContent,Nl=!0)),D=Yp(u,_),0<D.length&&(_=new M2(_,t,null,n,c),d.push({event:_,listeners:D}),k?_.data=k:(k=wR(n),k!==null&&(_.data=k)))),(k=JF?ZF(t,n):eB(t,n))&&(u=Yp(u,"onBeforeInput"),0<u.length&&(c=new M2("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=k))}RR(d,e)})}function Ld(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Yp(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Ad(t,n),s!=null&&r.unshift(Ld(t,s,i)),s=Ad(t,e),s!=null&&r.push(Ld(t,s,i))),t=t.return}return r}function bl(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function K2(t,e,n,r,i){for(var s=e._reactName,a=[];n!==null&&n!==r;){var o=n,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,i?(l=Ad(n,s),l!=null&&a.unshift(Ld(n,l,o))):i||(l=Ad(n,s),l!=null&&a.push(Ld(n,l,o)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var pB=/\r\n?/g,mB=/\u0000|\uFFFD/g;function Y2(t){return(typeof t=="string"?t:""+t).replace(pB,`
`).replace(mB,"")}function Ef(t,e,n){if(e=Y2(e),Y2(t)!==e&&n)throw Error(ae(425))}function Qp(){}var O0=null,D0=null;function M0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var L0=typeof setTimeout=="function"?setTimeout:void 0,gB=typeof clearTimeout=="function"?clearTimeout:void 0,Q2=typeof Promise=="function"?Promise:void 0,yB=typeof queueMicrotask=="function"?queueMicrotask:typeof Q2<"u"?function(t){return Q2.resolve(null).then(t).catch(_B)}:L0;function _B(t){setTimeout(function(){throw t})}function Ay(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Nd(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Nd(e)}function la(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function X2(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Cu=Math.random().toString(36).slice(2),bi="__reactFiber$"+Cu,zd="__reactProps$"+Cu,ds="__reactContainer$"+Cu,z0="__reactEvents$"+Cu,wB="__reactListeners$"+Cu,vB="__reactHandles$"+Cu;function yo(t){var e=t[bi];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ds]||n[bi]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=X2(t);t!==null;){if(n=t[bi])return n;t=X2(t)}return e}t=n,n=t.parentNode}return null}function gh(t){return t=t[bi]||t[ds],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ml(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function rg(t){return t[zd]||null}var V0=[],Ll=-1;function Na(t){return{current:t}}function mt(t){0>Ll||(t.current=V0[Ll],V0[Ll]=null,Ll--)}function ct(t,e){Ll++,V0[Ll]=t.current,t.current=e}var ba={},bn=Na(ba),Gn=Na(!1),Co=ba;function lu(t,e){var n=t.type.contextTypes;if(!n)return ba;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Kn(t){return t=t.childContextTypes,t!=null}function Xp(){mt(Gn),mt(bn)}function J2(t,e,n){if(bn.current!==ba)throw Error(ae(168));ct(bn,e),ct(Gn,n)}function NR(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(ae(108,iF(t)||"Unknown",i));return Et({},n,r)}function Jp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ba,Co=bn.current,ct(bn,t),ct(Gn,Gn.current),!0}function Z2(t,e,n){var r=t.stateNode;if(!r)throw Error(ae(169));n?(t=NR(t,e,Co),r.__reactInternalMemoizedMergedChildContext=t,mt(Gn),mt(bn),ct(bn,t)):mt(Gn),ct(Gn,n)}var ns=null,ig=!1,Ry=!1;function OR(t){ns===null?ns=[t]:ns.push(t)}function bB(t){ig=!0,OR(t)}function Oa(){if(!Ry&&ns!==null){Ry=!0;var t=0,e=nt;try{var n=ns;for(nt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ns=null,ig=!1}catch(i){throw ns!==null&&(ns=ns.slice(t+1)),sR($v,Oa),i}finally{nt=e,Ry=!1}}return null}var zl=[],Vl=0,Zp=null,em=0,fr=[],pr=0,Ao=null,ss=1,as="";function oo(t,e){zl[Vl++]=em,zl[Vl++]=Zp,Zp=t,em=e}function DR(t,e,n){fr[pr++]=ss,fr[pr++]=as,fr[pr++]=Ao,Ao=t;var r=ss;t=as;var i=32-Hr(r)-1;r&=~(1<<i),n+=1;var s=32-Hr(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,ss=1<<32-Hr(e)+i|n<<i|r,as=s+t}else ss=1<<s|n<<i|r,as=t}function Lv(t){t.return!==null&&(oo(t,1),DR(t,1,0))}function zv(t){for(;t===Zp;)Zp=zl[--Vl],zl[Vl]=null,em=zl[--Vl],zl[Vl]=null;for(;t===Ao;)Ao=fr[--pr],fr[pr]=null,as=fr[--pr],fr[pr]=null,ss=fr[--pr],fr[pr]=null}var ir=null,rr=null,gt=!1,Fr=null;function MR(t,e){var n=_r(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function eT(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ir=t,rr=la(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ir=t,rr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ao!==null?{id:ss,overflow:as}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_r(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ir=t,rr=null,!0):!1;default:return!1}}function F0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function B0(t){if(gt){var e=rr;if(e){var n=e;if(!eT(t,e)){if(F0(t))throw Error(ae(418));e=la(n.nextSibling);var r=ir;e&&eT(t,e)?MR(r,n):(t.flags=t.flags&-4097|2,gt=!1,ir=t)}}else{if(F0(t))throw Error(ae(418));t.flags=t.flags&-4097|2,gt=!1,ir=t}}}function tT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ir=t}function Sf(t){if(t!==ir)return!1;if(!gt)return tT(t),gt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!M0(t.type,t.memoizedProps)),e&&(e=rr)){if(F0(t))throw LR(),Error(ae(418));for(;e;)MR(t,e),e=la(e.nextSibling)}if(tT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){rr=la(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}rr=null}}else rr=ir?la(t.stateNode.nextSibling):null;return!0}function LR(){for(var t=rr;t;)t=la(t.nextSibling)}function uu(){rr=ir=null,gt=!1}function Vv(t){Fr===null?Fr=[t]:Fr.push(t)}var xB=ws.ReactCurrentBatchConfig;function yc(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ae(309));var r=n.stateNode}if(!r)throw Error(ae(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof t!="string")throw Error(ae(284));if(!n._owner)throw Error(ae(290,t))}return t}function If(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function nT(t){var e=t._init;return e(t._payload)}function zR(t){function e(v,y){if(t){var E=v.deletions;E===null?(v.deletions=[y],v.flags|=16):E.push(y)}}function n(v,y){if(!t)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function i(v,y){return v=ha(v,y),v.index=0,v.sibling=null,v}function s(v,y,E){return v.index=E,t?(E=v.alternate,E!==null?(E=E.index,E<y?(v.flags|=2,y):E):(v.flags|=2,y)):(v.flags|=1048576,y)}function a(v){return t&&v.alternate===null&&(v.flags|=2),v}function o(v,y,E,$){return y===null||y.tag!==6?(y=zy(E,v.mode,$),y.return=v,y):(y=i(y,E),y.return=v,y)}function l(v,y,E,$){var R=E.type;return R===Pl?c(v,y,E.props.children,$,E.key):y!==null&&(y.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Us&&nT(R)===y.type)?($=i(y,E.props),$.ref=yc(v,y,E),$.return=v,$):($=Ep(E.type,E.key,E.props,null,v.mode,$),$.ref=yc(v,y,E),$.return=v,$)}function u(v,y,E,$){return y===null||y.tag!==4||y.stateNode.containerInfo!==E.containerInfo||y.stateNode.implementation!==E.implementation?(y=Vy(E,v.mode,$),y.return=v,y):(y=i(y,E.children||[]),y.return=v,y)}function c(v,y,E,$,R){return y===null||y.tag!==7?(y=Eo(E,v.mode,$,R),y.return=v,y):(y=i(y,E),y.return=v,y)}function d(v,y,E){if(typeof y=="string"&&y!==""||typeof y=="number")return y=zy(""+y,v.mode,E),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case mf:return E=Ep(y.type,y.key,y.props,null,v.mode,E),E.ref=yc(v,null,y),E.return=v,E;case Rl:return y=Vy(y,v.mode,E),y.return=v,y;case Us:var $=y._init;return d(v,$(y._payload),E)}if(Uc(y)||hc(y))return y=Eo(y,v.mode,E,null),y.return=v,y;If(v,y)}return null}function h(v,y,E,$){var R=y!==null?y.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return R!==null?null:o(v,y,""+E,$);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case mf:return E.key===R?l(v,y,E,$):null;case Rl:return E.key===R?u(v,y,E,$):null;case Us:return R=E._init,h(v,y,R(E._payload),$)}if(Uc(E)||hc(E))return R!==null?null:c(v,y,E,$,null);If(v,E)}return null}function m(v,y,E,$,R){if(typeof $=="string"&&$!==""||typeof $=="number")return v=v.get(E)||null,o(y,v,""+$,R);if(typeof $=="object"&&$!==null){switch($.$$typeof){case mf:return v=v.get($.key===null?E:$.key)||null,l(y,v,$,R);case Rl:return v=v.get($.key===null?E:$.key)||null,u(y,v,$,R);case Us:var D=$._init;return m(v,y,E,D($._payload),R)}if(Uc($)||hc($))return v=v.get(E)||null,c(y,v,$,R,null);If(y,$)}return null}function g(v,y,E,$){for(var R=null,D=null,k=y,_=y=0,A=null;k!==null&&_<E.length;_++){k.index>_?(A=k,k=null):A=k.sibling;var N=h(v,k,E[_],$);if(N===null){k===null&&(k=A);break}t&&k&&N.alternate===null&&e(v,k),y=s(N,y,_),D===null?R=N:D.sibling=N,D=N,k=A}if(_===E.length)return n(v,k),gt&&oo(v,_),R;if(k===null){for(;_<E.length;_++)k=d(v,E[_],$),k!==null&&(y=s(k,y,_),D===null?R=k:D.sibling=k,D=k);return gt&&oo(v,_),R}for(k=r(v,k);_<E.length;_++)A=m(k,v,_,E[_],$),A!==null&&(t&&A.alternate!==null&&k.delete(A.key===null?_:A.key),y=s(A,y,_),D===null?R=A:D.sibling=A,D=A);return t&&k.forEach(function(L){return e(v,L)}),gt&&oo(v,_),R}function w(v,y,E,$){var R=hc(E);if(typeof R!="function")throw Error(ae(150));if(E=R.call(E),E==null)throw Error(ae(151));for(var D=R=null,k=y,_=y=0,A=null,N=E.next();k!==null&&!N.done;_++,N=E.next()){k.index>_?(A=k,k=null):A=k.sibling;var L=h(v,k,N.value,$);if(L===null){k===null&&(k=A);break}t&&k&&L.alternate===null&&e(v,k),y=s(L,y,_),D===null?R=L:D.sibling=L,D=L,k=A}if(N.done)return n(v,k),gt&&oo(v,_),R;if(k===null){for(;!N.done;_++,N=E.next())N=d(v,N.value,$),N!==null&&(y=s(N,y,_),D===null?R=N:D.sibling=N,D=N);return gt&&oo(v,_),R}for(k=r(v,k);!N.done;_++,N=E.next())N=m(k,v,_,N.value,$),N!==null&&(t&&N.alternate!==null&&k.delete(N.key===null?_:N.key),y=s(N,y,_),D===null?R=N:D.sibling=N,D=N);return t&&k.forEach(function(V){return e(v,V)}),gt&&oo(v,_),R}function x(v,y,E,$){if(typeof E=="object"&&E!==null&&E.type===Pl&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case mf:e:{for(var R=E.key,D=y;D!==null;){if(D.key===R){if(R=E.type,R===Pl){if(D.tag===7){n(v,D.sibling),y=i(D,E.props.children),y.return=v,v=y;break e}}else if(D.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Us&&nT(R)===D.type){n(v,D.sibling),y=i(D,E.props),y.ref=yc(v,D,E),y.return=v,v=y;break e}n(v,D);break}else e(v,D);D=D.sibling}E.type===Pl?(y=Eo(E.props.children,v.mode,$,E.key),y.return=v,v=y):($=Ep(E.type,E.key,E.props,null,v.mode,$),$.ref=yc(v,y,E),$.return=v,v=$)}return a(v);case Rl:e:{for(D=E.key;y!==null;){if(y.key===D)if(y.tag===4&&y.stateNode.containerInfo===E.containerInfo&&y.stateNode.implementation===E.implementation){n(v,y.sibling),y=i(y,E.children||[]),y.return=v,v=y;break e}else{n(v,y);break}else e(v,y);y=y.sibling}y=Vy(E,v.mode,$),y.return=v,v=y}return a(v);case Us:return D=E._init,x(v,y,D(E._payload),$)}if(Uc(E))return g(v,y,E,$);if(hc(E))return w(v,y,E,$);If(v,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,y!==null&&y.tag===6?(n(v,y.sibling),y=i(y,E),y.return=v,v=y):(n(v,y),y=zy(E,v.mode,$),y.return=v,v=y),a(v)):n(v,y)}return x}var cu=zR(!0),VR=zR(!1),tm=Na(null),nm=null,Fl=null,Fv=null;function Bv(){Fv=Fl=nm=null}function Uv(t){var e=tm.current;mt(tm),t._currentValue=e}function U0(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Xl(t,e){nm=t,Fv=Fl=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Hn=!0),t.firstContext=null)}function br(t){var e=t._currentValue;if(Fv!==t)if(t={context:t,memoizedValue:e,next:null},Fl===null){if(nm===null)throw Error(ae(308));Fl=t,nm.dependencies={lanes:0,firstContext:t}}else Fl=Fl.next=t;return e}var _o=null;function jv(t){_o===null?_o=[t]:_o.push(t)}function FR(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,jv(e)):(n.next=i.next,i.next=n),e.interleaved=n,hs(t,r)}function hs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var js=!1;function Wv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BR(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function us(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ua(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,He&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,hs(t,n)}return i=r.interleaved,i===null?(e.next=e,jv(r)):(e.next=i.next,i.next=e),r.interleaved=e,hs(t,n)}function _p(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Cv(t,n)}}function rT(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=a:s=s.next=a,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function rm(t,e,n,r){var i=t.updateQueue;js=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;a=0,c=u=l=null,o=s;do{var h=o.lane,m=o.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=t,w=o;switch(h=e,m=n,w.tag){case 1:if(g=w.payload,typeof g=="function"){d=g.call(m,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=w.payload,h=typeof g=="function"?g.call(m,d,h):g,h==null)break e;d=Et({},d,h);break e;case 2:js=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[o]:h.push(o))}else m={eventTime:m,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=m,l=d):c=c.next=m,a|=h;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;h=o,o=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Po|=a,t.lanes=a,t.memoizedState=d}}function iT(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(ae(191,i));i.call(r)}}}var yh={},Ii=Na(yh),Vd=Na(yh),Fd=Na(yh);function wo(t){if(t===yh)throw Error(ae(174));return t}function Hv(t,e){switch(ct(Fd,e),ct(Vd,t),ct(Ii,yh),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:x0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=x0(e,t)}mt(Ii),ct(Ii,e)}function du(){mt(Ii),mt(Vd),mt(Fd)}function UR(t){wo(Fd.current);var e=wo(Ii.current),n=x0(e,t.type);e!==n&&(ct(Vd,t),ct(Ii,n))}function qv(t){Vd.current===t&&(mt(Ii),mt(Vd))}var wt=Na(0);function im(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Py=[];function Gv(){for(var t=0;t<Py.length;t++)Py[t]._workInProgressVersionPrimary=null;Py.length=0}var wp=ws.ReactCurrentDispatcher,Ny=ws.ReactCurrentBatchConfig,Ro=0,xt=null,Ht=null,en=null,sm=!1,ld=!1,Bd=0,TB=0;function fn(){throw Error(ae(321))}function Kv(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Qr(t[n],e[n]))return!1;return!0}function Yv(t,e,n,r,i,s){if(Ro=s,xt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,wp.current=t===null||t.memoizedState===null?kB:$B,t=n(r,i),ld){s=0;do{if(ld=!1,Bd=0,25<=s)throw Error(ae(301));s+=1,en=Ht=null,e.updateQueue=null,wp.current=CB,t=n(r,i)}while(ld)}if(wp.current=am,e=Ht!==null&&Ht.next!==null,Ro=0,en=Ht=xt=null,sm=!1,e)throw Error(ae(300));return t}function Qv(){var t=Bd!==0;return Bd=0,t}function yi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?xt.memoizedState=en=t:en=en.next=t,en}function xr(){if(Ht===null){var t=xt.alternate;t=t!==null?t.memoizedState:null}else t=Ht.next;var e=en===null?xt.memoizedState:en.next;if(e!==null)en=e,Ht=t;else{if(t===null)throw Error(ae(310));Ht=t,t={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},en===null?xt.memoizedState=en=t:en=en.next=t}return en}function Ud(t,e){return typeof e=="function"?e(t):e}function Oy(t){var e=xr(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var r=Ht,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var o=a=null,l=null,u=s;do{var c=u.lane;if((Ro&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,xt.lanes|=c,Po|=c}u=u.next}while(u!==null&&u!==s);l===null?a=r:l.next=o,Qr(r,e.memoizedState)||(Hn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,xt.lanes|=s,Po|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Dy(t){var e=xr(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var a=i=i.next;do s=t(s,a.action),a=a.next;while(a!==i);Qr(s,e.memoizedState)||(Hn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function jR(){}function WR(t,e){var n=xt,r=xr(),i=e(),s=!Qr(r.memoizedState,i);if(s&&(r.memoizedState=i,Hn=!0),r=r.queue,Xv(GR.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||en!==null&&en.memoizedState.tag&1){if(n.flags|=2048,jd(9,qR.bind(null,n,r,i,e),void 0,null),nn===null)throw Error(ae(349));Ro&30||HR(n,e,i)}return i}function HR(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=xt.updateQueue,e===null?(e={lastEffect:null,stores:null},xt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function qR(t,e,n,r){e.value=n,e.getSnapshot=r,KR(e)&&YR(t)}function GR(t,e,n){return n(function(){KR(e)&&YR(t)})}function KR(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Qr(t,n)}catch{return!0}}function YR(t){var e=hs(t,1);e!==null&&qr(e,t,1,-1)}function sT(t){var e=yi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ud,lastRenderedState:t},e.queue=t,t=t.dispatch=IB.bind(null,xt,t),[e.memoizedState,t]}function jd(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=xt.updateQueue,e===null?(e={lastEffect:null,stores:null},xt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function QR(){return xr().memoizedState}function vp(t,e,n,r){var i=yi();xt.flags|=t,i.memoizedState=jd(1|e,n,void 0,r===void 0?null:r)}function sg(t,e,n,r){var i=xr();r=r===void 0?null:r;var s=void 0;if(Ht!==null){var a=Ht.memoizedState;if(s=a.destroy,r!==null&&Kv(r,a.deps)){i.memoizedState=jd(e,n,s,r);return}}xt.flags|=t,i.memoizedState=jd(1|e,n,s,r)}function aT(t,e){return vp(8390656,8,t,e)}function Xv(t,e){return sg(2048,8,t,e)}function XR(t,e){return sg(4,2,t,e)}function JR(t,e){return sg(4,4,t,e)}function ZR(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function eP(t,e,n){return n=n!=null?n.concat([t]):null,sg(4,4,ZR.bind(null,e,t),n)}function Jv(){}function tP(t,e){var n=xr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Kv(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function nP(t,e){var n=xr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Kv(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function rP(t,e,n){return Ro&21?(Qr(n,e)||(n=lR(),xt.lanes|=n,Po|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Hn=!0),t.memoizedState=n)}function EB(t,e){var n=nt;nt=n!==0&&4>n?n:4,t(!0);var r=Ny.transition;Ny.transition={};try{t(!1),e()}finally{nt=n,Ny.transition=r}}function iP(){return xr().memoizedState}function SB(t,e,n){var r=da(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},sP(t))aP(e,n);else if(n=FR(t,e,n,r),n!==null){var i=On();qr(n,t,r,i),oP(n,e,r)}}function IB(t,e,n){var r=da(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(sP(t))aP(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,Qr(o,a)){var l=e.interleaved;l===null?(i.next=i,jv(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=FR(t,e,i,r),n!==null&&(i=On(),qr(n,t,r,i),oP(n,e,r))}}function sP(t){var e=t.alternate;return t===xt||e!==null&&e===xt}function aP(t,e){ld=sm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function oP(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Cv(t,n)}}var am={readContext:br,useCallback:fn,useContext:fn,useEffect:fn,useImperativeHandle:fn,useInsertionEffect:fn,useLayoutEffect:fn,useMemo:fn,useReducer:fn,useRef:fn,useState:fn,useDebugValue:fn,useDeferredValue:fn,useTransition:fn,useMutableSource:fn,useSyncExternalStore:fn,useId:fn,unstable_isNewReconciler:!1},kB={readContext:br,useCallback:function(t,e){return yi().memoizedState=[t,e===void 0?null:e],t},useContext:br,useEffect:aT,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,vp(4194308,4,ZR.bind(null,e,t),n)},useLayoutEffect:function(t,e){return vp(4194308,4,t,e)},useInsertionEffect:function(t,e){return vp(4,2,t,e)},useMemo:function(t,e){var n=yi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=yi();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=SB.bind(null,xt,t),[r.memoizedState,t]},useRef:function(t){var e=yi();return t={current:t},e.memoizedState=t},useState:sT,useDebugValue:Jv,useDeferredValue:function(t){return yi().memoizedState=t},useTransition:function(){var t=sT(!1),e=t[0];return t=EB.bind(null,t[1]),yi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=xt,i=yi();if(gt){if(n===void 0)throw Error(ae(407));n=n()}else{if(n=e(),nn===null)throw Error(ae(349));Ro&30||HR(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,aT(GR.bind(null,r,s,t),[t]),r.flags|=2048,jd(9,qR.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=yi(),e=nn.identifierPrefix;if(gt){var n=as,r=ss;n=(r&~(1<<32-Hr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Bd++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=TB++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},$B={readContext:br,useCallback:tP,useContext:br,useEffect:Xv,useImperativeHandle:eP,useInsertionEffect:XR,useLayoutEffect:JR,useMemo:nP,useReducer:Oy,useRef:QR,useState:function(){return Oy(Ud)},useDebugValue:Jv,useDeferredValue:function(t){var e=xr();return rP(e,Ht.memoizedState,t)},useTransition:function(){var t=Oy(Ud)[0],e=xr().memoizedState;return[t,e]},useMutableSource:jR,useSyncExternalStore:WR,useId:iP,unstable_isNewReconciler:!1},CB={readContext:br,useCallback:tP,useContext:br,useEffect:Xv,useImperativeHandle:eP,useInsertionEffect:XR,useLayoutEffect:JR,useMemo:nP,useReducer:Dy,useRef:QR,useState:function(){return Dy(Ud)},useDebugValue:Jv,useDeferredValue:function(t){var e=xr();return Ht===null?e.memoizedState=t:rP(e,Ht.memoizedState,t)},useTransition:function(){var t=Dy(Ud)[0],e=xr().memoizedState;return[t,e]},useMutableSource:jR,useSyncExternalStore:WR,useId:iP,unstable_isNewReconciler:!1};function zr(t,e){if(t&&t.defaultProps){e=Et({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function j0(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Et({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ag={isMounted:function(t){return(t=t._reactInternals)?qo(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=On(),i=da(t),s=us(r,i);s.payload=e,n!=null&&(s.callback=n),e=ua(t,s,i),e!==null&&(qr(e,t,i,r),_p(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=On(),i=da(t),s=us(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=ua(t,s,i),e!==null&&(qr(e,t,i,r),_p(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=On(),r=da(t),i=us(n,r);i.tag=2,e!=null&&(i.callback=e),e=ua(t,i,r),e!==null&&(qr(e,t,r,n),_p(e,t,r))}};function oT(t,e,n,r,i,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!Dd(n,r)||!Dd(i,s):!0}function lP(t,e,n){var r=!1,i=ba,s=e.contextType;return typeof s=="object"&&s!==null?s=br(s):(i=Kn(e)?Co:bn.current,r=e.contextTypes,s=(r=r!=null)?lu(t,i):ba),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ag,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function lT(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&ag.enqueueReplaceState(e,e.state,null)}function W0(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Wv(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=br(s):(s=Kn(e)?Co:bn.current,i.context=lu(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(j0(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&ag.enqueueReplaceState(i,i.state,null),rm(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function hu(t,e){try{var n="",r=e;do n+=rF(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function My(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function H0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var AB=typeof WeakMap=="function"?WeakMap:Map;function uP(t,e,n){n=us(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){lm||(lm=!0,tw=r),H0(t,e)},n}function cP(t,e,n){n=us(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){H0(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){H0(t,e),typeof r!="function"&&(ca===null?ca=new Set([this]):ca.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function uT(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new AB;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=WB.bind(null,t,e,n),e.then(t,t))}function cT(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function dT(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=us(-1,1),e.tag=2,ua(n,e,1))),n.lanes|=1),t)}var RB=ws.ReactCurrentOwner,Hn=!1;function Pn(t,e,n,r){e.child=t===null?VR(e,null,n,r):cu(e,t.child,n,r)}function hT(t,e,n,r,i){n=n.render;var s=e.ref;return Xl(e,i),r=Yv(t,e,n,r,s,i),n=Qv(),t!==null&&!Hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,fs(t,e,i)):(gt&&n&&Lv(e),e.flags|=1,Pn(t,e,r,i),e.child)}function fT(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!ab(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,dP(t,e,s,r,i)):(t=Ep(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var a=s.memoizedProps;if(n=n.compare,n=n!==null?n:Dd,n(a,r)&&t.ref===e.ref)return fs(t,e,i)}return e.flags|=1,t=ha(s,r),t.ref=e.ref,t.return=e,e.child=t}function dP(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Dd(s,r)&&t.ref===e.ref)if(Hn=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(Hn=!0);else return e.lanes=t.lanes,fs(t,e,i)}return q0(t,e,n,r,i)}function hP(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ct(Ul,tr),tr|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ct(Ul,tr),tr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ct(Ul,tr),tr|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ct(Ul,tr),tr|=r;return Pn(t,e,i,n),e.child}function fP(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function q0(t,e,n,r,i){var s=Kn(n)?Co:bn.current;return s=lu(e,s),Xl(e,i),n=Yv(t,e,n,r,s,i),r=Qv(),t!==null&&!Hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,fs(t,e,i)):(gt&&r&&Lv(e),e.flags|=1,Pn(t,e,n,i),e.child)}function pT(t,e,n,r,i){if(Kn(n)){var s=!0;Jp(e)}else s=!1;if(Xl(e,i),e.stateNode===null)bp(t,e),lP(e,n,r),W0(e,n,r,i),r=!0;else if(t===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=br(u):(u=Kn(n)?Co:bn.current,u=lu(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&lT(e,a,r,u),js=!1;var h=e.memoizedState;a.state=h,rm(e,r,a,i),l=e.memoizedState,o!==r||h!==l||Gn.current||js?(typeof c=="function"&&(j0(e,n,c,r),l=e.memoizedState),(o=js||oT(e,n,o,r,h,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,BR(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:zr(e.type,o),a.props=u,d=e.pendingProps,h=a.context,l=n.contextType,typeof l=="object"&&l!==null?l=br(l):(l=Kn(n)?Co:bn.current,l=lu(e,l));var m=n.getDerivedStateFromProps;(c=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&lT(e,a,r,l),js=!1,h=e.memoizedState,a.state=h,rm(e,r,a,i);var g=e.memoizedState;o!==d||h!==g||Gn.current||js?(typeof m=="function"&&(j0(e,n,m,r),g=e.memoizedState),(u=js||oT(e,n,u,r,h,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),a.props=r,a.state=g,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return G0(t,e,n,r,s,i)}function G0(t,e,n,r,i,s){fP(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&Z2(e,n,!1),fs(t,e,s);r=e.stateNode,RB.current=e;var o=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=cu(e,t.child,null,s),e.child=cu(e,null,o,s)):Pn(t,e,o,s),e.memoizedState=r.state,i&&Z2(e,n,!0),e.child}function pP(t){var e=t.stateNode;e.pendingContext?J2(t,e.pendingContext,e.pendingContext!==e.context):e.context&&J2(t,e.context,!1),Hv(t,e.containerInfo)}function mT(t,e,n,r,i){return uu(),Vv(i),e.flags|=256,Pn(t,e,n,r),e.child}var K0={dehydrated:null,treeContext:null,retryLane:0};function Y0(t){return{baseLanes:t,cachePool:null,transitions:null}}function mP(t,e,n){var r=e.pendingProps,i=wt.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=t!==null&&t.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ct(wt,i&1),t===null)return B0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=ug(a,r,0,null),t=Eo(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Y0(n),e.memoizedState=K0,t):Zv(e,a));if(i=t.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return PB(t,e,a,r,o,i,n);if(s){s=r.fallback,a=e.mode,i=t.child,o=i.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=ha(i,l),r.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=ha(o,s):(s=Eo(s,a,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=t.child.memoizedState,a=a===null?Y0(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=t.childLanes&~n,e.memoizedState=K0,r}return s=t.child,t=s.sibling,r=ha(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Zv(t,e){return e=ug({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function kf(t,e,n,r){return r!==null&&Vv(r),cu(e,t.child,null,n),t=Zv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function PB(t,e,n,r,i,s,a){if(n)return e.flags&256?(e.flags&=-257,r=My(Error(ae(422))),kf(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=ug({mode:"visible",children:r.children},i,0,null),s=Eo(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&cu(e,t.child,null,a),e.child.memoizedState=Y0(a),e.memoizedState=K0,s);if(!(e.mode&1))return kf(t,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(ae(419)),r=My(s,r,void 0),kf(t,e,a,r)}if(o=(a&t.childLanes)!==0,Hn||o){if(r=nn,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,hs(t,i),qr(r,t,i,-1))}return sb(),r=My(Error(ae(421))),kf(t,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=HB.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,rr=la(i.nextSibling),ir=e,gt=!0,Fr=null,t!==null&&(fr[pr++]=ss,fr[pr++]=as,fr[pr++]=Ao,ss=t.id,as=t.overflow,Ao=e),e=Zv(e,r.children),e.flags|=4096,e)}function gT(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),U0(t.return,e,n)}function Ly(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function gP(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Pn(t,e,r.children,n),r=wt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&gT(t,n,e);else if(t.tag===19)gT(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ct(wt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&im(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Ly(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&im(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Ly(e,!0,n,null,s);break;case"together":Ly(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function bp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function fs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Po|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,n=ha(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ha(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function NB(t,e,n){switch(e.tag){case 3:pP(e),uu();break;case 5:UR(e);break;case 1:Kn(e.type)&&Jp(e);break;case 4:Hv(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ct(tm,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ct(wt,wt.current&1),e.flags|=128,null):n&e.child.childLanes?mP(t,e,n):(ct(wt,wt.current&1),t=fs(t,e,n),t!==null?t.sibling:null);ct(wt,wt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return gP(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ct(wt,wt.current),r)break;return null;case 22:case 23:return e.lanes=0,hP(t,e,n)}return fs(t,e,n)}var yP,Q0,_P,wP;yP=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Q0=function(){};_P=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,wo(Ii.current);var s=null;switch(n){case"input":i=_0(t,i),r=_0(t,r),s=[];break;case"select":i=Et({},i,{value:void 0}),r=Et({},r,{value:void 0}),s=[];break;case"textarea":i=b0(t,i),r=b0(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Qp)}T0(n,r);var a;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(a in o)o.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&($d.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(o=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&($d.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ht("scroll",t),s||o===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};wP=function(t,e,n,r){n!==r&&(e.flags|=4)};function _c(t,e){if(!gt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function pn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function OB(t,e,n){var r=e.pendingProps;switch(zv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pn(e),null;case 1:return Kn(e.type)&&Xp(),pn(e),null;case 3:return r=e.stateNode,du(),mt(Gn),mt(bn),Gv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Sf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Fr!==null&&(iw(Fr),Fr=null))),Q0(t,e),pn(e),null;case 5:qv(e);var i=wo(Fd.current);if(n=e.type,t!==null&&e.stateNode!=null)_P(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ae(166));return pn(e),null}if(t=wo(Ii.current),Sf(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[bi]=e,r[zd]=s,t=(e.mode&1)!==0,n){case"dialog":ht("cancel",r),ht("close",r);break;case"iframe":case"object":case"embed":ht("load",r);break;case"video":case"audio":for(i=0;i<Wc.length;i++)ht(Wc[i],r);break;case"source":ht("error",r);break;case"img":case"image":case"link":ht("error",r),ht("load",r);break;case"details":ht("toggle",r);break;case"input":S2(r,s),ht("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ht("invalid",r);break;case"textarea":k2(r,s),ht("invalid",r)}T0(n,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&Ef(r.textContent,o,t),i=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&Ef(r.textContent,o,t),i=["children",""+o]):$d.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ht("scroll",r)}switch(n){case"input":gf(r),I2(r,s,!0);break;case"textarea":gf(r),$2(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Qp)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=GA(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[bi]=e,t[zd]=r,yP(t,e,!1,!1),e.stateNode=t;e:{switch(a=E0(n,r),n){case"dialog":ht("cancel",t),ht("close",t),i=r;break;case"iframe":case"object":case"embed":ht("load",t),i=r;break;case"video":case"audio":for(i=0;i<Wc.length;i++)ht(Wc[i],t);i=r;break;case"source":ht("error",t),i=r;break;case"img":case"image":case"link":ht("error",t),ht("load",t),i=r;break;case"details":ht("toggle",t),i=r;break;case"input":S2(t,r),i=_0(t,r),ht("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Et({},r,{value:void 0}),ht("invalid",t);break;case"textarea":k2(t,r),i=b0(t,r),ht("invalid",t);break;default:i=r}T0(n,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?QA(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&KA(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Cd(t,l):typeof l=="number"&&Cd(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&($d.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ht("scroll",t):l!=null&&Tv(t,s,l,a))}switch(n){case"input":gf(t),I2(t,r,!1);break;case"textarea":gf(t),$2(t);break;case"option":r.value!=null&&t.setAttribute("value",""+va(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?Gl(t,!!r.multiple,s,!1):r.defaultValue!=null&&Gl(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Qp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return pn(e),null;case 6:if(t&&e.stateNode!=null)wP(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ae(166));if(n=wo(Fd.current),wo(Ii.current),Sf(e)){if(r=e.stateNode,n=e.memoizedProps,r[bi]=e,(s=r.nodeValue!==n)&&(t=ir,t!==null))switch(t.tag){case 3:Ef(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ef(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[bi]=e,e.stateNode=r}return pn(e),null;case 13:if(mt(wt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gt&&rr!==null&&e.mode&1&&!(e.flags&128))LR(),uu(),e.flags|=98560,s=!1;else if(s=Sf(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(ae(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ae(317));s[bi]=e}else uu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;pn(e),s=!1}else Fr!==null&&(iw(Fr),Fr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||wt.current&1?qt===0&&(qt=3):sb())),e.updateQueue!==null&&(e.flags|=4),pn(e),null);case 4:return du(),Q0(t,e),t===null&&Md(e.stateNode.containerInfo),pn(e),null;case 10:return Uv(e.type._context),pn(e),null;case 17:return Kn(e.type)&&Xp(),pn(e),null;case 19:if(mt(wt),s=e.memoizedState,s===null)return pn(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)_c(s,!1);else{if(qt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=im(t),a!==null){for(e.flags|=128,_c(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,t=a.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ct(wt,wt.current&1|2),e.child}t=t.sibling}s.tail!==null&&Dt()>fu&&(e.flags|=128,r=!0,_c(s,!1),e.lanes=4194304)}else{if(!r)if(t=im(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),_c(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!gt)return pn(e),null}else 2*Dt()-s.renderingStartTime>fu&&n!==1073741824&&(e.flags|=128,r=!0,_c(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(n=s.last,n!==null?n.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Dt(),e.sibling=null,n=wt.current,ct(wt,r?n&1|2:n&1),e):(pn(e),null);case 22:case 23:return ib(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?tr&1073741824&&(pn(e),e.subtreeFlags&6&&(e.flags|=8192)):pn(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function DB(t,e){switch(zv(e),e.tag){case 1:return Kn(e.type)&&Xp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return du(),mt(Gn),mt(bn),Gv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return qv(e),null;case 13:if(mt(wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));uu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return mt(wt),null;case 4:return du(),null;case 10:return Uv(e.type._context),null;case 22:case 23:return ib(),null;case 24:return null;default:return null}}var $f=!1,_n=!1,MB=typeof WeakSet=="function"?WeakSet:Set,ge=null;function Bl(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){$t(t,e,r)}else n.current=null}function X0(t,e,n){try{n()}catch(r){$t(t,e,r)}}var yT=!1;function LB(t,e){if(O0=Gp,t=ER(),Mv(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=t,h=null;t:for(;;){for(var m;d!==n||i!==0&&d.nodeType!==3||(o=a+i),d!==s||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(m=d.firstChild)!==null;)h=d,d=m;for(;;){if(d===t)break t;if(h===n&&++u===i&&(o=a),h===s&&++c===r&&(l=a),(m=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=m}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(D0={focusedElem:t,selectionRange:n},Gp=!1,ge=e;ge!==null;)if(e=ge,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ge=t;else for(;ge!==null;){e=ge;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var w=g.memoizedProps,x=g.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?w:zr(e.type,w),x);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch($){$t(e,e.return,$)}if(t=e.sibling,t!==null){t.return=e.return,ge=t;break}ge=e.return}return g=yT,yT=!1,g}function ud(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&X0(e,n,s)}i=i.next}while(i!==r)}}function og(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function J0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function vP(t){var e=t.alternate;e!==null&&(t.alternate=null,vP(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[bi],delete e[zd],delete e[z0],delete e[wB],delete e[vB])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function bP(t){return t.tag===5||t.tag===3||t.tag===4}function _T(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bP(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Z0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Qp));else if(r!==4&&(t=t.child,t!==null))for(Z0(t,e,n),t=t.sibling;t!==null;)Z0(t,e,n),t=t.sibling}function ew(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(ew(t,e,n),t=t.sibling;t!==null;)ew(t,e,n),t=t.sibling}var an=null,Vr=!1;function Ds(t,e,n){for(n=n.child;n!==null;)xP(t,e,n),n=n.sibling}function xP(t,e,n){if(Si&&typeof Si.onCommitFiberUnmount=="function")try{Si.onCommitFiberUnmount(Zm,n)}catch{}switch(n.tag){case 5:_n||Bl(n,e);case 6:var r=an,i=Vr;an=null,Ds(t,e,n),an=r,Vr=i,an!==null&&(Vr?(t=an,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):an.removeChild(n.stateNode));break;case 18:an!==null&&(Vr?(t=an,n=n.stateNode,t.nodeType===8?Ay(t.parentNode,n):t.nodeType===1&&Ay(t,n),Nd(t)):Ay(an,n.stateNode));break;case 4:r=an,i=Vr,an=n.stateNode.containerInfo,Vr=!0,Ds(t,e,n),an=r,Vr=i;break;case 0:case 11:case 14:case 15:if(!_n&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&X0(n,e,a),i=i.next}while(i!==r)}Ds(t,e,n);break;case 1:if(!_n&&(Bl(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){$t(n,e,o)}Ds(t,e,n);break;case 21:Ds(t,e,n);break;case 22:n.mode&1?(_n=(r=_n)||n.memoizedState!==null,Ds(t,e,n),_n=r):Ds(t,e,n);break;default:Ds(t,e,n)}}function wT(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new MB),e.forEach(function(r){var i=qB.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Rr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:an=o.stateNode,Vr=!1;break e;case 3:an=o.stateNode.containerInfo,Vr=!0;break e;case 4:an=o.stateNode.containerInfo,Vr=!0;break e}o=o.return}if(an===null)throw Error(ae(160));xP(s,a,i),an=null,Vr=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){$t(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)TP(e,t),e=e.sibling}function TP(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rr(e,t),fi(t),r&4){try{ud(3,t,t.return),og(3,t)}catch(w){$t(t,t.return,w)}try{ud(5,t,t.return)}catch(w){$t(t,t.return,w)}}break;case 1:Rr(e,t),fi(t),r&512&&n!==null&&Bl(n,n.return);break;case 5:if(Rr(e,t),fi(t),r&512&&n!==null&&Bl(n,n.return),t.flags&32){var i=t.stateNode;try{Cd(i,"")}catch(w){$t(t,t.return,w)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,a=n!==null?n.memoizedProps:s,o=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&HA(i,s),E0(o,a);var u=E0(o,s);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?QA(i,d):c==="dangerouslySetInnerHTML"?KA(i,d):c==="children"?Cd(i,d):Tv(i,c,d,u)}switch(o){case"input":w0(i,s);break;case"textarea":qA(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?Gl(i,!!s.multiple,m,!1):h!==!!s.multiple&&(s.defaultValue!=null?Gl(i,!!s.multiple,s.defaultValue,!0):Gl(i,!!s.multiple,s.multiple?[]:"",!1))}i[zd]=s}catch(w){$t(t,t.return,w)}}break;case 6:if(Rr(e,t),fi(t),r&4){if(t.stateNode===null)throw Error(ae(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(w){$t(t,t.return,w)}}break;case 3:if(Rr(e,t),fi(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Nd(e.containerInfo)}catch(w){$t(t,t.return,w)}break;case 4:Rr(e,t),fi(t);break;case 13:Rr(e,t),fi(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(nb=Dt())),r&4&&wT(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(_n=(u=_n)||c,Rr(e,t),_n=u):Rr(e,t),fi(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(ge=t,c=t.child;c!==null;){for(d=ge=c;ge!==null;){switch(h=ge,m=h.child,h.tag){case 0:case 11:case 14:case 15:ud(4,h,h.return);break;case 1:Bl(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(w){$t(r,n,w)}}break;case 5:Bl(h,h.return);break;case 22:if(h.memoizedState!==null){bT(d);continue}}m!==null?(m.return=h,ge=m):bT(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=YA("display",a))}catch(w){$t(t,t.return,w)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(w){$t(t,t.return,w)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Rr(e,t),fi(t),r&4&&wT(t);break;case 21:break;default:Rr(e,t),fi(t)}}function fi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(bP(n)){var r=n;break e}n=n.return}throw Error(ae(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Cd(i,""),r.flags&=-33);var s=_T(t);ew(t,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,o=_T(t);Z0(t,o,a);break;default:throw Error(ae(161))}}catch(l){$t(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function zB(t,e,n){ge=t,EP(t)}function EP(t,e,n){for(var r=(t.mode&1)!==0;ge!==null;){var i=ge,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||$f;if(!a){var o=i.alternate,l=o!==null&&o.memoizedState!==null||_n;o=$f;var u=_n;if($f=a,(_n=l)&&!u)for(ge=i;ge!==null;)a=ge,l=a.child,a.tag===22&&a.memoizedState!==null?xT(i):l!==null?(l.return=a,ge=l):xT(i);for(;s!==null;)ge=s,EP(s),s=s.sibling;ge=i,$f=o,_n=u}vT(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,ge=s):vT(t)}}function vT(t){for(;ge!==null;){var e=ge;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:_n||og(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!_n)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:zr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&iT(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}iT(e,a,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Nd(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}_n||e.flags&512&&J0(e)}catch(h){$t(e,e.return,h)}}if(e===t){ge=null;break}if(n=e.sibling,n!==null){n.return=e.return,ge=n;break}ge=e.return}}function bT(t){for(;ge!==null;){var e=ge;if(e===t){ge=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ge=n;break}ge=e.return}}function xT(t){for(;ge!==null;){var e=ge;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{og(4,e)}catch(l){$t(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){$t(e,i,l)}}var s=e.return;try{J0(e)}catch(l){$t(e,s,l)}break;case 5:var a=e.return;try{J0(e)}catch(l){$t(e,a,l)}}}catch(l){$t(e,e.return,l)}if(e===t){ge=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ge=o;break}ge=e.return}}var VB=Math.ceil,om=ws.ReactCurrentDispatcher,eb=ws.ReactCurrentOwner,vr=ws.ReactCurrentBatchConfig,He=0,nn=null,Bt=null,un=0,tr=0,Ul=Na(0),qt=0,Wd=null,Po=0,lg=0,tb=0,cd=null,Un=null,nb=0,fu=1/0,ts=null,lm=!1,tw=null,ca=null,Cf=!1,Js=null,um=0,dd=0,nw=null,xp=-1,Tp=0;function On(){return He&6?Dt():xp!==-1?xp:xp=Dt()}function da(t){return t.mode&1?He&2&&un!==0?un&-un:xB.transition!==null?(Tp===0&&(Tp=lR()),Tp):(t=nt,t!==0||(t=window.event,t=t===void 0?16:mR(t.type)),t):1}function qr(t,e,n,r){if(50<dd)throw dd=0,nw=null,Error(ae(185));ph(t,n,r),(!(He&2)||t!==nn)&&(t===nn&&(!(He&2)&&(lg|=n),qt===4&&Hs(t,un)),Yn(t,r),n===1&&He===0&&!(e.mode&1)&&(fu=Dt()+500,ig&&Oa()))}function Yn(t,e){var n=t.callbackNode;xF(t,e);var r=qp(t,t===nn?un:0);if(r===0)n!==null&&R2(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&R2(n),e===1)t.tag===0?bB(TT.bind(null,t)):OR(TT.bind(null,t)),yB(function(){!(He&6)&&Oa()}),n=null;else{switch(uR(r)){case 1:n=$v;break;case 4:n=aR;break;case 16:n=Hp;break;case 536870912:n=oR;break;default:n=Hp}n=PP(n,SP.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function SP(t,e){if(xp=-1,Tp=0,He&6)throw Error(ae(327));var n=t.callbackNode;if(Jl()&&t.callbackNode!==n)return null;var r=qp(t,t===nn?un:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=cm(t,r);else{e=r;var i=He;He|=2;var s=kP();(nn!==t||un!==e)&&(ts=null,fu=Dt()+500,To(t,e));do try{UB();break}catch(o){IP(t,o)}while(!0);Bv(),om.current=s,He=i,Bt!==null?e=0:(nn=null,un=0,e=qt)}if(e!==0){if(e===2&&(i=C0(t),i!==0&&(r=i,e=rw(t,i))),e===1)throw n=Wd,To(t,0),Hs(t,r),Yn(t,Dt()),n;if(e===6)Hs(t,r);else{if(i=t.current.alternate,!(r&30)&&!FB(i)&&(e=cm(t,r),e===2&&(s=C0(t),s!==0&&(r=s,e=rw(t,s))),e===1))throw n=Wd,To(t,0),Hs(t,r),Yn(t,Dt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(ae(345));case 2:lo(t,Un,ts);break;case 3:if(Hs(t,r),(r&130023424)===r&&(e=nb+500-Dt(),10<e)){if(qp(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){On(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=L0(lo.bind(null,t,Un,ts),e);break}lo(t,Un,ts);break;case 4:if(Hs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var a=31-Hr(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=Dt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*VB(r/1960))-r,10<r){t.timeoutHandle=L0(lo.bind(null,t,Un,ts),r);break}lo(t,Un,ts);break;case 5:lo(t,Un,ts);break;default:throw Error(ae(329))}}}return Yn(t,Dt()),t.callbackNode===n?SP.bind(null,t):null}function rw(t,e){var n=cd;return t.current.memoizedState.isDehydrated&&(To(t,e).flags|=256),t=cm(t,e),t!==2&&(e=Un,Un=n,e!==null&&iw(e)),t}function iw(t){Un===null?Un=t:Un.push.apply(Un,t)}function FB(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Qr(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Hs(t,e){for(e&=~tb,e&=~lg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Hr(e),r=1<<n;t[n]=-1,e&=~r}}function TT(t){if(He&6)throw Error(ae(327));Jl();var e=qp(t,0);if(!(e&1))return Yn(t,Dt()),null;var n=cm(t,e);if(t.tag!==0&&n===2){var r=C0(t);r!==0&&(e=r,n=rw(t,r))}if(n===1)throw n=Wd,To(t,0),Hs(t,e),Yn(t,Dt()),n;if(n===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,lo(t,Un,ts),Yn(t,Dt()),null}function rb(t,e){var n=He;He|=1;try{return t(e)}finally{He=n,He===0&&(fu=Dt()+500,ig&&Oa())}}function No(t){Js!==null&&Js.tag===0&&!(He&6)&&Jl();var e=He;He|=1;var n=vr.transition,r=nt;try{if(vr.transition=null,nt=1,t)return t()}finally{nt=r,vr.transition=n,He=e,!(He&6)&&Oa()}}function ib(){tr=Ul.current,mt(Ul)}function To(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,gB(n)),Bt!==null)for(n=Bt.return;n!==null;){var r=n;switch(zv(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Xp();break;case 3:du(),mt(Gn),mt(bn),Gv();break;case 5:qv(r);break;case 4:du();break;case 13:mt(wt);break;case 19:mt(wt);break;case 10:Uv(r.type._context);break;case 22:case 23:ib()}n=n.return}if(nn=t,Bt=t=ha(t.current,null),un=tr=e,qt=0,Wd=null,tb=lg=Po=0,Un=cd=null,_o!==null){for(e=0;e<_o.length;e++)if(n=_o[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}n.pending=r}_o=null}return t}function IP(t,e){do{var n=Bt;try{if(Bv(),wp.current=am,sm){for(var r=xt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}sm=!1}if(Ro=0,en=Ht=xt=null,ld=!1,Bd=0,eb.current=null,n===null||n.return===null){qt=1,Wd=e,Bt=null;break}e:{var s=t,a=n.return,o=n,l=e;if(e=un,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var m=cT(a);if(m!==null){m.flags&=-257,dT(m,a,o,s,e),m.mode&1&&uT(s,u,e),e=m,l=u;var g=e.updateQueue;if(g===null){var w=new Set;w.add(l),e.updateQueue=w}else g.add(l);break e}else{if(!(e&1)){uT(s,u,e),sb();break e}l=Error(ae(426))}}else if(gt&&o.mode&1){var x=cT(a);if(x!==null){!(x.flags&65536)&&(x.flags|=256),dT(x,a,o,s,e),Vv(hu(l,o));break e}}s=l=hu(l,o),qt!==4&&(qt=2),cd===null?cd=[s]:cd.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=uP(s,l,e);rT(s,v);break e;case 1:o=l;var y=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ca===null||!ca.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var $=cP(s,o,e);rT(s,$);break e}}s=s.return}while(s!==null)}CP(n)}catch(R){e=R,Bt===n&&n!==null&&(Bt=n=n.return);continue}break}while(!0)}function kP(){var t=om.current;return om.current=am,t===null?am:t}function sb(){(qt===0||qt===3||qt===2)&&(qt=4),nn===null||!(Po&268435455)&&!(lg&268435455)||Hs(nn,un)}function cm(t,e){var n=He;He|=2;var r=kP();(nn!==t||un!==e)&&(ts=null,To(t,e));do try{BB();break}catch(i){IP(t,i)}while(!0);if(Bv(),He=n,om.current=r,Bt!==null)throw Error(ae(261));return nn=null,un=0,qt}function BB(){for(;Bt!==null;)$P(Bt)}function UB(){for(;Bt!==null&&!fF();)$P(Bt)}function $P(t){var e=RP(t.alternate,t,tr);t.memoizedProps=t.pendingProps,e===null?CP(t):Bt=e,eb.current=null}function CP(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=DB(n,e),n!==null){n.flags&=32767,Bt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{qt=6,Bt=null;return}}else if(n=OB(n,e,tr),n!==null){Bt=n;return}if(e=e.sibling,e!==null){Bt=e;return}Bt=e=t}while(e!==null);qt===0&&(qt=5)}function lo(t,e,n){var r=nt,i=vr.transition;try{vr.transition=null,nt=1,jB(t,e,n,r)}finally{vr.transition=i,nt=r}return null}function jB(t,e,n,r){do Jl();while(Js!==null);if(He&6)throw Error(ae(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(TF(t,s),t===nn&&(Bt=nn=null,un=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Cf||(Cf=!0,PP(Hp,function(){return Jl(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=vr.transition,vr.transition=null;var a=nt;nt=1;var o=He;He|=4,eb.current=null,LB(t,n),TP(n,t),uB(D0),Gp=!!O0,D0=O0=null,t.current=n,zB(n),pF(),He=o,nt=a,vr.transition=s}else t.current=n;if(Cf&&(Cf=!1,Js=t,um=i),s=t.pendingLanes,s===0&&(ca=null),yF(n.stateNode),Yn(t,Dt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(lm)throw lm=!1,t=tw,tw=null,t;return um&1&&t.tag!==0&&Jl(),s=t.pendingLanes,s&1?t===nw?dd++:(dd=0,nw=t):dd=0,Oa(),null}function Jl(){if(Js!==null){var t=uR(um),e=vr.transition,n=nt;try{if(vr.transition=null,nt=16>t?16:t,Js===null)var r=!1;else{if(t=Js,Js=null,um=0,He&6)throw Error(ae(331));var i=He;for(He|=4,ge=t.current;ge!==null;){var s=ge,a=s.child;if(ge.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(ge=u;ge!==null;){var c=ge;switch(c.tag){case 0:case 11:case 15:ud(8,c,s)}var d=c.child;if(d!==null)d.return=c,ge=d;else for(;ge!==null;){c=ge;var h=c.sibling,m=c.return;if(vP(c),c===u){ge=null;break}if(h!==null){h.return=m,ge=h;break}ge=m}}}var g=s.alternate;if(g!==null){var w=g.child;if(w!==null){g.child=null;do{var x=w.sibling;w.sibling=null,w=x}while(w!==null)}}ge=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,ge=a;else e:for(;ge!==null;){if(s=ge,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ud(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,ge=v;break e}ge=s.return}}var y=t.current;for(ge=y;ge!==null;){a=ge;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,ge=E;else e:for(a=y;ge!==null;){if(o=ge,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:og(9,o)}}catch(R){$t(o,o.return,R)}if(o===a){ge=null;break e}var $=o.sibling;if($!==null){$.return=o.return,ge=$;break e}ge=o.return}}if(He=i,Oa(),Si&&typeof Si.onPostCommitFiberRoot=="function")try{Si.onPostCommitFiberRoot(Zm,t)}catch{}r=!0}return r}finally{nt=n,vr.transition=e}}return!1}function ET(t,e,n){e=hu(n,e),e=uP(t,e,1),t=ua(t,e,1),e=On(),t!==null&&(ph(t,1,e),Yn(t,e))}function $t(t,e,n){if(t.tag===3)ET(t,t,n);else for(;e!==null;){if(e.tag===3){ET(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ca===null||!ca.has(r))){t=hu(n,t),t=cP(e,t,1),e=ua(e,t,1),t=On(),e!==null&&(ph(e,1,t),Yn(e,t));break}}e=e.return}}function WB(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=On(),t.pingedLanes|=t.suspendedLanes&n,nn===t&&(un&n)===n&&(qt===4||qt===3&&(un&130023424)===un&&500>Dt()-nb?To(t,0):tb|=n),Yn(t,e)}function AP(t,e){e===0&&(t.mode&1?(e=wf,wf<<=1,!(wf&130023424)&&(wf=4194304)):e=1);var n=On();t=hs(t,e),t!==null&&(ph(t,e,n),Yn(t,n))}function HB(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),AP(t,n)}function qB(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ae(314))}r!==null&&r.delete(e),AP(t,n)}var RP;RP=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Gn.current)Hn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Hn=!1,NB(t,e,n);Hn=!!(t.flags&131072)}else Hn=!1,gt&&e.flags&1048576&&DR(e,em,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;bp(t,e),t=e.pendingProps;var i=lu(e,bn.current);Xl(e,n),i=Yv(null,e,r,t,i,n);var s=Qv();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Kn(r)?(s=!0,Jp(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Wv(e),i.updater=ag,e.stateNode=i,i._reactInternals=e,W0(e,r,t,n),e=G0(null,e,r,!0,s,n)):(e.tag=0,gt&&s&&Lv(e),Pn(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(bp(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=KB(r),t=zr(r,t),i){case 0:e=q0(null,e,r,t,n);break e;case 1:e=pT(null,e,r,t,n);break e;case 11:e=hT(null,e,r,t,n);break e;case 14:e=fT(null,e,r,zr(r.type,t),n);break e}throw Error(ae(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:zr(r,i),q0(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:zr(r,i),pT(t,e,r,i,n);case 3:e:{if(pP(e),t===null)throw Error(ae(387));r=e.pendingProps,s=e.memoizedState,i=s.element,BR(t,e),rm(e,r,null,n);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=hu(Error(ae(423)),e),e=mT(t,e,r,n,i);break e}else if(r!==i){i=hu(Error(ae(424)),e),e=mT(t,e,r,n,i);break e}else for(rr=la(e.stateNode.containerInfo.firstChild),ir=e,gt=!0,Fr=null,n=VR(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(uu(),r===i){e=fs(t,e,n);break e}Pn(t,e,r,n)}e=e.child}return e;case 5:return UR(e),t===null&&B0(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,a=i.children,M0(r,i)?a=null:s!==null&&M0(r,s)&&(e.flags|=32),fP(t,e),Pn(t,e,a,n),e.child;case 6:return t===null&&B0(e),null;case 13:return mP(t,e,n);case 4:return Hv(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=cu(e,null,r,n):Pn(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:zr(r,i),hT(t,e,r,i,n);case 7:return Pn(t,e,e.pendingProps,n),e.child;case 8:return Pn(t,e,e.pendingProps.children,n),e.child;case 12:return Pn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,ct(tm,r._currentValue),r._currentValue=a,s!==null)if(Qr(s.value,a)){if(s.children===i.children&&!Gn.current){e=fs(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=us(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),U0(s.return,n,e),o.lanes|=n;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ae(341));a.lanes|=n,o=a.alternate,o!==null&&(o.lanes|=n),U0(a,n,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Pn(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Xl(e,n),i=br(i),r=r(i),e.flags|=1,Pn(t,e,r,n),e.child;case 14:return r=e.type,i=zr(r,e.pendingProps),i=zr(r.type,i),fT(t,e,r,i,n);case 15:return dP(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:zr(r,i),bp(t,e),e.tag=1,Kn(r)?(t=!0,Jp(e)):t=!1,Xl(e,n),lP(e,r,i),W0(e,r,i,n),G0(null,e,r,!0,t,n);case 19:return gP(t,e,n);case 22:return hP(t,e,n)}throw Error(ae(156,e.tag))};function PP(t,e){return sR(t,e)}function GB(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _r(t,e,n,r){return new GB(t,e,n,r)}function ab(t){return t=t.prototype,!(!t||!t.isReactComponent)}function KB(t){if(typeof t=="function")return ab(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Sv)return 11;if(t===Iv)return 14}return 2}function ha(t,e){var n=t.alternate;return n===null?(n=_r(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ep(t,e,n,r,i,s){var a=2;if(r=t,typeof t=="function")ab(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Pl:return Eo(n.children,i,s,e);case Ev:a=8,i|=8;break;case p0:return t=_r(12,n,e,i|2),t.elementType=p0,t.lanes=s,t;case m0:return t=_r(13,n,e,i),t.elementType=m0,t.lanes=s,t;case g0:return t=_r(19,n,e,i),t.elementType=g0,t.lanes=s,t;case UA:return ug(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case FA:a=10;break e;case BA:a=9;break e;case Sv:a=11;break e;case Iv:a=14;break e;case Us:a=16,r=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=_r(a,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function Eo(t,e,n,r){return t=_r(7,t,r,e),t.lanes=n,t}function ug(t,e,n,r){return t=_r(22,t,r,e),t.elementType=UA,t.lanes=n,t.stateNode={isHidden:!1},t}function zy(t,e,n){return t=_r(6,t,null,e),t.lanes=n,t}function Vy(t,e,n){return e=_r(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function YB(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wy(0),this.expirationTimes=wy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wy(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function ob(t,e,n,r,i,s,a,o,l){return t=new YB(t,e,n,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=_r(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wv(s),t}function QB(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rl,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function NP(t){if(!t)return ba;t=t._reactInternals;e:{if(qo(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Kn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var n=t.type;if(Kn(n))return NR(t,n,e)}return e}function OP(t,e,n,r,i,s,a,o,l){return t=ob(n,r,!0,t,i,s,a,o,l),t.context=NP(null),n=t.current,r=On(),i=da(n),s=us(r,i),s.callback=e??null,ua(n,s,i),t.current.lanes=i,ph(t,i,r),Yn(t,r),t}function cg(t,e,n,r){var i=e.current,s=On(),a=da(i);return n=NP(n),e.context===null?e.context=n:e.pendingContext=n,e=us(s,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ua(i,e,a),t!==null&&(qr(t,i,a,s),_p(t,i,a)),a}function dm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ST(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function lb(t,e){ST(t,e),(t=t.alternate)&&ST(t,e)}function XB(){return null}var DP=typeof reportError=="function"?reportError:function(t){console.error(t)};function ub(t){this._internalRoot=t}dg.prototype.render=ub.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));cg(t,e,null,null)};dg.prototype.unmount=ub.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;No(function(){cg(null,t,null,null)}),e[ds]=null}};function dg(t){this._internalRoot=t}dg.prototype.unstable_scheduleHydration=function(t){if(t){var e=hR();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ws.length&&e!==0&&e<Ws[n].priority;n++);Ws.splice(n,0,t),n===0&&pR(t)}};function cb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function hg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function IT(){}function JB(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=dm(a);s.call(u)}}var a=OP(e,r,t,0,null,!1,!1,"",IT);return t._reactRootContainer=a,t[ds]=a.current,Md(t.nodeType===8?t.parentNode:t),No(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var o=r;r=function(){var u=dm(l);o.call(u)}}var l=ob(t,0,!1,null,null,!1,!1,"",IT);return t._reactRootContainer=l,t[ds]=l.current,Md(t.nodeType===8?t.parentNode:t),No(function(){cg(e,l,n,r)}),l}function fg(t,e,n,r,i){var s=n._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var l=dm(a);o.call(l)}}cg(e,a,t,i)}else a=JB(n,e,t,i,r);return dm(a)}cR=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=jc(e.pendingLanes);n!==0&&(Cv(e,n|1),Yn(e,Dt()),!(He&6)&&(fu=Dt()+500,Oa()))}break;case 13:No(function(){var r=hs(t,1);if(r!==null){var i=On();qr(r,t,1,i)}}),lb(t,1)}};Av=function(t){if(t.tag===13){var e=hs(t,134217728);if(e!==null){var n=On();qr(e,t,134217728,n)}lb(t,134217728)}};dR=function(t){if(t.tag===13){var e=da(t),n=hs(t,e);if(n!==null){var r=On();qr(n,t,e,r)}lb(t,e)}};hR=function(){return nt};fR=function(t,e){var n=nt;try{return nt=t,e()}finally{nt=n}};I0=function(t,e,n){switch(e){case"input":if(w0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=rg(r);if(!i)throw Error(ae(90));WA(r),w0(r,i)}}}break;case"textarea":qA(t,n);break;case"select":e=n.value,e!=null&&Gl(t,!!n.multiple,e,!1)}};ZA=rb;eR=No;var ZB={usingClientEntryPoint:!1,Events:[gh,Ml,rg,XA,JA,rb]},wc={findFiberByHostInstance:yo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eU={bundleType:wc.bundleType,version:wc.version,rendererPackageName:wc.rendererPackageName,rendererConfig:wc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ws.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=rR(t),t===null?null:t.stateNode},findFiberByHostInstance:wc.findFiberByHostInstance||XB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Af=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Af.isDisabled&&Af.supportsFiber)try{Zm=Af.inject(eU),Si=Af}catch{}}lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZB;lr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cb(e))throw Error(ae(200));return QB(t,e,null,n)};lr.createRoot=function(t,e){if(!cb(t))throw Error(ae(299));var n=!1,r="",i=DP;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=ob(t,1,!1,null,null,n,!1,r,i),t[ds]=e.current,Md(t.nodeType===8?t.parentNode:t),new ub(e)};lr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=rR(e),t=t===null?null:t.stateNode,t};lr.flushSync=function(t){return No(t)};lr.hydrate=function(t,e,n){if(!hg(e))throw Error(ae(200));return fg(null,t,e,!0,n)};lr.hydrateRoot=function(t,e,n){if(!cb(t))throw Error(ae(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",a=DP;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=OP(e,null,t,1,n??null,i,!1,s,a),t[ds]=e.current,Md(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new dg(e)};lr.render=function(t,e,n){if(!hg(e))throw Error(ae(200));return fg(null,t,e,!1,n)};lr.unmountComponentAtNode=function(t){if(!hg(t))throw Error(ae(40));return t._reactRootContainer?(No(function(){fg(null,null,t,!1,function(){t._reactRootContainer=null,t[ds]=null})}),!0):!1};lr.unstable_batchedUpdates=rb;lr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!hg(n))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return fg(t,e,n,!1,r)};lr.version="18.3.1-next-f1338f8080-20240426";function MP(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(MP)}catch(t){console.error(t)}}MP(),MA.exports=lr;var tU=MA.exports,kT=tU;h0.createRoot=kT.createRoot,h0.hydrateRoot=kT.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hd(){return Hd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Hd.apply(this,arguments)}var Zs;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Zs||(Zs={}));const $T="popstate";function nU(t){t===void 0&&(t={});function e(r,i){let{pathname:s,search:a,hash:o}=r.location;return sw("",{pathname:s,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:hm(i)}return iU(e,n,null,t)}function Tt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function db(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function rU(){return Math.random().toString(36).substr(2,8)}function CT(t,e){return{usr:t.state,key:t.key,idx:e}}function sw(t,e,n,r){return n===void 0&&(n=null),Hd({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Au(e):e,{state:n,key:e&&e.key||r||rU()})}function hm(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Au(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function iU(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,a=i.history,o=Zs.Pop,l=null,u=c();u==null&&(u=0,a.replaceState(Hd({},a.state,{idx:u}),""));function c(){return(a.state||{idx:null}).idx}function d(){o=Zs.Pop;let x=c(),v=x==null?null:x-u;u=x,l&&l({action:o,location:w.location,delta:v})}function h(x,v){o=Zs.Push;let y=sw(w.location,x,v);u=c()+1;let E=CT(y,u),$=w.createHref(y);try{a.pushState(E,"",$)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;i.location.assign($)}s&&l&&l({action:o,location:w.location,delta:1})}function m(x,v){o=Zs.Replace;let y=sw(w.location,x,v);u=c();let E=CT(y,u),$=w.createHref(y);a.replaceState(E,"",$),s&&l&&l({action:o,location:w.location,delta:0})}function g(x){let v=i.location.origin!=="null"?i.location.origin:i.location.href,y=typeof x=="string"?x:hm(x);return y=y.replace(/ $/,"%20"),Tt(v,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,v)}let w={get action(){return o},get location(){return t(i,a)},listen(x){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener($T,d),l=x,()=>{i.removeEventListener($T,d),l=null}},createHref(x){return e(i,x)},createURL:g,encodeLocation(x){let v=g(x);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:h,replace:m,go(x){return a.go(x)}};return w}var AT;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(AT||(AT={}));function sU(t,e,n){return n===void 0&&(n="/"),aU(t,e,n)}function aU(t,e,n,r){let i=typeof e=="string"?Au(e):e,s=pu(i.pathname||"/",n);if(s==null)return null;let a=LP(t);oU(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=_U(s);o=gU(a[l],u)}return o}function LP(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(Tt(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=fa([r,l.relativePath]),c=n.concat(l);s.children&&s.children.length>0&&(Tt(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),LP(s.children,e,c,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:pU(u,s.index),routesMeta:c})};return t.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))i(s,a);else for(let l of zP(s.path))i(s,a,l)}),e}function zP(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let a=zP(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),i&&o.push(...a),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function oU(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:mU(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const lU=/^:[\w-]+$/,uU=3,cU=2,dU=1,hU=10,fU=-2,RT=t=>t==="*";function pU(t,e){let n=t.split("/"),r=n.length;return n.some(RT)&&(r+=fU),e&&(r+=cU),n.filter(i=>!RT(i)).reduce((i,s)=>i+(lU.test(s)?uU:s===""?dU:hU),r)}function mU(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function gU(t,e,n){let{routesMeta:r}=t,i={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=aw({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),h=l.route;if(!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:fa([s,d.pathname]),pathnameBase:TU(fa([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=fa([s,d.pathnameBase]))}return a}function aw(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=yU(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:h,isOptional:m}=c;if(h==="*"){let w=o[d]||"";a=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const g=o[d];return m&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:t}}function yU(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),db(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function _U(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return db(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function pu(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}const wU=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vU=t=>wU.test(t);function bU(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Au(t):t,s;if(n)if(vU(n))s=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),db(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+n))}n.startsWith("/")?s=PT(n.substring(1),"/"):s=PT(n,e)}else s=e;return{pathname:s,search:EU(r),hash:SU(i)}}function PT(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Fy(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function xU(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function hb(t,e){let n=xU(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function fb(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=Au(t):(i=Hd({},t),Tt(!i.pathname||!i.pathname.includes("?"),Fy("?","pathname","search",i)),Tt(!i.pathname||!i.pathname.includes("#"),Fy("#","pathname","hash",i)),Tt(!i.search||!i.search.includes("#"),Fy("#","search","hash",i)));let s=t===""||i.pathname==="",a=s?"/":i.pathname,o;if(a==null)o=n;else{let d=e.length-1;if(!r&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;i.pathname=h.join("/")}o=d>=0?e[d]:"/"}let l=bU(i,o),u=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const fa=t=>t.join("/").replace(/\/\/+/g,"/"),TU=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),EU=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,SU=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function IU(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const VP=["post","put","patch","delete"];new Set(VP);const kU=["get",...VP];new Set(kU);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qd(){return qd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},qd.apply(this,arguments)}const pg=j.createContext(null),FP=j.createContext(null),vs=j.createContext(null),mg=j.createContext(null),bs=j.createContext({outlet:null,matches:[],isDataRoute:!1}),BP=j.createContext(null);function $U(t,e){let{relative:n}=e===void 0?{}:e;Ru()||Tt(!1);let{basename:r,navigator:i}=j.useContext(vs),{hash:s,pathname:a,search:o}=gg(t,{relative:n}),l=a;return r!=="/"&&(l=a==="/"?r:fa([r,a])),i.createHref({pathname:l,search:o,hash:s})}function Ru(){return j.useContext(mg)!=null}function Pu(){return Ru()||Tt(!1),j.useContext(mg).location}function UP(t){j.useContext(vs).static||j.useLayoutEffect(t)}function pb(){let{isDataRoute:t}=j.useContext(bs);return t?jU():CU()}function CU(){Ru()||Tt(!1);let t=j.useContext(pg),{basename:e,future:n,navigator:r}=j.useContext(vs),{matches:i}=j.useContext(bs),{pathname:s}=Pu(),a=JSON.stringify(hb(i,n.v7_relativeSplatPath)),o=j.useRef(!1);return UP(()=>{o.current=!0}),j.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let d=fb(u,JSON.parse(a),s,c.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:fa([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,a,s,t])}const AU=j.createContext(null);function RU(t){let e=j.useContext(bs).outlet;return e&&j.createElement(AU.Provider,{value:t},e)}function gg(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=j.useContext(vs),{matches:i}=j.useContext(bs),{pathname:s}=Pu(),a=JSON.stringify(hb(i,r.v7_relativeSplatPath));return j.useMemo(()=>fb(t,JSON.parse(a),s,n==="path"),[t,a,s,n])}function PU(t,e){return NU(t,e)}function NU(t,e,n,r){Ru()||Tt(!1);let{navigator:i}=j.useContext(vs),{matches:s}=j.useContext(bs),a=s[s.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let u=Pu(),c;if(e){var d;let x=typeof e=="string"?Au(e):e;l==="/"||(d=x.pathname)!=null&&d.startsWith(l)||Tt(!1),c=x}else c=u;let h=c.pathname||"/",m=h;if(l!=="/"){let x=l.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(x.length).join("/")}let g=sU(t,{pathname:m}),w=zU(g&&g.map(x=>Object.assign({},x,{params:Object.assign({},o,x.params),pathname:fa([l,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?l:fa([l,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),s,n,r);return e&&w?j.createElement(mg.Provider,{value:{location:qd({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Zs.Pop}},w):w}function OU(){let t=UU(),e=IU(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},e),n?j.createElement("pre",{style:i},n):null,null)}const DU=j.createElement(OU,null);class MU extends j.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?j.createElement(bs.Provider,{value:this.props.routeContext},j.createElement(BP.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function LU(t){let{routeContext:e,match:n,children:r}=t,i=j.useContext(pg);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),j.createElement(bs.Provider,{value:e},r)}function zU(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,o=(i=n)==null?void 0:i.errors;if(o!=null){let c=a.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);c>=0||Tt(!1),a=a.slice(0,Math.min(a.length,c+1))}let l=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let d=a[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:h,errors:m}=n,g=d.route.loader&&h[d.route.id]===void 0&&(!m||m[d.route.id]===void 0);if(d.route.lazy||g){l=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((c,d,h)=>{let m,g=!1,w=null,x=null;n&&(m=o&&d.route.id?o[d.route.id]:void 0,w=d.route.errorElement||DU,l&&(u<0&&h===0?(WU("route-fallback"),g=!0,x=null):u===h&&(g=!0,x=d.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,h+1)),y=()=>{let E;return m?E=w:g?E=x:d.route.Component?E=j.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=c,j.createElement(LU,{match:d,routeContext:{outlet:c,matches:v,isDataRoute:n!=null},children:E})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?j.createElement(MU,{location:n.location,revalidation:n.revalidation,component:w,error:m,children:y(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):y()},null)}var jP=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(jP||{}),WP=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(WP||{});function VU(t){let e=j.useContext(pg);return e||Tt(!1),e}function FU(t){let e=j.useContext(FP);return e||Tt(!1),e}function BU(t){let e=j.useContext(bs);return e||Tt(!1),e}function HP(t){let e=BU(),n=e.matches[e.matches.length-1];return n.route.id||Tt(!1),n.route.id}function UU(){var t;let e=j.useContext(BP),n=FU(),r=HP();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function jU(){let{router:t}=VU(jP.UseNavigateStable),e=HP(WP.UseNavigateStable),n=j.useRef(!1);return UP(()=>{n.current=!0}),j.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,qd({fromRouteId:e},s)))},[t,e])}const NT={};function WU(t,e,n){NT[t]||(NT[t]=!0)}function HU(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function qU(t){let{to:e,replace:n,state:r,relative:i}=t;Ru()||Tt(!1);let{future:s,static:a}=j.useContext(vs),{matches:o}=j.useContext(bs),{pathname:l}=Pu(),u=pb(),c=fb(e,hb(o,s.v7_relativeSplatPath),l,i==="path"),d=JSON.stringify(c);return j.useEffect(()=>u(JSON.parse(d),{replace:n,state:r,relative:i}),[u,d,i,n,r]),null}function GU(t){return RU(t.context)}function Lr(t){Tt(!1)}function KU(t){let{basename:e="/",children:n=null,location:r,navigationType:i=Zs.Pop,navigator:s,static:a=!1,future:o}=t;Ru()&&Tt(!1);let l=e.replace(/^\/*/,"/"),u=j.useMemo(()=>({basename:l,navigator:s,static:a,future:qd({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof r=="string"&&(r=Au(r));let{pathname:c="/",search:d="",hash:h="",state:m=null,key:g="default"}=r,w=j.useMemo(()=>{let x=pu(c,l);return x==null?null:{location:{pathname:x,search:d,hash:h,state:m,key:g},navigationType:i}},[l,c,d,h,m,g,i]);return w==null?null:j.createElement(vs.Provider,{value:u},j.createElement(mg.Provider,{children:n,value:w}))}function YU(t){let{children:e,location:n}=t;return PU(ow(e),n)}new Promise(()=>{});function ow(t,e){e===void 0&&(e=[]);let n=[];return j.Children.forEach(t,(r,i)=>{if(!j.isValidElement(r))return;let s=[...e,i];if(r.type===j.Fragment){n.push.apply(n,ow(r.props.children,s));return}r.type!==Lr&&Tt(!1),!r.props.index||!r.props.children||Tt(!1);let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=ow(r.props.children,s)),n.push(a)}),n}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fm(){return fm=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},fm.apply(this,arguments)}function qP(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function QU(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function XU(t,e){return t.button===0&&(!e||e==="_self")&&!QU(t)}const JU=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ZU=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],e6="6";try{window.__reactRouterVersion=e6}catch{}const t6=j.createContext({isTransitioning:!1}),n6="startTransition",OT=WV[n6];function r6(t){let{basename:e,children:n,future:r,window:i}=t,s=j.useRef();s.current==null&&(s.current=nU({window:i,v5Compat:!0}));let a=s.current,[o,l]=j.useState({action:a.action,location:a.location}),{v7_startTransition:u}=r||{},c=j.useCallback(d=>{u&&OT?OT(()=>l(d)):l(d)},[l,u]);return j.useLayoutEffect(()=>a.listen(c),[a,c]),j.useEffect(()=>HU(r),[r]),j.createElement(KU,{basename:e,children:n,location:o.location,navigationType:o.action,navigator:a,future:r})}const i6=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",s6=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,a6=j.forwardRef(function(e,n){let{onClick:r,relative:i,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:c,viewTransition:d}=e,h=qP(e,JU),{basename:m}=j.useContext(vs),g,w=!1;if(typeof u=="string"&&s6.test(u)&&(g=u,i6))try{let E=new URL(window.location.href),$=u.startsWith("//")?new URL(E.protocol+u):new URL(u),R=pu($.pathname,m);$.origin===E.origin&&R!=null?u=R+$.search+$.hash:w=!0}catch{}let x=$U(u,{relative:i}),v=u6(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:i,viewTransition:d});function y(E){r&&r(E),E.defaultPrevented||v(E)}return j.createElement("a",fm({},h,{href:g||x,onClick:w||s?r:y,ref:n,target:l}))}),o6=j.forwardRef(function(e,n){let{"aria-current":r="page",caseSensitive:i=!1,className:s="",end:a=!1,style:o,to:l,viewTransition:u,children:c}=e,d=qP(e,ZU),h=gg(l,{relative:d.relative}),m=Pu(),g=j.useContext(FP),{navigator:w,basename:x}=j.useContext(vs),v=g!=null&&c6(h)&&u===!0,y=w.encodeLocation?w.encodeLocation(h).pathname:h.pathname,E=m.pathname,$=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;i||(E=E.toLowerCase(),$=$?$.toLowerCase():null,y=y.toLowerCase()),$&&x&&($=pu($,x)||$);const R=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let D=E===y||!a&&E.startsWith(y)&&E.charAt(R)==="/",k=$!=null&&($===y||!a&&$.startsWith(y)&&$.charAt(y.length)==="/"),_={isActive:D,isPending:k,isTransitioning:v},A=D?r:void 0,N;typeof s=="function"?N=s(_):N=[s,D?"active":null,k?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let L=typeof o=="function"?o(_):o;return j.createElement(a6,fm({},d,{"aria-current":A,className:N,ref:n,style:L,to:l,viewTransition:u}),typeof c=="function"?c(_):c)});var lw;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(lw||(lw={}));var DT;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(DT||(DT={}));function l6(t){let e=j.useContext(pg);return e||Tt(!1),e}function u6(t,e){let{target:n,replace:r,state:i,preventScrollReset:s,relative:a,viewTransition:o}=e===void 0?{}:e,l=pb(),u=Pu(),c=gg(t,{relative:a});return j.useCallback(d=>{if(XU(d,n)){d.preventDefault();let h=r!==void 0?r:hm(u)===hm(c);l(t,{replace:h,state:i,preventScrollReset:s,relative:a,viewTransition:o})}},[u,l,c,r,i,n,t,s,a,o])}function c6(t,e){e===void 0&&(e={});let n=j.useContext(t6);n==null&&Tt(!1);let{basename:r}=l6(lw.useViewTransitionState),i=gg(t,{relative:e.relative});if(!n.isTransitioning)return!1;let s=pu(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=pu(n.nextLocation.pathname,r)||n.nextLocation.pathname;return aw(i.pathname,a)!=null||aw(i.pathname,s)!=null}const d6=()=>{};var MT={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GP=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},h6=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],a=t[n++],o=t[n++],l=((i&7)<<18|(s&63)<<12|(a&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],a=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},KP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],a=i+1<t.length,o=a?t[i+1]:0,l=i+2<t.length,u=l?t[i+2]:0,c=s>>2,d=(s&3)<<4|o>>4;let h=(o&15)<<2|u>>6,m=u&63;l||(m=64,a||(h=64)),r.push(n[c],n[d],n[h],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(GP(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):h6(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],o=i<t.length?n[t.charAt(i)]:0;++i;const u=i<t.length?n[t.charAt(i)]:64;++i;const d=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||o==null||u==null||d==null)throw new f6;const h=s<<2|o>>4;if(r.push(h),u!==64){const m=o<<4&240|u>>2;if(r.push(m),d!==64){const g=u<<6&192|d;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class f6 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p6=function(t){const e=GP(t);return KP.encodeByteArray(e,!0)},pm=function(t){return p6(t).replace(/\./g,"")},YP=function(t){try{return KP.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m6(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g6=()=>m6().__FIREBASE_DEFAULTS__,y6=()=>{if(typeof process>"u"||typeof MT>"u")return;const t=MT.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},_6=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&YP(t[1]);return e&&JSON.parse(e)},yg=()=>{try{return d6()||g6()||y6()||_6()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},QP=t=>{var e,n;return(n=(e=yg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},XP=t=>{const e=QP(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},JP=()=>{var t;return(t=yg())==null?void 0:t.config},ZP=t=>{var e;return(e=yg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w6{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function mb(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eN(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...t};return[pm(JSON.stringify(n)),pm(JSON.stringify(a)),""].join(".")}const hd={};function v6(){const t={prod:[],emulator:[]};for(const e of Object.keys(hd))hd[e]?t.emulator.push(e):t.prod.push(e);return t}function b6(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let LT=!1;function gb(t,e){if(typeof window>"u"||typeof document>"u"||!Da(window.location.host)||hd[t]===e||hd[t]||LT)return;hd[t]=e;function n(h){return`__firebase__banner__${h}`}const r="__firebase__banner",s=v6().prod.length>0;function a(){const h=document.getElementById(r);h&&h.remove()}function o(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,m){h.setAttribute("width","24"),h.setAttribute("id",m),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function u(){const h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{LT=!0,a()},h}function c(h,m){h.setAttribute("id",m),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function d(){const h=b6(r),m=n("text"),g=document.getElementById(m)||document.createElement("span"),w=n("learnmore"),x=document.getElementById(w)||document.createElement("a"),v=n("preprendIcon"),y=document.getElementById(v)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){const E=h.element;o(E),c(x,w);const $=u();l(y,v),E.append(y,g,x,$),document.body.appendChild(E)}s?(g.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function x6(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(xn())}function T6(){var e;const t=(e=yg())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function E6(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function S6(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function I6(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function k6(){const t=xn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function $6(){return!T6()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function C6(){try{return typeof indexedDB=="object"}catch{return!1}}function A6(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)==null?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R6="FirebaseError";class Vi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=R6,Object.setPrototypeOf(this,Vi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_h.prototype.create)}}class _h{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?P6(s,r):"Error",o=`${this.serviceName}: ${a} (${i}).`;return new Vi(i,o,r)}}function P6(t,e){return t.replace(N6,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const N6=/\{\$([^}]+)}/g;function O6(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Oo(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],a=e[i];if(zT(s)&&zT(a)){if(!Oo(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function zT(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Hc(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function qc(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function D6(t,e){const n=new M6(t,e);return n.subscribe.bind(n)}class M6{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");L6(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=By),i.error===void 0&&(i.error=By),i.complete===void 0&&(i.complete=By);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function L6(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function By(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(t){return t&&t._delegate?t._delegate:t}class xa{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z6{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new w6;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(F6(e))try{this.getOrInitializeService({instanceIdentifier:uo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=uo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=uo){return this.instances.has(e)}getOptions(e=uo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,a]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(s);r===o&&a.resolve(i)}return i}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:V6(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=uo){return this.component?this.component.multipleInstances?e:uo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function V6(t){return t===uo?void 0:t}function F6(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new z6(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Le||(Le={}));const U6={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},j6=Le.INFO,W6={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},H6=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=W6[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class yb{constructor(e){this.name=e,this._logLevel=j6,this._logHandler=H6,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?U6[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}}const q6=(t,e)=>e.some(n=>t instanceof n);let VT,FT;function G6(){return VT||(VT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function K6(){return FT||(FT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tN=new WeakMap,uw=new WeakMap,nN=new WeakMap,Uy=new WeakMap,_b=new WeakMap;function Y6(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",a)},s=()=>{n(pa(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&tN.set(n,t)}).catch(()=>{}),_b.set(e,t),e}function Q6(t){if(uw.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",a),t.removeEventListener("abort",a)},s=()=>{n(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",a),t.addEventListener("abort",a)});uw.set(t,e)}let cw={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return uw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||nN.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pa(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function X6(t){cw=t(cw)}function J6(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(jy(this),e,...n);return nN.set(r,e.sort?e.sort():[e]),pa(r)}:K6().includes(t)?function(...e){return t.apply(jy(this),e),pa(tN.get(this))}:function(...e){return pa(t.apply(jy(this),e))}}function Z6(t){return typeof t=="function"?J6(t):(t instanceof IDBTransaction&&Q6(t),q6(t,G6())?new Proxy(t,cw):t)}function pa(t){if(t instanceof IDBRequest)return Y6(t);if(Uy.has(t))return Uy.get(t);const e=Z6(t);return e!==t&&(Uy.set(t,e),_b.set(e,t)),e}const jy=t=>_b.get(t);function ej(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(t,e),o=pa(a);return r&&a.addEventListener("upgradeneeded",l=>{r(pa(a.result),l.oldVersion,l.newVersion,pa(a.transaction),l)}),n&&a.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),o.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),o}const tj=["get","getKey","getAll","getAllKeys","count"],nj=["put","add","delete","clear"],Wy=new Map;function BT(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Wy.get(e))return Wy.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=nj.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||tj.includes(n)))return;const s=async function(a,...o){const l=this.transaction(a,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(o.shift())),(await Promise.all([u[n](...o),i&&l.done]))[0]};return Wy.set(e,s),s}X6(t=>({...t,get:(e,n,r)=>BT(e,n)||t.get(e,n,r),has:(e,n)=>!!BT(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(ij(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function ij(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const dw="@firebase/app",UT="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ps=new yb("@firebase/app"),sj="@firebase/app-compat",aj="@firebase/analytics-compat",oj="@firebase/analytics",lj="@firebase/app-check-compat",uj="@firebase/app-check",cj="@firebase/auth",dj="@firebase/auth-compat",hj="@firebase/database",fj="@firebase/data-connect",pj="@firebase/database-compat",mj="@firebase/functions",gj="@firebase/functions-compat",yj="@firebase/installations",_j="@firebase/installations-compat",wj="@firebase/messaging",vj="@firebase/messaging-compat",bj="@firebase/performance",xj="@firebase/performance-compat",Tj="@firebase/remote-config",Ej="@firebase/remote-config-compat",Sj="@firebase/storage",Ij="@firebase/storage-compat",kj="@firebase/firestore",$j="@firebase/ai",Cj="@firebase/firestore-compat",Aj="firebase",Rj="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hw="[DEFAULT]",Pj={[dw]:"fire-core",[sj]:"fire-core-compat",[oj]:"fire-analytics",[aj]:"fire-analytics-compat",[uj]:"fire-app-check",[lj]:"fire-app-check-compat",[cj]:"fire-auth",[dj]:"fire-auth-compat",[hj]:"fire-rtdb",[fj]:"fire-data-connect",[pj]:"fire-rtdb-compat",[mj]:"fire-fn",[gj]:"fire-fn-compat",[yj]:"fire-iid",[_j]:"fire-iid-compat",[wj]:"fire-fcm",[vj]:"fire-fcm-compat",[bj]:"fire-perf",[xj]:"fire-perf-compat",[Tj]:"fire-rc",[Ej]:"fire-rc-compat",[Sj]:"fire-gcs",[Ij]:"fire-gcs-compat",[kj]:"fire-fst",[Cj]:"fire-fst-compat",[$j]:"fire-vertex","fire-js":"fire-js",[Aj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd=new Map,Nj=new Map,fw=new Map;function jT(t,e){try{t.container.addComponent(e)}catch(n){ps.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Do(t){const e=t.name;if(fw.has(e))return ps.debug(`There were multiple attempts to register component ${e}.`),!1;fw.set(e,t);for(const n of Gd.values())jT(n,t);for(const n of Nj.values())jT(n,t);return!0}function _g(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function jn(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ma=new _h("app","Firebase",Oj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dj{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new xa("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ma.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go=Rj;function rN(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:hw,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw ma.create("bad-app-name",{appName:String(i)});if(n||(n=JP()),!n)throw ma.create("no-options");const s=Gd.get(i);if(s){if(Oo(n,s.options)&&Oo(r,s.config))return s;throw ma.create("duplicate-app",{appName:i})}const a=new B6(i);for(const l of fw.values())a.addComponent(l);const o=new Dj(n,r,a);return Gd.set(i,o),o}function wb(t=hw){const e=Gd.get(t);if(!e&&t===hw&&JP())return rN();if(!e)throw ma.create("no-app",{appName:t});return e}function WT(){return Array.from(Gd.values())}function ki(t,e,n){let r=Pj[t]??t;n&&(r+=`-${n}`);const i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ps.warn(a.join(" "));return}Do(new xa(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mj="firebase-heartbeat-database",Lj=1,Kd="firebase-heartbeat-store";let Hy=null;function iN(){return Hy||(Hy=ej(Mj,Lj,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Kd)}catch(n){console.warn(n)}}}}).catch(t=>{throw ma.create("idb-open",{originalErrorMessage:t.message})})),Hy}async function zj(t){try{const n=(await iN()).transaction(Kd),r=await n.objectStore(Kd).get(sN(t));return await n.done,r}catch(e){if(e instanceof Vi)ps.warn(e.message);else{const n=ma.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ps.warn(n.message)}}}async function HT(t,e){try{const r=(await iN()).transaction(Kd,"readwrite");await r.objectStore(Kd).put(e,sN(t)),await r.done}catch(n){if(n instanceof Vi)ps.warn(n.message);else{const r=ma.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ps.warn(r.message)}}}function sN(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vj=1024,Fj=30;class Bj{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new jj(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=qT();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Fj){const a=Wj(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ps.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=qT(),{heartbeatsToSend:r,unsentEntries:i}=Uj(this._heartbeatsCache.heartbeats),s=pm(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return ps.warn(n),""}}}function qT(){return new Date().toISOString().substring(0,10)}function Uj(t,e=Vj){const n=[];let r=t.slice();for(const i of t){const s=n.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),GT(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),GT(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class jj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return C6()?A6().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await zj(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return HT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return HT(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function GT(t){return pm(JSON.stringify({version:2,heartbeats:t})).length}function Wj(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hj(t){Do(new xa("platform-logger",e=>new rj(e),"PRIVATE")),Do(new xa("heartbeat",e=>new Bj(e),"PRIVATE")),ki(dw,UT,t),ki(dw,UT,"esm2020"),ki("fire-js","")}Hj("");function aN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qj=aN,oN=new _h("auth","Firebase",aN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm=new yb("@firebase/auth");function Gj(t,...e){mm.logLevel<=Le.WARN&&mm.warn(`Auth (${Go}): ${t}`,...e)}function Sp(t,...e){mm.logLevel<=Le.ERROR&&mm.error(`Auth (${Go}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xr(t,...e){throw vb(t,...e)}function $i(t,...e){return vb(t,...e)}function lN(t,e,n){const r={...qj(),[e]:n};return new _h("auth","Firebase",r).create(e,{appName:t.name})}function Ci(t){return lN(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function vb(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return oN.create(t,...e)}function xe(t,e,...n){if(!t)throw vb(e,...n)}function os(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Sp(e),new Error(e)}function ms(t,e){t||os(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pw(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function Kj(){return KT()==="http:"||KT()==="https:"}function KT(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yj(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Kj()||S6()||"connection"in navigator)?navigator.onLine:!0}function Qj(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e,n){this.shortDelay=e,this.longDelay=n,ms(n>e,"Short delay should be less than long delay!"),this.isMobile=x6()||I6()}get(){return Yj()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(t,e){ms(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;os("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;os("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;os("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jj=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zj=new vh(3e4,6e4);function Ma(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function La(t,e,n,r,i={}){return cN(t,i,async()=>{let s={},a={};r&&(e==="GET"?a=r:s={body:JSON.stringify(r)});const o=wh({key:t.config.apiKey,...a}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const u={method:e,headers:l,...s};return E6()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&Da(t.emulatorConfig.host)&&(u.credentials="include"),uN.fetch()(await dN(t,t.config.apiHost,n,o),u)})}async function cN(t,e,n){t._canInitEmulator=!1;const r={...Xj,...e};try{const i=new t5(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Rf(t,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const o=s.ok?a.errorMessage:a.error.message,[l,u]=o.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Rf(t,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Rf(t,"email-already-in-use",a);if(l==="USER_DISABLED")throw Rf(t,"user-disabled",a);const c=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw lN(t,c,u);Xr(t,c)}}catch(i){if(i instanceof Vi)throw i;Xr(t,"network-request-failed",{message:String(i)})}}async function bh(t,e,n,r,i={}){const s=await La(t,e,n,r,i);return"mfaPendingCredential"in s&&Xr(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function dN(t,e,n,r){const i=`${e}${n}?${r}`,s=t,a=s.config.emulator?bb(t.config,i):`${t.config.apiScheme}://${i}`;return Jj.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(a).toString():a}function e5(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class t5{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r($i(this.auth,"network-request-failed")),Zj.get())})}}function Rf(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=$i(t,e,r);return i.customData._tokenResponse=n,i}function YT(t){return t!==void 0&&t.enterprise!==void 0}class n5{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return e5(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function r5(t,e){return La(t,"GET","/v2/recaptchaConfig",Ma(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i5(t,e){return La(t,"POST","/v1/accounts:delete",e)}async function gm(t,e){return La(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function s5(t,e=!1){const n=Wt(t),r=await n.getIdToken(e),i=xb(r);xe(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:fd(qy(i.auth_time)),issuedAtTime:fd(qy(i.iat)),expirationTime:fd(qy(i.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function qy(t){return Number(t)*1e3}function xb(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Sp("JWT malformed, contained fewer than 3 sections"),null;try{const i=YP(n);return i?JSON.parse(i):(Sp("Failed to decode base64 JWT payload"),null)}catch(i){return Sp("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function QT(t){const e=xb(t);return xe(e,"internal-error"),xe(typeof e.exp<"u","internal-error"),xe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yd(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Vi&&a5(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function a5({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=fd(this.lastLoginAt),this.creationTime=fd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ym(t){var d;const e=t.auth,n=await t.getIdToken(),r=await Yd(t,gm(e,{idToken:n}));xe(r==null?void 0:r.users.length,e,"internal-error");const i=r.users[0];t._notifyReloadListener(i);const s=(d=i.providerUserInfo)!=null&&d.length?hN(i.providerUserInfo):[],a=u5(t.providerData,s),o=t.isAnonymous,l=!(t.email&&i.passwordHash)&&!(a!=null&&a.length),u=o?l:!1,c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new mw(i.createdAt,i.lastLoginAt),isAnonymous:u};Object.assign(t,c)}async function l5(t){const e=Wt(t);await ym(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function u5(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function hN(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c5(t,e){const n=await cN(t,{},async()=>{const r=wh({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,a=await dN(t,i,"/v1/token",`key=${s}`),o=await t._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:o,body:r};return t.emulatorConfig&&Da(t.emulatorConfig.host)&&(l.credentials="include"),uN.fetch()(a,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function d5(t,e){return La(t,"POST","/v2/accounts:revokeToken",Ma(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){xe(e.idToken,"internal-error"),xe(typeof e.idToken<"u","internal-error"),xe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):QT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){xe(e.length!==0,"internal-error");const n=QT(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(xe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await c5(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,a=new Zl;return r&&(xe(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(xe(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(xe(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Zl,this.toJSON())}_performRefresh(){return os("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ms(t,e){xe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Ur{constructor({uid:e,auth:n,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new o5(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new mw(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const n=await Yd(this,this.stsTokenManager.getToken(this.auth,e));return xe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return s5(this,e)}reload(){return l5(this)}_assign(e){this!==e&&(xe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Ur({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){xe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await ym(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(jn(this.auth.app))return Promise.reject(Ci(this.auth));const e=await this.getIdToken();return await Yd(this,i5(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,i=n.email??void 0,s=n.phoneNumber??void 0,a=n.photoURL??void 0,o=n.tenantId??void 0,l=n._redirectEventId??void 0,u=n.createdAt??void 0,c=n.lastLoginAt??void 0,{uid:d,emailVerified:h,isAnonymous:m,providerData:g,stsTokenManager:w}=n;xe(d&&w,e,"internal-error");const x=Zl.fromJSON(this.name,w);xe(typeof d=="string",e,"internal-error"),Ms(r,e.name),Ms(i,e.name),xe(typeof h=="boolean",e,"internal-error"),xe(typeof m=="boolean",e,"internal-error"),Ms(s,e.name),Ms(a,e.name),Ms(o,e.name),Ms(l,e.name),Ms(u,e.name),Ms(c,e.name);const v=new Ur({uid:d,auth:e,email:i,emailVerified:h,displayName:r,isAnonymous:m,photoURL:a,phoneNumber:s,tenantId:o,stsTokenManager:x,createdAt:u,lastLoginAt:c});return g&&Array.isArray(g)&&(v.providerData=g.map(y=>({...y}))),l&&(v._redirectEventId=l),v}static async _fromIdTokenResponse(e,n,r=!1){const i=new Zl;i.updateFromServerResponse(n);const s=new Ur({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await ym(s),s}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];xe(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?hN(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),o=new Zl;o.updateFromIdToken(r);const l=new Ur({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:a}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new mw(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XT=new Map;function ls(t){ms(t instanceof Function,"Expected a class definition");let e=XT.get(t);return e?(ms(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,XT.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}fN.type="NONE";const JT=fN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ip(t,e,n){return`firebase:${t}:${e}:${n}`}class eu{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=Ip(this.userKey,i.apiKey,s),this.fullPersistenceKey=Ip("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await gm(this.auth,{idToken:e}).catch(()=>{});return n?Ur._fromGetAccountInfoResponse(this.auth,n,e):null}return Ur._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new eu(ls(JT),e,r);const i=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=i[0]||ls(JT);const a=Ip(r,e.config.apiKey,e.name);let o=null;for(const u of n)try{const c=await u._get(a);if(c){let d;if(typeof c=="string"){const h=await gm(e,{idToken:c}).catch(()=>{});if(!h)break;d=await Ur._fromGetAccountInfoResponse(e,h,c)}else d=Ur._fromJSON(e,c);u!==s&&(o=d),s=u;break}}catch{}const l=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new eu(s,e,r):(s=l[0],o&&await s._set(a,o.toJSON()),await Promise.all(n.map(async u=>{if(u!==s)try{await u._remove(a)}catch{}})),new eu(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZT(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yN(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(pN(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wN(e))return"Blackberry";if(vN(e))return"Webos";if(mN(e))return"Safari";if((e.includes("chrome/")||gN(e))&&!e.includes("edge/"))return"Chrome";if(_N(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function pN(t=xn()){return/firefox\//i.test(t)}function mN(t=xn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gN(t=xn()){return/crios\//i.test(t)}function yN(t=xn()){return/iemobile/i.test(t)}function _N(t=xn()){return/android/i.test(t)}function wN(t=xn()){return/blackberry/i.test(t)}function vN(t=xn()){return/webos/i.test(t)}function Tb(t=xn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function h5(t=xn()){var e;return Tb(t)&&!!((e=window.navigator)!=null&&e.standalone)}function f5(){return k6()&&document.documentMode===10}function bN(t=xn()){return Tb(t)||_N(t)||vN(t)||wN(t)||/windows phone/i.test(t)||yN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xN(t,e=[]){let n;switch(t){case"Browser":n=ZT(xn());break;case"Worker":n=`${ZT(xn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Go}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((a,o)=>{try{const l=e(s);a(l)}catch(l){o(l)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m5(t,e={}){return La(t,"GET","/v2/passwordPolicy",Ma(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g5=6;class y5{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??g5,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eE(this),this.idTokenSubscription=new eE(this),this.beforeStateQueue=new p5(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=oN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ls(n)),this._initializationPromise=this.queue(async()=>{var r,i,s;if(!this._deleted&&(this.persistenceManager=await eu.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((i=this._popupRedirectResolver)!=null&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)==null?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await gm(this,{idToken:e}),r=await Ur._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(jn(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(o,o))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)==null?void 0:s._redirectEventId,o=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!a||a===o)&&(l!=null&&l.user)&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return xe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await ym(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Qj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(jn(this.app))return Promise.reject(Ci(this));const n=e?Wt(e):null;return n&&xe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&xe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return jn(this.app)?Promise.reject(Ci(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return jn(this.app)?Promise.reject(Ci(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ls(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await m5(this),n=new y5(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new _h("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await d5(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ls(e)||this._popupRedirectResolver;xe(n,this,"argument-error"),this.redirectPersistenceManager=await eu.create(this,[ls(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let a=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(xe(o,this,"internal-error"),o.then(()=>{a||s(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,r,i);return()=>{a=!0,l()}}else{const l=e.addObserver(n);return()=>{a=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return xe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=xN(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var i;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((i=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:i.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(jn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&Gj(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function za(t){return Wt(t)}class eE{constructor(e){this.auth=e,this.observer=null,this.addObserver=D6(n=>this.observer=n)}get next(){return xe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wg={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function w5(t){wg=t}function TN(t){return wg.loadJS(t)}function v5(){return wg.recaptchaEnterpriseScript}function b5(){return wg.gapiScript}function x5(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class T5{constructor(){this.enterprise=new E5}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class E5{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const S5="recaptcha-enterprise",EN="NO_RECAPTCHA";class I5{constructor(e){this.type=S5,this.auth=za(e)}async verify(e="verify",n=!1){async function r(s){if(!n){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,o)=>{r5(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const u=new n5(l);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,a(u.siteKey)}}).catch(l=>{o(l)})})}function i(s,a,o){const l=window.grecaptcha;YT(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(u=>{a(u)}).catch(()=>{a(EN)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new T5().execute("siteKey",{action:"verify"}):new Promise((s,a)=>{r(this.auth).then(o=>{if(!n&&YT(window.grecaptcha))i(o,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let l=v5();l.length!==0&&(l+=o),TN(l).then(()=>{i(o,s,a)}).catch(u=>{a(u)})}}).catch(o=>{a(o)})})}}async function tE(t,e,n,r=!1,i=!1){const s=new I5(t);let a;if(i)a=EN;else try{a=await s.verify(n)}catch{a=await s.verify(n,!0)}const o={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const l=o.phoneEnrollmentInfo.phoneNumber,u=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const l=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function gw(t,e,n,r,i){var s;if((s=t._getRecaptchaConfig())!=null&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await tE(t,e,n,n==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await tE(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k5(t,e){const n=_g(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(Oo(s,e??{}))return i;Xr(i,"already-initialized")}return n.initialize({options:e})}function $5(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ls);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function C5(t,e,n){const r=za(t);xe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=SN(e),{host:a,port:o}=A5(e),l=o===null?"":`:${o}`,u={url:`${s}//${a}${l}/`},c=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){xe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),xe(Oo(u,r.config.emulator)&&Oo(c,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Da(a)?(mb(`${s}//${a}${l}`),gb("Auth",!0)):R5()}function SN(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function A5(t){const e=SN(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:nE(r.substr(s.length+1))}}else{const[s,a]=r.split(":");return{host:s,port:nE(a)}}}function nE(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function R5(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eb{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return os("not implemented")}_getIdTokenResponse(e){return os("not implemented")}_linkToIdToken(e,n){return os("not implemented")}_getReauthenticationResolver(e){return os("not implemented")}}async function P5(t,e){return La(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N5(t,e){return bh(t,"POST","/v1/accounts:signInWithPassword",Ma(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O5(t,e){return bh(t,"POST","/v1/accounts:signInWithEmailLink",Ma(t,e))}async function D5(t,e){return bh(t,"POST","/v1/accounts:signInWithEmailLink",Ma(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd extends Eb{constructor(e,n,r,i=null){super("password",r),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Qd(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Qd(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return gw(e,n,"signInWithPassword",N5);case"emailLink":return O5(e,{email:this._email,oobCode:this._password});default:Xr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return gw(e,r,"signUpPassword",P5);case"emailLink":return D5(e,{idToken:n,email:this._email,oobCode:this._password});default:Xr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tu(t,e){return bh(t,"POST","/v1/accounts:signInWithIdp",Ma(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M5="http://localhost";class Mo extends Eb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Mo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Xr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=n;if(!r||!i)return null;const a=new Mo(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return tu(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,tu(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,tu(e,n)}buildRequest(){const e={requestUri:M5,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=wh(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L5(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function z5(t){const e=Hc(qc(t)).link,n=e?Hc(qc(e)).deep_link_id:null,r=Hc(qc(t)).deep_link_id;return(r?Hc(qc(r)).link:null)||r||n||e||t}class Sb{constructor(e){const n=Hc(qc(e)),r=n.apiKey??null,i=n.oobCode??null,s=L5(n.mode??null);xe(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=z5(e);try{return new Sb(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(){this.providerId=Nu.PROVIDER_ID}static credential(e,n){return Qd._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Sb.parseLink(n);return xe(r,"argument-error"),Qd._fromEmailAndCode(e,r.code,r.tenantId)}}Nu.PROVIDER_ID="password";Nu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Nu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh extends IN{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends xh{constructor(){super("facebook.com")}static credential(e){return Mo._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qs.credential(e.oauthAccessToken)}catch{return null}}}qs.FACEBOOK_SIGN_IN_METHOD="facebook.com";qs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends xh{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Mo._fromParams({providerId:Gs.PROVIDER_ID,signInMethod:Gs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Gs.credentialFromTaggedObject(e)}static credentialFromError(e){return Gs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Gs.credential(n,r)}catch{return null}}}Gs.GOOGLE_SIGN_IN_METHOD="google.com";Gs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks extends xh{constructor(){super("github.com")}static credential(e){return Mo._fromParams({providerId:Ks.PROVIDER_ID,signInMethod:Ks.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ks.credentialFromTaggedObject(e)}static credentialFromError(e){return Ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ks.credential(e.oauthAccessToken)}catch{return null}}}Ks.GITHUB_SIGN_IN_METHOD="github.com";Ks.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends xh{constructor(){super("twitter.com")}static credential(e,n){return Mo._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ys.credential(n,r)}catch{return null}}}Ys.TWITTER_SIGN_IN_METHOD="twitter.com";Ys.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kN(t,e){return bh(t,"POST","/v1/accounts:signUp",Ma(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await Ur._fromIdTokenResponse(e,r,i),a=rE(r);return new gs({user:s,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=rE(r);return new gs({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function rE(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V5(t){var i;if(jn(t.app))return Promise.reject(Ci(t));const e=za(t);if(await e._initializationPromise,(i=e.currentUser)!=null&&i.isAnonymous)return new gs({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await kN(e,{returnSecureToken:!0}),r=await gs._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m extends Vi{constructor(e,n,r,i){super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,_m.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new _m(e,n,r,i)}}function $N(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?_m._fromErrorAndOperation(t,s,e,r):s})}async function F5(t,e,n=!1){const r=await Yd(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return gs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B5(t,e,n=!1){const{auth:r}=t;if(jn(r.app))return Promise.reject(Ci(r));const i="reauthenticate";try{const s=await Yd(t,$N(r,i,e,t),n);xe(s.idToken,r,"internal-error");const a=xb(s.idToken);xe(a,r,"internal-error");const{sub:o}=a;return xe(t.uid===o,r,"user-mismatch"),gs._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Xr(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CN(t,e,n=!1){if(jn(t.app))return Promise.reject(Ci(t));const r="signIn",i=await $N(t,r,e),s=await gs._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}async function U5(t,e){return CN(za(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AN(t){const e=za(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function j5(t,e,n){if(jn(t.app))return Promise.reject(Ci(t));const r=za(t),a=await gw(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",kN).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&AN(t),l}),o=await gs._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(o.user),o}function W5(t,e,n){return jn(t.app)?Promise.reject(Ci(t)):U5(Wt(t),Nu.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&AN(t),r})}function H5(t,e,n,r){return Wt(t).onIdTokenChanged(e,n,r)}function q5(t,e,n){return Wt(t).beforeAuthStateChanged(e,n)}function G5(t,e,n,r){return Wt(t).onAuthStateChanged(e,n,r)}function K5(t){return Wt(t).signOut()}const wm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RN{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(wm,"1"),this.storage.removeItem(wm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y5=1e3,Q5=10;class PN extends RN{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bN(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,o,l)=>{this.notifyListeners(a,l)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},s=this.storage.getItem(r);f5()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Q5):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Y5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}PN.type="LOCAL";const X5=PN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN extends RN{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}NN.type="SESSION";const ON=NN;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J5(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new vg(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const o=Array.from(a).map(async u=>u(n.origin,s)),l=await J5(o);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}vg.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ib(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((o,l)=>{const u=Ib("",20);i.port1.start();const c=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(d){const h=d;if(h.data.eventId===u)switch(h.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(h.data.response);break;default:clearTimeout(c),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ai(){return window}function e9(t){Ai().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DN(){return typeof Ai().WorkerGlobalScope<"u"&&typeof Ai().importScripts=="function"}async function t9(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function n9(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function r9(){return DN()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MN="firebaseLocalStorageDb",i9=1,vm="firebaseLocalStorage",LN="fbase_key";class Th{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function bg(t,e){return t.transaction([vm],e?"readwrite":"readonly").objectStore(vm)}function s9(){const t=indexedDB.deleteDatabase(MN);return new Th(t).toPromise()}function yw(){const t=indexedDB.open(MN,i9);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(vm,{keyPath:LN})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(vm)?e(r):(r.close(),await s9(),e(await yw()))})})}async function iE(t,e,n){const r=bg(t,!0).put({[LN]:e,value:n});return new Th(r).toPromise()}async function a9(t,e){const n=bg(t,!1).get(e),r=await new Th(n).toPromise();return r===void 0?null:r.value}function sE(t,e){const n=bg(t,!0).delete(e);return new Th(n).toPromise()}const o9=800,l9=3;class zN{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await yw(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>l9)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return DN()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=vg._getInstance(r9()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await t9(),!this.activeServiceWorker)return;this.sender=new Z5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||n9()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yw();return await iE(e,wm,"1"),await sE(e,wm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>iE(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>a9(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>sE(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=bg(i,!1).getAll();return new Th(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),o9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zN.type="LOCAL";const u9=zN;new vh(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c9(t,e){return e?ls(e):(xe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb extends Eb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return tu(e,this._buildIdpRequest())}_linkToIdToken(e,n){return tu(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return tu(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function d9(t){return CN(t.auth,new kb(t),t.bypassAuthState)}function h9(t){const{auth:e,user:n}=t;return xe(n,e,"internal-error"),B5(n,new kb(t),t.bypassAuthState)}async function f9(t){const{auth:e,user:n}=t;return xe(n,e,"internal-error"),F5(n,new kb(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:a,type:o}=e;if(a){this.reject(a);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return d9;case"linkViaPopup":case"linkViaRedirect":return f9;case"reauthViaPopup":case"reauthViaRedirect":return h9;default:Xr(this.auth,"internal-error")}}resolve(e){ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ms(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p9=new vh(2e3,1e4);class jl extends VN{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,jl.currentPopupAction&&jl.currentPopupAction.cancel(),jl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return xe(e,this.auth,"internal-error"),e}async onExecution(){ms(this.filter.length===1,"Popup operations only handle one event");const e=Ib();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject($i(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject($i(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,jl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($i(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,p9.get())};e()}}jl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m9="pendingRedirect",kp=new Map;class g9 extends VN{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=kp.get(this.auth._key());if(!e){try{const r=await y9(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}kp.set(this.auth._key(),e)}return this.bypassAuthState||kp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function y9(t,e){const n=v9(e),r=w9(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function _9(t,e){kp.set(t._key(),e)}function w9(t){return ls(t._redirectPersistence)}function v9(t){return Ip(m9,t.config.apiKey,t.name)}async function b9(t,e,n=!1){if(jn(t.app))return Promise.reject(Ci(t));const r=za(t),i=c9(r,e),a=await new g9(r,i,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x9=10*60*1e3;class T9{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!E9(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!FN(e)){const i=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError($i(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=x9&&this.cachedEventUids.clear(),this.cachedEventUids.has(aE(e))}saveEventToCache(e){this.cachedEventUids.add(aE(e)),this.lastProcessedEventTime=Date.now()}}function aE(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function FN({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function E9(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return FN(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S9(t,e={}){return La(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I9=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,k9=/^https?/;async function $9(t){if(t.config.emulator)return;const{authorizedDomains:e}=await S9(t);for(const n of e)try{if(C9(n))return}catch{}Xr(t,"unauthorized-domain")}function C9(t){const e=pw(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!k9.test(n))return!1;if(I9.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A9=new vh(3e4,6e4);function oE(){const t=Ai().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function R9(t){return new Promise((e,n)=>{var i,s,a;function r(){oE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{oE(),n($i(t,"network-request-failed"))},timeout:A9.get()})}if((s=(i=Ai().gapi)==null?void 0:i.iframes)!=null&&s.Iframe)e(gapi.iframes.getContext());else if((a=Ai().gapi)!=null&&a.load)r();else{const o=x5("iframefcb");return Ai()[o]=()=>{gapi.load?r():n($i(t,"network-request-failed"))},TN(`${b5()}?onload=${o}`).catch(l=>n(l))}}).catch(e=>{throw $p=null,e})}let $p=null;function P9(t){return $p=$p||R9(t),$p}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N9=new vh(5e3,15e3),O9="__/auth/iframe",D9="emulator/auth/iframe",M9={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},L9=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function z9(t){const e=t.config;xe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?bb(e,D9):`https://${t.config.authDomain}/${O9}`,r={apiKey:e.apiKey,appName:t.name,v:Go},i=L9.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${wh(r).slice(1)}`}async function V9(t){const e=await P9(t),n=Ai().gapi;return xe(n,t,"internal-error"),e.open({where:document.body,url:z9(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:M9,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const a=$i(t,"network-request-failed"),o=Ai().setTimeout(()=>{s(a)},N9.get());function l(){Ai().clearTimeout(o),i(r)}r.ping(l).then(l,()=>{s(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F9={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},B9=500,U9=600,j9="_blank",W9="http://localhost";class lE{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function H9(t,e,n,r=B9,i=U9){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l={...F9,width:r.toString(),height:i.toString(),top:s,left:a},u=xn().toLowerCase();n&&(o=gN(u)?j9:n),pN(u)&&(e=e||W9,l.scrollbars="yes");const c=Object.entries(l).reduce((h,[m,g])=>`${h}${m}=${g},`,"");if(h5(u)&&o!=="_self")return q9(e||"",o),new lE(null);const d=window.open(e||"",o,c);xe(d,t,"popup-blocked");try{d.focus()}catch{}return new lE(d)}function q9(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G9="__/auth/handler",K9="emulator/auth/handler",Y9=encodeURIComponent("fac");async function uE(t,e,n,r,i,s){xe(t.config.authDomain,t,"auth-domain-config-required"),xe(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Go,eventId:i};if(e instanceof IN){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",O6(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,d]of Object.entries({}))a[c]=d}if(e instanceof xh){const c=e.getScopes().filter(d=>d!=="");c.length>0&&(a.scopes=c.join(","))}t.tenantId&&(a.tid=t.tenantId);const o=a;for(const c of Object.keys(o))o[c]===void 0&&delete o[c];const l=await t._getAppCheckToken(),u=l?`#${Y9}=${encodeURIComponent(l)}`:"";return`${Q9(t)}?${wh(o).slice(1)}${u}`}function Q9({config:t}){return t.emulator?bb(t,K9):`https://${t.authDomain}/${G9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy="webStorageSupport";class X9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ON,this._completeRedirectFn=b9,this._overrideRedirectResult=_9}async _openPopup(e,n,r,i){var a;ms((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await uE(e,n,r,pw(),i);return H9(e,s,Ib())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await uE(e,n,r,pw(),i);return e9(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(ms(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await V9(e),r=new T9(e);return n.register("authEvent",i=>(xe(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Gy,{type:Gy},i=>{var a;const s=(a=i==null?void 0:i[0])==null?void 0:a[Gy];s!==void 0&&n(!!s),Xr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=$9(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return bN()||mN()||Tb()}}const J9=X9;var cE="@firebase/auth",dE="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z9{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){xe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eW(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function tW(t){Do(new xa("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;xe(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:xN(t)},u=new _5(r,i,s,l);return $5(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Do(new xa("auth-internal",e=>{const n=za(e.getProvider("auth").getImmediate());return(r=>new Z9(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ki(cE,dE,eW(t)),ki(cE,dE,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nW=5*60,rW=ZP("authIdTokenMaxAge")||nW;let hE=null;const iW=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>rW)return;const i=n==null?void 0:n.token;hE!==i&&(hE=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function sW(t=wb()){const e=_g(t,"auth");if(e.isInitialized())return e.getImmediate();const n=k5(t,{popupRedirectResolver:J9,persistence:[u9,X5,ON]}),r=ZP("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const a=iW(s.toString());q5(n,a,()=>a(n.currentUser)),H5(n,o=>a(o))}}const i=QP("auth");return i&&C5(n,`http://${i}`),n}function aW(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}w5({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=$i("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",aW().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});tW("Browser");var oW="firebase",lW="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ki(oW,lW,"app");var fE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ga,BN;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,_){function A(){}A.prototype=_.prototype,k.F=_.prototype,k.prototype=new A,k.prototype.constructor=k,k.D=function(N,L,V){for(var M=Array(arguments.length-2),B=2;B<arguments.length;B++)M[B-2]=arguments[B];return _.prototype[L].apply(N,M)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,_,A){A||(A=0);const N=Array(16);if(typeof _=="string")for(var L=0;L<16;++L)N[L]=_.charCodeAt(A++)|_.charCodeAt(A++)<<8|_.charCodeAt(A++)<<16|_.charCodeAt(A++)<<24;else for(L=0;L<16;++L)N[L]=_[A++]|_[A++]<<8|_[A++]<<16|_[A++]<<24;_=k.g[0],A=k.g[1],L=k.g[2];let V=k.g[3],M;M=_+(V^A&(L^V))+N[0]+3614090360&4294967295,_=A+(M<<7&4294967295|M>>>25),M=V+(L^_&(A^L))+N[1]+3905402710&4294967295,V=_+(M<<12&4294967295|M>>>20),M=L+(A^V&(_^A))+N[2]+606105819&4294967295,L=V+(M<<17&4294967295|M>>>15),M=A+(_^L&(V^_))+N[3]+3250441966&4294967295,A=L+(M<<22&4294967295|M>>>10),M=_+(V^A&(L^V))+N[4]+4118548399&4294967295,_=A+(M<<7&4294967295|M>>>25),M=V+(L^_&(A^L))+N[5]+1200080426&4294967295,V=_+(M<<12&4294967295|M>>>20),M=L+(A^V&(_^A))+N[6]+2821735955&4294967295,L=V+(M<<17&4294967295|M>>>15),M=A+(_^L&(V^_))+N[7]+4249261313&4294967295,A=L+(M<<22&4294967295|M>>>10),M=_+(V^A&(L^V))+N[8]+1770035416&4294967295,_=A+(M<<7&4294967295|M>>>25),M=V+(L^_&(A^L))+N[9]+2336552879&4294967295,V=_+(M<<12&4294967295|M>>>20),M=L+(A^V&(_^A))+N[10]+4294925233&4294967295,L=V+(M<<17&4294967295|M>>>15),M=A+(_^L&(V^_))+N[11]+2304563134&4294967295,A=L+(M<<22&4294967295|M>>>10),M=_+(V^A&(L^V))+N[12]+1804603682&4294967295,_=A+(M<<7&4294967295|M>>>25),M=V+(L^_&(A^L))+N[13]+4254626195&4294967295,V=_+(M<<12&4294967295|M>>>20),M=L+(A^V&(_^A))+N[14]+2792965006&4294967295,L=V+(M<<17&4294967295|M>>>15),M=A+(_^L&(V^_))+N[15]+1236535329&4294967295,A=L+(M<<22&4294967295|M>>>10),M=_+(L^V&(A^L))+N[1]+4129170786&4294967295,_=A+(M<<5&4294967295|M>>>27),M=V+(A^L&(_^A))+N[6]+3225465664&4294967295,V=_+(M<<9&4294967295|M>>>23),M=L+(_^A&(V^_))+N[11]+643717713&4294967295,L=V+(M<<14&4294967295|M>>>18),M=A+(V^_&(L^V))+N[0]+3921069994&4294967295,A=L+(M<<20&4294967295|M>>>12),M=_+(L^V&(A^L))+N[5]+3593408605&4294967295,_=A+(M<<5&4294967295|M>>>27),M=V+(A^L&(_^A))+N[10]+38016083&4294967295,V=_+(M<<9&4294967295|M>>>23),M=L+(_^A&(V^_))+N[15]+3634488961&4294967295,L=V+(M<<14&4294967295|M>>>18),M=A+(V^_&(L^V))+N[4]+3889429448&4294967295,A=L+(M<<20&4294967295|M>>>12),M=_+(L^V&(A^L))+N[9]+568446438&4294967295,_=A+(M<<5&4294967295|M>>>27),M=V+(A^L&(_^A))+N[14]+3275163606&4294967295,V=_+(M<<9&4294967295|M>>>23),M=L+(_^A&(V^_))+N[3]+4107603335&4294967295,L=V+(M<<14&4294967295|M>>>18),M=A+(V^_&(L^V))+N[8]+1163531501&4294967295,A=L+(M<<20&4294967295|M>>>12),M=_+(L^V&(A^L))+N[13]+2850285829&4294967295,_=A+(M<<5&4294967295|M>>>27),M=V+(A^L&(_^A))+N[2]+4243563512&4294967295,V=_+(M<<9&4294967295|M>>>23),M=L+(_^A&(V^_))+N[7]+1735328473&4294967295,L=V+(M<<14&4294967295|M>>>18),M=A+(V^_&(L^V))+N[12]+2368359562&4294967295,A=L+(M<<20&4294967295|M>>>12),M=_+(A^L^V)+N[5]+4294588738&4294967295,_=A+(M<<4&4294967295|M>>>28),M=V+(_^A^L)+N[8]+2272392833&4294967295,V=_+(M<<11&4294967295|M>>>21),M=L+(V^_^A)+N[11]+1839030562&4294967295,L=V+(M<<16&4294967295|M>>>16),M=A+(L^V^_)+N[14]+4259657740&4294967295,A=L+(M<<23&4294967295|M>>>9),M=_+(A^L^V)+N[1]+2763975236&4294967295,_=A+(M<<4&4294967295|M>>>28),M=V+(_^A^L)+N[4]+1272893353&4294967295,V=_+(M<<11&4294967295|M>>>21),M=L+(V^_^A)+N[7]+4139469664&4294967295,L=V+(M<<16&4294967295|M>>>16),M=A+(L^V^_)+N[10]+3200236656&4294967295,A=L+(M<<23&4294967295|M>>>9),M=_+(A^L^V)+N[13]+681279174&4294967295,_=A+(M<<4&4294967295|M>>>28),M=V+(_^A^L)+N[0]+3936430074&4294967295,V=_+(M<<11&4294967295|M>>>21),M=L+(V^_^A)+N[3]+3572445317&4294967295,L=V+(M<<16&4294967295|M>>>16),M=A+(L^V^_)+N[6]+76029189&4294967295,A=L+(M<<23&4294967295|M>>>9),M=_+(A^L^V)+N[9]+3654602809&4294967295,_=A+(M<<4&4294967295|M>>>28),M=V+(_^A^L)+N[12]+3873151461&4294967295,V=_+(M<<11&4294967295|M>>>21),M=L+(V^_^A)+N[15]+530742520&4294967295,L=V+(M<<16&4294967295|M>>>16),M=A+(L^V^_)+N[2]+3299628645&4294967295,A=L+(M<<23&4294967295|M>>>9),M=_+(L^(A|~V))+N[0]+4096336452&4294967295,_=A+(M<<6&4294967295|M>>>26),M=V+(A^(_|~L))+N[7]+1126891415&4294967295,V=_+(M<<10&4294967295|M>>>22),M=L+(_^(V|~A))+N[14]+2878612391&4294967295,L=V+(M<<15&4294967295|M>>>17),M=A+(V^(L|~_))+N[5]+4237533241&4294967295,A=L+(M<<21&4294967295|M>>>11),M=_+(L^(A|~V))+N[12]+1700485571&4294967295,_=A+(M<<6&4294967295|M>>>26),M=V+(A^(_|~L))+N[3]+2399980690&4294967295,V=_+(M<<10&4294967295|M>>>22),M=L+(_^(V|~A))+N[10]+4293915773&4294967295,L=V+(M<<15&4294967295|M>>>17),M=A+(V^(L|~_))+N[1]+2240044497&4294967295,A=L+(M<<21&4294967295|M>>>11),M=_+(L^(A|~V))+N[8]+1873313359&4294967295,_=A+(M<<6&4294967295|M>>>26),M=V+(A^(_|~L))+N[15]+4264355552&4294967295,V=_+(M<<10&4294967295|M>>>22),M=L+(_^(V|~A))+N[6]+2734768916&4294967295,L=V+(M<<15&4294967295|M>>>17),M=A+(V^(L|~_))+N[13]+1309151649&4294967295,A=L+(M<<21&4294967295|M>>>11),M=_+(L^(A|~V))+N[4]+4149444226&4294967295,_=A+(M<<6&4294967295|M>>>26),M=V+(A^(_|~L))+N[11]+3174756917&4294967295,V=_+(M<<10&4294967295|M>>>22),M=L+(_^(V|~A))+N[2]+718787259&4294967295,L=V+(M<<15&4294967295|M>>>17),M=A+(V^(L|~_))+N[9]+3951481745&4294967295,k.g[0]=k.g[0]+_&4294967295,k.g[1]=k.g[1]+(L+(M<<21&4294967295|M>>>11))&4294967295,k.g[2]=k.g[2]+L&4294967295,k.g[3]=k.g[3]+V&4294967295}r.prototype.v=function(k,_){_===void 0&&(_=k.length);const A=_-this.blockSize,N=this.C;let L=this.h,V=0;for(;V<_;){if(L==0)for(;V<=A;)i(this,k,V),V+=this.blockSize;if(typeof k=="string"){for(;V<_;)if(N[L++]=k.charCodeAt(V++),L==this.blockSize){i(this,N),L=0;break}}else for(;V<_;)if(N[L++]=k[V++],L==this.blockSize){i(this,N),L=0;break}}this.h=L,this.o+=_},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var _=1;_<k.length-8;++_)k[_]=0;_=this.o*8;for(var A=k.length-8;A<k.length;++A)k[A]=_&255,_/=256;for(this.v(k),k=Array(16),_=0,A=0;A<4;++A)for(let N=0;N<32;N+=8)k[_++]=this.g[A]>>>N&255;return k};function s(k,_){var A=o;return Object.prototype.hasOwnProperty.call(A,k)?A[k]:A[k]=_(k)}function a(k,_){this.h=_;const A=[];let N=!0;for(let L=k.length-1;L>=0;L--){const V=k[L]|0;N&&V==_||(A[L]=V,N=!1)}this.g=A}var o={};function l(k){return-128<=k&&k<128?s(k,function(_){return new a([_|0],_<0?-1:0)}):new a([k|0],k<0?-1:0)}function u(k){if(isNaN(k)||!isFinite(k))return d;if(k<0)return x(u(-k));const _=[];let A=1;for(let N=0;k>=A;N++)_[N]=k/A|0,A*=4294967296;return new a(_,0)}function c(k,_){if(k.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(k.charAt(0)=="-")return x(c(k.substring(1),_));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const A=u(Math.pow(_,8));let N=d;for(let V=0;V<k.length;V+=8){var L=Math.min(8,k.length-V);const M=parseInt(k.substring(V,V+L),_);L<8?(L=u(Math.pow(_,L)),N=N.j(L).add(u(M))):(N=N.j(A),N=N.add(u(M)))}return N}var d=l(0),h=l(1),m=l(16777216);t=a.prototype,t.m=function(){if(w(this))return-x(this).m();let k=0,_=1;for(let A=0;A<this.g.length;A++){const N=this.i(A);k+=(N>=0?N:4294967296+N)*_,_*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(g(this))return"0";if(w(this))return"-"+x(this).toString(k);const _=u(Math.pow(k,6));var A=this;let N="";for(;;){const L=$(A,_).g;A=v(A,L.j(_));let V=((A.g.length>0?A.g[0]:A.h)>>>0).toString(k);if(A=L,g(A))return V+N;for(;V.length<6;)V="0"+V;N=V+N}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function g(k){if(k.h!=0)return!1;for(let _=0;_<k.g.length;_++)if(k.g[_]!=0)return!1;return!0}function w(k){return k.h==-1}t.l=function(k){return k=v(this,k),w(k)?-1:g(k)?0:1};function x(k){const _=k.g.length,A=[];for(let N=0;N<_;N++)A[N]=~k.g[N];return new a(A,~k.h).add(h)}t.abs=function(){return w(this)?x(this):this},t.add=function(k){const _=Math.max(this.g.length,k.g.length),A=[];let N=0;for(let L=0;L<=_;L++){let V=N+(this.i(L)&65535)+(k.i(L)&65535),M=(V>>>16)+(this.i(L)>>>16)+(k.i(L)>>>16);N=M>>>16,V&=65535,M&=65535,A[L]=M<<16|V}return new a(A,A[A.length-1]&-2147483648?-1:0)};function v(k,_){return k.add(x(_))}t.j=function(k){if(g(this)||g(k))return d;if(w(this))return w(k)?x(this).j(x(k)):x(x(this).j(k));if(w(k))return x(this.j(x(k)));if(this.l(m)<0&&k.l(m)<0)return u(this.m()*k.m());const _=this.g.length+k.g.length,A=[];for(var N=0;N<2*_;N++)A[N]=0;for(N=0;N<this.g.length;N++)for(let L=0;L<k.g.length;L++){const V=this.i(N)>>>16,M=this.i(N)&65535,B=k.i(L)>>>16,Z=k.i(L)&65535;A[2*N+2*L]+=M*Z,y(A,2*N+2*L),A[2*N+2*L+1]+=V*Z,y(A,2*N+2*L+1),A[2*N+2*L+1]+=M*B,y(A,2*N+2*L+1),A[2*N+2*L+2]+=V*B,y(A,2*N+2*L+2)}for(k=0;k<_;k++)A[k]=A[2*k+1]<<16|A[2*k];for(k=_;k<2*_;k++)A[k]=0;return new a(A,0)};function y(k,_){for(;(k[_]&65535)!=k[_];)k[_+1]+=k[_]>>>16,k[_]&=65535,_++}function E(k,_){this.g=k,this.h=_}function $(k,_){if(g(_))throw Error("division by zero");if(g(k))return new E(d,d);if(w(k))return _=$(x(k),_),new E(x(_.g),x(_.h));if(w(_))return _=$(k,x(_)),new E(x(_.g),_.h);if(k.g.length>30){if(w(k)||w(_))throw Error("slowDivide_ only works with positive integers.");for(var A=h,N=_;N.l(k)<=0;)A=R(A),N=R(N);var L=D(A,1),V=D(N,1);for(N=D(N,2),A=D(A,2);!g(N);){var M=V.add(N);M.l(k)<=0&&(L=L.add(A),V=M),N=D(N,1),A=D(A,1)}return _=v(k,L.j(_)),new E(L,_)}for(L=d;k.l(_)>=0;){for(A=Math.max(1,Math.floor(k.m()/_.m())),N=Math.ceil(Math.log(A)/Math.LN2),N=N<=48?1:Math.pow(2,N-48),V=u(A),M=V.j(_);w(M)||M.l(k)>0;)A-=N,V=u(A),M=V.j(_);g(V)&&(V=h),L=L.add(V),k=v(k,M)}return new E(L,k)}t.B=function(k){return $(this,k).h},t.and=function(k){const _=Math.max(this.g.length,k.g.length),A=[];for(let N=0;N<_;N++)A[N]=this.i(N)&k.i(N);return new a(A,this.h&k.h)},t.or=function(k){const _=Math.max(this.g.length,k.g.length),A=[];for(let N=0;N<_;N++)A[N]=this.i(N)|k.i(N);return new a(A,this.h|k.h)},t.xor=function(k){const _=Math.max(this.g.length,k.g.length),A=[];for(let N=0;N<_;N++)A[N]=this.i(N)^k.i(N);return new a(A,this.h^k.h)};function R(k){const _=k.g.length+1,A=[];for(let N=0;N<_;N++)A[N]=k.i(N)<<1|k.i(N-1)>>>31;return new a(A,k.h)}function D(k,_){const A=_>>5;_%=32;const N=k.g.length-A,L=[];for(let V=0;V<N;V++)L[V]=_>0?k.i(V+A)>>>_|k.i(V+A+1)<<32-_:k.i(V+A);return new a(L,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,BN=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=u,a.fromString=c,ga=a}).apply(typeof fE<"u"?fE:typeof self<"u"?self:typeof window<"u"?window:{});var Pf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var UN,Gc,jN,Cp,_w,WN,HN,qN;(function(){var t,e=Object.defineProperty;function n(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Pf=="object"&&Pf];for(var T=0;T<f.length;++T){var C=f[T];if(C&&C.Math==Math)return C}throw Error("Cannot find global object")}var r=n(this);function i(f,T){if(T)e:{var C=r;f=f.split(".");for(var z=0;z<f.length-1;z++){var W=f[z];if(!(W in C))break e;C=C[W]}f=f[f.length-1],z=C[f],T=T(z),T!=z&&T!=null&&e(C,f,{configurable:!0,writable:!0,value:T})}}i("Symbol.dispose",function(f){return f||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(f){return f||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(f){return f||function(T){var C=[],z;for(z in T)Object.prototype.hasOwnProperty.call(T,z)&&C.push([z,T[z]]);return C}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},a=this||self;function o(f){var T=typeof f;return T=="object"&&f!=null||T=="function"}function l(f,T,C){return f.call.apply(f.bind,arguments)}function u(f,T,C){return u=l,u.apply(null,arguments)}function c(f,T){var C=Array.prototype.slice.call(arguments,1);return function(){var z=C.slice();return z.push.apply(z,arguments),f.apply(this,z)}}function d(f,T){function C(){}C.prototype=T.prototype,f.Z=T.prototype,f.prototype=new C,f.prototype.constructor=f,f.Ob=function(z,W,K){for(var ce=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)ce[Ae-2]=arguments[Ae];return T.prototype[W].apply(z,ce)}}var h=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?f=>f&&AsyncContext.Snapshot.wrap(f):f=>f;function m(f){const T=f.length;if(T>0){const C=Array(T);for(let z=0;z<T;z++)C[z]=f[z];return C}return[]}function g(f,T){for(let z=1;z<arguments.length;z++){const W=arguments[z];var C=typeof W;if(C=C!="object"?C:W?Array.isArray(W)?"array":C:"null",C=="array"||C=="object"&&typeof W.length=="number"){C=f.length||0;const K=W.length||0;f.length=C+K;for(let ce=0;ce<K;ce++)f[C+ce]=W[ce]}else f.push(W)}}class w{constructor(T,C){this.i=T,this.j=C,this.h=0,this.g=null}get(){let T;return this.h>0?(this.h--,T=this.g,this.g=T.next,T.next=null):T=this.i(),T}}function x(f){a.setTimeout(()=>{throw f},0)}function v(){var f=k;let T=null;return f.g&&(T=f.g,f.g=f.g.next,f.g||(f.h=null),T.next=null),T}class y{constructor(){this.h=this.g=null}add(T,C){const z=E.get();z.set(T,C),this.h?this.h.next=z:this.g=z,this.h=z}}var E=new w(()=>new $,f=>f.reset());class ${constructor(){this.next=this.g=this.h=null}set(T,C){this.h=T,this.g=C,this.next=null}reset(){this.next=this.g=this.h=null}}let R,D=!1,k=new y,_=()=>{const f=Promise.resolve(void 0);R=()=>{f.then(A)}};function A(){for(var f;f=v();){try{f.h.call(f.g)}catch(C){x(C)}var T=E;T.j(f),T.h<100&&(T.h++,f.next=T.g,T.g=f)}D=!1}function N(){this.u=this.u,this.C=this.C}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function L(f,T){this.type=f,this.g=this.target=T,this.defaultPrevented=!1}L.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var f=!1,T=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const C=()=>{};a.addEventListener("test",C,T),a.removeEventListener("test",C,T)}catch{}return f}();function M(f){return/^[\s\xa0]*$/.test(f)}function B(f,T){L.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f&&this.init(f,T)}d(B,L),B.prototype.init=function(f,T){const C=this.type=f.type,z=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;this.target=f.target||f.srcElement,this.g=T,T=f.relatedTarget,T||(C=="mouseover"?T=f.fromElement:C=="mouseout"&&(T=f.toElement)),this.relatedTarget=T,z?(this.clientX=z.clientX!==void 0?z.clientX:z.pageX,this.clientY=z.clientY!==void 0?z.clientY:z.pageY,this.screenX=z.screenX||0,this.screenY=z.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=f.pointerType,this.state=f.state,this.i=f,f.defaultPrevented&&B.Z.h.call(this)},B.prototype.h=function(){B.Z.h.call(this);const f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var Z="closure_listenable_"+(Math.random()*1e6|0),ie=0;function de(f,T,C,z,W){this.listener=f,this.proxy=null,this.src=T,this.type=C,this.capture=!!z,this.ha=W,this.key=++ie,this.da=this.fa=!1}function ee(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Y(f,T,C){for(const z in f)T.call(C,f[z],z,f)}function J(f,T){for(const C in f)T.call(void 0,f[C],C,f)}function G(f){const T={};for(const C in f)T[C]=f[C];return T}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(f,T){let C,z;for(let W=1;W<arguments.length;W++){z=arguments[W];for(C in z)f[C]=z[C];for(let K=0;K<H.length;K++)C=H[K],Object.prototype.hasOwnProperty.call(z,C)&&(f[C]=z[C])}}function ue(f){this.src=f,this.g={},this.h=0}ue.prototype.add=function(f,T,C,z,W){const K=f.toString();f=this.g[K],f||(f=this.g[K]=[],this.h++);const ce=rt(f,T,z,W);return ce>-1?(T=f[ce],C||(T.fa=!1)):(T=new de(T,this.src,K,!!z,W),T.fa=C,f.push(T)),T};function Ne(f,T){const C=T.type;if(C in f.g){var z=f.g[C],W=Array.prototype.indexOf.call(z,T,void 0),K;(K=W>=0)&&Array.prototype.splice.call(z,W,1),K&&(ee(T),f.g[C].length==0&&(delete f.g[C],f.h--))}}function rt(f,T,C,z){for(let W=0;W<f.length;++W){const K=f[W];if(!K.da&&K.listener==T&&K.capture==!!C&&K.ha==z)return W}return-1}var rn="closure_lm_"+(Math.random()*1e6|0),Ui={};function Ba(f,T,C,z,W){if(Array.isArray(T)){for(let K=0;K<T.length;K++)Ba(f,T[K],C,z,W);return null}return C=kr(C),f&&f[Z]?f.J(T,C,o(z)?!!z.capture:!1,W):En(f,T,C,!1,z,W)}function En(f,T,C,z,W,K){if(!T)throw Error("Invalid event type");const ce=o(W)?!!W.capture:!!W;let Ae=Ts(f);if(Ae||(f[rn]=Ae=new ue(f)),C=Ae.add(T,C,z,ce,K),C.proxy)return C;if(z=hn(),C.proxy=z,z.src=f,z.listener=C,f.addEventListener)V||(W=ce),W===void 0&&(W=!1),f.addEventListener(T.toString(),z,W);else if(f.attachEvent)f.attachEvent(be(T.toString()),z);else if(f.addListener&&f.removeListener)f.addListener(z);else throw Error("addEventListener and attachEvent are unavailable.");return C}function hn(){function f(C){return T.call(f.src,f.listener,C)}const T=Sn;return f}function Ir(f,T,C,z,W){if(Array.isArray(T))for(var K=0;K<T.length;K++)Ir(f,T[K],C,z,W);else z=o(z)?!!z.capture:!!z,C=kr(C),f&&f[Z]?(f=f.i,K=String(T).toString(),K in f.g&&(T=f.g[K],C=rt(T,C,z,W),C>-1&&(ee(T[C]),Array.prototype.splice.call(T,C,1),T.length==0&&(delete f.g[K],f.h--)))):f&&(f=Ts(f))&&(T=f.g[T.toString()],f=-1,T&&(f=rt(T,C,z,W)),(C=f>-1?T[f]:null)&&Ke(C))}function Ke(f){if(typeof f!="number"&&f&&!f.da){var T=f.src;if(T&&T[Z])Ne(T.i,f);else{var C=f.type,z=f.proxy;T.removeEventListener?T.removeEventListener(C,z,f.capture):T.detachEvent?T.detachEvent(be(C),z):T.addListener&&T.removeListener&&T.removeListener(z),(C=Ts(T))?(Ne(C,f),C.h==0&&(C.src=null,T[rn]=null)):ee(f)}}}function be(f){return f in Ui?Ui[f]:Ui[f]="on"+f}function Sn(f,T){if(f.da)f=!0;else{T=new B(T,this);const C=f.listener,z=f.ha||f.src;f.fa&&Ke(f),f=C.call(z,T)}return f}function Ts(f){return f=f[rn],f instanceof ue?f:null}var ji="__closure_events_fn_"+(Math.random()*1e9>>>0);function kr(f){return typeof f=="function"?f:(f[ji]||(f[ji]=function(T){return f.handleEvent(T)}),f[ji])}function kt(){N.call(this),this.i=new ue(this),this.M=this,this.G=null}d(kt,N),kt.prototype[Z]=!0,kt.prototype.removeEventListener=function(f,T,C,z){Ir(this,f,T,C,z)};function Qt(f,T){var C,z=f.G;if(z)for(C=[];z;z=z.G)C.push(z);if(f=f.M,z=T.type||T,typeof T=="string")T=new L(T,f);else if(T instanceof L)T.target=T.target||f;else{var W=T;T=new L(z,f),oe(T,W)}W=!0;let K,ce;if(C)for(ce=C.length-1;ce>=0;ce--)K=T.g=C[ce],W=cr(K,z,!0,T)&&W;if(K=T.g=f,W=cr(K,z,!0,T)&&W,W=cr(K,z,!1,T)&&W,C)for(ce=0;ce<C.length;ce++)K=T.g=C[ce],W=cr(K,z,!1,T)&&W}kt.prototype.N=function(){if(kt.Z.N.call(this),this.i){var f=this.i;for(const T in f.g){const C=f.g[T];for(let z=0;z<C.length;z++)ee(C[z]);delete f.g[T],f.h--}}this.G=null},kt.prototype.J=function(f,T,C,z){return this.i.add(String(f),T,!1,C,z)},kt.prototype.K=function(f,T,C,z){return this.i.add(String(f),T,!0,C,z)};function cr(f,T,C,z){if(T=f.i.g[String(T)],!T)return!0;T=T.concat();let W=!0;for(let K=0;K<T.length;++K){const ce=T[K];if(ce&&!ce.da&&ce.capture==C){const Ae=ce.listener,Nt=ce.ha||ce.src;ce.fa&&Ne(f.i,ce),W=Ae.call(Nt,z)!==!1&&W}}return W&&!z.defaultPrevented}function Nh(f,T){if(typeof f!="function")if(f&&typeof f.handleEvent=="function")f=u(f.handleEvent,f);else throw Error("Invalid listener argument");return Number(T)>2147483647?-1:a.setTimeout(f,T||0)}function ju(f){f.g=Nh(()=>{f.g=null,f.i&&(f.i=!1,ju(f))},f.l);const T=f.h;f.h=null,f.m.apply(null,T)}class Oh extends N{constructor(T,C){super(),this.m=T,this.l=C,this.h=null,this.i=!1,this.g=null}j(T){this.h=arguments,this.g?this.i=!0:ju(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Es(f){N.call(this),this.h=f,this.g={}}d(Es,N);var $r=[];function Dh(f){Y(f.g,function(T,C){this.g.hasOwnProperty(C)&&Ke(T)},f),f.g={}}Es.prototype.N=function(){Es.Z.N.call(this),Dh(this)},Es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ss=a.JSON.stringify,rl=a.JSON.parse,Gg=class{stringify(f){return a.JSON.stringify(f,void 0)}parse(f){return a.JSON.parse(f,void 0)}};function Wi(){}function Mh(){}var Is={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function il(){L.call(this,"d")}d(il,L);function Ua(){L.call(this,"c")}d(Ua,L);var Cr={},Lh=null;function sl(){return Lh=Lh||new kt}Cr.Ia="serverreachability";function zh(f){L.call(this,Cr.Ia,f)}d(zh,L);function ja(f){const T=sl();Qt(T,new zh(T))}Cr.STAT_EVENT="statevent";function Vh(f,T){L.call(this,Cr.STAT_EVENT,f),this.stat=T}d(Vh,L);function sn(f){const T=sl();Qt(T,new Vh(T,f))}Cr.Ja="timingevent";function Wu(f,T){L.call(this,Cr.Ja,f),this.size=T}d(Wu,L);function ks(f,T){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){f()},T)}function Wa(){this.g=!0}Wa.prototype.ua=function(){this.g=!1};function Fh(f,T,C,z,W,K){f.info(function(){if(f.g)if(K){var ce="",Ae=K.split("&");for(let Xe=0;Xe<Ae.length;Xe++){var Nt=Ae[Xe].split("=");if(Nt.length>1){const lt=Nt[0];Nt=Nt[1];const Cn=lt.split("_");ce=Cn.length>=2&&Cn[1]=="type"?ce+(lt+"="+Nt+"&"):ce+(lt+"=redacted&")}}}else ce=null;else ce=K;return"XMLHTTP REQ ("+z+") [attempt "+W+"]: "+T+`
`+C+`
`+ce})}function Bh(f,T,C,z,W,K,ce){f.info(function(){return"XMLHTTP RESP ("+z+") [ attempt "+W+"]: "+T+`
`+C+`
`+K+" "+ce})}function Hi(f,T,C,z){f.info(function(){return"XMLHTTP TEXT ("+T+"): "+Uh(f,C)+(z?" "+z:"")})}function _t(f,T){f.info(function(){return"TIMEOUT: "+T})}Wa.prototype.info=function(){};function Uh(f,T){if(!f.g)return T;if(!T)return null;try{const K=JSON.parse(T);if(K){for(f=0;f<K.length;f++)if(Array.isArray(K[f])){var C=K[f];if(!(C.length<2)){var z=C[1];if(Array.isArray(z)&&!(z.length<1)){var W=z[0];if(W!="noop"&&W!="stop"&&W!="close")for(let ce=1;ce<z.length;ce++)z[ce]=""}}}}return Ss(K)}catch{return T}}var Ha={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Hu={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},qu;function al(){}d(al,Wi),al.prototype.g=function(){return new XMLHttpRequest},qu=new al;function $s(f){return encodeURIComponent(String(f))}function jh(f){var T=1;f=f.split(":");const C=[];for(;T>0&&f.length;)C.push(f.shift()),T--;return f.length&&C.push(f.join(":")),C}function Ar(f,T,C,z){this.j=f,this.i=T,this.l=C,this.S=z||1,this.V=new Es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Gu}function Gu(){this.i=null,this.g="",this.h=!1}var Ku={},ol={};function ll(f,T,C){f.M=1,f.A=cl(dr(T)),f.u=C,f.R=!0,Yu(f,null)}function Yu(f,T){f.F=Date.now(),Cs(f),f.B=dr(f.A);var C=f.B,z=f.S;Array.isArray(z)||(z=[String(z)]),hl(C.i,"t",z),f.C=0,C=f.j.L,f.h=new Gu,f.g=ac(f.j,C?T:null,!f.u),f.P>0&&(f.O=new Oh(u(f.Y,f,f.g),f.P)),T=f.V,C=f.g,z=f.ba;var W="readystatechange";Array.isArray(W)||(W&&($r[0]=W.toString()),W=$r);for(let K=0;K<W.length;K++){const ce=Ba(C,W[K],z||T.handleEvent,!1,T.h||T);if(!ce)break;T.g[ce.key]=ce}T=f.J?G(f.J):{},f.u?(f.v||(f.v="POST"),T["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.B,f.v,f.u,T)):(f.v="GET",f.g.ea(f.B,f.v,null,T)),ja(),Fh(f.i,f.v,f.B,f.l,f.S,f.u)}Ar.prototype.ba=function(f){f=f.target;const T=this.O;T&&oi(f)==3?T.j():this.Y(f)},Ar.prototype.Y=function(f){try{if(f==this.g)e:{const Ae=oi(this.g),Nt=this.g.ya(),Xe=this.g.ca();if(!(Ae<3)&&(Ae!=3||this.g&&(this.h.h||this.g.la()||ef(this.g)))){this.K||Ae!=4||Nt==7||(Nt==8||Xe<=0?ja(3):ja(2)),Xn(this);var T=this.g.ca();this.X=T;var C=Kg(this);if(this.o=T==200,Bh(this.i,this.v,this.B,this.l,this.S,Ae,T),this.o){if(this.U&&!this.L){t:{if(this.g){var z,W=this.g;if((z=W.g?W.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(z)){var K=z;break t}}K=null}if(f=K)Hi(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Xu(this,f);else{this.o=!1,this.m=3,sn(12),Gi(this),As(this);break e}}if(this.R){f=!0;let lt;for(;!this.K&&this.C<C.length;)if(lt=Qu(this,C),lt==ol){Ae==4&&(this.m=4,sn(14),f=!1),Hi(this.i,this.l,null,"[Incomplete Response]");break}else if(lt==Ku){this.m=4,sn(15),Hi(this.i,this.l,C,"[Invalid Chunk]"),f=!1;break}else Hi(this.i,this.l,lt,null),Xu(this,lt);if(Qn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ae!=4||C.length!=0||this.h.h||(this.m=1,sn(16),f=!1),this.o=this.o&&f,!f)Hi(this.i,this.l,C,"[Invalid Chunked Response]"),Gi(this),As(this);else if(C.length>0&&!this.W){this.W=!0;var ce=this.j;ce.g==this&&ce.aa&&!ce.P&&(ce.j.info("Great, no buffering proxy detected. Bytes received: "+C.length),rc(ce),ce.P=!0,sn(11))}}else Hi(this.i,this.l,C,null),Xu(this,C);Ae==4&&Gi(this),this.o&&!this.K&&(Ae==4?ic(this.j,this):(this.o=!1,Cs(this)))}else gl(this.g),T==400&&C.indexOf("Unknown SID")>0?(this.m=3,sn(12)):(this.m=0,sn(13)),Gi(this),As(this)}}}catch{}finally{}};function Kg(f){if(!Qn(f))return f.g.la();const T=ef(f.g);if(T==="")return"";let C="";const z=T.length,W=oi(f.g)==4;if(!f.h.i){if(typeof TextDecoder>"u")return Gi(f),As(f),"";f.h.i=new a.TextDecoder}for(let K=0;K<z;K++)f.h.h=!0,C+=f.h.i.decode(T[K],{stream:!(W&&K==z-1)});return T.length=0,f.h.g+=C,f.C=0,f.h.g}function Qn(f){return f.g?f.v=="GET"&&f.M!=2&&f.j.Aa:!1}function Qu(f,T){var C=f.C,z=T.indexOf(`
`,C);return z==-1?ol:(C=Number(T.substring(C,z)),isNaN(C)?Ku:(z+=1,z+C>T.length?ol:(T=T.slice(z,z+C),f.C=z+C,T)))}Ar.prototype.cancel=function(){this.K=!0,Gi(this)};function Cs(f){f.T=Date.now()+f.H,qi(f,f.H)}function qi(f,T){if(f.D!=null)throw Error("WatchDog timer not null");f.D=ks(u(f.aa,f),T)}function Xn(f){f.D&&(a.clearTimeout(f.D),f.D=null)}Ar.prototype.aa=function(){this.D=null;const f=Date.now();f-this.T>=0?(_t(this.i,this.B),this.M!=2&&(ja(),sn(17)),Gi(this),this.m=2,As(this)):qi(this,this.T-f)};function As(f){f.j.I==0||f.K||ic(f.j,f)}function Gi(f){Xn(f);var T=f.O;T&&typeof T.dispose=="function"&&T.dispose(),f.O=null,Dh(f.V),f.g&&(T=f.g,f.g=null,T.abort(),T.dispose())}function Xu(f,T){try{var C=f.j;if(C.I!=0&&(C.g==f||kn(C.h,f))){if(!f.L&&kn(C.h,f)&&C.I==3){try{var z=C.Ba.g.parse(T)}catch{z=null}if(Array.isArray(z)&&z.length==3){var W=z;if(W[0]==0){e:if(!C.v){if(C.g)if(C.g.F+3e3<f.F)wl(C),yl(C);else break e;nc(C),sn(18)}}else C.xa=W[1],0<C.xa-C.K&&W[2]<37500&&C.F&&C.A==0&&!C.C&&(C.C=ks(u(C.Va,C),6e3));In(C.h)<=1&&C.ta&&(C.ta=void 0)}else li(C,11)}else if((f.L||C.g==f)&&wl(C),!M(T))for(W=C.Ba.g.parse(T),T=0;T<W.length;T++){let Xe=W[T];const lt=Xe[0];if(!(lt<=C.K))if(C.K=lt,Xe=Xe[1],C.I==2)if(Xe[0]=="c"){C.M=Xe[1],C.ba=Xe[2];const Cn=Xe[3];Cn!=null&&(C.ka=Cn,C.j.info("VER="+C.ka));const ci=Xe[4];ci!=null&&(C.za=ci,C.j.info("SVER="+C.za));const di=Xe[5];di!=null&&typeof di=="number"&&di>0&&(z=1.5*di,C.O=z,C.j.info("backChannelRequestTimeoutMs_="+z)),z=C;const Jn=f.g;if(Jn){const vl=Jn.g?Jn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vl){var K=z.h;K.g||vl.indexOf("spdy")==-1&&vl.indexOf("quic")==-1&&vl.indexOf("h2")==-1||(K.j=K.l,K.g=new Set,K.h&&(qa(K,K.h),K.h=null))}if(z.G){const uc=Jn.g?Jn.g.getResponseHeader("X-HTTP-Session-Id"):null;uc&&(z.wa=uc,it(z.J,z.G,uc))}}C.I=3,C.l&&C.l.ra(),C.aa&&(C.T=Date.now()-f.F,C.j.info("Handshake RTT: "+C.T+"ms")),z=C;var ce=f;if(z.na=cf(z,z.L?z.ba:null,z.W),ce.L){Hh(z.h,ce);var Ae=ce,Nt=z.O;Nt&&(Ae.H=Nt),Ae.D&&(Xn(Ae),Cs(Ae)),z.g=ce}else of(z);C.i.length>0&&_l(C)}else Xe[0]!="stop"&&Xe[0]!="close"||li(C,7);else C.I==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?li(C,7):tc(C):Xe[0]!="noop"&&C.l&&C.l.qa(Xe),C.A=0)}}ja(4)}catch{}}var Wh=class{constructor(f,T){this.g=f,this.map=T}};function ti(f){this.l=f||10,a.PerformanceNavigationTiming?(f=a.performance.getEntriesByType("navigation"),f=f.length>0&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ul(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function In(f){return f.h?1:f.g?f.g.size:0}function kn(f,T){return f.h?f.h==T:f.g?f.g.has(T):!1}function qa(f,T){f.g?f.g.add(T):f.h=T}function Hh(f,T){f.h&&f.h==T?f.h=null:f.g&&f.g.has(T)&&f.g.delete(T)}ti.prototype.cancel=function(){if(this.i=qh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function qh(f){if(f.h!=null)return f.i.concat(f.h.G);if(f.g!=null&&f.g.size!==0){let T=f.i;for(const C of f.g.values())T=T.concat(C.G);return T}return m(f.i)}var Gh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yg(f,T){if(f){f=f.split("&");for(let C=0;C<f.length;C++){const z=f[C].indexOf("=");let W,K=null;z>=0?(W=f[C].substring(0,z),K=f[C].substring(z+1)):W=f[C],T(W,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function ni(f){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let T;f instanceof ni?(this.l=f.l,Ln(this,f.j),this.o=f.o,this.g=f.g,ri(this,f.u),this.h=f.h,Ju(this,Qh(f.i)),this.m=f.m):f&&(T=String(f).match(Gh))?(this.l=!1,Ln(this,T[1]||"",!0),this.o=Ga(T[2]||""),this.g=Ga(T[3]||"",!0),ri(this,T[4]),this.h=Ga(T[5]||"",!0),Ju(this,T[6]||"",!0),this.m=Ga(T[7]||"")):(this.l=!1,this.i=new ii(null,this.l))}ni.prototype.toString=function(){const f=[];var T=this.j;T&&f.push(Ka(T,Kh,!0),":");var C=this.g;return(C||T=="file")&&(f.push("//"),(T=this.o)&&f.push(Ka(T,Kh,!0),"@"),f.push($s(C).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C=this.u,C!=null&&f.push(":",String(C))),(C=this.h)&&(this.g&&C.charAt(0)!="/"&&f.push("/"),f.push(Ka(C,C.charAt(0)=="/"?Jg:Xg,!0))),(C=this.i.toString())&&f.push("?",C),(C=this.m)&&f.push("#",Ka(C,ey)),f.join("")},ni.prototype.resolve=function(f){const T=dr(this);let C=!!f.j;C?Ln(T,f.j):C=!!f.o,C?T.o=f.o:C=!!f.g,C?T.g=f.g:C=f.u!=null;var z=f.h;if(C)ri(T,f.u);else if(C=!!f.h){if(z.charAt(0)!="/")if(this.g&&!this.h)z="/"+z;else{var W=T.h.lastIndexOf("/");W!=-1&&(z=T.h.slice(0,W+1)+z)}if(W=z,W==".."||W==".")z="";else if(W.indexOf("./")!=-1||W.indexOf("/.")!=-1){z=W.lastIndexOf("/",0)==0,W=W.split("/");const K=[];for(let ce=0;ce<W.length;){const Ae=W[ce++];Ae=="."?z&&ce==W.length&&K.push(""):Ae==".."?((K.length>1||K.length==1&&K[0]!="")&&K.pop(),z&&ce==W.length&&K.push("")):(K.push(Ae),z=!0)}z=K.join("/")}else z=W}return C?T.h=z:C=f.i.toString()!=="",C?Ju(T,Qh(f.i)):C=!!f.m,C&&(T.m=f.m),T};function dr(f){return new ni(f)}function Ln(f,T,C){f.j=C?Ga(T,!0):T,f.j&&(f.j=f.j.replace(/:$/,""))}function ri(f,T){if(T){if(T=Number(T),isNaN(T)||T<0)throw Error("Bad port number "+T);f.u=T}else f.u=null}function Ju(f,T,C){T instanceof ii?(f.i=T,ty(f.i,f.l)):(C||(T=Ka(T,Zg)),f.i=new ii(T,f.l))}function it(f,T,C){f.i.set(T,C)}function cl(f){return it(f,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),f}function Ga(f,T){return f?T?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function Ka(f,T,C){return typeof f=="string"?(f=encodeURI(f).replace(T,Qg),C&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function Qg(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var Kh=/[#\/\?@]/g,Xg=/[#\?:]/g,Jg=/[#\?]/g,Zg=/[#\?@]/g,ey=/#/g;function ii(f,T){this.h=this.g=null,this.i=f||null,this.j=!!T}function Ki(f){f.g||(f.g=new Map,f.h=0,f.i&&Yg(f.i,function(T,C){f.add(decodeURIComponent(T.replace(/\+/g," ")),C)}))}t=ii.prototype,t.add=function(f,T){Ki(this),this.i=null,f=Rs(this,f);let C=this.g.get(f);return C||this.g.set(f,C=[]),C.push(T),this.h+=1,this};function dl(f,T){Ki(f),T=Rs(f,T),f.g.has(T)&&(f.i=null,f.h-=f.g.get(T).length,f.g.delete(T))}function Ya(f,T){return Ki(f),T=Rs(f,T),f.g.has(T)}t.forEach=function(f,T){Ki(this),this.g.forEach(function(C,z){C.forEach(function(W){f.call(T,W,z,this)},this)},this)};function Yh(f,T){Ki(f);let C=[];if(typeof T=="string")Ya(f,T)&&(C=C.concat(f.g.get(Rs(f,T))));else for(f=Array.from(f.g.values()),T=0;T<f.length;T++)C=C.concat(f[T]);return C}t.set=function(f,T){return Ki(this),this.i=null,f=Rs(this,f),Ya(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[T]),this.h+=1,this},t.get=function(f,T){return f?(f=Yh(this,f),f.length>0?String(f[0]):T):T};function hl(f,T,C){dl(f,T),C.length>0&&(f.i=null,f.g.set(Rs(f,T),m(C)),f.h+=C.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],T=Array.from(this.g.keys());for(let z=0;z<T.length;z++){var C=T[z];const W=$s(C);C=Yh(this,C);for(let K=0;K<C.length;K++){let ce=W;C[K]!==""&&(ce+="="+$s(C[K])),f.push(ce)}}return this.i=f.join("&")};function Qh(f){const T=new ii;return T.i=f.i,f.g&&(T.g=new Map(f.g),T.h=f.h),T}function Rs(f,T){return T=String(T),f.j&&(T=T.toLowerCase()),T}function ty(f,T){T&&!f.j&&(Ki(f),f.i=null,f.g.forEach(function(C,z){const W=z.toLowerCase();z!=W&&(dl(this,z),hl(this,W,C))},f)),f.j=T}function ny(f,T){const C=new Wa;if(a.Image){const z=new Image;z.onload=c(si,C,"TestLoadImage: loaded",!0,T,z),z.onerror=c(si,C,"TestLoadImage: error",!1,T,z),z.onabort=c(si,C,"TestLoadImage: abort",!1,T,z),z.ontimeout=c(si,C,"TestLoadImage: timeout",!1,T,z),a.setTimeout(function(){z.ontimeout&&z.ontimeout()},1e4),z.src=f}else T(!1)}function fl(f,T){const C=new Wa,z=new AbortController,W=setTimeout(()=>{z.abort(),si(C,"TestPingServer: timeout",!1,T)},1e4);fetch(f,{signal:z.signal}).then(K=>{clearTimeout(W),K.ok?si(C,"TestPingServer: ok",!0,T):si(C,"TestPingServer: server error",!1,T)}).catch(()=>{clearTimeout(W),si(C,"TestPingServer: error",!1,T)})}function si(f,T,C,z,W){try{W&&(W.onload=null,W.onerror=null,W.onabort=null,W.ontimeout=null),z(C)}catch{}}function ai(){this.g=new Gg}function zn(f){this.i=f.Sb||null,this.h=f.ab||!1}d(zn,Wi),zn.prototype.g=function(){return new Qa(this.i,this.h)};function Qa(f,T){kt.call(this),this.H=f,this.o=T,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(Qa,kt),t=Qa.prototype,t.open=function(f,T){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=f,this.D=T,this.readyState=1,Ps(this)},t.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const T={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};f&&(T.body=f),(this.H||a).fetch(new Request(this.D,T)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Yi(this)),this.readyState=0},t.Pa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Ps(this)),this.g&&(this.readyState=3,Ps(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Xa(this)}else f.text().then(this.Oa.bind(this),this.ga.bind(this))};function Xa(f){f.j.read().then(f.Ma.bind(f)).catch(f.ga.bind(f))}t.Ma=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var T=f.value?f.value:new Uint8Array(0);(T=this.B.decode(T,{stream:!f.done}))&&(this.response=this.responseText+=T)}f.done?Yi(this):Ps(this),this.readyState==3&&Xa(this)}},t.Oa=function(f){this.g&&(this.response=this.responseText=f,Yi(this))},t.Na=function(f){this.g&&(this.response=f,Yi(this))},t.ga=function(){this.g&&Yi(this)};function Yi(f){f.readyState=4,f.l=null,f.j=null,f.B=null,Ps(f)}t.setRequestHeader=function(f,T){this.A.append(f,T)},t.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],T=this.h.entries();for(var C=T.next();!C.done;)C=C.value,f.push(C[0]+": "+C[1]),C=T.next();return f.join(`\r
`)};function Ps(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(Qa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function Zu(f){let T="";return Y(f,function(C,z){T+=z,T+=":",T+=C,T+=`\r
`}),T}function ec(f,T,C){e:{for(z in C){var z=!1;break e}z=!0}z||(C=Zu(C),typeof f=="string"?C!=null&&$s(C):it(f,T,C))}function ot(f){kt.call(this),this.headers=new Map,this.L=f||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(ot,kt);var ry=/^https?$/i,Xh=["POST","PUT"];t=ot.prototype,t.Fa=function(f){this.H=f},t.ea=function(f,T,C,z){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);T=T?T.toUpperCase():"GET",this.D=f,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():qu.g(),this.g.onreadystatechange=h(u(this.Ca,this));try{this.B=!0,this.g.open(T,String(f),!0),this.B=!1}catch(K){Jh(this,K);return}if(f=C||"",C=new Map(this.headers),z)if(Object.getPrototypeOf(z)===Object.prototype)for(var W in z)C.set(W,z[W]);else if(typeof z.keys=="function"&&typeof z.get=="function")for(const K of z.keys())C.set(K,z.get(K));else throw Error("Unknown input type for opt_headers: "+String(z));z=Array.from(C.keys()).find(K=>K.toLowerCase()=="content-type"),W=a.FormData&&f instanceof a.FormData,!(Array.prototype.indexOf.call(Xh,T,void 0)>=0)||z||W||C.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[K,ce]of C)this.g.setRequestHeader(K,ce);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(f),this.v=!1}catch(K){Jh(this,K)}};function Jh(f,T){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=T,f.o=5,pl(f),ml(f)}function pl(f){f.A||(f.A=!0,Qt(f,"complete"),Qt(f,"error"))}t.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=f||7,Qt(this,"complete"),Qt(this,"abort"),ml(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ml(this,!0)),ot.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?Zh(this):this.Xa())},t.Xa=function(){Zh(this)};function Zh(f){if(f.h&&typeof s<"u"){if(f.v&&oi(f)==4)setTimeout(f.Ca.bind(f),0);else if(Qt(f,"readystatechange"),oi(f)==4){f.h=!1;try{const K=f.ca();e:switch(K){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var T=!0;break e;default:T=!1}var C;if(!(C=T)){var z;if(z=K===0){let ce=String(f.D).match(Gh)[1]||null;!ce&&a.self&&a.self.location&&(ce=a.self.location.protocol.slice(0,-1)),z=!ry.test(ce?ce.toLowerCase():"")}C=z}if(C)Qt(f,"complete"),Qt(f,"success");else{f.o=6;try{var W=oi(f)>2?f.g.statusText:""}catch{W=""}f.l=W+" ["+f.ca()+"]",pl(f)}}finally{ml(f)}}}}function ml(f,T){if(f.g){f.m&&(clearTimeout(f.m),f.m=null);const C=f.g;f.g=null,T||Qt(f,"ready");try{C.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function oi(f){return f.g?f.g.readyState:0}t.ca=function(){try{return oi(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(f){if(this.g){var T=this.g.responseText;return f&&T.indexOf(f)==0&&(T=T.substring(f.length)),rl(T)}};function ef(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.F){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function gl(f){const T={};f=(f.g&&oi(f)>=2&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let z=0;z<f.length;z++){if(M(f[z]))continue;var C=jh(f[z]);const W=C[0];if(C=C[1],typeof C!="string")continue;C=C.trim();const K=T[W]||[];T[W]=K,K.push(C)}J(T,function(z){return z.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ja(f,T,C){return C&&C.internalChannelParams&&C.internalChannelParams[f]||T}function tf(f){this.za=0,this.i=[],this.j=new Wa,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ja("failFast",!1,f),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ja("baseRetryDelayMs",5e3,f),this.Za=Ja("retryDelaySeedMs",1e4,f),this.Ta=Ja("forwardChannelMaxRetries",2,f),this.va=Ja("forwardChannelRequestTimeoutMs",2e4,f),this.ma=f&&f.xmlHttpFactory||void 0,this.Ua=f&&f.Rb||void 0,this.Aa=f&&f.useFetchStreams||!1,this.O=void 0,this.L=f&&f.supportsCrossDomainXhr||!1,this.M="",this.h=new ti(f&&f.concurrentRequestLimit),this.Ba=new ai,this.S=f&&f.fastHandshake||!1,this.R=f&&f.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=f&&f.Pb||!1,f&&f.ua&&this.j.ua(),f&&f.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&f&&f.detectBufferingProxy||!1,this.ia=void 0,f&&f.longPollingTimeout&&f.longPollingTimeout>0&&(this.ia=f.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=tf.prototype,t.ka=8,t.I=1,t.connect=function(f,T,C,z){sn(0),this.W=f,this.H=T||{},C&&z!==void 0&&(this.H.OSID=C,this.H.OAID=z),this.F=this.X,this.J=cf(this,null,this.W),_l(this)};function tc(f){if(nf(f),f.I==3){var T=f.V++,C=dr(f.J);if(it(C,"SID",f.M),it(C,"RID",T),it(C,"TYPE","terminate"),Za(f,C),T=new Ar(f,f.j,T),T.M=2,T.A=cl(dr(C)),C=!1,a.navigator&&a.navigator.sendBeacon)try{C=a.navigator.sendBeacon(T.A.toString(),"")}catch{}!C&&a.Image&&(new Image().src=T.A,C=!0),C||(T.g=ac(T.j,null),T.g.ea(T.A)),T.F=Date.now(),Cs(T)}uf(f)}function yl(f){f.g&&(rc(f),f.g.cancel(),f.g=null)}function nf(f){yl(f),f.v&&(a.clearTimeout(f.v),f.v=null),wl(f),f.h.cancel(),f.m&&(typeof f.m=="number"&&a.clearTimeout(f.m),f.m=null)}function _l(f){if(!ul(f.h)&&!f.m){f.m=!0;var T=f.Ea;R||_(),D||(R(),D=!0),k.add(T,f),f.D=0}}function rf(f,T){return In(f.h)>=f.h.j-(f.m?1:0)?!1:f.m?(f.i=T.G.concat(f.i),!0):f.I==1||f.I==2||f.D>=(f.Sa?0:f.Ta)?!1:(f.m=ks(u(f.Ea,f,T),sc(f,f.D)),f.D++,!0)}t.Ea=function(f){if(this.m)if(this.m=null,this.I==1){if(!f){this.V=Math.floor(Math.random()*1e5),f=this.V++;const W=new Ar(this,this.j,f);let K=this.o;if(this.U&&(K?(K=G(K),oe(K,this.U)):K=this.U),this.u!==null||this.R||(W.J=K,K=null),this.S)e:{for(var T=0,C=0;C<this.i.length;C++){t:{var z=this.i[C];if("__data__"in z.map&&(z=z.map.__data__,typeof z=="string")){z=z.length;break t}z=void 0}if(z===void 0)break;if(T+=z,T>4096){T=C;break e}if(T===4096||C===this.i.length-1){T=C+1;break e}}T=1e3}else T=1e3;T=af(this,W,T),C=dr(this.J),it(C,"RID",f),it(C,"CVER",22),this.G&&it(C,"X-HTTP-Session-Id",this.G),Za(this,C),K&&(this.R?T="headers="+$s(Zu(K))+"&"+T:this.u&&ec(C,this.u,K)),qa(this.h,W),this.Ra&&it(C,"TYPE","init"),this.S?(it(C,"$req",T),it(C,"SID","null"),W.U=!0,ll(W,C,null)):ll(W,C,T),this.I=2}}else this.I==3&&(f?sf(this,f):this.i.length==0||ul(this.h)||sf(this))};function sf(f,T){var C;T?C=T.l:C=f.V++;const z=dr(f.J);it(z,"SID",f.M),it(z,"RID",C),it(z,"AID",f.K),Za(f,z),f.u&&f.o&&ec(z,f.u,f.o),C=new Ar(f,f.j,C,f.D+1),f.u===null&&(C.J=f.o),T&&(f.i=T.G.concat(f.i)),T=af(f,C,1e3),C.H=Math.round(f.va*.5)+Math.round(f.va*.5*Math.random()),qa(f.h,C),ll(C,z,T)}function Za(f,T){f.H&&Y(f.H,function(C,z){it(T,z,C)}),f.l&&Y({},function(C,z){it(T,z,C)})}function af(f,T,C){C=Math.min(f.i.length,C);const z=f.l?u(f.l.Ka,f.l,f):null;e:{var W=f.i;let Ae=-1;for(;;){const Nt=["count="+C];Ae==-1?C>0?(Ae=W[0].g,Nt.push("ofs="+Ae)):Ae=0:Nt.push("ofs="+Ae);let Xe=!0;for(let lt=0;lt<C;lt++){var K=W[lt].g;const Cn=W[lt].map;if(K-=Ae,K<0)Ae=Math.max(0,W[lt].g-100),Xe=!1;else try{K="req"+K+"_"||"";try{var ce=Cn instanceof Map?Cn:Object.entries(Cn);for(const[ci,di]of ce){let Jn=di;o(di)&&(Jn=Ss(di)),Nt.push(K+ci+"="+encodeURIComponent(Jn))}}catch(ci){throw Nt.push(K+"type="+encodeURIComponent("_badmap")),ci}}catch{z&&z(Cn)}}if(Xe){ce=Nt.join("&");break e}}ce=void 0}return f=f.i.splice(0,C),T.G=f,ce}function of(f){if(!f.g&&!f.v){f.Y=1;var T=f.Da;R||_(),D||(R(),D=!0),k.add(T,f),f.A=0}}function nc(f){return f.g||f.v||f.A>=3?!1:(f.Y++,f.v=ks(u(f.Da,f),sc(f,f.A)),f.A++,!0)}t.Da=function(){if(this.v=null,lf(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var f=4*this.T;this.j.info("BP detection timer enabled: "+f),this.B=ks(u(this.Wa,this),f)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,sn(10),yl(this),lf(this))};function rc(f){f.B!=null&&(a.clearTimeout(f.B),f.B=null)}function lf(f){f.g=new Ar(f,f.j,"rpc",f.Y),f.u===null&&(f.g.J=f.o),f.g.P=0;var T=dr(f.na);it(T,"RID","rpc"),it(T,"SID",f.M),it(T,"AID",f.K),it(T,"CI",f.F?"0":"1"),!f.F&&f.ia&&it(T,"TO",f.ia),it(T,"TYPE","xmlhttp"),Za(f,T),f.u&&f.o&&ec(T,f.u,f.o),f.O&&(f.g.H=f.O);var C=f.g;f=f.ba,C.M=1,C.A=cl(dr(T)),C.u=null,C.R=!0,Yu(C,f)}t.Va=function(){this.C!=null&&(this.C=null,yl(this),nc(this),sn(19))};function wl(f){f.C!=null&&(a.clearTimeout(f.C),f.C=null)}function ic(f,T){var C=null;if(f.g==T){wl(f),rc(f),f.g=null;var z=2}else if(kn(f.h,T))C=T.G,Hh(f.h,T),z=1;else return;if(f.I!=0){if(T.o)if(z==1){C=T.u?T.u.length:0,T=Date.now()-T.F;var W=f.D;z=sl(),Qt(z,new Wu(z,C)),_l(f)}else of(f);else if(W=T.m,W==3||W==0&&T.X>0||!(z==1&&rf(f,T)||z==2&&nc(f)))switch(C&&C.length>0&&(T=f.h,T.i=T.i.concat(C)),W){case 1:li(f,5);break;case 4:li(f,10);break;case 3:li(f,6);break;default:li(f,2)}}}function sc(f,T){let C=f.Qa+Math.floor(Math.random()*f.Za);return f.isActive()||(C*=2),C*T}function li(f,T){if(f.j.info("Error code "+T),T==2){var C=u(f.bb,f),z=f.Ua;const W=!z;z=new ni(z||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ln(z,"https"),cl(z),W?ny(z.toString(),C):fl(z.toString(),C)}else sn(2);f.I=0,f.l&&f.l.pa(T),uf(f),nf(f)}t.bb=function(f){f?(this.j.info("Successfully pinged google.com"),sn(2)):(this.j.info("Failed to ping google.com"),sn(1))};function uf(f){if(f.I=0,f.ja=[],f.l){const T=qh(f.h);(T.length!=0||f.i.length!=0)&&(g(f.ja,T),g(f.ja,f.i),f.h.i.length=0,m(f.i),f.i.length=0),f.l.oa()}}function cf(f,T,C){var z=C instanceof ni?dr(C):new ni(C);if(z.g!="")T&&(z.g=T+"."+z.g),ri(z,z.u);else{var W=a.location;z=W.protocol,T=T?T+"."+W.hostname:W.hostname,W=+W.port;const K=new ni(null);z&&Ln(K,z),T&&(K.g=T),W&&ri(K,W),C&&(K.h=C),z=K}return C=f.G,T=f.wa,C&&T&&it(z,C,T),it(z,"VER",f.ka),Za(f,z),z}function ac(f,T,C){if(T&&!f.L)throw Error("Can't create secondary domain capable XhrIo object.");return T=f.Aa&&!f.ma?new ot(new zn({ab:C})):new ot(f.ma),T.Fa(f.L),T}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function oc(){}t=oc.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function ui(){}ui.prototype.g=function(f,T){return new $n(f,T)};function $n(f,T){kt.call(this),this.g=new tf(T),this.l=f,this.h=T&&T.messageUrlParams||null,f=T&&T.messageHeaders||null,T&&T.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=T&&T.initMessageHeaders||null,T&&T.messageContentType&&(f?f["X-WebChannel-Content-Type"]=T.messageContentType:f={"X-WebChannel-Content-Type":T.messageContentType}),T&&T.sa&&(f?f["X-WebChannel-Client-Profile"]=T.sa:f={"X-WebChannel-Client-Profile":T.sa}),this.g.U=f,(f=T&&T.Qb)&&!M(f)&&(this.g.u=f),this.A=T&&T.supportsCrossDomainXhr||!1,this.v=T&&T.sendRawJson||!1,(T=T&&T.httpSessionIdParam)&&!M(T)&&(this.g.G=T,f=this.h,f!==null&&T in f&&(f=this.h,T in f&&delete f[T])),this.j=new Ns(this)}d($n,kt),$n.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},$n.prototype.close=function(){tc(this.g)},$n.prototype.o=function(f){var T=this.g;if(typeof f=="string"){var C={};C.__data__=f,f=C}else this.v&&(C={},C.__data__=Ss(f),f=C);T.i.push(new Wh(T.Ya++,f)),T.I==3&&_l(T)},$n.prototype.N=function(){this.g.l=null,delete this.j,tc(this.g),delete this.g,$n.Z.N.call(this)};function lc(f){il.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var T=f.__sm__;if(T){e:{for(const C in T){f=C;break e}f=void 0}(this.i=f)&&(f=this.i,T=T!==null&&f in T?T[f]:void 0),this.data=T}else this.data=f}d(lc,il);function df(){Ua.call(this),this.status=1}d(df,Ua);function Ns(f){this.g=f}d(Ns,oc),Ns.prototype.ra=function(){Qt(this.g,"a")},Ns.prototype.qa=function(f){Qt(this.g,new lc(f))},Ns.prototype.pa=function(f){Qt(this.g,new df)},Ns.prototype.oa=function(){Qt(this.g,"b")},ui.prototype.createWebChannel=ui.prototype.g,$n.prototype.send=$n.prototype.o,$n.prototype.open=$n.prototype.m,$n.prototype.close=$n.prototype.close,qN=function(){return new ui},HN=function(){return sl()},WN=Cr,_w={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ha.NO_ERROR=0,Ha.TIMEOUT=8,Ha.HTTP_ERROR=6,Cp=Ha,Hu.COMPLETE="complete",jN=Hu,Mh.EventType=Is,Is.OPEN="a",Is.CLOSE="b",Is.ERROR="c",Is.MESSAGE="d",kt.prototype.listen=kt.prototype.J,Gc=Mh,ot.prototype.listenOnce=ot.prototype.K,ot.prototype.getLastError=ot.prototype.Ha,ot.prototype.getLastErrorCode=ot.prototype.ya,ot.prototype.getStatus=ot.prototype.ca,ot.prototype.getResponseJson=ot.prototype.La,ot.prototype.getResponseText=ot.prototype.la,ot.prototype.send=ot.prototype.ea,ot.prototype.setWithCredentials=ot.prototype.Fa,UN=ot}).apply(typeof Pf<"u"?Pf:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}yn.UNAUTHENTICATED=new yn(null),yn.GOOGLE_CREDENTIALS=new yn("google-credentials-uid"),yn.FIRST_PARTY=new yn("first-party-uid"),yn.MOCK_USER=new yn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ou="12.9.0";function uW(t){Ou=t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lo=new yb("@firebase/firestore");function Il(){return Lo.logLevel}function pe(t,...e){if(Lo.logLevel<=Le.DEBUG){const n=e.map($b);Lo.debug(`Firestore (${Ou}): ${t}`,...n)}}function ys(t,...e){if(Lo.logLevel<=Le.ERROR){const n=e.map($b);Lo.error(`Firestore (${Ou}): ${t}`,...n)}}function zo(t,...e){if(Lo.logLevel<=Le.WARN){const n=e.map($b);Lo.warn(`Firestore (${Ou}): ${t}`,...n)}}function $b(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Te(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,GN(t,r,n)}function GN(t,e,n){let r=`FIRESTORE (${Ou}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw ys(r),new Error(r)}function Qe(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||GN(e,i,r)}function $e(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fe extends Vi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cW{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(yn.UNAUTHENTICATED))}shutdown(){}}class dW{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class hW{constructor(e){this.t=e,this.currentUser=yn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Qe(this.o===void 0,42304);let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new ya;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ya,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},o=l=>{pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>o(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?o(l):(pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ya)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Qe(typeof r.accessToken=="string",31837,{l:r}),new KN(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Qe(e===null||typeof e=="string",2055,{h:e}),new yn(e)}}class fW{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=yn.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class pW{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new fW(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(yn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class pE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class mW{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,jn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Qe(this.o===void 0,3512);const r=s=>{s.error!=null&&pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.m;return this.m=s.token,pe("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new pE(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Qe(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new pE(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gW(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=gW(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%62))}return r}}function ze(t,e){return t<e?-1:t>e?1:0}function ww(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const i=t.charAt(r),s=e.charAt(r);if(i!==s)return Ky(i)===Ky(s)?ze(i,s):Ky(i)?1:-1}return ze(t.length,e.length)}const yW=55296,_W=57343;function Ky(t){const e=t.charCodeAt(0);return e>=yW&&e<=_W}function mu(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE="__name__";class wi{constructor(e,n,r){n===void 0?n=0:n>e.length&&Te(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Te(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return wi.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof wi?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=wi.compareSegments(e.get(i),n.get(i));if(s!==0)return s}return ze(e.length,n.length)}static compareSegments(e,n){const r=wi.isNumericId(e),i=wi.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?wi.extractNumericId(e).compare(wi.extractNumericId(n)):ww(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ga.fromString(e.substring(4,e.length-2))}}class ut extends wi{construct(e,n,r){return new ut(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new fe(te.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new ut(n)}static emptyPath(){return new ut([])}}const wW=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ln extends wi{construct(e,n,r){return new ln(e,n,r)}static isValidIdentifier(e){return wW.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ln.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mE}static keyField(){return new ln([mE])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new fe(te.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;i<e.length;){const o=e[i];if(o==="\\"){if(i+1===e.length)throw new fe(te.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new fe(te.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else o==="`"?(a=!a,i++):o!=="."||a?(r+=o,i++):(s(),i++)}if(s(),a)throw new fe(te.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ln(n)}static emptyPath(){return new ln([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e){this.path=e}static fromPath(e){return new we(ut.fromString(e))}static fromName(e){return new we(ut.fromString(e).popFirst(5))}static empty(){return new we(ut.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ut.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ut.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new we(new ut(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YN(t,e,n){if(!n)throw new fe(te.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function vW(t,e,n,r){if(e===!0&&r===!0)throw new fe(te.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function gE(t){if(!we.isDocumentKey(t))throw new fe(te.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function yE(t){if(we.isDocumentKey(t))throw new fe(te.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function QN(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function xg(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Te(12329,{type:typeof t})}function gu(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new fe(te.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=xg(t);throw new fe(te.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function bW(t,e){if(e<=0)throw new fe(te.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jt(t,e){const n={typeString:t};return e&&(n.value=e),n}function Eh(t,e){if(!QN(t))throw new fe(te.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const a=t[r];if(i&&typeof a!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new fe(te.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _E=-62135596800,wE=1e6;class pt{static now(){return pt.fromMillis(Date.now())}static fromDate(e){return pt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*wE);return new pt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new fe(te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new fe(te.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<_E)throw new fe(te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new fe(te.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/wE}_compareTo(e){return this.seconds===e.seconds?ze(this.nanoseconds,e.nanoseconds):ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:pt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Eh(e,pt._jsonSchema))return new pt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-_E;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}pt._jsonSchemaVersion="firestore/timestamp/1.0",pt._jsonSchema={type:jt("string",pt._jsonSchemaVersion),seconds:jt("number"),nanoseconds:jt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{static fromTimestamp(e){return new Ie(e)}static min(){return new Ie(new pt(0,0))}static max(){return new Ie(new pt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd=-1;function xW(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Ie.fromTimestamp(r===1e9?new pt(n+1,0):new pt(n,r));return new Ta(i,we.empty(),e)}function TW(t){return new Ta(t.readTime,t.key,Xd)}class Ta{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Ta(Ie.min(),we.empty(),Xd)}static max(){return new Ta(Ie.max(),we.empty(),Xd)}}function EW(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=we.comparator(t.documentKey,e.documentKey),n!==0?n:ze(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SW="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class IW{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Du(t){if(t.code!==te.FAILED_PRECONDITION||t.message!==SW)throw t;pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Te(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ne((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ne?n:ne.resolve(n)}catch(n){return ne.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ne.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ne.reject(n)}static resolve(e){return new ne((n,r)=>{n(e)})}static reject(e){return new ne((n,r)=>{r(e)})}static waitFor(e){return new ne((n,r)=>{let i=0,s=0,a=!1;e.forEach(o=>{++i,o.next(()=>{++s,a&&s===i&&n()},l=>r(l))}),a=!0,s===i&&n()})}static or(e){let n=ne.resolve(!1);for(const r of e)n=n.next(i=>i?ne.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new ne((r,i)=>{const s=e.length,a=new Array(s);let o=0;for(let l=0;l<s;l++){const u=l;n(e[u]).next(c=>{a[u]=c,++o,o===s&&r(a)},c=>i(c))}})}static doWhile(e,n){return new ne((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function kW(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Mu(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Tg.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ab=-1;function Eg(t){return t==null}function bm(t){return t===0&&1/t==-1/0}function $W(t){return typeof t=="number"&&Number.isInteger(t)&&!bm(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XN="";function CW(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=vE(e)),e=AW(t.get(n),e);return vE(e)}function AW(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case XN:n+="";break;default:n+=s}}return n}function vE(t){return t+XN+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bE(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ko(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function JN(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e,n){this.comparator=e,this.root=n||on.EMPTY}insert(e,n){return new St(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,on.BLACK,null,null))}remove(e){return new St(this.comparator,this.root.remove(e,this.comparator).copy(null,null,on.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nf(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nf(this.root,e,this.comparator,!0)}}class Nf{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class on{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??on.RED,this.left=i??on.EMPTY,this.right=s??on.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new on(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return on.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return on.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,on.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,on.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Te(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Te(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Te(27949);return e+(this.isRed()?0:1)}}on.EMPTY=null,on.RED=!0,on.BLACK=!1;on.EMPTY=new class{constructor(){this.size=0}get key(){throw Te(57766)}get value(){throw Te(16141)}get color(){throw Te(16727)}get left(){throw Te(29726)}get right(){throw Te(36894)}copy(e,n,r,i,s){return this}insert(e,n,r){return new on(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e){this.comparator=e,this.data=new St(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new xE(this.data.getIterator())}getIteratorFrom(e){return new xE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Kt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Kt(this.comparator);return n.data=e,n}}class xE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e){this.fields=e,e.sort(ln.comparator)}static empty(){return new jr([])}unionWith(e){let n=new Kt(ln.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new jr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return mu(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ZN("Invalid base64 string: "+s):s}}(e);return new dn(n)}static fromUint8Array(e){const n=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new dn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}dn.EMPTY_BYTE_STRING=new dn("");const RW=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ea(t){if(Qe(!!t,39018),typeof t=="string"){let e=0;const n=RW.exec(t);if(Qe(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ot(t.seconds),nanos:Ot(t.nanos)}}function Ot(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Sa(t){return typeof t=="string"?dn.fromBase64String(t):dn.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3="server_timestamp",t3="__type__",n3="__previous_value__",r3="__local_write_time__";function Rb(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[t3])==null?void 0:r.stringValue)===e3}function Sg(t){const e=t.mapValue.fields[n3];return Rb(e)?Sg(e):e}function Jd(t){const e=Ea(t.mapValue.fields[r3].timestampValue);return new pt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PW{constructor(e,n,r,i,s,a,o,l,u,c,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=o,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=c,this.apiKey=d}}const xm="(default)";class Zd{constructor(e,n){this.projectId=e,this.database=n||xm}static empty(){return new Zd("","")}get isDefaultDatabase(){return this.database===xm}isEqual(e){return e instanceof Zd&&e.projectId===this.projectId&&e.database===this.database}}function NW(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new fe(te.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zd(t.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i3="__type__",OW="__max__",Of={mapValue:{}},s3="__vector__",Tm="value";function Ia(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Rb(t)?4:MW(t)?9007199254740991:DW(t)?10:11:Te(28295,{value:t})}function Di(t,e){if(t===e)return!0;const n=Ia(t);if(n!==Ia(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Jd(t).isEqual(Jd(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Ea(i.timestampValue),o=Ea(s.timestampValue);return a.seconds===o.seconds&&a.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return Sa(i.bytesValue).isEqual(Sa(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return Ot(i.geoPointValue.latitude)===Ot(s.geoPointValue.latitude)&&Ot(i.geoPointValue.longitude)===Ot(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ot(i.integerValue)===Ot(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Ot(i.doubleValue),o=Ot(s.doubleValue);return a===o?bm(a)===bm(o):isNaN(a)&&isNaN(o)}return!1}(t,e);case 9:return mu(t.arrayValue.values||[],e.arrayValue.values||[],Di);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},o=s.mapValue.fields||{};if(bE(a)!==bE(o))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(o[l]===void 0||!Di(a[l],o[l])))return!1;return!0}(t,e);default:return Te(52216,{left:t})}}function eh(t,e){return(t.values||[]).find(n=>Di(n,e))!==void 0}function yu(t,e){if(t===e)return 0;const n=Ia(t),r=Ia(e);if(n!==r)return ze(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ze(t.booleanValue,e.booleanValue);case 2:return function(s,a){const o=Ot(s.integerValue||s.doubleValue),l=Ot(a.integerValue||a.doubleValue);return o<l?-1:o>l?1:o===l?0:isNaN(o)?isNaN(l)?0:-1:1}(t,e);case 3:return TE(t.timestampValue,e.timestampValue);case 4:return TE(Jd(t),Jd(e));case 5:return ww(t.stringValue,e.stringValue);case 6:return function(s,a){const o=Sa(s),l=Sa(a);return o.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(s,a){const o=s.split("/"),l=a.split("/");for(let u=0;u<o.length&&u<l.length;u++){const c=ze(o[u],l[u]);if(c!==0)return c}return ze(o.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,a){const o=ze(Ot(s.latitude),Ot(a.latitude));return o!==0?o:ze(Ot(s.longitude),Ot(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return EE(t.arrayValue,e.arrayValue);case 10:return function(s,a){var h,m,g,w;const o=s.fields||{},l=a.fields||{},u=(h=o[Tm])==null?void 0:h.arrayValue,c=(m=l[Tm])==null?void 0:m.arrayValue,d=ze(((g=u==null?void 0:u.values)==null?void 0:g.length)||0,((w=c==null?void 0:c.values)==null?void 0:w.length)||0);return d!==0?d:EE(u,c)}(t.mapValue,e.mapValue);case 11:return function(s,a){if(s===Of.mapValue&&a===Of.mapValue)return 0;if(s===Of.mapValue)return 1;if(a===Of.mapValue)return-1;const o=s.fields||{},l=Object.keys(o),u=a.fields||{},c=Object.keys(u);l.sort(),c.sort();for(let d=0;d<l.length&&d<c.length;++d){const h=ww(l[d],c[d]);if(h!==0)return h;const m=yu(o[l[d]],u[c[d]]);if(m!==0)return m}return ze(l.length,c.length)}(t.mapValue,e.mapValue);default:throw Te(23264,{he:n})}}function TE(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ze(t,e);const n=Ea(t),r=Ea(e),i=ze(n.seconds,r.seconds);return i!==0?i:ze(n.nanos,r.nanos)}function EE(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=yu(n[i],r[i]);if(s)return s}return ze(n.length,r.length)}function _u(t){return vw(t)}function vw(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Ea(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Sa(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return we.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=vw(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${vw(n.fields[a])}`;return i+"}"}(t.mapValue):Te(61005,{value:t})}function Ap(t){switch(Ia(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Sg(t);return e?16+Ap(e):16;case 5:return 2*t.stringValue.length;case 6:return Sa(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+Ap(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Ko(r.fields,(s,a)=>{i+=s.length+Ap(a)}),i}(t.mapValue);default:throw Te(13486,{value:t})}}function SE(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function bw(t){return!!t&&"integerValue"in t}function Pb(t){return!!t&&"arrayValue"in t}function IE(t){return!!t&&"nullValue"in t}function kE(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Rp(t){return!!t&&"mapValue"in t}function DW(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[i3])==null?void 0:r.stringValue)===s3}function pd(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ko(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=pd(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=pd(t.arrayValue.values[n]);return e}return{...t}}function MW(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===OW}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e){this.value=e}static empty(){return new mr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Rp(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=pd(n)}setAll(e){let n=ln.emptyPath(),r={},i=[];e.forEach((a,o)=>{if(!n.isImmediateParentOf(o)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=o.popLast()}a?r[o.lastSegment()]=pd(a):i.push(o.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());Rp(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Di(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Rp(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Ko(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new mr(pd(this.value))}}function a3(t){const e=[];return Ko(t.fields,(n,r)=>{const i=new ln([n]);if(Rp(r)){const s=a3(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new jr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,n,r,i,s,a,o){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=o}static newInvalidDocument(e){return new wn(e,0,Ie.min(),Ie.min(),Ie.min(),mr.empty(),0)}static newFoundDocument(e,n,r,i){return new wn(e,1,n,Ie.min(),r,i,0)}static newNoDocument(e,n){return new wn(e,2,n,Ie.min(),Ie.min(),mr.empty(),0)}static newUnknownDocument(e,n){return new wn(e,3,n,Ie.min(),Ie.min(),mr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof wn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,n){this.position=e,this.inclusive=n}}function $E(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],a=t.position[i];if(s.field.isKeyField()?r=we.comparator(we.fromName(a.referenceValue),n.key):r=yu(a,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function CE(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Di(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e,n="asc"){this.field=e,this.dir=n}}function LW(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3{}class Ut extends o3{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new VW(e,n,r):n==="array-contains"?new UW(e,r):n==="in"?new jW(e,r):n==="not-in"?new WW(e,r):n==="array-contains-any"?new HW(e,r):new Ut(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new FW(e,r):new BW(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(yu(n,this.value)):n!==null&&Ia(this.value)===Ia(n)&&this.matchesComparison(yu(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Te(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Jr extends o3{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Jr(e,n)}matches(e){return l3(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function l3(t){return t.op==="and"}function u3(t){return zW(t)&&l3(t)}function zW(t){for(const e of t.filters)if(e instanceof Jr)return!1;return!0}function xw(t){if(t instanceof Ut)return t.field.canonicalString()+t.op.toString()+_u(t.value);if(u3(t))return t.filters.map(e=>xw(e)).join(",");{const e=t.filters.map(n=>xw(n)).join(",");return`${t.op}(${e})`}}function c3(t,e){return t instanceof Ut?function(r,i){return i instanceof Ut&&r.op===i.op&&r.field.isEqual(i.field)&&Di(r.value,i.value)}(t,e):t instanceof Jr?function(r,i){return i instanceof Jr&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,o)=>s&&c3(a,i.filters[o]),!0):!1}(t,e):void Te(19439)}function d3(t){return t instanceof Ut?function(n){return`${n.field.canonicalString()} ${n.op} ${_u(n.value)}`}(t):t instanceof Jr?function(n){return n.op.toString()+" {"+n.getFilters().map(d3).join(" ,")+"}"}(t):"Filter"}class VW extends Ut{constructor(e,n,r){super(e,n,r),this.key=we.fromName(r.referenceValue)}matches(e){const n=we.comparator(e.key,this.key);return this.matchesComparison(n)}}class FW extends Ut{constructor(e,n){super(e,"in",n),this.keys=h3("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class BW extends Ut{constructor(e,n){super(e,"not-in",n),this.keys=h3("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function h3(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>we.fromName(r.referenceValue))}class UW extends Ut{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Pb(n)&&eh(n.arrayValue,this.value)}}class jW extends Ut{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&eh(this.value.arrayValue,n)}}class WW extends Ut{constructor(e,n){super(e,"not-in",n)}matches(e){if(eh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!eh(this.value.arrayValue,n)}}class HW extends Ut{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Pb(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>eh(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qW{constructor(e,n=null,r=[],i=[],s=null,a=null,o=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=o,this.Te=null}}function AE(t,e=null,n=[],r=[],i=null,s=null,a=null){return new qW(t,e,n,r,i,s,a)}function Nb(t){const e=$e(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>xw(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Eg(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>_u(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>_u(r)).join(",")),e.Te=n}return e.Te}function Ob(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!LW(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!c3(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!CE(t.startAt,e.startAt)&&CE(t.endAt,e.endAt)}function Tw(t){return we.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,n=null,r=[],i=[],s=null,a="F",o=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=o,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function GW(t,e,n,r,i,s,a,o){return new Lu(t,e,n,r,i,s,a,o)}function f3(t){return new Lu(t)}function RE(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function KW(t){return we.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function p3(t){return t.collectionGroup!==null}function md(t){const e=$e(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let o=new Kt(ln.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(o=o.add(u.field))})}),o})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new th(s,r))}),n.has(ln.keyField().canonicalString())||e.Ie.push(new th(ln.keyField(),r))}return e.Ie}function Ri(t){const e=$e(t);return e.Ee||(e.Ee=YW(e,md(t))),e.Ee}function YW(t,e){if(t.limitType==="F")return AE(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new th(i.field,s)});const n=t.endAt?new Em(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Em(t.startAt.position,t.startAt.inclusive):null;return AE(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ew(t,e){const n=t.filters.concat([e]);return new Lu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function QW(t,e){const n=t.explicitOrderBy.concat([e]);return new Lu(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}function Sm(t,e,n){return new Lu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ig(t,e){return Ob(Ri(t),Ri(e))&&t.limitType===e.limitType}function m3(t){return`${Nb(Ri(t))}|lt:${t.limitType}`}function kl(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>d3(i)).join(", ")}]`),Eg(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>_u(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>_u(i)).join(",")),`Target(${r})`}(Ri(t))}; limitType=${t.limitType})`}function kg(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):we.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of md(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(a,o,l){const u=$E(a,o,l);return a.inclusive?u<=0:u<0}(r.startAt,md(r),i)||r.endAt&&!function(a,o,l){const u=$E(a,o,l);return a.inclusive?u>=0:u>0}(r.endAt,md(r),i))}(t,e)}function XW(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function g3(t){return(e,n)=>{let r=!1;for(const i of md(t)){const s=JW(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function JW(t,e,n){const r=t.field.isKeyField()?we.comparator(e.key,n.key):function(s,a,o){const l=a.data.field(s),u=o.data.field(s);return l!==null&&u!==null?yu(l,u):Te(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Te(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ko(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return JN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZW=new St(we.comparator);function _s(){return ZW}const y3=new St(we.comparator);function Kc(...t){let e=y3;for(const n of t)e=e.insert(n.key,n);return e}function _3(t){let e=y3;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function vo(){return gd()}function w3(){return gd()}function gd(){return new Yo(t=>t.toString(),(t,e)=>t.isEqual(e))}const e8=new St(we.comparator),t8=new Kt(we.comparator);function Ve(...t){let e=t8;for(const n of t)e=e.add(n);return e}const n8=new Kt(ze);function r8(){return n8}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bm(e)?"-0":e}}function v3(t){return{integerValue:""+t}}function i8(t,e){return $W(e)?v3(e):Db(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(){this._=void 0}}function s8(t,e,n){return t instanceof Im?function(i,s){const a={fields:{[t3]:{stringValue:e3},[r3]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Rb(s)&&(s=Sg(s)),s&&(a.fields[n3]=s),{mapValue:a}}(n,e):t instanceof nh?x3(t,e):t instanceof rh?T3(t,e):function(i,s){const a=b3(i,s),o=PE(a)+PE(i.Ae);return bw(a)&&bw(i.Ae)?v3(o):Db(i.serializer,o)}(t,e)}function a8(t,e,n){return t instanceof nh?x3(t,e):t instanceof rh?T3(t,e):n}function b3(t,e){return t instanceof km?function(r){return bw(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class Im extends $g{}class nh extends $g{constructor(e){super(),this.elements=e}}function x3(t,e){const n=E3(e);for(const r of t.elements)n.some(i=>Di(i,r))||n.push(r);return{arrayValue:{values:n}}}class rh extends $g{constructor(e){super(),this.elements=e}}function T3(t,e){let n=E3(e);for(const r of t.elements)n=n.filter(i=>!Di(i,r));return{arrayValue:{values:n}}}class km extends $g{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function PE(t){return Ot(t.integerValue||t.doubleValue)}function E3(t){return Pb(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function o8(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof nh&&i instanceof nh||r instanceof rh&&i instanceof rh?mu(r.elements,i.elements,Di):r instanceof km&&i instanceof km?Di(r.Ae,i.Ae):r instanceof Im&&i instanceof Im}(t.transform,e.transform)}class l8{constructor(e,n){this.version=e,this.transformResults=n}}class Pi{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Pi}static exists(e){return new Pi(void 0,e)}static updateTime(e){return new Pi(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Pp(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Cg{}function S3(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new k3(t.key,Pi.none()):new Sh(t.key,t.data,Pi.none());{const n=t.data,r=mr.empty();let i=new Kt(ln.comparator);for(let s of e.fields)if(!i.has(s)){let a=n.field(s);a===null&&s.length>1&&(s=s.popLast(),a=n.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new Qo(t.key,r,new jr(i.toArray()),Pi.none())}}function u8(t,e,n){t instanceof Sh?function(i,s,a){const o=i.value.clone(),l=OE(i.fieldTransforms,s,a.transformResults);o.setAll(l),s.convertToFoundDocument(a.version,o).setHasCommittedMutations()}(t,e,n):t instanceof Qo?function(i,s,a){if(!Pp(i.precondition,s))return void s.convertToUnknownDocument(a.version);const o=OE(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(I3(i)),l.setAll(o),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function yd(t,e,n,r){return t instanceof Sh?function(s,a,o,l){if(!Pp(s.precondition,a))return o;const u=s.value.clone(),c=DE(s.fieldTransforms,l,a);return u.setAll(c),a.convertToFoundDocument(a.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Qo?function(s,a,o,l){if(!Pp(s.precondition,a))return o;const u=DE(s.fieldTransforms,l,a),c=a.data;return c.setAll(I3(s)),c.setAll(u),a.convertToFoundDocument(a.version,c).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(t,e,n,r):function(s,a,o){return Pp(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):o}(t,e,n)}function c8(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=b3(r.transform,i||null);s!=null&&(n===null&&(n=mr.empty()),n.set(r.field,s))}return n||null}function NE(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&mu(r,i,(s,a)=>o8(s,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Sh extends Cg{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Qo extends Cg{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function I3(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function OE(t,e,n){const r=new Map;Qe(t.length===n.length,32656,{Ve:n.length,de:t.length});for(let i=0;i<n.length;i++){const s=t[i],a=s.transform,o=e.data.field(s.field);r.set(s.field,a8(a,o,n[i]))}return r}function DE(t,e,n){const r=new Map;for(const i of t){const s=i.transform,a=n.data.field(i.field);r.set(i.field,s8(s,a,e))}return r}class k3 extends Cg{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class d8 extends Cg{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h8{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&u8(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=yd(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=yd(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=w3();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let o=this.applyToLocalView(a,s.mutatedFields);o=n.has(i.key)?null:o;const l=S3(a,o);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(Ie.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&mu(this.mutations,e.mutations,(n,r)=>NE(n,r))&&mu(this.baseMutations,e.baseMutations,(n,r)=>NE(n,r))}}class Mb{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Qe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=function(){return e8}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new Mb(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f8{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p8{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ft,Ue;function m8(t){switch(t){case te.OK:return Te(64938);case te.CANCELLED:case te.UNKNOWN:case te.DEADLINE_EXCEEDED:case te.RESOURCE_EXHAUSTED:case te.INTERNAL:case te.UNAVAILABLE:case te.UNAUTHENTICATED:return!1;case te.INVALID_ARGUMENT:case te.NOT_FOUND:case te.ALREADY_EXISTS:case te.PERMISSION_DENIED:case te.FAILED_PRECONDITION:case te.ABORTED:case te.OUT_OF_RANGE:case te.UNIMPLEMENTED:case te.DATA_LOSS:return!0;default:return Te(15467,{code:t})}}function $3(t){if(t===void 0)return ys("GRPC error has no .code"),te.UNKNOWN;switch(t){case Ft.OK:return te.OK;case Ft.CANCELLED:return te.CANCELLED;case Ft.UNKNOWN:return te.UNKNOWN;case Ft.DEADLINE_EXCEEDED:return te.DEADLINE_EXCEEDED;case Ft.RESOURCE_EXHAUSTED:return te.RESOURCE_EXHAUSTED;case Ft.INTERNAL:return te.INTERNAL;case Ft.UNAVAILABLE:return te.UNAVAILABLE;case Ft.UNAUTHENTICATED:return te.UNAUTHENTICATED;case Ft.INVALID_ARGUMENT:return te.INVALID_ARGUMENT;case Ft.NOT_FOUND:return te.NOT_FOUND;case Ft.ALREADY_EXISTS:return te.ALREADY_EXISTS;case Ft.PERMISSION_DENIED:return te.PERMISSION_DENIED;case Ft.FAILED_PRECONDITION:return te.FAILED_PRECONDITION;case Ft.ABORTED:return te.ABORTED;case Ft.OUT_OF_RANGE:return te.OUT_OF_RANGE;case Ft.UNIMPLEMENTED:return te.UNIMPLEMENTED;case Ft.DATA_LOSS:return te.DATA_LOSS;default:return Te(39323,{code:t})}}(Ue=Ft||(Ft={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g8(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y8=new ga([4294967295,4294967295],0);function ME(t){const e=g8().encode(t),n=new BN;return n.update(e),new Uint8Array(n.digest())}function LE(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ga([n,r],0),new ga([i,s],0)]}class Lb{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Yc(`Invalid padding: ${n}`);if(r<0)throw new Yc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Yc(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Yc(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ga.fromNumber(this.ge)}ye(e,n,r){let i=e.add(n.multiply(ga.fromNumber(r)));return i.compare(y8)===1&&(i=new ga([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=ME(e),[r,i]=LE(n);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);if(!this.we(a))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Lb(s,i,n);return r.forEach(o=>a.insert(o)),a}insert(e){if(this.ge===0)return;const n=ME(e),[r,i]=LE(n);for(let s=0;s<this.hashCount;s++){const a=this.ye(r,i,s);this.be(a)}}be(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Yc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Ih.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Ag(Ie.min(),i,new St(ze),_s(),Ve())}}class Ih{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Ih(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(e,n,r,i){this.Se=e,this.removedTargetIds=n,this.key=r,this.De=i}}class C3{constructor(e,n){this.targetId=e,this.Ce=n}}class A3{constructor(e,n,r=dn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class zE{constructor(){this.ve=0,this.Fe=VE(),this.Me=dn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ve(),n=Ve(),r=Ve();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Te(38017,{changeType:s})}}),new Ih(this.Me,this.xe,e,n,r)}Ke(){this.Oe=!1,this.Fe=VE()}qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Qe(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class _8{constructor(e){this.Ge=e,this.ze=new Map,this.je=_s(),this.He=Df(),this.Je=Df(),this.Ze=new St(ze)}Xe(e){for(const n of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Te(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,i)=>{this.rt(i)&&n(i)})}st(e){const n=e.targetId,r=e.Ce.count,i=this.ot(n);if(i){const s=i.target;if(Tw(s))if(r===0){const a=new we(s.path);this.et(n,a,wn.newNoDocument(a,Ie.min()))}else Qe(r===1,20013,{expectedCount:r});else{const a=this._t(n);if(a!==r){const o=this.ut(e),l=o?this.ct(o,e,a):1;if(l!==0){this.it(n);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(n,u)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let a,o;try{a=Sa(r).toUint8Array()}catch(l){if(l instanceof ZN)return zo("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{o=new Lb(a,i,s)}catch(l){return zo(l instanceof Yc?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return o.ge===0?null:o}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const a=this.Ge.ht(),o=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(o)||(this.et(n,s,null),i++)}),i}Tt(e){const n=new Map;this.ze.forEach((s,a)=>{const o=this.ot(a);if(o){if(s.current&&Tw(o.target)){const l=new we(o.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,wn.newNoDocument(l,e))}s.Be&&(n.set(a,s.ke()),s.Ke())}});let r=Ve();this.Je.forEach((s,a)=>{let o=!0;a.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(r=r.add(s))}),this.je.forEach((s,a)=>a.setReadTime(e));const i=new Ag(e,n,this.Ze,this.je,r);return this.je=_s(),this.He=Df(),this.Je=Df(),this.Ze=new St(ze),i}Ye(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).qe(n.key,r),this.je=this.je.insert(n.key,n),this.He=this.He.insert(n.key,this.It(n.key).add(e)),this.Je=this.Je.insert(n.key,this.Rt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,n)?i.qe(n,1):i.Ue(n),this.Je=this.Je.insert(n,this.Rt(n).delete(e)),this.Je=this.Je.insert(n,this.Rt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let n=this.ze.get(e);return n||(n=new zE,this.ze.set(e,n)),n}Rt(e){let n=this.Je.get(e);return n||(n=new Kt(ze),this.Je=this.Je.insert(e,n)),n}It(e){let n=this.He.get(e);return n||(n=new Kt(ze),this.He=this.He.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||pe("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new zE),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Df(){return new St(we.comparator)}function VE(){return new St(we.comparator)}const w8={asc:"ASCENDING",desc:"DESCENDING"},v8={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},b8={and:"AND",or:"OR"};class x8{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Sw(t,e){return t.useProto3Json||Eg(e)?e:{value:e}}function $m(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function R3(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function T8(t,e){return $m(t,e.toTimestamp())}function Ni(t){return Qe(!!t,49232),Ie.fromTimestamp(function(n){const r=Ea(n);return new pt(r.seconds,r.nanos)}(t))}function zb(t,e){return Iw(t,e).canonicalString()}function Iw(t,e){const n=function(i){return new ut(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function P3(t){const e=ut.fromString(t);return Qe(L3(e),10190,{key:e.toString()}),e}function kw(t,e){return zb(t.databaseId,e.path)}function Yy(t,e){const n=P3(e);if(n.get(1)!==t.databaseId.projectId)throw new fe(te.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new fe(te.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new we(O3(n))}function N3(t,e){return zb(t.databaseId,e)}function E8(t){const e=P3(t);return e.length===4?ut.emptyPath():O3(e)}function $w(t){return new ut(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function O3(t){return Qe(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function FE(t,e,n){return{name:kw(t,e),fields:n.value.mapValue.fields}}function S8(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Te(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,c){return u.useProto3Json?(Qe(c===void 0||typeof c=="string",58123),dn.fromBase64String(c||"")):(Qe(c===void 0||c instanceof Buffer||c instanceof Uint8Array,16193),dn.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(u){const c=u.code===void 0?te.UNKNOWN:$3(u.code);return new fe(c,u.message||"")}(a);n=new A3(r,i,s,o||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Yy(t,r.document.name),s=Ni(r.document.updateTime),a=r.document.createTime?Ni(r.document.createTime):Ie.min(),o=new mr({mapValue:{fields:r.document.fields}}),l=wn.newFoundDocument(i,s,a,o),u=r.targetIds||[],c=r.removedTargetIds||[];n=new Np(u,c,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Yy(t,r.document),s=r.readTime?Ni(r.readTime):Ie.min(),a=wn.newNoDocument(i,s),o=r.removedTargetIds||[];n=new Np([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Yy(t,r.document),s=r.removedTargetIds||[];n=new Np([],s,i,null)}else{if(!("filter"in e))return Te(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new p8(i,s),o=r.targetId;n=new C3(o,a)}}return n}function I8(t,e){let n;if(e instanceof Sh)n={update:FE(t,e.key,e.value)};else if(e instanceof k3)n={delete:kw(t,e.key)};else if(e instanceof Qo)n={update:FE(t,e.key,e.data),updateMask:D8(e.fieldMask)};else{if(!(e instanceof d8))return Te(16599,{dt:e.type});n={verify:kw(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const o=a.transform;if(o instanceof Im)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof nh)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof rh)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof km)return{fieldPath:a.field.canonicalString(),increment:o.Ae};throw Te(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:T8(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Te(27497)}(t,e.precondition)),n}function k8(t,e){return t&&t.length>0?(Qe(e!==void 0,14353),t.map(n=>function(i,s){let a=i.updateTime?Ni(i.updateTime):Ni(s);return a.isEqual(Ie.min())&&(a=Ni(s)),new l8(a,i.transformResults||[])}(n,e))):[]}function $8(t,e){return{documents:[N3(t,e.path)]}}function C8(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=N3(t,i);const s=function(u){if(u.length!==0)return M3(Jr.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const a=function(u){if(u.length!==0)return u.map(c=>function(h){return{field:$l(h.field),direction:P8(h.dir)}}(c))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const o=Sw(t,e.limit);return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:n,parent:i}}function A8(t){let e=E8(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Qe(r===1,65062);const c=n.from[0];c.allDescendants?i=c.collectionId:e=e.child(c.collectionId)}let s=[];n.where&&(s=function(d){const h=D3(d);return h instanceof Jr&&u3(h)?h.getFilters():[h]}(n.where));let a=[];n.orderBy&&(a=function(d){return d.map(h=>function(g){return new th(Cl(g.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(h))}(n.orderBy));let o=null;n.limit&&(o=function(d){let h;return h=typeof d=="object"?d.value:d,Eg(h)?null:h}(n.limit));let l=null;n.startAt&&(l=function(d){const h=!!d.before,m=d.values||[];return new Em(m,h)}(n.startAt));let u=null;return n.endAt&&(u=function(d){const h=!d.before,m=d.values||[];return new Em(m,h)}(n.endAt)),GW(e,i,a,s,o,"F",l,u)}function R8(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Te(28987,{purpose:i})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function D3(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Cl(n.unaryFilter.field);return Ut.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Cl(n.unaryFilter.field);return Ut.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Cl(n.unaryFilter.field);return Ut.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Cl(n.unaryFilter.field);return Ut.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Te(61313);default:return Te(60726)}}(t):t.fieldFilter!==void 0?function(n){return Ut.create(Cl(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Te(58110);default:return Te(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Jr.create(n.compositeFilter.filters.map(r=>D3(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Te(1026)}}(n.compositeFilter.op))}(t):Te(30097,{filter:t})}function P8(t){return w8[t]}function N8(t){return v8[t]}function O8(t){return b8[t]}function $l(t){return{fieldPath:t.canonicalString()}}function Cl(t){return ln.fromServerFormat(t.fieldPath)}function M3(t){return t instanceof Ut?function(n){if(n.op==="=="){if(kE(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NAN"}};if(IE(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(kE(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NOT_NAN"}};if(IE(n.value))return{unaryFilter:{field:$l(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$l(n.field),op:N8(n.op),value:n.value}}}(t):t instanceof Jr?function(n){const r=n.getFilters().map(i=>M3(i));return r.length===1?r[0]:{compositeFilter:{op:O8(n.op),filters:r}}}(t):Te(54877,{filter:t})}function D8(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function L3(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}function z3(t){return!!t&&typeof t._toProto=="function"&&t._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e,n,r,i,s=Ie.min(),a=Ie.min(),o=dn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=o,this.expectedCount=l}withSequenceNumber(e){return new ea(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ea(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ea(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M8{constructor(e){this.yt=e}}function L8(t){const e=A8({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sm(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z8{constructor(){this.Sn=new V8}addToCollectionParentIndex(e,n){return this.Sn.add(n),ne.resolve()}getCollectionParents(e,n){return ne.resolve(this.Sn.getEntries(n))}addFieldIndex(e,n){return ne.resolve()}deleteFieldIndex(e,n){return ne.resolve()}deleteAllFieldIndexes(e){return ne.resolve()}createTargetIndexes(e,n){return ne.resolve()}getDocumentsMatchingTarget(e,n){return ne.resolve(null)}getIndexType(e,n){return ne.resolve(0)}getFieldIndexes(e,n){return ne.resolve([])}getNextCollectionGroupToUpdate(e){return ne.resolve(null)}getMinOffset(e,n){return ne.resolve(Ta.min())}getMinOffsetFromCollectionGroup(e,n){return ne.resolve(Ta.min())}updateCollectionGroup(e,n,r){return ne.resolve()}updateIndexEntries(e,n){return ne.resolve()}}class V8{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Kt(ut.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Kt(ut.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},V3=41943040;class Bn{static withCacheSize(e){return new Bn(e,Bn.DEFAULT_COLLECTION_PERCENTILE,Bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bn.DEFAULT_COLLECTION_PERCENTILE=10,Bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bn.DEFAULT=new Bn(V3,Bn.DEFAULT_COLLECTION_PERCENTILE,Bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bn.DISABLED=new Bn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new wu(0)}static ar(){return new wu(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UE="LruGarbageCollector",F8=1048576;function jE([t,e],[n,r]){const i=ze(t,n);return i===0?ze(e,r):i}class B8{constructor(e){this.Pr=e,this.buffer=new Kt(jE),this.Tr=0}Ir(){return++this.Tr}Er(e){const n=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();jE(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class U8{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){pe(UE,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Mu(n)?pe(UE,"Ignoring IndexedDB error during garbage collection: ",n):await Du(n)}await this.Ar(3e5)})}}class j8{constructor(e,n){this.Vr=e,this.params=n}calculateTargetCount(e,n){return this.Vr.dr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ne.resolve(Tg.ce);const r=new B8(n);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.mr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Vr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Vr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(pe("LruGarbageCollector","Garbage collection skipped; disabled"),ne.resolve(BE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),BE):this.gr(e,n))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,n){let r,i,s,a,o,l,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,a=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,o=Date.now(),this.removeTargets(e,r,n))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(u=Date.now(),Il()<=Le.DEBUG&&pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-c}ms
	Determined least recently used ${i} in `+(o-a)+`ms
	Removed ${s} targets in `+(l-o)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-c}ms`),ne.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})))}}function W8(t,e){return new j8(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H8{constructor(){this.changes=new Yo(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,wn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ne.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q8{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G8{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&yd(r.mutation,i,jr.empty(),pt.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const i=vo();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let a=Kc();return s.forEach((o,l)=>{a=a.insert(o,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=vo();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,o)=>{n.set(a,o)})})}computeViews(e,n,r,i){let s=_s();const a=gd(),o=function(){return gd()}();return n.forEach((l,u)=>{const c=r.get(u.key);i.has(u.key)&&(c===void 0||c.mutation instanceof Qo)?s=s.insert(u.key,u):c!==void 0?(a.set(u.key,c.mutation.getFieldMask()),yd(c.mutation,u,c.mutation.getFieldMask(),pt.now())):a.set(u.key,jr.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,c)=>a.set(u,c)),n.forEach((u,c)=>o.set(u,new q8(c,a.get(u)??null))),o))}recalculateAndSaveOverlays(e,n){const r=gd();let i=new St((a,o)=>a-o),s=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const o of a)o.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let c=r.get(l)||jr.empty();c=o.applyToLocalView(u,c),r.set(l,c);const d=(i.get(o.batchId)||Ve()).add(l);i=i.insert(o.batchId,d)})}).next(()=>{const a=[],o=i.getReverseIterator();for(;o.hasNext();){const l=o.getNext(),u=l.key,c=l.value,d=w3();c.forEach(h=>{if(!s.has(h)){const m=S3(n.get(h),r.get(h));m!==null&&d.set(h,m),s=s.add(h)}}),a.push(this.documentOverlayCache.saveOverlays(e,u,d))}return ne.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return KW(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):p3(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):ne.resolve(vo());let o=Xd,l=s;return a.next(u=>ne.forEach(u,(c,d)=>(o<d.largestBatchId&&(o=d.largestBatchId),s.get(c)?ne.resolve():this.remoteDocumentCache.getEntry(e,c).next(h=>{l=l.insert(c,h)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,Ve())).next(c=>({batchId:o,changes:_3(c)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new we(n)).next(r=>{let i=Kc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let a=Kc();return this.indexManager.getCollectionParents(e,s).next(o=>ne.forEach(o,l=>{const u=function(d,h){return new Lu(h,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(n,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(c=>{c.forEach((d,h)=>{a=a.insert(d,h)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(a=>{s.forEach((l,u)=>{const c=u.getKey();a.get(c)===null&&(a=a.insert(c,wn.newInvalidDocument(c)))});let o=Kc();return a.forEach((l,u)=>{const c=s.get(l);c!==void 0&&yd(c.mutation,u,jr.empty(),pt.now()),kg(n,u)&&(o=o.insert(l,u))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K8{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,n){return ne.resolve(this.Nr.get(n))}saveBundleMetadata(e,n){return this.Nr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:Ni(i.createTime)}}(n)),ne.resolve()}getNamedQuery(e,n){return ne.resolve(this.Br.get(n))}saveNamedQuery(e,n){return this.Br.set(n.name,function(i){return{name:i.name,query:L8(i.bundledQuery),readTime:Ni(i.readTime)}}(n)),ne.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y8{constructor(){this.overlays=new St(we.comparator),this.Lr=new Map}getOverlay(e,n){return ne.resolve(this.overlays.get(n))}getOverlays(e,n){const r=vo();return ne.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.bt(e,n,s)}),ne.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Lr.delete(r)),ne.resolve()}getOverlaysForCollection(e,n,r){const i=vo(),s=n.length+1,a=new we(n.child("")),o=this.overlays.getIteratorFrom(a);for(;o.hasNext();){const l=o.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return ne.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new St((u,c)=>u-c);const a=this.overlays.getIterator();for(;a.hasNext();){const u=a.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let c=s.get(u.largestBatchId);c===null&&(c=vo(),s=s.insert(u.largestBatchId,c)),c.set(u.getKey(),u)}}const o=vo(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,c)=>o.set(u,c)),!(o.size()>=i)););return ne.resolve(o)}bt(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new f8(n,r));let s=this.Lr.get(n);s===void 0&&(s=Ve(),this.Lr.set(n,s)),this.Lr.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q8{constructor(){this.sessionToken=dn.EMPTY_BYTE_STRING}getSessionToken(e){return ne.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ne.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vb{constructor(){this.kr=new Kt(Zt.Kr),this.qr=new Kt(Zt.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,n){const r=new Zt(e,n);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Wr(new Zt(e,n))}Qr(e,n){e.forEach(r=>this.removeReference(r,n))}Gr(e){const n=new we(new ut([])),r=new Zt(n,e),i=new Zt(n,e+1),s=[];return this.qr.forEachInRange([r,i],a=>{this.Wr(a),s.push(a.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const n=new we(new ut([])),r=new Zt(n,e),i=new Zt(n,e+1);let s=Ve();return this.qr.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const n=new Zt(e,0),r=this.kr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Zt{constructor(e,n){this.key=e,this.Hr=n}static Kr(e,n){return we.comparator(e.key,n.key)||ze(e.Hr,n.Hr)}static Ur(e,n){return ze(e.Hr,n.Hr)||we.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X8{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Yn=1,this.Jr=new Kt(Zt.Kr)}checkEmpty(e){return ne.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new h8(s,n,r,i);this.mutationQueue.push(a);for(const o of i)this.Jr=this.Jr.add(new Zt(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ne.resolve(a)}lookupMutationBatch(e,n){return ne.resolve(this.Zr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.Xr(r),s=i<0?0:i;return ne.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return ne.resolve(this.mutationQueue.length===0?Ab:this.Yn-1)}getAllMutationBatches(e){return ne.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Zt(n,0),i=new Zt(n,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([r,i],a=>{const o=this.Zr(a.Hr);s.push(o)}),ne.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Kt(ze);return n.forEach(i=>{const s=new Zt(i,0),a=new Zt(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,a],o=>{r=r.add(o.Hr)})}),ne.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;we.isDocumentKey(s)||(s=s.child(""));const a=new Zt(new we(s),0);let o=new Kt(ze);return this.Jr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(o=o.add(l.Hr)),!0)},a),ne.resolve(this.Yr(o))}Yr(e){const n=[];return e.forEach(r=>{const i=this.Zr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Qe(this.ei(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return ne.forEach(n.mutations,i=>{const s=new Zt(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,n){const r=new Zt(n,0),i=this.Jr.firstAfterOrEqual(r);return ne.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ne.resolve()}ei(e,n){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const n=this.Xr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J8{constructor(e){this.ti=e,this.docs=function(){return new St(we.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,a=this.ti(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ne.resolve(r?r.document.mutableCopy():wn.newInvalidDocument(n))}getEntries(e,n){let r=_s();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():wn.newInvalidDocument(i))}),ne.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=_s();const a=n.path,o=new we(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(o);for(;l.hasNext();){const{key:u,value:{document:c}}=l.getNext();if(!a.isPrefixOf(u.path))break;u.path.length>a.length+1||EW(TW(c),r)<=0||(i.has(c.key)||kg(n,c))&&(s=s.insert(c.key,c.mutableCopy()))}return ne.resolve(s)}getAllFromCollectionGroup(e,n,r,i){Te(9500)}ni(e,n){return ne.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new Z8(this)}getSize(e){return ne.resolve(this.size)}}class Z8 extends H8{constructor(e){super(),this.Mr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(r)}),ne.waitFor(n)}getFromCache(e,n){return this.Mr.getEntry(e,n)}getAllFromCache(e,n){return this.Mr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eH{constructor(e){this.persistence=e,this.ri=new Yo(n=>Nb(n),Ob),this.lastRemoteSnapshotVersion=Ie.min(),this.highestTargetId=0,this.ii=0,this.si=new Vb,this.targetCount=0,this.oi=wu._r()}forEachTarget(e,n){return this.ri.forEach((r,i)=>n(i)),ne.resolve()}getLastRemoteSnapshotVersion(e){return ne.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ne.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),ne.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ii&&(this.ii=n),ne.resolve()}lr(e){this.ri.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.oi=new wu(n),this.highestTargetId=n),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,n){return this.lr(n),this.targetCount+=1,ne.resolve()}updateTargetData(e,n){return this.lr(n),ne.resolve()}removeTargetData(e,n){return this.ri.delete(n.target),this.si.Gr(n.targetId),this.targetCount-=1,ne.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.ri.forEach((a,o)=>{o.sequenceNumber<=n&&r.get(o.targetId)===null&&(this.ri.delete(a),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),ne.waitFor(s).next(()=>i)}getTargetCount(e){return ne.resolve(this.targetCount)}getTargetData(e,n){const r=this.ri.get(n)||null;return ne.resolve(r)}addMatchingKeys(e,n,r){return this.si.$r(n,r),ne.resolve()}removeMatchingKeys(e,n,r){this.si.Qr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),ne.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.si.Gr(n),ne.resolve()}getMatchingKeysForTargetId(e,n){const r=this.si.jr(n);return ne.resolve(r)}containsKey(e,n){return ne.resolve(this.si.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3{constructor(e,n){this._i={},this.overlays={},this.ai=new Tg(0),this.ui=!1,this.ui=!0,this.ci=new Q8,this.referenceDelegate=e(this),this.li=new eH(this),this.indexManager=new z8,this.remoteDocumentCache=function(i){return new J8(i)}(r=>this.referenceDelegate.hi(r)),this.serializer=new M8(n),this.Pi=new K8(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Y8,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this._i[e.toKey()];return r||(r=new X8(n,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,n,r){pe("MemoryPersistence","Starting transaction:",e);const i=new tH(this.ai.next());return this.referenceDelegate.Ti(),r(i).next(s=>this.referenceDelegate.Ii(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,n){return ne.or(Object.values(this._i).map(r=>()=>r.containsKey(e,n)))}}class tH extends IW{constructor(e){super(),this.currentSequenceNumber=e}}class Fb{constructor(e){this.persistence=e,this.Ri=new Vb,this.Ai=null}static Vi(e){return new Fb(e)}get di(){if(this.Ai)return this.Ai;throw Te(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.di.delete(r.toString()),ne.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.di.add(r.toString()),ne.resolve()}markPotentiallyOrphaned(e,n){return this.di.add(n.toString()),ne.resolve()}removeTarget(e,n){this.Ri.Gr(n.targetId).forEach(i=>this.di.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.di.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Ti(){this.Ai=new Set}Ii(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ne.forEach(this.di,r=>{const i=we.fromPath(r);return this.mi(e,i).next(s=>{s||n.removeEntry(i,Ie.min())})}).next(()=>(this.Ai=null,n.apply(e)))}updateLimboDocument(e,n){return this.mi(e,n).next(r=>{r?this.di.delete(n.toString()):this.di.add(n.toString())})}hi(e){return 0}mi(e,n){return ne.or([()=>ne.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ei(e,n)])}}class Cm{constructor(e,n){this.persistence=e,this.fi=new Yo(r=>CW(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=W8(this,n)}static Vi(e,n){return new Cm(e,n)}Ti(){}Ii(e){return ne.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}dr(e){const n=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}pr(e){let n=0;return this.mr(e,r=>{n++}).next(()=>n)}mr(e,n){return ne.forEach(this.fi,(r,i)=>this.wr(e,r,i).next(s=>s?ne.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ni(e,a=>this.wr(e,a,n).next(o=>{o||(r++,s.removeEntry(a,Ie.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.fi.set(n,e.currentSequenceNumber),ne.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.fi.set(r,e.currentSequenceNumber),ne.resolve()}removeReference(e,n,r){return this.fi.set(r,e.currentSequenceNumber),ne.resolve()}updateLimboDocument(e,n){return this.fi.set(n,e.currentSequenceNumber),ne.resolve()}hi(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Ap(e.data.value)),n}wr(e,n,r){return ne.or([()=>this.persistence.Ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.fi.get(n);return ne.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Ts=r,this.Is=i}static Es(e,n){let r=Ve(),i=Ve();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Bb(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nH{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rH{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return $6()?8:kW(xn())>0?6:4}()}initialize(e,n){this.fs=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.gs(e,n).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ps(e,n,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new nH;return this.ys(e,n,a).next(o=>{if(s.result=o,this.As)return this.ws(e,n,a,o.size)})}).next(()=>s.result)}ws(e,n,r,i){return r.documentReadCount<this.Vs?(Il()<=Le.DEBUG&&pe("QueryEngine","SDK will not create cache indexes for query:",kl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),ne.resolve()):(Il()<=Le.DEBUG&&pe("QueryEngine","Query:",kl(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(Il()<=Le.DEBUG&&pe("QueryEngine","The SDK decides to create cache indexes for query:",kl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ri(n))):ne.resolve())}gs(e,n){if(RE(n))return ne.resolve(null);let r=Ri(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=Sm(n,null,"F"),r=Ri(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=Ve(...s);return this.fs.getDocuments(e,a).next(o=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.bs(n,o);return this.Ss(n,u,a,l.readTime)?this.gs(e,Sm(n,null,"F")):this.Ds(e,u,n,l)}))})))}ps(e,n,r,i){return RE(n)||i.isEqual(Ie.min())?ne.resolve(null):this.fs.getDocuments(e,r).next(s=>{const a=this.bs(n,s);return this.Ss(n,a,r,i)?ne.resolve(null):(Il()<=Le.DEBUG&&pe("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),kl(n)),this.Ds(e,a,n,xW(i,Xd)).next(o=>o))})}bs(e,n){let r=new Kt(g3(e));return n.forEach((i,s)=>{kg(e,s)&&(r=r.add(s))}),r}Ss(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ys(e,n,r){return Il()<=Le.DEBUG&&pe("QueryEngine","Using full collection scan to execute query:",kl(n)),this.fs.getDocumentsMatchingQuery(e,n,Ta.min(),r)}Ds(e,n,r,i){return this.fs.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub="LocalStore",iH=3e8;class sH{constructor(e,n,r,i){this.persistence=e,this.Cs=n,this.serializer=i,this.vs=new St(ze),this.Fs=new Yo(s=>Nb(s),Ob),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new G8(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.vs))}}function aH(t,e,n,r){return new sH(t,e,n,r)}async function B3(t,e){const n=$e(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Os(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],o=[];let l=Ve();for(const u of i){a.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}for(const u of s){o.push(u.batchId);for(const c of u.mutations)l=l.add(c.key)}return n.localDocuments.getDocuments(r,l).next(u=>({Ns:u,removedBatchIds:a,addedBatchIds:o}))})})}function oH(t,e){const n=$e(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.xs.newChangeBuffer({trackRemovals:!0});return function(o,l,u,c){const d=u.batch,h=d.keys();let m=ne.resolve();return h.forEach(g=>{m=m.next(()=>c.getEntry(l,g)).next(w=>{const x=u.docVersions.get(g);Qe(x!==null,48541),w.version.compareTo(x)<0&&(d.applyToRemoteDocument(w,u),w.isValidDocument()&&(w.setReadTime(u.commitVersion),c.addEntry(w)))})}),m.next(()=>o.mutationQueue.removeMutationBatch(l,d))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let l=Ve();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(l=l.add(o.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function U3(t){const e=$e(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.li.getLastRemoteSnapshotVersion(n))}function lH(t,e){const n=$e(t),r=e.snapshotVersion;let i=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=n.xs.newChangeBuffer({trackRemovals:!0});i=n.vs;const o=[];e.targetChanges.forEach((c,d)=>{const h=i.get(d);if(!h)return;o.push(n.li.removeMatchingKeys(s,c.removedDocuments,d).next(()=>n.li.addMatchingKeys(s,c.addedDocuments,d)));let m=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(dn.EMPTY_BYTE_STRING,Ie.min()).withLastLimboFreeSnapshotVersion(Ie.min()):c.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(c.resumeToken,r)),i=i.insert(d,m),function(w,x,v){return w.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=iH?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(h,m,c)&&o.push(n.li.updateTargetData(s,m))});let l=_s(),u=Ve();if(e.documentUpdates.forEach(c=>{e.resolvedLimboDocuments.has(c)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(s,c))}),o.push(uH(s,a,e.documentUpdates).next(c=>{l=c.Bs,u=c.Ls})),!r.isEqual(Ie.min())){const c=n.li.getLastRemoteSnapshotVersion(s).next(d=>n.li.setTargetsMetadata(s,s.currentSequenceNumber,r));o.push(c)}return ne.waitFor(o).next(()=>a.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(n.vs=i,s))}function uH(t,e,n){let r=Ve(),i=Ve();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let a=_s();return n.forEach((o,l)=>{const u=s.get(o);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(o)),l.isNoDocument()&&l.version.isEqual(Ie.min())?(e.removeEntry(o,l.readTime),a=a.insert(o,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),a=a.insert(o,l)):pe(Ub,"Ignoring outdated watch update for ",o,". Current version:",u.version," Watch version:",l.version)}),{Bs:a,Ls:i}})}function cH(t,e){const n=$e(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ab),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function dH(t,e){const n=$e(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.li.getTargetData(r,e).next(s=>s?(i=s,ne.resolve(i)):n.li.allocateTargetId(r).next(a=>(i=new ea(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.li.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.vs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.vs=n.vs.insert(r.targetId,r),n.Fs.set(e,r.targetId)),r})}async function Cw(t,e,n){const r=$e(t),i=r.vs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Mu(a))throw a;pe(Ub,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(i.target)}function WE(t,e,n){const r=$e(t);let i=Ie.min(),s=Ve();return r.persistence.runTransaction("Execute query","readwrite",a=>function(l,u,c){const d=$e(l),h=d.Fs.get(c);return h!==void 0?ne.resolve(d.vs.get(h)):d.li.getTargetData(u,c)}(r,a,Ri(e)).next(o=>{if(o)return i=o.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,o.targetId).next(l=>{s=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,n?i:Ie.min(),n?s:Ve())).next(o=>(hH(r,XW(e),o),{documents:o,ks:s})))}function hH(t,e,n){let r=t.Ms.get(e)||Ie.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Ms.set(e,r)}class HE{constructor(){this.activeTargetIds=r8()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fH{constructor(){this.vo=new HE,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,n,r){this.Fo[e]=n}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new HE,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pH{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE="ConnectivityMonitor";class GE{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){pe(qE,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){pe(qE,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mf=null;function Aw(){return Mf===null?Mf=function(){return 268435456+Math.round(2147483648*Math.random())}():Mf++,"0x"+Mf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy="RestConnection",mH={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class gH{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=n+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===xm?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,n,r,i,s){const a=Aw(),o=this.Qo(e,n.toUriEncodedString());pe(Qy,`Sending RPC '${e}' ${a}:`,o,r);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,i,s);const{host:u}=new URL(o),c=Da(u);return this.zo(e,o,l,r,c).then(d=>(pe(Qy,`Received RPC '${e}' ${a}: `,d),d),d=>{throw zo(Qy,`RPC '${e}' ${a} failed with error: `,d,"url: ",o,"request:",r),d})}jo(e,n,r,i,s,a){return this.Wo(e,n,r,i,s)}Go(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ou}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Qo(e,n){const r=mH[e];let i=`${this.qo}/v1/${n}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mn="WebChannelConnection",vc=(t,e,n)=>{t.listen(e,r=>{try{n(r)}catch(i){setTimeout(()=>{throw i},0)}})};class nu extends gH{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!nu.c_){const e=HN();vc(e,WN.STAT_EVENT,n=>{n.stat===_w.PROXY?pe(mn,"STAT_EVENT: detected buffering proxy"):n.stat===_w.NOPROXY&&pe(mn,"STAT_EVENT: detected no buffering proxy")}),nu.c_=!0}}zo(e,n,r,i,s){const a=Aw();return new Promise((o,l)=>{const u=new UN;u.setWithCredentials(!0),u.listenOnce(jN.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Cp.NO_ERROR:const d=u.getResponseJson();pe(mn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(d)),o(d);break;case Cp.TIMEOUT:pe(mn,`RPC '${e}' ${a} timed out`),l(new fe(te.DEADLINE_EXCEEDED,"Request time out"));break;case Cp.HTTP_ERROR:const h=u.getStatus();if(pe(mn,`RPC '${e}' ${a} failed with status:`,h,"response text:",u.getResponseText()),h>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const g=m==null?void 0:m.error;if(g&&g.status&&g.message){const w=function(v){const y=v.toLowerCase().replace(/_/g,"-");return Object.values(te).indexOf(y)>=0?y:te.UNKNOWN}(g.status);l(new fe(w,g.message))}else l(new fe(te.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new fe(te.UNAVAILABLE,"Connection failed."));break;default:Te(9055,{l_:e,streamId:a,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{pe(mn,`RPC '${e}' ${a} completed.`)}});const c=JSON.stringify(i);pe(mn,`RPC '${e}' ${a} sending request:`,i),u.send(n,"POST",c,r,15)})}T_(e,n,r){const i=Aw(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Go(o.initMessageHeaders,n,r),o.encodeInitMessageHeaders=!0;const u=s.join("");pe(mn,`Creating RPC '${e}' stream ${i}: ${u}`,o);const c=a.createWebChannel(u,o);this.I_(c);let d=!1,h=!1;const m=new yH({Ho:g=>{h?pe(mn,`Not sending because RPC '${e}' stream ${i} is closed:`,g):(d||(pe(mn,`Opening RPC '${e}' stream ${i} transport.`),c.open(),d=!0),pe(mn,`RPC '${e}' stream ${i} sending:`,g),c.send(g))},Jo:()=>c.close()});return vc(c,Gc.EventType.OPEN,()=>{h||(pe(mn,`RPC '${e}' stream ${i} transport opened.`),m.i_())}),vc(c,Gc.EventType.CLOSE,()=>{h||(h=!0,pe(mn,`RPC '${e}' stream ${i} transport closed`),m.o_(),this.E_(c))}),vc(c,Gc.EventType.ERROR,g=>{h||(h=!0,zo(mn,`RPC '${e}' stream ${i} transport errored. Name:`,g.name,"Message:",g.message),m.o_(new fe(te.UNAVAILABLE,"The operation could not be completed")))}),vc(c,Gc.EventType.MESSAGE,g=>{var w;if(!h){const x=g.data[0];Qe(!!x,16349);const v=x,y=(v==null?void 0:v.error)||((w=v[0])==null?void 0:w.error);if(y){pe(mn,`RPC '${e}' stream ${i} received error:`,y);const E=y.status;let $=function(k){const _=Ft[k];if(_!==void 0)return $3(_)}(E),R=y.message;E==="NOT_FOUND"&&R.includes("database")&&R.includes("does not exist")&&R.includes(this.databaseId.database)&&zo(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),$===void 0&&($=te.INTERNAL,R="Unknown error status: "+E+" with message "+y.message),h=!0,m.o_(new fe($,R)),c.close()}else pe(mn,`RPC '${e}' stream ${i} received:`,x),m.__(x)}}),nu.u_(),setTimeout(()=>{m.s_()},0),m}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(n=>n===e)}Go(e,n,r){super.Go(e,n,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return qN()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _H(t){return new nu(t)}function Xy(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rg(t){return new x8(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nu.c_=!1;class j3{constructor(e,n,r=1e3,i=1.5,s=6e4){this.Ci=e,this.timerId=n,this.R_=r,this.A_=i,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const n=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,n-r);i>0&&pe("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KE="PersistentStream";class W3{constructor(e,n,r,i,s,a,o,l){this.Ci=e,this.b_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=o,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new j3(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===te.RESOURCE_EXHAUSTED?(ys(n.toString()),ys("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===te.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(n)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===n&&this.G_(r,i)},r=>{e(()=>{const i=new fe(te.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,n){const r=this.Q_(this.D_);this.stream=this.j_(e,n),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.H_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return pe(KE,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return n=>{this.Ci.enqueueAndForget(()=>this.D_===e?n():(pe(KE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class wH extends W3{constructor(e,n,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,a),this.serializer=s}j_(e,n){return this.connection.T_("Listen",e,n)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=S8(this.serializer,e),r=function(s){if(!("targetChange"in s))return Ie.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?Ie.min():a.readTime?Ni(a.readTime):Ie.min()}(e);return this.listener.J_(n,r)}Z_(e){const n={};n.database=$w(this.serializer),n.addTarget=function(s,a){let o;const l=a.target;if(o=Tw(l)?{documents:$8(s,l)}:{query:C8(s,l).ft},o.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){o.resumeToken=R3(s,a.resumeToken);const u=Sw(s,a.expectedCount);u!==null&&(o.expectedCount=u)}else if(a.snapshotVersion.compareTo(Ie.min())>0){o.readTime=$m(s,a.snapshotVersion.toTimestamp());const u=Sw(s,a.expectedCount);u!==null&&(o.expectedCount=u)}return o}(this.serializer,e);const r=R8(this.serializer,e);r&&(n.labels=r),this.K_(n)}X_(e){const n={};n.database=$w(this.serializer),n.removeTarget=e,this.K_(n)}}class vH extends W3{constructor(e,n,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,a),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}H_(e){return Qe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Qe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Qe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=k8(e.writeResults,e.commitTime),r=Ni(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=$w(this.serializer),this.K_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>I8(this.serializer,r))};this.K_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bH{}class xH extends bH{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new fe(te.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,Iw(n,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new fe(te.UNKNOWN,s.toString())})}jo(e,n,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.jo(e,Iw(n,r),i,a,o,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===te.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new fe(te.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function TH(t,e,n,r){return new xH(t,e,n,r)}class EH{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ys(n),this.aa=!1):pe("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vo="RemoteStore";class SH{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(a=>{r.enqueueAndForget(async()=>{Xo(this)&&(pe(Vo,"Restarting streams for network reachability change."),await async function(l){const u=$e(l);u.Ea.add(4),await kh(u),u.Va.set("Unknown"),u.Ea.delete(4),await Pg(u)}(this))})}),this.Va=new EH(r,i)}}async function Pg(t){if(Xo(t))for(const e of t.Ra)await e(!0)}async function kh(t){for(const e of t.Ra)await e(!1)}function H3(t,e){const n=$e(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),qb(n)?Hb(n):zu(n).O_()&&Wb(n,e))}function jb(t,e){const n=$e(t),r=zu(n);n.Ia.delete(e),r.O_()&&q3(n,e),n.Ia.size===0&&(r.O_()?r.L_():Xo(n)&&n.Va.set("Unknown"))}function Wb(t,e){if(t.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ie.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}zu(t).Z_(e)}function q3(t,e){t.da.$e(e),zu(t).X_(e)}function Hb(t){t.da=new _8({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),zu(t).start(),t.Va.ua()}function qb(t){return Xo(t)&&!zu(t).x_()&&t.Ia.size>0}function Xo(t){return $e(t).Ea.size===0}function G3(t){t.da=void 0}async function IH(t){t.Va.set("Online")}async function kH(t){t.Ia.forEach((e,n)=>{Wb(t,e)})}async function $H(t,e){G3(t),qb(t)?(t.Va.ha(e),Hb(t)):t.Va.set("Unknown")}async function CH(t,e,n){if(t.Va.set("Online"),e instanceof A3&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const o of s.targetIds)i.Ia.has(o)&&(await i.remoteSyncer.rejectListen(o,a),i.Ia.delete(o),i.da.removeTarget(o))}(t,e)}catch(r){pe(Vo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Am(t,r)}else if(e instanceof Np?t.da.Xe(e):e instanceof C3?t.da.st(e):t.da.tt(e),!n.isEqual(Ie.min()))try{const r=await U3(t.localStore);n.compareTo(r)>=0&&await function(s,a){const o=s.da.Tt(a);return o.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const c=s.Ia.get(u);c&&s.Ia.set(u,c.withResumeToken(l.resumeToken,a))}}),o.targetMismatches.forEach((l,u)=>{const c=s.Ia.get(l);if(!c)return;s.Ia.set(l,c.withResumeToken(dn.EMPTY_BYTE_STRING,c.snapshotVersion)),q3(s,l);const d=new ea(c.target,l,u,c.sequenceNumber);Wb(s,d)}),s.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(r){pe(Vo,"Failed to raise snapshot:",r),await Am(t,r)}}async function Am(t,e,n){if(!Mu(e))throw e;t.Ea.add(1),await kh(t),t.Va.set("Offline"),n||(n=()=>U3(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{pe(Vo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Pg(t)})}function K3(t,e){return e().catch(n=>Am(t,n,e))}async function Ng(t){const e=$e(t),n=ka(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ab;for(;AH(e);)try{const i=await cH(e.localStore,r);if(i===null){e.Ta.length===0&&n.L_();break}r=i.batchId,RH(e,i)}catch(i){await Am(e,i)}Y3(e)&&Q3(e)}function AH(t){return Xo(t)&&t.Ta.length<10}function RH(t,e){t.Ta.push(e);const n=ka(t);n.O_()&&n.Y_&&n.ea(e.mutations)}function Y3(t){return Xo(t)&&!ka(t).x_()&&t.Ta.length>0}function Q3(t){ka(t).start()}async function PH(t){ka(t).ra()}async function NH(t){const e=ka(t);for(const n of t.Ta)e.ea(n.mutations)}async function OH(t,e,n){const r=t.Ta.shift(),i=Mb.from(r,e,n);await K3(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Ng(t)}async function DH(t,e){e&&ka(t).Y_&&await async function(r,i){if(function(a){return m8(a)&&a!==te.ABORTED}(i.code)){const s=r.Ta.shift();ka(r).B_(),await K3(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await Ng(r)}}(t,e),Y3(t)&&Q3(t)}async function YE(t,e){const n=$e(t);n.asyncQueue.verifyOperationInProgress(),pe(Vo,"RemoteStore received new credentials");const r=Xo(n);n.Ea.add(3),await kh(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Pg(n)}async function MH(t,e){const n=$e(t);e?(n.Ea.delete(2),await Pg(n)):e||(n.Ea.add(2),await kh(n),n.Va.set("Unknown"))}function zu(t){return t.ma||(t.ma=function(n,r,i){const s=$e(n);return s.sa(),new wH(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Zo:IH.bind(null,t),Yo:kH.bind(null,t),t_:$H.bind(null,t),J_:CH.bind(null,t)}),t.Ra.push(async e=>{e?(t.ma.B_(),qb(t)?Hb(t):t.Va.set("Unknown")):(await t.ma.stop(),G3(t))})),t.ma}function ka(t){return t.fa||(t.fa=function(n,r,i){const s=$e(n);return s.sa(),new vH(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Zo:()=>Promise.resolve(),Yo:PH.bind(null,t),t_:DH.bind(null,t),ta:NH.bind(null,t),na:OH.bind(null,t)}),t.Ra.push(async e=>{e?(t.fa.B_(),await Ng(t)):(await t.fa.stop(),t.Ta.length>0&&(pe(Vo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ya,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const a=Date.now()+r,o=new Gb(e,n,a,i,s);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new fe(te.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kb(t,e){if(ys("AsyncQueue",`${e}: ${t}`),Mu(t))return new fe(te.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{static emptySet(e){return new ru(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||we.comparator(n.key,r.key):(n,r)=>we.comparator(n.key,r.key),this.keyedMap=Kc(),this.sortedSet=new St(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ru)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ru;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(){this.ga=new St(we.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Te(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class vu{constructor(e,n,r,i,s,a,o,l,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=o,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){const a=[];return n.forEach(o=>{a.push({type:0,doc:o})}),new vu(e,n,ru.emptySet(n),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ig(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LH{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class zH{constructor(){this.queries=XE(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=$e(n),s=i.queries;i.queries=XE(),s.forEach((a,o)=>{for(const l of o.ba)l.onError(r)})})(this,new fe(te.ABORTED,"Firestore shutting down"))}}function XE(){return new Yo(t=>m3(t),Ig)}async function VH(t,e){const n=$e(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.Sa()&&e.Da()&&(r=2):(s=new LH,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(a){const o=Kb(a,`Initialization of query '${kl(e.query)}' failed`);return void e.onError(o)}n.queries.set(i,s),s.ba.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&Yb(n)}async function FH(t,e){const n=$e(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const a=s.ba.indexOf(e);a>=0&&(s.ba.splice(a,1),s.ba.length===0?i=e.Da()?0:1:!s.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function BH(t,e){const n=$e(t);let r=!1;for(const i of e){const s=i.query,a=n.queries.get(s);if(a){for(const o of a.ba)o.Fa(i)&&(r=!0);a.wa=i}}r&&Yb(n)}function UH(t,e,n){const r=$e(t),i=r.queries.get(e);if(i)for(const s of i.ba)s.onError(n);r.queries.delete(e)}function Yb(t){t.Ca.forEach(e=>{e.next()})}var Rw,JE;(JE=Rw||(Rw={})).Ma="default",JE.Cache="cache";class jH{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new vu(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=vu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Rw.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X3{constructor(e){this.key=e}}class J3{constructor(e){this.key=e}}class WH{constructor(e,n){this.query=e,this.Za=n,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Ve(),this.mutatedKeys=Ve(),this.eu=g3(e),this.tu=new ru(this.eu)}get nu(){return this.Za}ru(e,n){const r=n?n.iu:new QE,i=n?n.tu:this.tu;let s=n?n.mutatedKeys:this.mutatedKeys,a=i,o=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((c,d)=>{const h=i.get(c),m=kg(this.query,d)?d:null,g=!!h&&this.mutatedKeys.has(h.key),w=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let x=!1;h&&m?h.data.isEqual(m.data)?g!==w&&(r.track({type:3,doc:m}),x=!0):this.su(h,m)||(r.track({type:2,doc:m}),x=!0,(l&&this.eu(m,l)>0||u&&this.eu(m,u)<0)&&(o=!0)):!h&&m?(r.track({type:0,doc:m}),x=!0):h&&!m&&(r.track({type:1,doc:h}),x=!0,(l||u)&&(o=!0)),x&&(m?(a=a.add(m),s=w?s.add(c):s.delete(c)):(a=a.delete(c),s=s.delete(c)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const c=this.query.limitType==="F"?a.last():a.first();a=a.delete(c.key),s=s.delete(c.key),r.track({type:1,doc:c})}return{tu:a,iu:r,Ss:o,mutatedKeys:s}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((c,d)=>function(m,g){const w=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Te(20277,{Vt:x})}};return w(m)-w(g)}(c.type,d.type)||this.eu(c.doc,d.doc)),this.ou(r),i=i??!1;const o=n&&!i?this._u():[],l=this.Ya.size===0&&this.current&&!i?1:0,u=l!==this.Xa;return this.Xa=l,a.length!==0||u?{snapshot:new vu(this.query,e.tu,s,a,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new QE,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Za=this.Za.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Za=this.Za.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});const n=[];return e.forEach(r=>{this.Ya.has(r)||n.push(new J3(r))}),this.Ya.forEach(r=>{e.has(r)||n.push(new X3(r))}),n}cu(e){this.Za=e.ks,this.Ya=Ve();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return vu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const Qb="SyncEngine";class HH{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class qH{constructor(e){this.key=e,this.hu=!1}}class GH{constructor(e,n,r,i,s,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Yo(o=>m3(o),Ig),this.Iu=new Map,this.Eu=new Set,this.Ru=new St(we.comparator),this.Au=new Map,this.Vu=new Vb,this.du={},this.mu=new Map,this.fu=wu.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function KH(t,e,n=!0){const r=iO(t);let i;const s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await Z3(r,e,n,!0),i}async function YH(t,e){const n=iO(t);await Z3(n,e,!0,!1)}async function Z3(t,e,n,r){const i=await dH(t.localStore,Ri(e)),s=i.targetId,a=t.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await QH(t,e,s,a==="current",i.resumeToken)),t.isPrimaryClient&&n&&H3(t.remoteStore,i),o}async function QH(t,e,n,r,i){t.pu=(d,h,m)=>async function(w,x,v,y){let E=x.view.ru(v);E.Ss&&(E=await WE(w.localStore,x.query,!1).then(({documents:k})=>x.view.ru(k,E)));const $=y&&y.targetChanges.get(x.targetId),R=y&&y.targetMismatches.get(x.targetId)!=null,D=x.view.applyChanges(E,w.isPrimaryClient,$,R);return eS(w,x.targetId,D.au),D.snapshot}(t,d,h,m);const s=await WE(t.localStore,e,!0),a=new WH(e,s.ks),o=a.ru(s.documents),l=Ih.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=a.applyChanges(o,t.isPrimaryClient,l);eS(t,n,u.au);const c=new HH(e,n,a);return t.Tu.set(e,c),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}async function XH(t,e,n){const r=$e(t),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter(a=>!Ig(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Cw(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&jb(r.remoteStore,i.targetId),Pw(r,i.targetId)}).catch(Du)):(Pw(r,i.targetId),await Cw(r.localStore,i.targetId,!0))}async function JH(t,e){const n=$e(t),r=n.Tu.get(e),i=n.Iu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),jb(n.remoteStore,r.targetId))}async function ZH(t,e,n){const r=aq(t);try{const i=await function(a,o){const l=$e(a),u=pt.now(),c=o.reduce((m,g)=>m.add(g.key),Ve());let d,h;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let g=_s(),w=Ve();return l.xs.getEntries(m,c).next(x=>{g=x,g.forEach((v,y)=>{y.isValidDocument()||(w=w.add(v))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,g)).next(x=>{d=x;const v=[];for(const y of o){const E=c8(y,d.get(y.key).overlayedDocument);E!=null&&v.push(new Qo(y.key,E,a3(E.value.mapValue),Pi.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,v,o)}).next(x=>{h=x;const v=x.applyToLocalDocumentSet(d,w);return l.documentOverlayCache.saveOverlays(m,x.batchId,v)})}).then(()=>({batchId:h.batchId,changes:_3(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,o,l){let u=a.du[a.currentUser.toKey()];u||(u=new St(ze)),u=u.insert(o,l),a.du[a.currentUser.toKey()]=u}(r,i.batchId,n),await $h(r,i.changes),await Ng(r.remoteStore)}catch(i){const s=Kb(i,"Failed to persist write");n.reject(s)}}async function eO(t,e){const n=$e(t);try{const r=await lH(n.localStore,e);e.targetChanges.forEach((i,s)=>{const a=n.Au.get(s);a&&(Qe(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Qe(a.hu,14607):i.removedDocuments.size>0&&(Qe(a.hu,42227),a.hu=!1))}),await $h(n,r,e)}catch(r){await Du(r)}}function ZE(t,e,n){const r=$e(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Tu.forEach((s,a)=>{const o=a.view.va(e);o.snapshot&&i.push(o.snapshot)}),function(a,o){const l=$e(a);l.onlineState=o;let u=!1;l.queries.forEach((c,d)=>{for(const h of d.ba)h.va(o)&&(u=!0)}),u&&Yb(l)}(r.eventManager,e),i.length&&r.Pu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function eq(t,e,n){const r=$e(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Au.get(e),s=i&&i.key;if(s){let a=new St(we.comparator);a=a.insert(s,wn.newNoDocument(s,Ie.min()));const o=Ve().add(s),l=new Ag(Ie.min(),new Map,new St(ze),a,o);await eO(r,l),r.Ru=r.Ru.remove(s),r.Au.delete(e),Xb(r)}else await Cw(r.localStore,e,!1).then(()=>Pw(r,e,n)).catch(Du)}async function tq(t,e){const n=$e(t),r=e.batch.batchId;try{const i=await oH(n.localStore,e);nO(n,r,null),tO(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await $h(n,i)}catch(i){await Du(i)}}async function nq(t,e,n){const r=$e(t);try{const i=await function(a,o){const l=$e(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return l.mutationQueue.lookupMutationBatch(u,o).next(d=>(Qe(d!==null,37113),c=d.keys(),l.mutationQueue.removeMutationBatch(u,d))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>l.localDocuments.getDocuments(u,c))})}(r.localStore,e);nO(r,e,n),tO(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await $h(r,i)}catch(i){await Du(i)}}function tO(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function nO(t,e,n){const r=$e(t);let i=r.du[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.du[r.currentUser.toKey()]=i}}function Pw(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Vu.Gr(e).forEach(r=>{t.Vu.containsKey(r)||rO(t,r)})}function rO(t,e){t.Eu.delete(e.path.canonicalString());const n=t.Ru.get(e);n!==null&&(jb(t.remoteStore,n),t.Ru=t.Ru.remove(e),t.Au.delete(n),Xb(t))}function eS(t,e,n){for(const r of n)r instanceof X3?(t.Vu.addReference(r.key,e),rq(t,r)):r instanceof J3?(pe(Qb,"Document no longer in limbo: "+r.key),t.Vu.removeReference(r.key,e),t.Vu.containsKey(r.key)||rO(t,r.key)):Te(19791,{wu:r})}function rq(t,e){const n=e.key,r=n.path.canonicalString();t.Ru.get(n)||t.Eu.has(r)||(pe(Qb,"New document in limbo: "+n),t.Eu.add(r),Xb(t))}function Xb(t){for(;t.Eu.size>0&&t.Ru.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new we(ut.fromString(e)),r=t.fu.next();t.Au.set(r,new qH(n)),t.Ru=t.Ru.insert(n,r),H3(t.remoteStore,new ea(Ri(f3(n.path)),r,"TargetPurposeLimboResolution",Tg.ce))}}async function $h(t,e,n){const r=$e(t),i=[],s=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((o,l)=>{a.push(r.pu(l,e,n).then(u=>{var c;if((u||n)&&r.isPrimaryClient){const d=u?!u.fromCache:(c=n==null?void 0:n.targetChanges.get(l.targetId))==null?void 0:c.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(u){i.push(u);const d=Bb.Es(l.targetId,u);s.push(d)}}))}),await Promise.all(a),r.Pu.J_(i),await async function(l,u){const c=$e(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>ne.forEach(u,h=>ne.forEach(h.Ts,m=>c.persistence.referenceDelegate.addReference(d,h.targetId,m)).next(()=>ne.forEach(h.Is,m=>c.persistence.referenceDelegate.removeReference(d,h.targetId,m)))))}catch(d){if(!Mu(d))throw d;pe(Ub,"Failed to update sequence numbers: "+d)}for(const d of u){const h=d.targetId;if(!d.fromCache){const m=c.vs.get(h),g=m.snapshotVersion,w=m.withLastLimboFreeSnapshotVersion(g);c.vs=c.vs.insert(h,w)}}}(r.localStore,s))}async function iq(t,e){const n=$e(t);if(!n.currentUser.isEqual(e)){pe(Qb,"User change. New user:",e.toKey());const r=await B3(n.localStore,e);n.currentUser=e,function(s,a){s.mu.forEach(o=>{o.forEach(l=>{l.reject(new fe(te.CANCELLED,a))})}),s.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await $h(n,r.Ns)}}function sq(t,e){const n=$e(t),r=n.Au.get(e);if(r&&r.hu)return Ve().add(r.key);{let i=Ve();const s=n.Iu.get(e);if(!s)return i;for(const a of s){const o=n.Tu.get(a);i=i.unionWith(o.view.nu)}return i}}function iO(t){const e=$e(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=eO.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sq.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=eq.bind(null,e),e.Pu.J_=BH.bind(null,e.eventManager),e.Pu.yu=UH.bind(null,e.eventManager),e}function aq(t){const e=$e(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tq.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nq.bind(null,e),e}class Rm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Rg(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return aH(this.persistence,new rH,e.initialUser,this.serializer)}Cu(e){return new F3(Fb.Vi,this.serializer)}Du(e){return new fH}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rm.provider={build:()=>new Rm};class oq extends Rm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Qe(this.persistence.referenceDelegate instanceof Cm,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new U8(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Bn.withCacheSize(this.cacheSizeBytes):Bn.DEFAULT;return new F3(r=>Cm.Vi(r,n),this.serializer)}}class Nw{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>ZE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=iq.bind(null,this.syncEngine),await MH(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new zH}()}createDatastore(e){const n=Rg(e.databaseInfo.databaseId),r=_H(e.databaseInfo);return TH(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,a,o){return new SH(r,i,s,a,o)}(this.localStore,this.datastore,e.asyncQueue,n=>ZE(this.syncEngine,n,0),function(){return GE.v()?new GE:new pH}())}createSyncEngine(e,n){return function(i,s,a,o,l,u,c){const d=new GH(i,s,a,o,l,u);return c&&(d.gu=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=$e(i);pe(Vo,"RemoteStore shutting down."),s.Ea.add(5),await kh(s),s.Aa.shutdown(),s.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Nw.provider={build:()=>new Nw};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lq{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ys("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a="FirestoreClient";class uq{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this._databaseInfo=i,this.user=yn.UNAUTHENTICATED,this.clientId=Cb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async a=>{pe($a,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(pe($a,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ya;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Kb(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Jy(t,e){t.asyncQueue.verifyOperationInProgress(),pe($a,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await B3(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function tS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await cq(t);pe($a,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>YE(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>YE(e.remoteStore,i)),t._onlineComponents=e}async function cq(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){pe($a,"Using user provided OfflineComponentProvider");try{await Jy(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===te.FAILED_PRECONDITION||i.code===te.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;zo("Error using user provided cache. Falling back to memory cache: "+n),await Jy(t,new Rm)}}else pe($a,"Using default OfflineComponentProvider"),await Jy(t,new oq(void 0));return t._offlineComponents}async function sO(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(pe($a,"Using user provided OnlineComponentProvider"),await tS(t,t._uninitializedComponentsProvider._online)):(pe($a,"Using default OnlineComponentProvider"),await tS(t,new Nw))),t._onlineComponents}function dq(t){return sO(t).then(e=>e.syncEngine)}async function hq(t){const e=await sO(t),n=e.eventManager;return n.onListen=KH.bind(null,e.syncEngine),n.onUnlisten=XH.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=YH.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=JH.bind(null,e.syncEngine),n}function fq(t,e,n={}){const r=new ya;return t.asyncQueue.enqueueAndForget(async()=>function(s,a,o,l,u){const c=new lq({next:h=>{c.Nu(),a.enqueueAndForget(()=>FH(s,d)),h.fromCache&&l.source==="server"?u.reject(new fe(te.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(h)},error:h=>u.reject(h)}),d=new jH(o,c,{includeMetadataChanges:!0,Ka:!0});return VH(s,d)}(await hq(t),t.asyncQueue,e,n,r)),r.promise}function pq(t,e){const n=new ya;return t.asyncQueue.enqueueAndForget(async()=>ZH(await dq(t),e,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aO(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mq="ComponentProvider",nS=new Map;function gq(t,e,n,r,i){return new PW(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,aO(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oO="firestore.googleapis.com",rS=!0;class iS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new fe(te.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oO,this.ssl=rS}else this.host=e.host,this.ssl=e.ssl??rS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=V3;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<F8)throw new fe(te.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vW("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aO(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new fe(te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new fe(te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new fe(te.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Og{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new fe(te.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new fe(te.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new cW;switch(r.type){case"firstParty":return new pW(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new fe(te.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=nS.get(n);r&&(pe(mq,"Removing Datastore"),nS.delete(n),r.terminate())}(this),Promise.resolve()}}function yq(t,e,n,r={}){var u;t=gu(t,Og);const i=Da(e),s=t._getSettings(),a={...s,emulatorOptions:t._getEmulatorOptions()},o=`${e}:${n}`;i&&(mb(`https://${o}`),gb("Firestore",!0)),s.host!==oO&&s.host!==o&&zo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:o,ssl:i,emulatorOptions:r};if(!Oo(l,a)&&(t._setSettings(l),r.mockUserToken)){let c,d;if(typeof r.mockUserToken=="string")c=r.mockUserToken,d=yn.MOCK_USER;else{c=eN(r.mockUserToken,(u=t._app)==null?void 0:u.options.projectId);const h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new fe(te.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new yn(h)}t._authCredentials=new dW(new KN(c,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Va(this.firestore,e,this._query)}}class Gt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _a(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gt(this.firestore,e,this._key)}toJSON(){return{type:Gt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Eh(n,Gt._jsonSchema))return new Gt(e,r||null,new we(ut.fromString(n.referencePath)))}}Gt._jsonSchemaVersion="firestore/documentReference/1.0",Gt._jsonSchema={type:jt("string",Gt._jsonSchemaVersion),referencePath:jt("string")};class _a extends Va{constructor(e,n,r){super(e,n,f3(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gt(this.firestore,null,new we(e))}withConverter(e){return new _a(this.firestore,e,this._path)}}function Vt(t,e,...n){if(t=Wt(t),YN("collection","path",e),t instanceof Og){const r=ut.fromString(e,...n);return yE(r),new _a(t,null,r)}{if(!(t instanceof Gt||t instanceof _a))throw new fe(te.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ut.fromString(e,...n));return yE(r),new _a(t.firestore,null,r)}}function Ow(t,e,...n){if(t=Wt(t),arguments.length===1&&(e=Cb.newId()),YN("doc","path",e),t instanceof Og){const r=ut.fromString(e,...n);return gE(r),new Gt(t,null,new we(r))}{if(!(t instanceof Gt||t instanceof _a))throw new fe(te.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ut.fromString(e,...n));return gE(r),new Gt(t.firestore,t instanceof _a?t.converter:null,new we(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sS="AsyncQueue";class aS{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new j3(this,"async_queue_retry"),this._c=()=>{const r=Xy();r&&pe(sS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Xy();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Xy();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new ya;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Mu(e))throw e;pe(sS,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,ys("INTERNAL UNHANDLED ERROR: ",oS(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const i=Gb.createAndSchedule(this,e,n,r,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&Te(47125,{Pc:oS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function oS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Dg extends Og{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new aS,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new aS(e),this._firestoreClient=void 0,await e}}}function _q(t,e){const n=typeof t=="object"?t:wb(),r=typeof t=="string"?t:xm,i=_g(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=XP("firestore");s&&yq(i,...s)}return i}function lO(t){if(t._terminated)throw new fe(te.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||wq(t),t._firestoreClient}function wq(t){var r,i,s,a;const e=t._freezeSettings(),n=gq(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,(i=t._app)==null?void 0:i.options.apiKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new uq(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const u=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gr(dn.fromBase64String(e))}catch(n){throw new fe(te.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new gr(dn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:gr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Eh(e,gr._jsonSchema))return gr.fromBase64String(e.bytes)}}gr._jsonSchemaVersion="firestore/bytes/1.0",gr._jsonSchema={type:jt("string",gr._jsonSchemaVersion),bytes:jt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uO{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new fe(te.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ln(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new fe(te.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new fe(te.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ze(this._lat,e._lat)||ze(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Oi._jsonSchemaVersion}}static fromJSON(e){if(Eh(e,Oi._jsonSchema))return new Oi(e.latitude,e.longitude)}}Oi._jsonSchemaVersion="firestore/geoPoint/1.0",Oi._jsonSchema={type:jt("string",Oi._jsonSchemaVersion),latitude:jt("number"),longitude:jt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Gr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Eh(e,Gr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Gr(e.vectorValues);throw new fe(te.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gr._jsonSchemaVersion="firestore/vectorValue/1.0",Gr._jsonSchema={type:jt("string",Gr._jsonSchemaVersion),vectorValues:jt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vq=/^__.*__$/;class bq{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Qo(e,this.data,this.fieldMask,n,this.fieldTransforms):new Sh(e,this.data,n,this.fieldTransforms)}}function dO(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Te(40011,{dataSource:t})}}class Jb{constructor(e,n,r,i,s,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new Jb({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var i;const n=(i=this.path)==null?void 0:i.child(e),r=this.contextWith({path:n,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Pm(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(dO(this.dataSource)&&vq.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class xq{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Rg(e)}createContext(e,n,r,i=!1){return new Jb({dataSource:e,methodName:n,targetDoc:r,path:ln.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zb(t){const e=t._freezeSettings(),n=Rg(t._databaseId);return new xq(t._databaseId,!!e.ignoreUndefinedProperties,n)}function hO(t,e,n,r,i,s={}){const a=t.createContext(s.merge||s.mergeFields?2:0,e,n,i);mO("Data must be an object, but it was:",a,r);const o=fO(r,a);let l,u;if(s.merge)l=new jr(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const c=[];for(const d of s.mergeFields){const h=Mg(e,d,n);if(!a.contains(h))throw new fe(te.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);Iq(c,h)||c.push(h)}l=new jr(c),u=a.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,u=a.fieldTransforms;return new bq(new mr(o),l,u)}function Tq(t,e,n,r=!1){return ex(n,t.createContext(r?4:3,e))}function ex(t,e){if(pO(t=Wt(t)))return mO("Unsupported field value:",e,t),fO(t,e);if(t instanceof cO)return function(r,i){if(!dO(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const o of r){let l=ex(o,i.childContextForArray(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=Wt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return i8(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=pt.fromDate(r);return{timestampValue:$m(i.serializer,s)}}if(r instanceof pt){const s=new pt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$m(i.serializer,s)}}if(r instanceof Oi)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof gr)return{bytesValue:R3(i.serializer,r._byteString)};if(r instanceof Gt){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:zb(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gr)return function(a,o){const l=a instanceof Gr?a.toArray():a;return{mapValue:{fields:{[i3]:{stringValue:s3},[Tm]:{arrayValue:{values:l.map(c=>{if(typeof c!="number")throw o.createError("VectorValues must only contain numeric values.");return Db(o.serializer,c)})}}}}}}(r,i);if(z3(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${xg(r)}`)}(t,e)}function fO(t,e){const n={};return JN(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ko(t,(r,i)=>{const s=ex(i,e.childContextForField(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function pO(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof pt||t instanceof Oi||t instanceof gr||t instanceof Gt||t instanceof cO||t instanceof Gr||z3(t))}function mO(t,e,n){if(!pO(n)||!QN(n)){const r=xg(n);throw r==="an object"?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Mg(t,e,n){if((e=Wt(e))instanceof uO)return e._internalPath;if(typeof e=="string")return Sq(t,e);throw Pm("Field path arguments must be of type string or ",t,!1,void 0,n)}const Eq=new RegExp("[~\\*/\\[\\]]");function Sq(t,e,n){if(e.search(Eq)>=0)throw Pm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new uO(...e.split("."))._internalPath}catch{throw Pm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Pm(t,e,n,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let o=`Function ${e}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new fe(te.INVALID_ARGUMENT,o+t+l)}function Iq(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kq{convertValue(e,n="none"){switch(Ia(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ot(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Sa(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Te(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ko(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var r,i,s;const n=(s=(i=(r=e.fields)==null?void 0:r[Tm].arrayValue)==null?void 0:i.values)==null?void 0:s.map(a=>Ot(a.doubleValue));return new Gr(n)}convertGeoPoint(e){return new Oi(Ot(e.latitude),Ot(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Sg(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Jd(e));default:return null}}convertTimestamp(e){const n=Ea(e);return new pt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ut.fromString(e);Qe(L3(r),9688,{name:e});const i=new Zd(r.get(1),r.get(3)),s=new we(r.popFirst(5));return i.isEqual(n)||ys(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $q extends kq{constructor(e){super(),this.firestore=e}convertBytes(e){return new gr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Gt(this.firestore,null,n)}}const lS="@firebase/firestore",uS="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Gt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Cq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const n=this._document.data.field(Mg("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Cq extends gO{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aq(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new fe(te.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tx{}class nx extends tx{}function Fi(t,e,...n){let r=[];e instanceof tx&&r.push(e),r=r.concat(n),function(s){const a=s.filter(l=>l instanceof ix).length,o=s.filter(l=>l instanceof rx).length;if(a>1||a>0&&o>0)throw new fe(te.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class rx extends nx{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new rx(e,n,r)}_apply(e){const n=this._parse(e);return yO(e._query,n),new Va(e.firestore,e.converter,Ew(e._query,n))}_parse(e){const n=Zb(e.firestore);return function(s,a,o,l,u,c,d){let h;if(u.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new fe(te.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if(c==="in"||c==="not-in"){dS(d,c);const g=[];for(const w of d)g.push(cS(l,s,w));h={arrayValue:{values:g}}}else h=cS(l,s,d)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||dS(d,c),h=Tq(o,a,d,c==="in"||c==="not-in");return Ut.create(u,c,h)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}class ix extends tx{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new ix(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Jr.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let a=i;const o=s.getFlattenedFilters();for(const l of o)yO(a,l),a=Ew(a,l)}(e._query,n),new Va(e.firestore,e.converter,Ew(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class sx extends nx{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new sx(e,n)}_apply(e){const n=function(i,s,a){if(i.startAt!==null)throw new fe(te.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new fe(te.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new th(s,a)}(e._query,this._field,this._direction);return new Va(e.firestore,e.converter,QW(e._query,n))}}function Bi(t,e="asc"){const n=e,r=Mg("orderBy",t);return sx._create(r,n)}class ax extends nx{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new ax(e,n,r)}_apply(e){return new Va(e.firestore,e.converter,Sm(e._query,this._limit,this._limitType))}}function Vu(t){return bW("limit",t),ax._create("limit",t,"F")}function cS(t,e,n){if(typeof(n=Wt(n))=="string"){if(n==="")throw new fe(te.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!p3(e)&&n.indexOf("/")!==-1)throw new fe(te.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ut.fromString(n));if(!we.isDocumentKey(r))throw new fe(te.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return SE(t,new we(r))}if(n instanceof Gt)return SE(t,n._key);throw new fe(te.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xg(n)}.`)}function dS(t,e){if(!Array.isArray(t)||t.length===0)throw new fe(te.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function yO(t,e){const n=function(i,s){for(const a of i)for(const o of a.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new fe(te.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new fe(te.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function _O(t,e,n){let r;return r=t?t.toFirestore(e):e,r}class Lf{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class iu extends gO{constructor(e,n,r,i,s,a){super(e,n,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Op(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Mg("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new fe(te.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=iu._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}iu._jsonSchemaVersion="firestore/documentSnapshot/1.0",iu._jsonSchema={type:jt("string",iu._jsonSchemaVersion),bundleSource:jt("string","DocumentSnapshot"),bundleName:jt("string"),bundle:jt("string")};class Op extends iu{data(e={}){return super.data(e)}}class su{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Lf(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Op(this._firestore,this._userDataWriter,r.key,r,new Lf(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new fe(te.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(o=>{const l=new Op(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Lf(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const l=new Op(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Lf(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,c=-1;return o.type!==0&&(u=a.indexOf(o.doc.key),a=a.delete(o.doc.key)),o.type!==1&&(a=a.add(o.doc),c=a.indexOf(o.doc.key)),{type:Rq(o.type),doc:l,oldIndex:u,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new fe(te.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=su._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Cb.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(n.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Rq(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Te(61501,{type:t})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */su._jsonSchemaVersion="firestore/querySnapshot/1.0",su._jsonSchema={type:jt("string",su._jsonSchemaVersion),bundleSource:jt("string","QuerySnapshot"),bundleName:jt("string"),bundle:jt("string")};function Zr(t){t=gu(t,Va);const e=gu(t.firestore,Dg),n=lO(e),r=new $q(e);return Aq(t._query),fq(n,t._query).then(i=>new su(e,r,t,i))}function hS(t,e,n){t=gu(t,Gt);const r=gu(t.firestore,Dg),i=_O(t.converter,e),s=Zb(r);return wO(r,[hO(s,"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,Pi.none())])}function Mi(t,e){const n=gu(t.firestore,Dg),r=Ow(t),i=_O(t.converter,e),s=Zb(t.firestore);return wO(n,[hO(s,"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,Pi.exists(!1))]).then(()=>r)}function wO(t,e){const n=lO(t);return pq(n,e)}(function(e,n=!0){uW(Go),Do(new xa("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),o=new Dg(new hW(r.getProvider("auth-internal")),new mW(a,r.getProvider("app-check-internal")),NW(a,i),a);return s={useFetchStreams:n,...s},o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),ki(lS,uS,e),ki(lS,uS,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vO="firebasestorage.googleapis.com",bO="storageBucket",Pq=2*60*1e3,Nq=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt extends Vi{constructor(e,n,r=0){super(Zy(e),`Firebase Storage: ${n} (${Zy(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Pt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Zy(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ct;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ct||(Ct={}));function Zy(t){return"storage/"+t}function ox(){const t="An unknown error occurred, please check the error payload for server response.";return new Pt(Ct.UNKNOWN,t)}function Oq(t){return new Pt(Ct.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function Dq(t){return new Pt(Ct.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Mq(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Pt(Ct.UNAUTHENTICATED,t)}function Lq(){return new Pt(Ct.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function zq(t){return new Pt(Ct.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function Vq(){return new Pt(Ct.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Fq(){return new Pt(Ct.CANCELED,"User canceled the upload/download.")}function Bq(t){return new Pt(Ct.INVALID_URL,"Invalid URL '"+t+"'.")}function Uq(t){return new Pt(Ct.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function jq(){return new Pt(Ct.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+bO+"' property when initializing the app?")}function Wq(){return new Pt(Ct.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Hq(){return new Pt(Ct.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function qq(t){return new Pt(Ct.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Dw(t){return new Pt(Ct.INVALID_ARGUMENT,t)}function xO(){return new Pt(Ct.APP_DELETED,"The Firebase app was deleted.")}function Gq(t){return new Pt(Ct.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _d(t,e){return new Pt(Ct.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function bc(t){throw new Pt(Ct.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Nn.makeFromUrl(e,n)}catch{return new Nn(e,"")}if(r.path==="")return r;throw Uq(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s($){$.path.charAt($.path.length-1)==="/"&&($.path_=$.path_.slice(0,-1))}const a="(/(.*))?$",o=new RegExp("^gs://"+i+a,"i"),l={bucket:1,path:3};function u($){$.path_=decodeURIComponent($.path)}const c="v[A-Za-z0-9_]+",d=n.replace(/[.]/g,"\\."),h="(/([^?#]*).*)?$",m=new RegExp(`^https?://${d}/${c}/b/${i}/o${h}`,"i"),g={bucket:1,path:3},w=n===vO?"(?:storage.googleapis.com|storage.cloud.google.com)":n,x="([^?#]*)",v=new RegExp(`^https?://${w}/${i}/${x}`,"i"),E=[{regex:o,indices:l,postModify:s},{regex:m,indices:g,postModify:u},{regex:v,indices:{bucket:1,path:2},postModify:u}];for(let $=0;$<E.length;$++){const R=E[$],D=R.regex.exec(e);if(D){const k=D[R.indices.bucket];let _=D[R.indices.path];_||(_=""),r=new Nn(k,_),R.postModify(r);break}}if(r==null)throw Bq(e);return r}}class Kq{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yq(t,e,n){let r=1,i=null,s=null,a=!1,o=0;function l(){return o===2}let u=!1;function c(...x){u||(u=!0,e.apply(null,x))}function d(x){i=setTimeout(()=>{i=null,t(m,l())},x)}function h(){s&&clearTimeout(s)}function m(x,...v){if(u){h();return}if(x){h(),c.call(null,x,...v);return}if(l()||a){h(),c.call(null,x,...v);return}r<64&&(r*=2);let E;o===1?(o=2,E=0):E=(r+Math.random())*1e3,d(E)}let g=!1;function w(x){g||(g=!0,h(),!u&&(i!==null?(x||(o=2),clearTimeout(i),d(0)):x||(o=1)))}return d(0),s=setTimeout(()=>{a=!0,w(!0)},n),w}function Qq(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xq(t){return t!==void 0}function Jq(t){return typeof t=="object"&&!Array.isArray(t)}function lx(t){return typeof t=="string"||t instanceof String}function fS(t){return ux()&&t instanceof Blob}function ux(){return typeof Blob<"u"}function Mw(t,e,n,r){if(r<e)throw Dw(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Dw(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lg(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function TO(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var So;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(So||(So={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zq(t,e){const n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,s=e.indexOf(t)!==-1;return n||i||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e7{constructor(e,n,r,i,s,a,o,l,u,c,d,h=!0,m=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=a,this.callback_=o,this.errorCallback_=l,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=d,this.retry=h,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((g,w)=>{this.resolve_=g,this.reject_=w,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new zf(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const a=o=>{const l=o.loaded,u=o.lengthComputable?o.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,u)};this.progressCallback_!==null&&s.addUploadProgressListener(a),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(a),this.pendingConnection_=null;const o=s.getErrorCode()===So.NO_ERROR,l=s.getStatus();if(!o||Zq(l,this.additionalRetryCodes_)&&this.retry){const c=s.getErrorCode()===So.ABORT;r(!1,new zf(!1,null,c));return}const u=this.successCodes_.indexOf(l)!==-1;r(!0,new zf(u,s))})},n=(r,i)=>{const s=this.resolve_,a=this.reject_,o=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(o,o.getResponse());Xq(l)?s(l):s()}catch(l){a(l)}else if(o!==null){const l=ox();l.serverResponse=o.getErrorText(),this.errorCallback_?a(this.errorCallback_(o,l)):a(l)}else if(i.canceled){const l=this.appDelete_?xO():Fq();a(l)}else{const l=Vq();a(l)}};this.canceled_?n(!1,new zf(!1,null,!0)):this.backoffId_=Yq(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Qq(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class zf{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function t7(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function n7(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function r7(t,e){e&&(t["X-Firebase-GMPID"]=e)}function i7(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function s7(t,e,n,r,i,s,a=!0,o=!1){const l=TO(t.urlParams),u=t.url+l,c=Object.assign({},t.headers);return r7(c,e),t7(c,n),n7(c,s),i7(c,r),new e7(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,a,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a7(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function o7(...t){const e=a7();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(ux())return new Blob(t);throw new Pt(Ct.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function l7(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u7(t){if(typeof atob>"u")throw qq("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ei={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class e_{constructor(e,n){this.data=e,this.contentType=n||null}}function c7(t,e){switch(t){case Ei.RAW:return new e_(EO(e));case Ei.BASE64:case Ei.BASE64URL:return new e_(SO(t,e));case Ei.DATA_URL:return new e_(h7(e),f7(e))}throw ox()}function EO(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const s=r,a=t.charCodeAt(++n);r=65536|(s&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function d7(t){let e;try{e=decodeURIComponent(t)}catch{throw _d(Ei.DATA_URL,"Malformed data URL.")}return EO(e)}function SO(t,e){switch(t){case Ei.BASE64:{const i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw _d(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case Ei.BASE64URL:{const i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw _d(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=u7(e)}catch(i){throw i.message.includes("polyfill")?i:_d(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class IO{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw _d(Ei.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=p7(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function h7(t){const e=new IO(t);return e.base64?SO(Ei.BASE64,e.rest):d7(e.rest)}function f7(t){return new IO(t).contentType}function p7(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e,n){let r=0,i="";fS(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(fS(this.data_)){const r=this.data_,i=l7(r,e,n);return i===null?null:new Qs(i)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Qs(r,!0)}}static getBlob(...e){if(ux()){const n=e.map(r=>r instanceof Qs?r.data_:r);return new Qs(o7.apply(null,n))}else{const n=e.map(a=>lx(a)?c7(Ei.RAW,a).data:a.data_);let r=0;n.forEach(a=>{r+=a.byteLength});const i=new Uint8Array(r);let s=0;return n.forEach(a=>{for(let o=0;o<a.length;o++)i[s++]=a[o]}),new Qs(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cx(t){let e;try{e=JSON.parse(t)}catch{return null}return Jq(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m7(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function g7(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function kO(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y7(t,e){return e}class An{constructor(e,n,r,i){this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||y7}}let Vf=null;function _7(t){return!lx(t)||t.length<2?t:kO(t)}function $O(){if(Vf)return Vf;const t=[];t.push(new An("bucket")),t.push(new An("generation")),t.push(new An("metageneration")),t.push(new An("name","fullPath",!0));function e(s,a){return _7(a)}const n=new An("name");n.xform=e,t.push(n);function r(s,a){return a!==void 0?Number(a):a}const i=new An("size");return i.xform=r,t.push(i),t.push(new An("timeCreated")),t.push(new An("updated")),t.push(new An("md5Hash",null,!0)),t.push(new An("cacheControl",null,!0)),t.push(new An("contentDisposition",null,!0)),t.push(new An("contentEncoding",null,!0)),t.push(new An("contentLanguage",null,!0)),t.push(new An("contentType",null,!0)),t.push(new An("metadata","customMetadata",!0)),Vf=t,Vf}function w7(t,e){function n(){const r=t.bucket,i=t.fullPath,s=new Nn(r,i);return e._makeStorageReference(s)}Object.defineProperty(t,"ref",{get:n})}function v7(t,e,n){const r={};r.type="file";const i=n.length;for(let s=0;s<i;s++){const a=n[s];r[a.local]=a.xform(r,e[a.server])}return w7(r,t),r}function CO(t,e,n){const r=cx(e);return r===null?null:v7(t,r,n)}function b7(t,e,n,r){const i=cx(e);if(i===null||!lx(i.downloadTokens))return null;const s=i.downloadTokens;if(s.length===0)return null;const a=encodeURIComponent;return s.split(",").map(u=>{const c=t.bucket,d=t.fullPath,h="/b/"+a(c)+"/o/"+a(d),m=Lg(h,n,r),g=TO({alt:"media",token:u});return m+g})[0]}function x7(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(n[s.server]=t[s.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pS="prefixes",mS="items";function T7(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[pS])for(const i of n[pS]){const s=i.replace(/\/$/,""),a=t._makeStorageReference(new Nn(e,s));r.prefixes.push(a)}if(n[mS])for(const i of n[mS]){const s=t._makeStorageReference(new Nn(e,i.name));r.items.push(s)}return r}function E7(t,e,n){const r=cx(n);return r===null?null:T7(t,e,r)}class dx{constructor(e,n,r,i){this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hx(t){if(!t)throw ox()}function S7(t,e){function n(r,i){const s=CO(t,i,e);return hx(s!==null),s}return n}function I7(t,e){function n(r,i){const s=E7(t,e,i);return hx(s!==null),s}return n}function k7(t,e){function n(r,i){const s=CO(t,i,e);return hx(s!==null),b7(s,i,t.host,t._protocol)}return n}function fx(t){function e(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=Lq():i=Mq():n.getStatus()===402?i=Dq(t.bucket):n.getStatus()===403?i=zq(t.path):i=r,i.status=n.getStatus(),i.serverResponse=r.serverResponse,i}return e}function $7(t){const e=fx(t);function n(r,i){let s=e(r,i);return r.getStatus()===404&&(s=Oq(t.path)),s.serverResponse=i.serverResponse,s}return n}function C7(t,e,n,r,i){const s={};e.isRoot?s.prefix="":s.prefix=e.path+"/",n.length>0&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);const a=e.bucketOnlyServerUrl(),o=Lg(a,t.host,t._protocol),l="GET",u=t.maxOperationRetryTime,c=new dx(o,l,I7(t,e.bucket),u);return c.urlParams=s,c.errorHandler=fx(e),c}function A7(t,e,n){const r=e.fullServerUrl(),i=Lg(r,t.host,t._protocol),s="GET",a=t.maxOperationRetryTime,o=new dx(i,s,k7(t,n),a);return o.errorHandler=$7(e),o}function R7(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function P7(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=R7(null,e)),r}function N7(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function o(){let E="";for(let $=0;$<2;$++)E=E+Math.random().toString().slice(2);return E}const l=o();a["Content-Type"]="multipart/related; boundary="+l;const u=P7(e,r,i),c=x7(u,n),d="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+c+`\r
--`+l+`\r
Content-Type: `+u.contentType+`\r
\r
`,h=`\r
--`+l+"--",m=Qs.getBlob(d,r,h);if(m===null)throw Wq();const g={name:u.fullPath},w=Lg(s,t.host,t._protocol),x="POST",v=t.maxUploadRetryTime,y=new dx(w,x,S7(t,n),v);return y.urlParams=g,y.headers=a,y.body=m.uploadData(),y.errorHandler=fx(e),y}class O7{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=So.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=So.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=So.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,i,s){if(this.sent_)throw bc("cannot .send() more than once");if(Da(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),s!==void 0)for(const a in s)s.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,s[a].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw bc("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw bc("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw bc("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw bc("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class D7 extends O7{initXhr(){this.xhr_.responseType="text"}}function px(){return new D7}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,n){this._service=e,n instanceof Nn?this._location=n:this._location=Nn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Fo(e,n)}get root(){const e=new Nn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return kO(this._location.path)}get storage(){return this._service}get parent(){const e=m7(this._location.path);if(e===null)return null;const n=new Nn(this._location.bucket,e);return new Fo(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw Gq(e)}}function M7(t,e,n){t._throwIfRoot("uploadBytes");const r=N7(t.storage,t._location,$O(),new Qs(e,!0),n);return t.storage.makeRequestWithTokens(r,px).then(i=>({metadata:i,ref:t}))}function L7(t){const e={prefixes:[],items:[]};return AO(t,e).then(()=>e)}async function AO(t,e,n){const i=await z7(t,{pageToken:n});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&await AO(t,e,i.nextPageToken)}function z7(t,e){e!=null&&typeof e.maxResults=="number"&&Mw("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=C7(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,px)}function V7(t){t._throwIfRoot("getDownloadURL");const e=A7(t.storage,t._location,$O());return t.storage.makeRequestWithTokens(e,px).then(n=>{if(n===null)throw Hq();return n})}function F7(t,e){const n=g7(t._location.path,e),r=new Nn(t._location.bucket,n);return new Fo(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B7(t){return/^[A-Za-z]+:\/\//.test(t)}function U7(t,e){return new Fo(t,e)}function RO(t,e){if(t instanceof mx){const n=t;if(n._bucket==null)throw jq();const r=new Fo(n,n._bucket);return e!=null?RO(r,e):r}else return e!==void 0?F7(t,e):t}function j7(t,e){if(e&&B7(e)){if(t instanceof mx)return U7(t,e);throw Dw("To use ref(service, url), the first argument must be a Storage instance.")}else return RO(t,e)}function gS(t,e){const n=e==null?void 0:e[bO];return n==null?null:Nn.makeFromBucketSpec(n,t)}function W7(t,e,n,r={}){t.host=`${e}:${n}`;const i=Da(e);i&&(mb(`https://${t.host}/b`),gb("Storage",!0)),t._isUsingEmulator=!0,t._protocol=i?"https":"http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:eN(s,t.app.options.projectId))}class mx{constructor(e,n,r,i,s,a=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=a,this._bucket=null,this._host=vO,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Pq,this._maxUploadRetryTime=Nq,this._requests=new Set,i!=null?this._bucket=Nn.makeFromBucketSpec(i,this._host):this._bucket=gS(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Nn.makeFromBucketSpec(this._url,e):this._bucket=gS(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Mw("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Mw("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(jn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Fo(this,e)}_makeRequest(e,n,r,i,s=!0){if(this._deleted)return new Kq(xO());{const a=s7(e,this._appId,r,i,n,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const yS="@firebase/storage",_S="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO="storage";function H7(t,e,n){return t=Wt(t),M7(t,e,n)}function q7(t){return t=Wt(t),L7(t)}function NO(t){return t=Wt(t),V7(t)}function OO(t,e){return t=Wt(t),j7(t,e)}function G7(t=wb(),e){t=Wt(t);const r=_g(t,PO).getImmediate({identifier:e}),i=XP("storage");return i&&K7(r,...i),r}function K7(t,e,n,r={}){W7(t,e,n,r)}function Y7(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new mx(n,r,i,e,Go)}function Q7(){Do(new xa(PO,Y7,"PUBLIC").setMultipleInstances(!0)),ki(yS,_S,""),ki(yS,_S,"esm2020")}Q7();const X7={apiKey:"AIzaSyDskYJol705ucTtdbE3zZIBpgJRVsqt_aY",authDomain:"water-velocity-project.firebaseapp.com",projectId:"water-velocity-project",storageBucket:"water-velocity-project.firebasestorage.app",messagingSenderId:"478499917558",appId:"1:478499917558:web:5d941d13e4ca875f2126d7",measurementId:"G-LLSY5LFLE0"},gx=WT().length?WT()[0]:rN(X7),Al=sW(gx),bt=_q(gx),DO=G7(gx),MO=j.createContext(void 0),J7=({children:t})=>{const[e,n]=j.useState(null),[r,i]=j.useState(!0);j.useEffect(()=>{const u=G5(Al,async c=>{if(!c){try{await V5(Al)}catch(h){console.error("Anonymous sign-in failed",h),n(null),i(!1)}return}const d={uid:c.uid,email:c.email||"guest",role:"user",token:await c.getIdToken()};n(d),i(!1)});return()=>u()},[]);const s=async(u,c)=>{const d=await W5(Al,u,c),h={uid:d.user.uid,email:d.user.email||u,role:"user",token:await d.user.getIdToken()};n(h)},a=async(u,c,d)=>{const h=await j5(Al,u,c),m={uid:h.user.uid,email:h.user.email||u,role:d,token:await h.user.getIdToken()};n(m)},o=()=>{K5(Al).catch(()=>{}),n(null)},l=j.useMemo(()=>({user:e,loading:r,login:s,register:a,logout:o}),[e,r]);return P.jsx(MO.Provider,{value:l,children:t})},yx=()=>{const t=j.useContext(MO);if(!t)throw new Error("useAuth must be used within AuthProvider");return t},Z7=[{to:"/",label:"Overview"},{to:"/live",label:"Live Feed"},{to:"/velocity",label:"Velocity Analytics"},{to:"/alerts",label:"Alerts"},{to:"/notifications",label:"Notifications"},{to:"/sites",label:"Sites & Health"},{to:"/datasets",label:"Datasets"},{to:"/model",label:"Model"}],eG=()=>{const{logout:t,user:e}=yx();return P.jsxs("aside",{className:"w-64 h-screen sticky top-0 flex flex-col border-r-4 border-slate-900 bg-white shadow-[6px_6px_0_#0f172a]",children:[P.jsxs("div",{className:"p-6 border-b-4 border-slate-900",children:[P.jsx("h1",{className:"text-xl font-bold text-slate-900 uppercase tracking-tight",children:"Water Velocity"}),P.jsx("p",{className:"text-xs text-slate-600",children:"Vision Flood Monitor"})]}),P.jsx("nav",{className:"flex-1 p-4 space-y-2",children:Z7.map(n=>P.jsx(o6,{to:n.to,className:({isActive:r})=>`block px-3 py-2 rounded-md text-sm font-semibold border-2 border-slate-900 transition-all ${r?"bg-sky-200 text-slate-900 shadow-[4px_4px_0_#0f172a] translate-x-1":"bg-white text-slate-800 hover:-translate-y-0.5 hover:shadow-[4px_4px_0_#0f172a]"}`,children:n.label},n.to))}),P.jsxs("div",{className:"p-4 border-t-4 border-slate-900 text-sm text-slate-700 bg-slate-50",children:[P.jsx("p",{className:"mb-2 font-semibold",children:(e==null?void 0:e.email)||"guest@anon"}),P.jsx("button",{onClick:t,className:"w-full rounded-md border-2 border-slate-900 px-3 py-2 text-sm font-semibold hover:shadow-[3px_3px_0_#0f172a]",children:"Sign out"})]})]})},tG=()=>{const{user:t,loading:e}=yx();return e?P.jsx("div",{className:"h-screen flex items-center justify-center text-slate-600",children:"Loading..."}):t?P.jsxs("div",{className:"flex min-h-screen bg-transparent",children:[P.jsx(eG,{}),P.jsx("main",{className:"flex-1 p-8 overflow-y-auto",children:P.jsx(GU,{})})]}):P.jsx(qU,{to:"/auth",replace:!0})},nG={default:"bg-slate-100 text-slate-800",success:"bg-emerald-100 text-emerald-800",danger:"bg-rose-100 text-rose-800",warning:"bg-amber-100 text-amber-800"},xl=({title:t,value:e,hint:n,tone:r="default"})=>P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("div",{className:"text-sm text-slate-500 mb-1",children:t}),P.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:e}),n&&P.jsx("div",{className:`mt-2 inline-flex px-2 py-1 rounded-md text-xs ${nG[r]}`,children:n})]});/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Ch(t){return t+.5|0}const ta=(t,e,n)=>Math.max(Math.min(t,n),e);function Qc(t){return ta(Ch(t*2.55),0,255)}function wa(t){return ta(Ch(t*255),0,255)}function rs(t){return ta(Ch(t/2.55)/100,0,1)}function wS(t){return ta(Ch(t*100),0,100)}const hr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Lw=[..."0123456789ABCDEF"],rG=t=>Lw[t&15],iG=t=>Lw[(t&240)>>4]+Lw[t&15],Ff=t=>(t&240)>>4===(t&15),sG=t=>Ff(t.r)&&Ff(t.g)&&Ff(t.b)&&Ff(t.a);function aG(t){var e=t.length,n;return t[0]==="#"&&(e===4||e===5?n={r:255&hr[t[1]]*17,g:255&hr[t[2]]*17,b:255&hr[t[3]]*17,a:e===5?hr[t[4]]*17:255}:(e===7||e===9)&&(n={r:hr[t[1]]<<4|hr[t[2]],g:hr[t[3]]<<4|hr[t[4]],b:hr[t[5]]<<4|hr[t[6]],a:e===9?hr[t[7]]<<4|hr[t[8]]:255})),n}const oG=(t,e)=>t<255?e(t):"";function lG(t){var e=sG(t)?rG:iG;return t?"#"+e(t.r)+e(t.g)+e(t.b)+oG(t.a,e):void 0}const uG=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function LO(t,e,n){const r=e*Math.min(n,1-n),i=(s,a=(s+t/30)%12)=>n-r*Math.max(Math.min(a-3,9-a,1),-1);return[i(0),i(8),i(4)]}function cG(t,e,n){const r=(i,s=(i+t/60)%6)=>n-n*e*Math.max(Math.min(s,4-s,1),0);return[r(5),r(3),r(1)]}function dG(t,e,n){const r=LO(t,1,.5);let i;for(e+n>1&&(i=1/(e+n),e*=i,n*=i),i=0;i<3;i++)r[i]*=1-e-n,r[i]+=e;return r}function hG(t,e,n,r,i){return t===i?(e-n)/r+(e<n?6:0):e===i?(n-t)/r+2:(t-e)/r+4}function _x(t){const n=t.r/255,r=t.g/255,i=t.b/255,s=Math.max(n,r,i),a=Math.min(n,r,i),o=(s+a)/2;let l,u,c;return s!==a&&(c=s-a,u=o>.5?c/(2-s-a):c/(s+a),l=hG(n,r,i,c,s),l=l*60+.5),[l|0,u||0,o]}function wx(t,e,n,r){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,n,r)).map(wa)}function vx(t,e,n){return wx(LO,t,e,n)}function fG(t,e,n){return wx(dG,t,e,n)}function pG(t,e,n){return wx(cG,t,e,n)}function zO(t){return(t%360+360)%360}function mG(t){const e=uG.exec(t);let n=255,r;if(!e)return;e[5]!==r&&(n=e[6]?Qc(+e[5]):wa(+e[5]));const i=zO(+e[2]),s=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?r=fG(i,s,a):e[1]==="hsv"?r=pG(i,s,a):r=vx(i,s,a),{r:r[0],g:r[1],b:r[2],a:n}}function gG(t,e){var n=_x(t);n[0]=zO(n[0]+e),n=vx(n),t.r=n[0],t.g=n[1],t.b=n[2]}function yG(t){if(!t)return;const e=_x(t),n=e[0],r=wS(e[1]),i=wS(e[2]);return t.a<255?`hsla(${n}, ${r}%, ${i}%, ${rs(t.a)})`:`hsl(${n}, ${r}%, ${i}%)`}const vS={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},bS={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function _G(){const t={},e=Object.keys(bS),n=Object.keys(vS);let r,i,s,a,o;for(r=0;r<e.length;r++){for(a=o=e[r],i=0;i<n.length;i++)s=n[i],o=o.replace(s,vS[s]);s=parseInt(bS[a],16),t[o]=[s>>16&255,s>>8&255,s&255]}return t}let Bf;function wG(t){Bf||(Bf=_G(),Bf.transparent=[0,0,0,0]);const e=Bf[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const vG=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function bG(t){const e=vG.exec(t);let n=255,r,i,s;if(e){if(e[7]!==r){const a=+e[7];n=e[8]?Qc(a):ta(a*255,0,255)}return r=+e[1],i=+e[3],s=+e[5],r=255&(e[2]?Qc(r):ta(r,0,255)),i=255&(e[4]?Qc(i):ta(i,0,255)),s=255&(e[6]?Qc(s):ta(s,0,255)),{r,g:i,b:s,a:n}}}function xG(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${rs(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const t_=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,Tl=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function TG(t,e,n){const r=Tl(rs(t.r)),i=Tl(rs(t.g)),s=Tl(rs(t.b));return{r:wa(t_(r+n*(Tl(rs(e.r))-r))),g:wa(t_(i+n*(Tl(rs(e.g))-i))),b:wa(t_(s+n*(Tl(rs(e.b))-s))),a:t.a+n*(e.a-t.a)}}function Uf(t,e,n){if(t){let r=_x(t);r[e]=Math.max(0,Math.min(r[e]+r[e]*n,e===0?360:1)),r=vx(r),t.r=r[0],t.g=r[1],t.b=r[2]}}function VO(t,e){return t&&Object.assign(e||{},t)}function xS(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=wa(t[3]))):(e=VO(t,{r:0,g:0,b:0,a:1}),e.a=wa(e.a)),e}function EG(t){return t.charAt(0)==="r"?bG(t):mG(t)}class ih{constructor(e){if(e instanceof ih)return e;const n=typeof e;let r;n==="object"?r=xS(e):n==="string"&&(r=aG(e)||wG(e)||EG(e)),this._rgb=r,this._valid=!!r}get valid(){return this._valid}get rgb(){var e=VO(this._rgb);return e&&(e.a=rs(e.a)),e}set rgb(e){this._rgb=xS(e)}rgbString(){return this._valid?xG(this._rgb):void 0}hexString(){return this._valid?lG(this._rgb):void 0}hslString(){return this._valid?yG(this._rgb):void 0}mix(e,n){if(e){const r=this.rgb,i=e.rgb;let s;const a=n===s?.5:n,o=2*a-1,l=r.a-i.a,u=((o*l===-1?o:(o+l)/(1+o*l))+1)/2;s=1-u,r.r=255&u*r.r+s*i.r+.5,r.g=255&u*r.g+s*i.g+.5,r.b=255&u*r.b+s*i.b+.5,r.a=a*r.a+(1-a)*i.a,this.rgb=r}return this}interpolate(e,n){return e&&(this._rgb=TG(this._rgb,e._rgb,n)),this}clone(){return new ih(this.rgb)}alpha(e){return this._rgb.a=wa(e),this}clearer(e){const n=this._rgb;return n.a*=1-e,this}greyscale(){const e=this._rgb,n=Ch(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=n,this}opaquer(e){const n=this._rgb;return n.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Uf(this._rgb,2,e),this}darken(e){return Uf(this._rgb,2,-e),this}saturate(e){return Uf(this._rgb,1,e),this}desaturate(e){return Uf(this._rgb,1,-e),this}rotate(e){return gG(this._rgb,e),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Xi(){}const SG=(()=>{let t=0;return()=>t++})();function dt(t){return t==null}function tn(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function We(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function Tn(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function pi(t,e){return Tn(t)?t:e}function Be(t,e){return typeof t>"u"?e:t}const IG=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function ft(t,e,n){if(t&&typeof t.call=="function")return t.apply(n,e)}function tt(t,e,n,r){let i,s,a;if(tn(t))for(s=t.length,i=0;i<s;i++)e.call(n,t[i],i);else if(We(t))for(a=Object.keys(t),s=a.length,i=0;i<s;i++)e.call(n,t[a[i]],a[i])}function Nm(t,e){let n,r,i,s;if(!t||!e||t.length!==e.length)return!1;for(n=0,r=t.length;n<r;++n)if(i=t[n],s=e[n],i.datasetIndex!==s.datasetIndex||i.index!==s.index)return!1;return!0}function Om(t){if(tn(t))return t.map(Om);if(We(t)){const e=Object.create(null),n=Object.keys(t),r=n.length;let i=0;for(;i<r;++i)e[n[i]]=Om(t[n[i]]);return e}return t}function FO(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function kG(t,e,n,r){if(!FO(t))return;const i=e[t],s=n[t];We(i)&&We(s)?sh(i,s,r):e[t]=Om(s)}function sh(t,e,n){const r=tn(e)?e:[e],i=r.length;if(!We(t))return t;n=n||{};const s=n.merger||kG;let a;for(let o=0;o<i;++o){if(a=r[o],!We(a))continue;const l=Object.keys(a);for(let u=0,c=l.length;u<c;++u)s(l[u],t,a,n)}return t}function wd(t,e){return sh(t,e,{merger:$G})}function $G(t,e,n){if(!FO(t))return;const r=e[t],i=n[t];We(r)&&We(i)?wd(r,i):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=Om(i))}const TS={"":t=>t,x:t=>t.x,y:t=>t.y};function CG(t){const e=t.split("."),n=[];let r="";for(const i of e)r+=i,r.endsWith("\\")?r=r.slice(0,-1)+".":(n.push(r),r="");return n}function AG(t){const e=CG(t);return n=>{for(const r of e){if(r==="")break;n=n&&n[r]}return n}}function Dm(t,e){return(TS[e]||(TS[e]=AG(e)))(t)}function bx(t){return t.charAt(0).toUpperCase()+t.slice(1)}const Mm=t=>typeof t<"u",Ca=t=>typeof t=="function",ES=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0};function RG(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const vn=Math.PI,Kr=2*vn,PG=Kr+vn,Lm=Number.POSITIVE_INFINITY,NG=vn/180,Wr=vn/2,eo=vn/4,SS=vn*2/3,BO=Math.log10,bu=Math.sign;function vd(t,e,n){return Math.abs(t-e)<n}function IS(t){const e=Math.round(t);t=vd(t,e,t/1e3)?e:t;const n=Math.pow(10,Math.floor(BO(t))),r=t/n;return(r<=1?1:r<=2?2:r<=5?5:10)*n}function OG(t){const e=[],n=Math.sqrt(t);let r;for(r=1;r<n;r++)t%r===0&&(e.push(r),e.push(t/r));return n===(n|0)&&e.push(n),e.sort((i,s)=>i-s).pop(),e}function DG(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function ah(t){return!DG(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function MG(t,e){const n=Math.round(t);return n-e<=t&&n+e>=t}function LG(t,e,n){let r,i,s;for(r=0,i=t.length;r<i;r++)s=t[r][n],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function bo(t){return t*(vn/180)}function zG(t){return t*(180/vn)}function kS(t){if(!Tn(t))return;let e=1,n=0;for(;Math.round(t*e)/e!==t;)e*=10,n++;return n}function VG(t,e){const n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);let s=Math.atan2(r,n);return s<-.5*vn&&(s+=Kr),{angle:s,distance:i}}function zw(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function FG(t,e){return(t-e+PG)%Kr-vn}function vi(t){return(t%Kr+Kr)%Kr}function UO(t,e,n,r){const i=vi(t),s=vi(e),a=vi(n),o=vi(s-i),l=vi(a-i),u=vi(i-s),c=vi(i-a);return i===s||i===a||r&&s===a||o>l&&u<c}function wr(t,e,n){return Math.max(e,Math.min(n,t))}function BG(t){return wr(t,-32768,32767)}function Wl(t,e,n,r=1e-6){return t>=Math.min(e,n)-r&&t<=Math.max(e,n)+r}function xx(t,e,n){n=n||(a=>t[a]<e);let r=t.length-1,i=0,s;for(;r-i>1;)s=i+r>>1,n(s)?i=s:r=s;return{lo:i,hi:r}}const xo=(t,e,n,r)=>xx(t,n,r?i=>{const s=t[i][e];return s<n||s===n&&t[i+1][e]===n}:i=>t[i][e]<n),UG=(t,e,n)=>xx(t,n,r=>t[r][e]>=n);function jG(t,e,n){let r=0,i=t.length;for(;r<i&&t[r]<e;)r++;for(;i>r&&t[i-1]>n;)i--;return r>0||i<t.length?t.slice(r,i):t}const jO=["push","pop","shift","splice","unshift"];function WG(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),jO.forEach(n=>{const r="_onData"+bx(n),i=t[n];Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value(...s){const a=i.apply(this,s);return t._chartjs.listeners.forEach(o=>{typeof o[r]=="function"&&o[r](...s)}),a}})})}function $S(t,e){const n=t._chartjs;if(!n)return;const r=n.listeners,i=r.indexOf(e);i!==-1&&r.splice(i,1),!(r.length>0)&&(jO.forEach(s=>{delete t[s]}),delete t._chartjs)}function HG(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const WO=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function HO(t,e){let n=[],r=!1;return function(...i){n=i,r||(r=!0,WO.call(window,()=>{r=!1,t.apply(e,n)}))}}function qG(t,e){let n;return function(...r){return e?(clearTimeout(n),n=setTimeout(t,e,r)):t.apply(this,r),e}}const qO=t=>t==="start"?"left":t==="end"?"right":"center",er=(t,e,n)=>t==="start"?e:t==="end"?n:(e+n)/2,GG=(t,e,n,r)=>t===(r?"left":"right")?n:t==="center"?(e+n)/2:e;function KG(t,e,n){const r=e.length;let i=0,s=r;if(t._sorted){const{iScale:a,vScale:o,_parsed:l}=t,u=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,c=a.axis,{min:d,max:h,minDefined:m,maxDefined:g}=a.getUserBounds();if(m){if(i=Math.min(xo(l,c,d).lo,n?r:xo(e,c,a.getPixelForValue(d)).lo),u){const w=l.slice(0,i+1).reverse().findIndex(x=>!dt(x[o.axis]));i-=Math.max(0,w)}i=wr(i,0,r-1)}if(g){let w=Math.max(xo(l,a.axis,h,!0).hi+1,n?0:xo(e,c,a.getPixelForValue(h),!0).hi+1);if(u){const x=l.slice(w-1).findIndex(v=>!dt(v[o.axis]));w+=Math.max(0,x)}s=wr(w,i,r)-i}else s=r-i}return{start:i,count:s}}function YG(t){const{xScale:e,yScale:n,_scaleRanges:r}=t,i={xmin:e.min,xmax:e.max,ymin:n.min,ymax:n.max};if(!r)return t._scaleRanges=i,!0;const s=r.xmin!==e.min||r.xmax!==e.max||r.ymin!==n.min||r.ymax!==n.max;return Object.assign(r,i),s}const jf=t=>t===0||t===1,CS=(t,e,n)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*Kr/n)),AS=(t,e,n)=>Math.pow(2,-10*t)*Math.sin((t-e)*Kr/n)+1,bd={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*Wr)+1,easeOutSine:t=>Math.sin(t*Wr),easeInOutSine:t=>-.5*(Math.cos(vn*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>jf(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>jf(t)?t:CS(t,.075,.3),easeOutElastic:t=>jf(t)?t:AS(t,.075,.3),easeInOutElastic(t){return jf(t)?t:t<.5?.5*CS(t*2,.1125,.45):.5+.5*AS(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-bd.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?bd.easeInBounce(t*2)*.5:bd.easeOutBounce(t*2-1)*.5+.5};function Tx(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function RS(t){return Tx(t)?t:new ih(t)}function n_(t){return Tx(t)?t:new ih(t).saturate(.5).darken(.1).hexString()}const QG=["x","y","borderWidth","radius","tension"],XG=["color","borderColor","backgroundColor"];function JG(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:XG},numbers:{type:"number",properties:QG}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function ZG(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const PS=new Map;function eK(t,e){e=e||{};const n=t+JSON.stringify(e);let r=PS.get(n);return r||(r=new Intl.NumberFormat(t,e),PS.set(n,r)),r}function GO(t,e,n){return eK(e,n).format(t)}const tK={values(t){return tn(t)?t:""+t},numeric(t,e,n){if(t===0)return"0";const r=this.chart.options.locale;let i,s=t;if(n.length>1){const u=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(u<1e-4||u>1e15)&&(i="scientific"),s=nK(t,n)}const a=BO(Math.abs(s)),o=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:i,minimumFractionDigits:o,maximumFractionDigits:o};return Object.assign(l,this.options.ticks.format),GO(t,r,l)}};function nK(t,e){let n=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(n)>=1&&t!==Math.floor(t)&&(n=t-Math.floor(t)),n}var KO={formatters:tK};function rK(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,n)=>n.lineWidth,tickColor:(e,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:KO.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Bo=Object.create(null),Vw=Object.create(null);function xd(t,e){if(!e)return t;const n=e.split(".");for(let r=0,i=n.length;r<i;++r){const s=n[r];t=t[s]||(t[s]=Object.create(null))}return t}function r_(t,e,n){return typeof e=="string"?sh(xd(t,e),n):sh(xd(t,""),e)}class iK{constructor(e,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=r=>r.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(r,i)=>n_(i.backgroundColor),this.hoverBorderColor=(r,i)=>n_(i.borderColor),this.hoverColor=(r,i)=>n_(i.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(n)}set(e,n){return r_(this,e,n)}get(e){return xd(this,e)}describe(e,n){return r_(Vw,e,n)}override(e,n){return r_(Bo,e,n)}route(e,n,r,i){const s=xd(this,e),a=xd(this,r),o="_"+n;Object.defineProperties(s,{[o]:{value:s[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[o],u=a[i];return We(l)?Object.assign({},u,l):Be(l,u)},set(l){this[o]=l}}})}apply(e){e.forEach(n=>n(this))}}var Mt=new iK({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[JG,ZG,rK]);function sK(t){return!t||dt(t.size)||dt(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function NS(t,e,n,r,i){let s=e[i];return s||(s=e[i]=t.measureText(i).width,n.push(i)),s>r&&(r=s),r}function to(t,e,n){const r=t.currentDevicePixelRatio,i=n!==0?Math.max(n/2,.5):0;return Math.round((e-i)*r)/r+i}function OS(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function Fw(t,e,n,r){YO(t,e,n,r,null)}function YO(t,e,n,r,i){let s,a,o,l,u,c,d,h;const m=e.pointStyle,g=e.rotation,w=e.radius;let x=(g||0)*NG;if(m&&typeof m=="object"&&(s=m.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){t.save(),t.translate(n,r),t.rotate(x),t.drawImage(m,-m.width/2,-m.height/2,m.width,m.height),t.restore();return}if(!(isNaN(w)||w<=0)){switch(t.beginPath(),m){default:i?t.ellipse(n,r,i/2,w,0,0,Kr):t.arc(n,r,w,0,Kr),t.closePath();break;case"triangle":c=i?i/2:w,t.moveTo(n+Math.sin(x)*c,r-Math.cos(x)*w),x+=SS,t.lineTo(n+Math.sin(x)*c,r-Math.cos(x)*w),x+=SS,t.lineTo(n+Math.sin(x)*c,r-Math.cos(x)*w),t.closePath();break;case"rectRounded":u=w*.516,l=w-u,a=Math.cos(x+eo)*l,d=Math.cos(x+eo)*(i?i/2-u:l),o=Math.sin(x+eo)*l,h=Math.sin(x+eo)*(i?i/2-u:l),t.arc(n-d,r-o,u,x-vn,x-Wr),t.arc(n+h,r-a,u,x-Wr,x),t.arc(n+d,r+o,u,x,x+Wr),t.arc(n-h,r+a,u,x+Wr,x+vn),t.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*w,c=i?i/2:l,t.rect(n-c,r-l,2*c,2*l);break}x+=eo;case"rectRot":d=Math.cos(x)*(i?i/2:w),a=Math.cos(x)*w,o=Math.sin(x)*w,h=Math.sin(x)*(i?i/2:w),t.moveTo(n-d,r-o),t.lineTo(n+h,r-a),t.lineTo(n+d,r+o),t.lineTo(n-h,r+a),t.closePath();break;case"crossRot":x+=eo;case"cross":d=Math.cos(x)*(i?i/2:w),a=Math.cos(x)*w,o=Math.sin(x)*w,h=Math.sin(x)*(i?i/2:w),t.moveTo(n-d,r-o),t.lineTo(n+d,r+o),t.moveTo(n+h,r-a),t.lineTo(n-h,r+a);break;case"star":d=Math.cos(x)*(i?i/2:w),a=Math.cos(x)*w,o=Math.sin(x)*w,h=Math.sin(x)*(i?i/2:w),t.moveTo(n-d,r-o),t.lineTo(n+d,r+o),t.moveTo(n+h,r-a),t.lineTo(n-h,r+a),x+=eo,d=Math.cos(x)*(i?i/2:w),a=Math.cos(x)*w,o=Math.sin(x)*w,h=Math.sin(x)*(i?i/2:w),t.moveTo(n-d,r-o),t.lineTo(n+d,r+o),t.moveTo(n+h,r-a),t.lineTo(n-h,r+a);break;case"line":a=i?i/2:Math.cos(x)*w,o=Math.sin(x)*w,t.moveTo(n-a,r-o),t.lineTo(n+a,r+o);break;case"dash":t.moveTo(n,r),t.lineTo(n+Math.cos(x)*(i?i/2:w),r+Math.sin(x)*w);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function oh(t,e,n){return n=n||.5,!e||t&&t.x>e.left-n&&t.x<e.right+n&&t.y>e.top-n&&t.y<e.bottom+n}function zg(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function Vg(t){t.restore()}function aK(t,e,n,r,i){if(!e)return t.lineTo(n.x,n.y);if(i==="middle"){const s=(e.x+n.x)/2;t.lineTo(s,e.y),t.lineTo(s,n.y)}else i==="after"!=!!r?t.lineTo(e.x,n.y):t.lineTo(n.x,e.y);t.lineTo(n.x,n.y)}function oK(t,e,n,r){if(!e)return t.lineTo(n.x,n.y);t.bezierCurveTo(r?e.cp1x:e.cp2x,r?e.cp1y:e.cp2y,r?n.cp2x:n.cp1x,r?n.cp2y:n.cp1y,n.x,n.y)}function lK(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),dt(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function uK(t,e,n,r,i){if(i.strikethrough||i.underline){const s=t.measureText(r),a=e-s.actualBoundingBoxLeft,o=e+s.actualBoundingBoxRight,l=n-s.actualBoundingBoxAscent,u=n+s.actualBoundingBoxDescent,c=i.strikethrough?(l+u)/2:u;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=i.decorationWidth||2,t.moveTo(a,c),t.lineTo(o,c),t.stroke()}}function cK(t,e){const n=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=n}function zm(t,e,n,r,i,s={}){const a=tn(e)?e:[e],o=s.strokeWidth>0&&s.strokeColor!=="";let l,u;for(t.save(),t.font=i.string,lK(t,s),l=0;l<a.length;++l)u=a[l],s.backdrop&&cK(t,s.backdrop),o&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),dt(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(u,n,r,s.maxWidth)),t.fillText(u,n,r,s.maxWidth),uK(t,n,r,u,s),r+=Number(i.lineHeight);t.restore()}function Bw(t,e){const{x:n,y:r,w:i,h:s,radius:a}=e;t.arc(n+a.topLeft,r+a.topLeft,a.topLeft,1.5*vn,vn,!0),t.lineTo(n,r+s-a.bottomLeft),t.arc(n+a.bottomLeft,r+s-a.bottomLeft,a.bottomLeft,vn,Wr,!0),t.lineTo(n+i-a.bottomRight,r+s),t.arc(n+i-a.bottomRight,r+s-a.bottomRight,a.bottomRight,Wr,0,!0),t.lineTo(n+i,r+a.topRight),t.arc(n+i-a.topRight,r+a.topRight,a.topRight,0,-Wr,!0),t.lineTo(n+a.topLeft,r)}const dK=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,hK=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function fK(t,e){const n=(""+t).match(dK);if(!n||n[1]==="normal")return e*1.2;switch(t=+n[2],n[3]){case"px":return t;case"%":t/=100;break}return e*t}const pK=t=>+t||0;function QO(t,e){const n={},r=We(e),i=r?Object.keys(e):e,s=We(t)?r?a=>Be(t[a],t[e[a]]):a=>t[a]:()=>t;for(const a of i)n[a]=pK(s(a));return n}function mK(t){return QO(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Td(t){return QO(t,["topLeft","topRight","bottomLeft","bottomRight"])}function ei(t){const e=mK(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function qn(t,e){t=t||{},e=e||Mt.font;let n=Be(t.size,e.size);typeof n=="string"&&(n=parseInt(n,10));let r=Be(t.style,e.style);r&&!(""+r).match(hK)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);const i={family:Be(t.family,e.family),lineHeight:fK(Be(t.lineHeight,e.lineHeight),n),size:n,style:r,weight:Be(t.weight,e.weight),string:""};return i.string=sK(i),i}function Wf(t,e,n,r){let i,s,a;for(i=0,s=t.length;i<s;++i)if(a=t[i],a!==void 0&&a!==void 0)return a}function gK(t,e,n){const{min:r,max:i}=t,s=IG(e,(i-r)/2),a=(o,l)=>n&&o===0?0:o+l;return{min:a(r,-Math.abs(s)),max:a(i,s)}}function Jo(t,e){return Object.assign(Object.create(t),e)}function Ex(t,e=[""],n,r,i=()=>t[0]){const s=n||t;typeof r>"u"&&(r=eD("_fallback",t));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:s,_fallback:r,_getTarget:i,override:o=>Ex([o,...t],e,s,r)};return new Proxy(a,{deleteProperty(o,l){return delete o[l],delete o._keys,delete t[0][l],!0},get(o,l){return JO(o,l,()=>EK(l,e,t,o))},getOwnPropertyDescriptor(o,l){return Reflect.getOwnPropertyDescriptor(o._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(o,l){return MS(o).includes(l)},ownKeys(o){return MS(o)},set(o,l,u){const c=o._storage||(o._storage=i());return o[l]=c[l]=u,delete o._keys,!0}})}function xu(t,e,n,r){const i={_cacheable:!1,_proxy:t,_context:e,_subProxy:n,_stack:new Set,_descriptors:XO(t,r),setContext:s=>xu(t,s,n,r),override:s=>xu(t.override(s),e,n,r)};return new Proxy(i,{deleteProperty(s,a){return delete s[a],delete t[a],!0},get(s,a,o){return JO(s,a,()=>_K(s,a,o))},getOwnPropertyDescriptor(s,a){return s._descriptors.allKeys?Reflect.has(t,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,a)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(s,a){return Reflect.has(t,a)},ownKeys(){return Reflect.ownKeys(t)},set(s,a,o){return t[a]=o,delete s[a],!0}})}function XO(t,e={scriptable:!0,indexable:!0}){const{_scriptable:n=e.scriptable,_indexable:r=e.indexable,_allKeys:i=e.allKeys}=t;return{allKeys:i,scriptable:n,indexable:r,isScriptable:Ca(n)?n:()=>n,isIndexable:Ca(r)?r:()=>r}}const yK=(t,e)=>t?t+bx(e):e,Sx=(t,e)=>We(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function JO(t,e,n){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const r=n();return t[e]=r,r}function _K(t,e,n){const{_proxy:r,_context:i,_subProxy:s,_descriptors:a}=t;let o=r[e];return Ca(o)&&a.isScriptable(e)&&(o=wK(e,o,t,n)),tn(o)&&o.length&&(o=vK(e,o,t,a.isIndexable)),Sx(e,o)&&(o=xu(o,i,s&&s[e],a)),o}function wK(t,e,n,r){const{_proxy:i,_context:s,_subProxy:a,_stack:o}=n;if(o.has(t))throw new Error("Recursion detected: "+Array.from(o).join("->")+"->"+t);o.add(t);let l=e(s,a||r);return o.delete(t),Sx(t,l)&&(l=Ix(i._scopes,i,t,l)),l}function vK(t,e,n,r){const{_proxy:i,_context:s,_subProxy:a,_descriptors:o}=n;if(typeof s.index<"u"&&r(t))return e[s.index%e.length];if(We(e[0])){const l=e,u=i._scopes.filter(c=>c!==l);e=[];for(const c of l){const d=Ix(u,i,t,c);e.push(xu(d,s,a&&a[t],o))}}return e}function ZO(t,e,n){return Ca(t)?t(e,n):t}const bK=(t,e)=>t===!0?e:typeof t=="string"?Dm(e,t):void 0;function xK(t,e,n,r,i){for(const s of e){const a=bK(n,s);if(a){t.add(a);const o=ZO(a._fallback,n,i);if(typeof o<"u"&&o!==n&&o!==r)return o}else if(a===!1&&typeof r<"u"&&n!==r)return null}return!1}function Ix(t,e,n,r){const i=e._rootScopes,s=ZO(e._fallback,n,r),a=[...t,...i],o=new Set;o.add(r);let l=DS(o,a,n,s||n,r);return l===null||typeof s<"u"&&s!==n&&(l=DS(o,a,s,l,r),l===null)?!1:Ex(Array.from(o),[""],i,s,()=>TK(e,n,r))}function DS(t,e,n,r,i){for(;n;)n=xK(t,e,n,r,i);return n}function TK(t,e,n){const r=t._getTarget();e in r||(r[e]={});const i=r[e];return tn(i)&&We(n)?n:i||{}}function EK(t,e,n,r){let i;for(const s of e)if(i=eD(yK(s,t),n),typeof i<"u")return Sx(t,i)?Ix(n,r,t,i):i}function eD(t,e){for(const n of e){if(!n)continue;const r=n[t];if(typeof r<"u")return r}}function MS(t){let e=t._keys;return e||(e=t._keys=SK(t._scopes)),e}function SK(t){const e=new Set;for(const n of t)for(const r of Object.keys(n).filter(i=>!i.startsWith("_")))e.add(r);return Array.from(e)}const IK=Number.EPSILON||1e-14,Tu=(t,e)=>e<t.length&&!t[e].skip&&t[e],tD=t=>t==="x"?"y":"x";function kK(t,e,n,r){const i=t.skip?e:t,s=e,a=n.skip?e:n,o=zw(s,i),l=zw(a,s);let u=o/(o+l),c=l/(o+l);u=isNaN(u)?0:u,c=isNaN(c)?0:c;const d=r*u,h=r*c;return{previous:{x:s.x-d*(a.x-i.x),y:s.y-d*(a.y-i.y)},next:{x:s.x+h*(a.x-i.x),y:s.y+h*(a.y-i.y)}}}function $K(t,e,n){const r=t.length;let i,s,a,o,l,u=Tu(t,0);for(let c=0;c<r-1;++c)if(l=u,u=Tu(t,c+1),!(!l||!u)){if(vd(e[c],0,IK)){n[c]=n[c+1]=0;continue}i=n[c]/e[c],s=n[c+1]/e[c],o=Math.pow(i,2)+Math.pow(s,2),!(o<=9)&&(a=3/Math.sqrt(o),n[c]=i*a*e[c],n[c+1]=s*a*e[c])}}function CK(t,e,n="x"){const r=tD(n),i=t.length;let s,a,o,l=Tu(t,0);for(let u=0;u<i;++u){if(a=o,o=l,l=Tu(t,u+1),!o)continue;const c=o[n],d=o[r];a&&(s=(c-a[n])/3,o[`cp1${n}`]=c-s,o[`cp1${r}`]=d-s*e[u]),l&&(s=(l[n]-c)/3,o[`cp2${n}`]=c+s,o[`cp2${r}`]=d+s*e[u])}}function AK(t,e="x"){const n=tD(e),r=t.length,i=Array(r).fill(0),s=Array(r);let a,o,l,u=Tu(t,0);for(a=0;a<r;++a)if(o=l,l=u,u=Tu(t,a+1),!!l){if(u){const c=u[e]-l[e];i[a]=c!==0?(u[n]-l[n])/c:0}s[a]=o?u?bu(i[a-1])!==bu(i[a])?0:(i[a-1]+i[a])/2:i[a-1]:i[a]}$K(t,i,s),CK(t,s,e)}function Hf(t,e,n){return Math.max(Math.min(t,n),e)}function RK(t,e){let n,r,i,s,a,o=oh(t[0],e);for(n=0,r=t.length;n<r;++n)a=s,s=o,o=n<r-1&&oh(t[n+1],e),s&&(i=t[n],a&&(i.cp1x=Hf(i.cp1x,e.left,e.right),i.cp1y=Hf(i.cp1y,e.top,e.bottom)),o&&(i.cp2x=Hf(i.cp2x,e.left,e.right),i.cp2y=Hf(i.cp2y,e.top,e.bottom)))}function PK(t,e,n,r,i){let s,a,o,l;if(e.spanGaps&&(t=t.filter(u=>!u.skip)),e.cubicInterpolationMode==="monotone")AK(t,i);else{let u=r?t[t.length-1]:t[0];for(s=0,a=t.length;s<a;++s)o=t[s],l=kK(u,o,t[Math.min(s+1,a-(r?0:1))%a],e.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,u=o}e.capBezierPoints&&RK(t,n)}function kx(){return typeof window<"u"&&typeof document<"u"}function $x(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function Vm(t,e,n){let r;return typeof t=="string"?(r=parseInt(t,10),t.indexOf("%")!==-1&&(r=r/100*e.parentNode[n])):r=t,r}const Fg=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function NK(t,e){return Fg(t).getPropertyValue(e)}const OK=["top","right","bottom","left"];function Io(t,e,n){const r={};n=n?"-"+n:"";for(let i=0;i<4;i++){const s=OK[i];r[s]=parseFloat(t[e+"-"+s+n])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}const DK=(t,e,n)=>(t>0||e>0)&&(!n||!n.shadowRoot);function MK(t,e){const n=t.touches,r=n&&n.length?n[0]:t,{offsetX:i,offsetY:s}=r;let a=!1,o,l;if(DK(i,s,t.target))o=i,l=s;else{const u=e.getBoundingClientRect();o=r.clientX-u.left,l=r.clientY-u.top,a=!0}return{x:o,y:l,box:a}}function co(t,e){if("native"in t)return t;const{canvas:n,currentDevicePixelRatio:r}=e,i=Fg(n),s=i.boxSizing==="border-box",a=Io(i,"padding"),o=Io(i,"border","width"),{x:l,y:u,box:c}=MK(t,n),d=a.left+(c&&o.left),h=a.top+(c&&o.top);let{width:m,height:g}=e;return s&&(m-=a.width+o.width,g-=a.height+o.height),{x:Math.round((l-d)/m*n.width/r),y:Math.round((u-h)/g*n.height/r)}}function LK(t,e,n){let r,i;if(e===void 0||n===void 0){const s=t&&$x(t);if(!s)e=t.clientWidth,n=t.clientHeight;else{const a=s.getBoundingClientRect(),o=Fg(s),l=Io(o,"border","width"),u=Io(o,"padding");e=a.width-u.width-l.width,n=a.height-u.height-l.height,r=Vm(o.maxWidth,s,"clientWidth"),i=Vm(o.maxHeight,s,"clientHeight")}}return{width:e,height:n,maxWidth:r||Lm,maxHeight:i||Lm}}const na=t=>Math.round(t*10)/10;function zK(t,e,n,r){const i=Fg(t),s=Io(i,"margin"),a=Vm(i.maxWidth,t,"clientWidth")||Lm,o=Vm(i.maxHeight,t,"clientHeight")||Lm,l=LK(t,e,n);let{width:u,height:c}=l;if(i.boxSizing==="content-box"){const h=Io(i,"border","width"),m=Io(i,"padding");u-=m.width+h.width,c-=m.height+h.height}return u=Math.max(0,u-s.width),c=Math.max(0,r?u/r:c-s.height),u=na(Math.min(u,a,l.maxWidth)),c=na(Math.min(c,o,l.maxHeight)),u&&!c&&(c=na(u/2)),(e!==void 0||n!==void 0)&&r&&l.height&&c>l.height&&(c=l.height,u=na(Math.floor(c*r))),{width:u,height:c}}function LS(t,e,n){const r=e||1,i=na(t.height*r),s=na(t.width*r);t.height=na(t.height),t.width=na(t.width);const a=t.canvas;return a.style&&(n||!a.style.height&&!a.style.width)&&(a.style.height=`${t.height}px`,a.style.width=`${t.width}px`),t.currentDevicePixelRatio!==r||a.height!==i||a.width!==s?(t.currentDevicePixelRatio=r,a.height=i,a.width=s,t.ctx.setTransform(r,0,0,r,0,0),!0):!1}const VK=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};kx()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function zS(t,e){const n=NK(t,e),r=n&&n.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function ho(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:t.y+n*(e.y-t.y)}}function FK(t,e,n,r){return{x:t.x+n*(e.x-t.x),y:r==="middle"?n<.5?t.y:e.y:r==="after"?n<1?t.y:e.y:n>0?e.y:t.y}}function BK(t,e,n,r){const i={x:t.cp2x,y:t.cp2y},s={x:e.cp1x,y:e.cp1y},a=ho(t,i,n),o=ho(i,s,n),l=ho(s,e,n),u=ho(a,o,n),c=ho(o,l,n);return ho(u,c,n)}const UK=function(t,e){return{x(n){return t+t+e-n},setWidth(n){e=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,r){return n-r},leftForLtr(n,r){return n-r}}},jK=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function au(t,e,n){return t?UK(e,n):jK()}function nD(t,e){let n,r;(e==="ltr"||e==="rtl")&&(n=t.canvas.style,r=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",e,"important"),t.prevTextDirection=r)}function rD(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function iD(t){return t==="angle"?{between:UO,compare:FG,normalize:vi}:{between:Wl,compare:(e,n)=>e-n,normalize:e=>e}}function VS({start:t,end:e,count:n,loop:r,style:i}){return{start:t%n,end:e%n,loop:r&&(e-t+1)%n===0,style:i}}function WK(t,e,n){const{property:r,start:i,end:s}=n,{between:a,normalize:o}=iD(r),l=e.length;let{start:u,end:c,loop:d}=t,h,m;if(d){for(u+=l,c+=l,h=0,m=l;h<m&&a(o(e[u%l][r]),i,s);++h)u--,c--;u%=l,c%=l}return c<u&&(c+=l),{start:u,end:c,loop:d,style:t.style}}function sD(t,e,n){if(!n)return[t];const{property:r,start:i,end:s}=n,a=e.length,{compare:o,between:l,normalize:u}=iD(r),{start:c,end:d,loop:h,style:m}=WK(t,e,n),g=[];let w=!1,x=null,v,y,E;const $=()=>l(i,E,v)&&o(i,E)!==0,R=()=>o(s,v)===0||l(s,E,v),D=()=>w||$(),k=()=>!w||R();for(let _=c,A=c;_<=d;++_)y=e[_%a],!y.skip&&(v=u(y[r]),v!==E&&(w=l(v,i,s),x===null&&D()&&(x=o(v,i)===0?_:A),x!==null&&k()&&(g.push(VS({start:x,end:_,loop:h,count:a,style:m})),x=null),A=_,E=v));return x!==null&&g.push(VS({start:x,end:d,loop:h,count:a,style:m})),g}function aD(t,e){const n=[],r=t.segments;for(let i=0;i<r.length;i++){const s=sD(r[i],t.points,e);s.length&&n.push(...s)}return n}function HK(t,e,n,r){let i=0,s=e-1;if(n&&!r)for(;i<e&&!t[i].skip;)i++;for(;i<e&&t[i].skip;)i++;for(i%=e,n&&(s+=i);s>i&&t[s%e].skip;)s--;return s%=e,{start:i,end:s}}function qK(t,e,n,r){const i=t.length,s=[];let a=e,o=t[e],l;for(l=e+1;l<=n;++l){const u=t[l%i];u.skip||u.stop?o.skip||(r=!1,s.push({start:e%i,end:(l-1)%i,loop:r}),e=a=u.stop?l:null):(a=l,o.skip&&(e=l)),o=u}return a!==null&&s.push({start:e%i,end:a%i,loop:r}),s}function GK(t,e){const n=t.points,r=t.options.spanGaps,i=n.length;if(!i)return[];const s=!!t._loop,{start:a,end:o}=HK(n,i,s,r);if(r===!0)return FS(t,[{start:a,end:o,loop:s}],n,e);const l=o<a?o+i:o,u=!!t._fullLoop&&a===0&&o===i-1;return FS(t,qK(n,a,l,u),n,e)}function FS(t,e,n,r){return!r||!r.setContext||!n?e:KK(t,e,n,r)}function KK(t,e,n,r){const i=t._chart.getContext(),s=BS(t.options),{_datasetIndex:a,options:{spanGaps:o}}=t,l=n.length,u=[];let c=s,d=e[0].start,h=d;function m(g,w,x,v){const y=o?-1:1;if(g!==w){for(g+=l;n[g%l].skip;)g-=y;for(;n[w%l].skip;)w+=y;g%l!==w%l&&(u.push({start:g%l,end:w%l,loop:x,style:v}),c=v,d=w%l)}}for(const g of e){d=o?d:g.start;let w=n[d%l],x;for(h=d+1;h<=g.end;h++){const v=n[h%l];x=BS(r.setContext(Jo(i,{type:"segment",p0:w,p1:v,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:a}))),YK(x,c)&&m(d,h-1,g.loop,c),w=v,c=x}d<h-1&&m(d,h-1,g.loop,c)}return u}function BS(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function YK(t,e){if(!e)return!1;const n=[],r=function(i,s){return Tx(s)?(n.includes(s)||n.push(s),n.indexOf(s)):s};return JSON.stringify(t,r)!==JSON.stringify(e,r)}function qf(t,e,n){return t.options.clip?t[n]:e[n]}function QK(t,e){const{xScale:n,yScale:r}=t;return n&&r?{left:qf(n,e,"left"),right:qf(n,e,"right"),top:qf(r,e,"top"),bottom:qf(r,e,"bottom")}:e}function oD(t,e){const n=e._clip;if(n.disabled)return!1;const r=QK(e,t.chartArea);return{left:n.left===!1?0:r.left-(n.left===!0?0:n.left),right:n.right===!1?t.width:r.right+(n.right===!0?0:n.right),top:n.top===!1?0:r.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?t.height:r.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class XK{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,n,r,i){const s=n.listeners[i],a=n.duration;s.forEach(o=>o({chart:e,initial:n.initial,numSteps:a,currentStep:Math.min(r-n.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=WO.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let n=0;this._charts.forEach((r,i)=>{if(!r.running||!r.items.length)return;const s=r.items;let a=s.length-1,o=!1,l;for(;a>=0;--a)l=s[a],l._active?(l._total>r.duration&&(r.duration=l._total),l.tick(e),o=!0):(s[a]=s[s.length-1],s.pop());o&&(i.draw(),this._notify(i,r,e,"progress")),s.length||(r.running=!1,this._notify(i,r,e,"complete"),r.initial=!1),n+=s.length}),this._lastDate=e,n===0&&(this._running=!1)}_getAnims(e){const n=this._charts;let r=n.get(e);return r||(r={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(e,r)),r}listen(e,n,r){this._getAnims(e).listeners[n].push(r)}add(e,n){!n||!n.length||this._getAnims(e).items.push(...n)}has(e){return this._getAnims(e).items.length>0}start(e){const n=this._charts.get(e);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((r,i)=>Math.max(r,i._duration),0),this._refresh())}running(e){if(!this._running)return!1;const n=this._charts.get(e);return!(!n||!n.running||!n.items.length)}stop(e){const n=this._charts.get(e);if(!n||!n.items.length)return;const r=n.items;let i=r.length-1;for(;i>=0;--i)r[i].cancel();n.items=[],this._notify(e,n,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Zi=new XK;const US="transparent",JK={boolean(t,e,n){return n>.5?e:t},color(t,e,n){const r=RS(t||US),i=r.valid&&RS(e||US);return i&&i.valid?i.mix(r,n).hexString():e},number(t,e,n){return t+(e-t)*n}};class ZK{constructor(e,n,r,i){const s=n[r];i=Wf([e.to,i,s,e.from]);const a=Wf([e.from,s,i]);this._active=!0,this._fn=e.fn||JK[e.type||typeof a],this._easing=bd[e.easing]||bd.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=n,this._prop=r,this._from=a,this._to=i,this._promises=void 0}active(){return this._active}update(e,n,r){if(this._active){this._notify(!1);const i=this._target[this._prop],s=r-this._start,a=this._duration-s;this._start=r,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=Wf([e.to,n,i,e.from]),this._from=Wf([e.from,i,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const n=e-this._start,r=this._duration,i=this._prop,s=this._from,a=this._loop,o=this._to;let l;if(this._active=s!==o&&(a||n<r),!this._active){this._target[i]=o,this._notify(!0);return}if(n<0){this._target[i]=s;return}l=n/r%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[i]=this._fn(s,o,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((n,r)=>{e.push({res:n,rej:r})})}_notify(e){const n=e?"res":"rej",r=this._promises||[];for(let i=0;i<r.length;i++)r[i][n]()}}class lD{constructor(e,n){this._chart=e,this._properties=new Map,this.configure(n)}configure(e){if(!We(e))return;const n=Object.keys(Mt.animation),r=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const s=e[i];if(!We(s))return;const a={};for(const o of n)a[o]=s[o];(tn(s.properties)&&s.properties||[i]).forEach(o=>{(o===i||!r.has(o))&&r.set(o,a)})})}_animateOptions(e,n){const r=n.options,i=tY(e,r);if(!i)return[];const s=this._createAnimations(i,r);return r.$shared&&eY(e.options.$animations,r).then(()=>{e.options=r},()=>{}),s}_createAnimations(e,n){const r=this._properties,i=[],s=e.$animations||(e.$animations={}),a=Object.keys(n),o=Date.now();let l;for(l=a.length-1;l>=0;--l){const u=a[l];if(u.charAt(0)==="$")continue;if(u==="options"){i.push(...this._animateOptions(e,n));continue}const c=n[u];let d=s[u];const h=r.get(u);if(d)if(h&&d.active()){d.update(h,c,o);continue}else d.cancel();if(!h||!h.duration){e[u]=c;continue}s[u]=d=new ZK(h,e,u,c),i.push(d)}return i}update(e,n){if(this._properties.size===0){Object.assign(e,n);return}const r=this._createAnimations(e,n);if(r.length)return Zi.add(this._chart,r),!0}}function eY(t,e){const n=[],r=Object.keys(e);for(let i=0;i<r.length;i++){const s=t[r[i]];s&&s.active()&&n.push(s.wait())}return Promise.all(n)}function tY(t,e){if(!e)return;let n=t.options;if(!n){t.options=e;return}return n.$shared&&(t.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function jS(t,e){const n=t&&t.options||{},r=n.reverse,i=n.min===void 0?e:0,s=n.max===void 0?e:0;return{start:r?s:i,end:r?i:s}}function nY(t,e,n){if(n===!1)return!1;const r=jS(t,n),i=jS(e,n);return{top:i.end,right:r.end,bottom:i.start,left:r.start}}function rY(t){let e,n,r,i;return We(t)?(e=t.top,n=t.right,r=t.bottom,i=t.left):e=n=r=i=t,{top:e,right:n,bottom:r,left:i,disabled:t===!1}}function uD(t,e){const n=[],r=t._getSortedDatasetMetas(e);let i,s;for(i=0,s=r.length;i<s;++i)n.push(r[i].index);return n}function WS(t,e,n,r={}){const i=t.keys,s=r.mode==="single";let a,o,l,u;if(e===null)return;let c=!1;for(a=0,o=i.length;a<o;++a){if(l=+i[a],l===n){if(c=!0,r.all)continue;break}u=t.values[l],Tn(u)&&(s||e===0||bu(e)===bu(u))&&(e+=u)}return!c&&!r.all?0:e}function iY(t,e){const{iScale:n,vScale:r}=e,i=n.axis==="x"?"x":"y",s=r.axis==="x"?"x":"y",a=Object.keys(t),o=new Array(a.length);let l,u,c;for(l=0,u=a.length;l<u;++l)c=a[l],o[l]={[i]:c,[s]:t[c]};return o}function i_(t,e){const n=t&&t.options.stacked;return n||n===void 0&&e.stack!==void 0}function sY(t,e,n){return`${t.id}.${e.id}.${n.stack||n.type}`}function aY(t){const{min:e,max:n,minDefined:r,maxDefined:i}=t.getUserBounds();return{min:r?e:Number.NEGATIVE_INFINITY,max:i?n:Number.POSITIVE_INFINITY}}function oY(t,e,n){const r=t[e]||(t[e]={});return r[n]||(r[n]={})}function HS(t,e,n,r){for(const i of e.getMatchingVisibleMetas(r).reverse()){const s=t[i.index];if(n&&s>0||!n&&s<0)return i.index}return null}function qS(t,e){const{chart:n,_cachedMeta:r}=t,i=n._stacks||(n._stacks={}),{iScale:s,vScale:a,index:o}=r,l=s.axis,u=a.axis,c=sY(s,a,r),d=e.length;let h;for(let m=0;m<d;++m){const g=e[m],{[l]:w,[u]:x}=g,v=g._stacks||(g._stacks={});h=v[u]=oY(i,c,w),h[o]=x,h._top=HS(h,a,!0,r.type),h._bottom=HS(h,a,!1,r.type);const y=h._visualValues||(h._visualValues={});y[o]=x}}function s_(t,e){const n=t.scales;return Object.keys(n).filter(r=>n[r].axis===e).shift()}function lY(t,e){return Jo(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function uY(t,e,n){return Jo(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:n,index:e,mode:"default",type:"data"})}function xc(t,e){const n=t.controller.index,r=t.vScale&&t.vScale.axis;if(r){e=e||t._parsed;for(const i of e){const s=i._stacks;if(!s||s[r]===void 0||s[r][n]===void 0)return;delete s[r][n],s[r]._visualValues!==void 0&&s[r]._visualValues[n]!==void 0&&delete s[r]._visualValues[n]}}}const a_=t=>t==="reset"||t==="none",GS=(t,e)=>e?t:Object.assign({},t),cY=(t,e,n)=>t&&!e.hidden&&e._stacked&&{keys:uD(n,!0),values:null};class Ed{constructor(e,n){this.chart=e,this._ctx=e.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=i_(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&xc(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,n=this._cachedMeta,r=this.getDataset(),i=(d,h,m,g)=>d==="x"?h:d==="r"?g:m,s=n.xAxisID=Be(r.xAxisID,s_(e,"x")),a=n.yAxisID=Be(r.yAxisID,s_(e,"y")),o=n.rAxisID=Be(r.rAxisID,s_(e,"r")),l=n.indexAxis,u=n.iAxisID=i(l,s,a,o),c=n.vAxisID=i(l,a,s,o);n.xScale=this.getScaleForId(s),n.yScale=this.getScaleForId(a),n.rScale=this.getScaleForId(o),n.iScale=this.getScaleForId(u),n.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const n=this._cachedMeta;return e===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&$S(this._data,this),e._stacked&&xc(e)}_dataCheck(){const e=this.getDataset(),n=e.data||(e.data=[]),r=this._data;if(We(n)){const i=this._cachedMeta;this._data=iY(n,i)}else if(r!==n){if(r){$S(r,this);const i=this._cachedMeta;xc(i),i._parsed=[]}n&&Object.isExtensible(n)&&WG(n,this),this._syncList=[],this._data=n}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const n=this._cachedMeta,r=this.getDataset();let i=!1;this._dataCheck();const s=n._stacked;n._stacked=i_(n.vScale,n),n.stack!==r.stack&&(i=!0,xc(n),n.stack=r.stack),this._resyncElements(e),(i||s!==n._stacked)&&(qS(this,n._parsed),n._stacked=i_(n.vScale,n))}configure(){const e=this.chart.config,n=e.datasetScopeKeys(this._type),r=e.getOptionScopes(this.getDataset(),n,!0);this.options=e.createResolver(r,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,n){const{_cachedMeta:r,_data:i}=this,{iScale:s,_stacked:a}=r,o=s.axis;let l=e===0&&n===i.length?!0:r._sorted,u=e>0&&r._parsed[e-1],c,d,h;if(this._parsing===!1)r._parsed=i,r._sorted=!0,h=i;else{tn(i[e])?h=this.parseArrayData(r,i,e,n):We(i[e])?h=this.parseObjectData(r,i,e,n):h=this.parsePrimitiveData(r,i,e,n);const m=()=>d[o]===null||u&&d[o]<u[o];for(c=0;c<n;++c)r._parsed[c+e]=d=h[c],l&&(m()&&(l=!1),u=d);r._sorted=l}a&&qS(this,h)}parsePrimitiveData(e,n,r,i){const{iScale:s,vScale:a}=e,o=s.axis,l=a.axis,u=s.getLabels(),c=s===a,d=new Array(i);let h,m,g;for(h=0,m=i;h<m;++h)g=h+r,d[h]={[o]:c||s.parse(u[g],g),[l]:a.parse(n[g],g)};return d}parseArrayData(e,n,r,i){const{xScale:s,yScale:a}=e,o=new Array(i);let l,u,c,d;for(l=0,u=i;l<u;++l)c=l+r,d=n[c],o[l]={x:s.parse(d[0],c),y:a.parse(d[1],c)};return o}parseObjectData(e,n,r,i){const{xScale:s,yScale:a}=e,{xAxisKey:o="x",yAxisKey:l="y"}=this._parsing,u=new Array(i);let c,d,h,m;for(c=0,d=i;c<d;++c)h=c+r,m=n[h],u[c]={x:s.parse(Dm(m,o),h),y:a.parse(Dm(m,l),h)};return u}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,n,r){const i=this.chart,s=this._cachedMeta,a=n[e.axis],o={keys:uD(i,!0),values:n._stacks[e.axis]._visualValues};return WS(o,a,s.index,{mode:r})}updateRangeFromParsed(e,n,r,i){const s=r[n.axis];let a=s===null?NaN:s;const o=i&&r._stacks[n.axis];i&&o&&(i.values=o,a=WS(i,s,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,n){const r=this._cachedMeta,i=r._parsed,s=r._sorted&&e===r.iScale,a=i.length,o=this._getOtherScale(e),l=cY(n,r,this.chart),u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=aY(o);let h,m;function g(){m=i[h];const w=m[o.axis];return!Tn(m[e.axis])||c>w||d<w}for(h=0;h<a&&!(!g()&&(this.updateRangeFromParsed(u,e,m,l),s));++h);if(s){for(h=a-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(u,e,m,l);break}}return u}getAllParsedValues(e){const n=this._cachedMeta._parsed,r=[];let i,s,a;for(i=0,s=n.length;i<s;++i)a=n[i][e.axis],Tn(a)&&r.push(a);return r}getMaxOverflow(){return!1}getLabelAndValue(e){const n=this._cachedMeta,r=n.iScale,i=n.vScale,s=this.getParsed(e);return{label:r?""+r.getLabelForValue(s[r.axis]):"",value:i?""+i.getLabelForValue(s[i.axis]):""}}_update(e){const n=this._cachedMeta;this.update(e||"default"),n._clip=rY(Be(this.options.clip,nY(n.xScale,n.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,n=this.chart,r=this._cachedMeta,i=r.data||[],s=n.chartArea,a=[],o=this._drawStart||0,l=this._drawCount||i.length-o,u=this.options.drawActiveElementsOnTop;let c;for(r.dataset&&r.dataset.draw(e,s,o,l),c=o;c<o+l;++c){const d=i[c];d.hidden||(d.active&&u?a.push(d):d.draw(e,s))}for(c=0;c<a.length;++c)a[c].draw(e,s)}getStyle(e,n){const r=n?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(r):this.resolveDataElementOptions(e||0,r)}getContext(e,n,r){const i=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];s=a.$context||(a.$context=uY(this.getContext(),e,a)),s.parsed=this.getParsed(e),s.raw=i.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=lY(this.chart.getContext(),this.index)),s.dataset=i,s.index=s.datasetIndex=this.index;return s.active=!!n,s.mode=r,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,n){return this._resolveElementOptions(this.dataElementType.id,n,e)}_resolveElementOptions(e,n="default",r){const i=n==="active",s=this._cachedDataOpts,a=e+"-"+n,o=s[a],l=this.enableOptionSharing&&Mm(r);if(o)return GS(o,l);const u=this.chart.config,c=u.datasetElementScopeKeys(this._type,e),d=i?[`${e}Hover`,"hover",e,""]:[e,""],h=u.getOptionScopes(this.getDataset(),c),m=Object.keys(Mt.elements[e]),g=()=>this.getContext(r,i,n),w=u.resolveNamedOptions(h,m,g,d);return w.$shared&&(w.$shared=l,s[a]=Object.freeze(GS(w,l))),w}_resolveAnimations(e,n,r){const i=this.chart,s=this._cachedDataOpts,a=`animation-${n}`,o=s[a];if(o)return o;let l;if(i.options.animation!==!1){const c=this.chart.config,d=c.datasetAnimationScopeKeys(this._type,n),h=c.getOptionScopes(this.getDataset(),d);l=c.createResolver(h,this.getContext(e,r,n))}const u=new lD(i,l&&l.animations);return l&&l._cacheable&&(s[a]=Object.freeze(u)),u}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,n){return!n||a_(e)||this.chart._animationsDisabled}_getSharedOptions(e,n){const r=this.resolveDataElementOptions(e,n),i=this._sharedOptions,s=this.getSharedOptions(r),a=this.includeOptions(n,s)||s!==i;return this.updateSharedOptions(s,n,r),{sharedOptions:s,includeOptions:a}}updateElement(e,n,r,i){a_(i)?Object.assign(e,r):this._resolveAnimations(n,i).update(e,r)}updateSharedOptions(e,n,r){e&&!a_(n)&&this._resolveAnimations(void 0,n).update(e,r)}_setStyle(e,n,r,i){e.active=i;const s=this.getStyle(n,i);this._resolveAnimations(n,r,i).update(e,{options:!i&&this.getSharedOptions(s)||s})}removeHoverStyle(e,n,r){this._setStyle(e,r,"active",!1)}setHoverStyle(e,n,r){this._setStyle(e,r,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const n=this._data,r=this._cachedMeta.data;for(const[o,l,u]of this._syncList)this[o](l,u);this._syncList=[];const i=r.length,s=n.length,a=Math.min(s,i);a&&this.parse(0,a),s>i?this._insertElements(i,s-i,e):s<i&&this._removeElements(s,i-s)}_insertElements(e,n,r=!0){const i=this._cachedMeta,s=i.data,a=e+n;let o;const l=u=>{for(u.length+=n,o=u.length-1;o>=a;o--)u[o]=u[o-n]};for(l(s),o=e;o<a;++o)s[o]=new this.dataElementType;this._parsing&&l(i._parsed),this.parse(e,n),r&&this.updateElements(s,e,n,"reset")}updateElements(e,n,r,i){}_removeElements(e,n){const r=this._cachedMeta;if(this._parsing){const i=r._parsed.splice(e,n);r._stacked&&xc(r,i)}r.data.splice(e,n)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[n,r,i]=e;this[n](r,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,n){n&&this._sync(["_removeElements",e,n]);const r=arguments.length-2;r&&this._sync(["_insertElements",e,r])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}re(Ed,"defaults",{}),re(Ed,"datasetElementType",null),re(Ed,"dataElementType",null);class Dp extends Ed{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const n=this._cachedMeta,{dataset:r,data:i=[],_dataset:s}=n,a=this.chart._animationsDisabled;let{start:o,count:l}=KG(n,i,a);this._drawStart=o,this._drawCount=l,YG(n)&&(o=0,l=i.length),r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!s._decimated,r.points=i;const u=this.resolveDatasetElementOptions(e);this.options.showLine||(u.borderWidth=0),u.segment=this.options.segment,this.updateElement(r,void 0,{animated:!a,options:u},e),this.updateElements(i,o,l,e)}updateElements(e,n,r,i){const s=i==="reset",{iScale:a,vScale:o,_stacked:l,_dataset:u}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(n,i),h=a.axis,m=o.axis,{spanGaps:g,segment:w}=this.options,x=ah(g)?g:Number.POSITIVE_INFINITY,v=this.chart._animationsDisabled||s||i==="none",y=n+r,E=e.length;let $=n>0&&this.getParsed(n-1);for(let R=0;R<E;++R){const D=e[R],k=v?D:{};if(R<n||R>=y){k.skip=!0;continue}const _=this.getParsed(R),A=dt(_[m]),N=k[h]=a.getPixelForValue(_[h],R),L=k[m]=s||A?o.getBasePixel():o.getPixelForValue(l?this.applyStack(o,_,l):_[m],R);k.skip=isNaN(N)||isNaN(L)||A,k.stop=R>0&&Math.abs(_[h]-$[h])>x,w&&(k.parsed=_,k.raw=u.data[R]),d&&(k.options=c||this.resolveDataElementOptions(R,D.active?"active":i)),v||this.updateElement(D,R,k,i),$=_}}getMaxOverflow(){const e=this._cachedMeta,n=e.dataset,r=n.options&&n.options.borderWidth||0,i=e.data||[];if(!i.length)return r;const s=i[0].size(this.resolveDataElementOptions(0)),a=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(r,s,a)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}re(Dp,"id","line"),re(Dp,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),re(Dp,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function no(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Cx{constructor(e){re(this,"options");this.options=e||{}}static override(e){Object.assign(Cx.prototype,e)}init(){}formats(){return no()}parse(){return no()}format(){return no()}add(){return no()}diff(){return no()}startOf(){return no()}endOf(){return no()}}var cD={_date:Cx};function dY(t,e,n,r){const{controller:i,data:s,_sorted:a}=t,o=i._cachedMeta.iScale,l=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(o&&e===o.axis&&e!=="r"&&a&&s.length){const u=o._reversePixels?UG:xo;if(r){if(i._sharedOptions){const c=s[0],d=typeof c.getRange=="function"&&c.getRange(e);if(d){const h=u(s,e,n-d),m=u(s,e,n+d);return{lo:h.lo,hi:m.hi}}}}else{const c=u(s,e,n);if(l){const{vScale:d}=i._cachedMeta,{_parsed:h}=t,m=h.slice(0,c.lo+1).reverse().findIndex(w=>!dt(w[d.axis]));c.lo-=Math.max(0,m);const g=h.slice(c.hi).findIndex(w=>!dt(w[d.axis]));c.hi+=Math.max(0,g)}return c}}return{lo:0,hi:s.length-1}}function Bg(t,e,n,r,i){const s=t.getSortedVisibleDatasetMetas(),a=n[e];for(let o=0,l=s.length;o<l;++o){const{index:u,data:c}=s[o],{lo:d,hi:h}=dY(s[o],e,a,i);for(let m=d;m<=h;++m){const g=c[m];g.skip||r(g,u,m)}}}function hY(t){const e=t.indexOf("x")!==-1,n=t.indexOf("y")!==-1;return function(r,i){const s=e?Math.abs(r.x-i.x):0,a=n?Math.abs(r.y-i.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))}}function o_(t,e,n,r,i){const s=[];return!i&&!t.isPointInArea(e)||Bg(t,n,e,function(o,l,u){!i&&!oh(o,t.chartArea,0)||o.inRange(e.x,e.y,r)&&s.push({element:o,datasetIndex:l,index:u})},!0),s}function fY(t,e,n,r){let i=[];function s(a,o,l){const{startAngle:u,endAngle:c}=a.getProps(["startAngle","endAngle"],r),{angle:d}=VG(a,{x:e.x,y:e.y});UO(d,u,c)&&i.push({element:a,datasetIndex:o,index:l})}return Bg(t,n,e,s),i}function pY(t,e,n,r,i,s){let a=[];const o=hY(n);let l=Number.POSITIVE_INFINITY;function u(c,d,h){const m=c.inRange(e.x,e.y,i);if(r&&!m)return;const g=c.getCenterPoint(i);if(!(!!s||t.isPointInArea(g))&&!m)return;const x=o(e,g);x<l?(a=[{element:c,datasetIndex:d,index:h}],l=x):x===l&&a.push({element:c,datasetIndex:d,index:h})}return Bg(t,n,e,u),a}function l_(t,e,n,r,i,s){return!s&&!t.isPointInArea(e)?[]:n==="r"&&!r?fY(t,e,n,i):pY(t,e,n,r,i,s)}function KS(t,e,n,r,i){const s=[],a=n==="x"?"inXRange":"inYRange";let o=!1;return Bg(t,n,e,(l,u,c)=>{l[a]&&l[a](e[n],i)&&(s.push({element:l,datasetIndex:u,index:c}),o=o||l.inRange(e.x,e.y,i))}),r&&!o?[]:s}var mY={modes:{index(t,e,n,r){const i=co(e,t),s=n.axis||"x",a=n.includeInvisible||!1,o=n.intersect?o_(t,i,s,r,a):l_(t,i,s,!1,r,a),l=[];return o.length?(t.getSortedVisibleDatasetMetas().forEach(u=>{const c=o[0].index,d=u.data[c];d&&!d.skip&&l.push({element:d,datasetIndex:u.index,index:c})}),l):[]},dataset(t,e,n,r){const i=co(e,t),s=n.axis||"xy",a=n.includeInvisible||!1;let o=n.intersect?o_(t,i,s,r,a):l_(t,i,s,!1,r,a);if(o.length>0){const l=o[0].datasetIndex,u=t.getDatasetMeta(l).data;o=[];for(let c=0;c<u.length;++c)o.push({element:u[c],datasetIndex:l,index:c})}return o},point(t,e,n,r){const i=co(e,t),s=n.axis||"xy",a=n.includeInvisible||!1;return o_(t,i,s,r,a)},nearest(t,e,n,r){const i=co(e,t),s=n.axis||"xy",a=n.includeInvisible||!1;return l_(t,i,s,n.intersect,r,a)},x(t,e,n,r){const i=co(e,t);return KS(t,i,"x",n.intersect,r)},y(t,e,n,r){const i=co(e,t);return KS(t,i,"y",n.intersect,r)}}};const dD=["left","top","right","bottom"];function Tc(t,e){return t.filter(n=>n.pos===e)}function YS(t,e){return t.filter(n=>dD.indexOf(n.pos)===-1&&n.box.axis===e)}function Ec(t,e){return t.sort((n,r)=>{const i=e?r:n,s=e?n:r;return i.weight===s.weight?i.index-s.index:i.weight-s.weight})}function gY(t){const e=[];let n,r,i,s,a,o;for(n=0,r=(t||[]).length;n<r;++n)i=t[n],{position:s,options:{stack:a,stackWeight:o=1}}=i,e.push({index:n,box:i,pos:s,horizontal:i.isHorizontal(),weight:i.weight,stack:a&&s+a,stackWeight:o});return e}function yY(t){const e={};for(const n of t){const{stack:r,pos:i,stackWeight:s}=n;if(!r||!dD.includes(i))continue;const a=e[r]||(e[r]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=s}return e}function _Y(t,e){const n=yY(t),{vBoxMaxWidth:r,hBoxMaxHeight:i}=e;let s,a,o;for(s=0,a=t.length;s<a;++s){o=t[s];const{fullSize:l}=o.box,u=n[o.stack],c=u&&o.stackWeight/u.weight;o.horizontal?(o.width=c?c*r:l&&e.availableWidth,o.height=i):(o.width=r,o.height=c?c*i:l&&e.availableHeight)}return n}function wY(t){const e=gY(t),n=Ec(e.filter(u=>u.box.fullSize),!0),r=Ec(Tc(e,"left"),!0),i=Ec(Tc(e,"right")),s=Ec(Tc(e,"top"),!0),a=Ec(Tc(e,"bottom")),o=YS(e,"x"),l=YS(e,"y");return{fullSize:n,leftAndTop:r.concat(s),rightAndBottom:i.concat(l).concat(a).concat(o),chartArea:Tc(e,"chartArea"),vertical:r.concat(i).concat(l),horizontal:s.concat(a).concat(o)}}function QS(t,e,n,r){return Math.max(t[n],e[n])+Math.max(t[r],e[r])}function hD(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function vY(t,e,n,r){const{pos:i,box:s}=n,a=t.maxPadding;if(!We(i)){n.size&&(t[i]-=n.size);const d=r[n.stack]||{size:0,count:1};d.size=Math.max(d.size,n.horizontal?s.height:s.width),n.size=d.size/d.count,t[i]+=n.size}s.getPadding&&hD(a,s.getPadding());const o=Math.max(0,e.outerWidth-QS(a,t,"left","right")),l=Math.max(0,e.outerHeight-QS(a,t,"top","bottom")),u=o!==t.w,c=l!==t.h;return t.w=o,t.h=l,n.horizontal?{same:u,other:c}:{same:c,other:u}}function bY(t){const e=t.maxPadding;function n(r){const i=Math.max(e[r]-t[r],0);return t[r]+=i,i}t.y+=n("top"),t.x+=n("left"),n("right"),n("bottom")}function xY(t,e){const n=e.maxPadding;function r(i){const s={left:0,top:0,right:0,bottom:0};return i.forEach(a=>{s[a]=Math.max(e[a],n[a])}),s}return r(t?["left","right"]:["top","bottom"])}function Xc(t,e,n,r){const i=[];let s,a,o,l,u,c;for(s=0,a=t.length,u=0;s<a;++s){o=t[s],l=o.box,l.update(o.width||e.w,o.height||e.h,xY(o.horizontal,e));const{same:d,other:h}=vY(e,n,o,r);u|=d&&i.length,c=c||h,l.fullSize||i.push(o)}return u&&Xc(i,e,n,r)||c}function Gf(t,e,n,r,i){t.top=n,t.left=e,t.right=e+r,t.bottom=n+i,t.width=r,t.height=i}function XS(t,e,n,r){const i=n.padding;let{x:s,y:a}=e;for(const o of t){const l=o.box,u=r[o.stack]||{placed:0,weight:1},c=o.stackWeight/u.weight||1;if(o.horizontal){const d=e.w*c,h=u.size||l.height;Mm(u.start)&&(a=u.start),l.fullSize?Gf(l,i.left,a,n.outerWidth-i.right-i.left,h):Gf(l,e.left+u.placed,a,d,h),u.start=a,u.placed+=d,a=l.bottom}else{const d=e.h*c,h=u.size||l.width;Mm(u.start)&&(s=u.start),l.fullSize?Gf(l,s,i.top,h,n.outerHeight-i.bottom-i.top):Gf(l,s,e.top+u.placed,h,d),u.start=s,u.placed+=d,s=l.right}}e.x=s,e.y=a}var ra={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(n){e.draw(n)}}]},t.boxes.push(e)},removeBox(t,e){const n=t.boxes?t.boxes.indexOf(e):-1;n!==-1&&t.boxes.splice(n,1)},configure(t,e,n){e.fullSize=n.fullSize,e.position=n.position,e.weight=n.weight},update(t,e,n,r){if(!t)return;const i=ei(t.options.layout.padding),s=Math.max(e-i.width,0),a=Math.max(n-i.height,0),o=wY(t.boxes),l=o.vertical,u=o.horizontal;tt(t.boxes,w=>{typeof w.beforeLayout=="function"&&w.beforeLayout()});const c=l.reduce((w,x)=>x.box.options&&x.box.options.display===!1?w:w+1,0)||1,d=Object.freeze({outerWidth:e,outerHeight:n,padding:i,availableWidth:s,availableHeight:a,vBoxMaxWidth:s/2/c,hBoxMaxHeight:a/2}),h=Object.assign({},i);hD(h,ei(r));const m=Object.assign({maxPadding:h,w:s,h:a,x:i.left,y:i.top},i),g=_Y(l.concat(u),d);Xc(o.fullSize,m,d,g),Xc(l,m,d,g),Xc(u,m,d,g)&&Xc(l,m,d,g),bY(m),XS(o.leftAndTop,m,d,g),m.x+=m.w,m.y+=m.h,XS(o.rightAndBottom,m,d,g),t.chartArea={left:m.left,top:m.top,right:m.left+m.w,bottom:m.top+m.h,height:m.h,width:m.w},tt(o.chartArea,w=>{const x=w.box;Object.assign(x,t.chartArea),x.update(m.w,m.h,{left:0,top:0,right:0,bottom:0})})}};class fD{acquireContext(e,n){}releaseContext(e){return!1}addEventListener(e,n,r){}removeEventListener(e,n,r){}getDevicePixelRatio(){return 1}getMaximumSize(e,n,r,i){return n=Math.max(0,n||e.width),r=r||e.height,{width:n,height:Math.max(0,i?Math.floor(n/i):r)}}isAttached(e){return!0}updateConfig(e){}}class TY extends fD{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Mp="$chartjs",EY={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},JS=t=>t===null||t==="";function SY(t,e){const n=t.style,r=t.getAttribute("height"),i=t.getAttribute("width");if(t[Mp]={initial:{height:r,width:i,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",JS(i)){const s=zS(t,"width");s!==void 0&&(t.width=s)}if(JS(r))if(t.style.height==="")t.height=t.width/(e||2);else{const s=zS(t,"height");s!==void 0&&(t.height=s)}return t}const pD=VK?{passive:!0}:!1;function IY(t,e,n){t&&t.addEventListener(e,n,pD)}function kY(t,e,n){t&&t.canvas&&t.canvas.removeEventListener(e,n,pD)}function $Y(t,e){const n=EY[t.type]||t.type,{x:r,y:i}=co(t,e);return{type:n,chart:e,native:t,x:r!==void 0?r:null,y:i!==void 0?i:null}}function Fm(t,e){for(const n of t)if(n===e||n.contains(e))return!0}function CY(t,e,n){const r=t.canvas,i=new MutationObserver(s=>{let a=!1;for(const o of s)a=a||Fm(o.addedNodes,r),a=a&&!Fm(o.removedNodes,r);a&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}function AY(t,e,n){const r=t.canvas,i=new MutationObserver(s=>{let a=!1;for(const o of s)a=a||Fm(o.removedNodes,r),a=a&&!Fm(o.addedNodes,r);a&&n()});return i.observe(document,{childList:!0,subtree:!0}),i}const lh=new Map;let ZS=0;function mD(){const t=window.devicePixelRatio;t!==ZS&&(ZS=t,lh.forEach((e,n)=>{n.currentDevicePixelRatio!==t&&e()}))}function RY(t,e){lh.size||window.addEventListener("resize",mD),lh.set(t,e)}function PY(t){lh.delete(t),lh.size||window.removeEventListener("resize",mD)}function NY(t,e,n){const r=t.canvas,i=r&&$x(r);if(!i)return;const s=HO((o,l)=>{const u=i.clientWidth;n(o,l),u<i.clientWidth&&n()},window),a=new ResizeObserver(o=>{const l=o[0],u=l.contentRect.width,c=l.contentRect.height;u===0&&c===0||s(u,c)});return a.observe(i),RY(t,s),a}function u_(t,e,n){n&&n.disconnect(),e==="resize"&&PY(t)}function OY(t,e,n){const r=t.canvas,i=HO(s=>{t.ctx!==null&&n($Y(s,t))},t);return IY(r,e,i),i}class DY extends fD{acquireContext(e,n){const r=e&&e.getContext&&e.getContext("2d");return r&&r.canvas===e?(SY(e,n),r):null}releaseContext(e){const n=e.canvas;if(!n[Mp])return!1;const r=n[Mp].initial;["height","width"].forEach(s=>{const a=r[s];dt(a)?n.removeAttribute(s):n.setAttribute(s,a)});const i=r.style||{};return Object.keys(i).forEach(s=>{n.style[s]=i[s]}),n.width=n.width,delete n[Mp],!0}addEventListener(e,n,r){this.removeEventListener(e,n);const i=e.$proxies||(e.$proxies={}),a={attach:CY,detach:AY,resize:NY}[n]||OY;i[n]=a(e,n,r)}removeEventListener(e,n){const r=e.$proxies||(e.$proxies={}),i=r[n];if(!i)return;({attach:u_,detach:u_,resize:u_}[n]||kY)(e,n,i),r[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,n,r,i){return zK(e,n,r,i)}isAttached(e){const n=e&&$x(e);return!!(n&&n.isConnected)}}function MY(t){return!kx()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?TY:DY}class Aa{constructor(){re(this,"x");re(this,"y");re(this,"active",!1);re(this,"options");re(this,"$animations")}tooltipPosition(e){const{x:n,y:r}=this.getProps(["x","y"],e);return{x:n,y:r}}hasValue(){return ah(this.x)&&ah(this.y)}getProps(e,n){const r=this.$animations;if(!n||!r)return this;const i={};return e.forEach(s=>{i[s]=r[s]&&r[s].active()?r[s]._to:this[s]}),i}}re(Aa,"defaults",{}),re(Aa,"defaultRoutes");function LY(t,e){const n=t.options.ticks,r=zY(t),i=Math.min(n.maxTicksLimit||r,r),s=n.major.enabled?FY(e):[],a=s.length,o=s[0],l=s[a-1],u=[];if(a>i)return BY(e,u,s,a/i),u;const c=VY(s,e,i);if(a>0){let d,h;const m=a>1?Math.round((l-o)/(a-1)):null;for(Kf(e,u,c,dt(m)?0:o-m,o),d=0,h=a-1;d<h;d++)Kf(e,u,c,s[d],s[d+1]);return Kf(e,u,c,l,dt(m)?e.length:l+m),u}return Kf(e,u,c),u}function zY(t){const e=t.options.offset,n=t._tickSize(),r=t._length/n+(e?0:1),i=t._maxLength/n;return Math.floor(Math.min(r,i))}function VY(t,e,n){const r=UY(t),i=e.length/n;if(!r)return Math.max(i,1);const s=OG(r);for(let a=0,o=s.length-1;a<o;a++){const l=s[a];if(l>i)return l}return Math.max(i,1)}function FY(t){const e=[];let n,r;for(n=0,r=t.length;n<r;n++)t[n].major&&e.push(n);return e}function BY(t,e,n,r){let i=0,s=n[0],a;for(r=Math.ceil(r),a=0;a<t.length;a++)a===s&&(e.push(t[a]),i++,s=n[i*r])}function Kf(t,e,n,r,i){const s=Be(r,0),a=Math.min(Be(i,t.length),t.length);let o=0,l,u,c;for(n=Math.ceil(n),i&&(l=i-r,n=l/Math.floor(l/n)),c=s;c<0;)o++,c=Math.round(s+o*n);for(u=Math.max(s,0);u<a;u++)u===c&&(e.push(t[u]),o++,c=Math.round(s+o*n))}function UY(t){const e=t.length;let n,r;if(e<2)return!1;for(r=t[0],n=1;n<e;++n)if(t[n]-t[n-1]!==r)return!1;return r}const jY=t=>t==="left"?"right":t==="right"?"left":t,eI=(t,e,n)=>e==="top"||e==="left"?t[e]+n:t[e]-n,tI=(t,e)=>Math.min(e||t,t);function nI(t,e){const n=[],r=t.length/e,i=t.length;let s=0;for(;s<i;s+=r)n.push(t[Math.floor(s)]);return n}function WY(t,e,n){const r=t.ticks.length,i=Math.min(e,r-1),s=t._startPixel,a=t._endPixel,o=1e-6;let l=t.getPixelForTick(i),u;if(!(n&&(r===1?u=Math.max(l-s,a-l):e===0?u=(t.getPixelForTick(1)-l)/2:u=(l-t.getPixelForTick(i-1))/2,l+=i<e?u:-u,l<s-o||l>a+o)))return l}function HY(t,e){tt(t,n=>{const r=n.gc,i=r.length/2;let s;if(i>e){for(s=0;s<i;++s)delete n.data[r[s]];r.splice(0,i)}})}function Sc(t){return t.drawTicks?t.tickLength:0}function rI(t,e){if(!t.display)return 0;const n=qn(t.font,e),r=ei(t.padding);return(tn(t.text)?t.text.length:1)*n.lineHeight+r.height}function qY(t,e){return Jo(t,{scale:e,type:"scale"})}function GY(t,e,n){return Jo(t,{tick:n,index:e,type:"tick"})}function KY(t,e,n){let r=qO(t);return(n&&e!=="right"||!n&&e==="right")&&(r=jY(r)),r}function YY(t,e,n,r){const{top:i,left:s,bottom:a,right:o,chart:l}=t,{chartArea:u,scales:c}=l;let d=0,h,m,g;const w=a-i,x=o-s;if(t.isHorizontal()){if(m=er(r,s,o),We(n)){const v=Object.keys(n)[0],y=n[v];g=c[v].getPixelForValue(y)+w-e}else n==="center"?g=(u.bottom+u.top)/2+w-e:g=eI(t,n,e);h=o-s}else{if(We(n)){const v=Object.keys(n)[0],y=n[v];m=c[v].getPixelForValue(y)-x+e}else n==="center"?m=(u.left+u.right)/2-x+e:m=eI(t,n,e);g=er(r,a,i),d=n==="left"?-Wr:Wr}return{titleX:m,titleY:g,maxWidth:h,rotation:d}}class Fu extends Aa{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,n){return e}getUserBounds(){let{_userMin:e,_userMax:n,_suggestedMin:r,_suggestedMax:i}=this;return e=pi(e,Number.POSITIVE_INFINITY),n=pi(n,Number.NEGATIVE_INFINITY),r=pi(r,Number.POSITIVE_INFINITY),i=pi(i,Number.NEGATIVE_INFINITY),{min:pi(e,r),max:pi(n,i),minDefined:Tn(e),maxDefined:Tn(n)}}getMinMax(e){let{min:n,max:r,minDefined:i,maxDefined:s}=this.getUserBounds(),a;if(i&&s)return{min:n,max:r};const o=this.getMatchingVisibleMetas();for(let l=0,u=o.length;l<u;++l)a=o[l].controller.getMinMax(this,e),i||(n=Math.min(n,a.min)),s||(r=Math.max(r,a.max));return n=s&&n>r?r:n,r=i&&n>r?n:r,{min:pi(n,pi(r,n)),max:pi(r,pi(n,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ft(this.options.beforeUpdate,[this])}update(e,n,r){const{beginAtZero:i,grace:s,ticks:a}=this.options,o=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=n,this._margins=r=Object.assign({left:0,right:0,top:0,bottom:0},r),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+r.left+r.right:this.height+r.top+r.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=gK(this,s,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=o<this.ticks.length;this._convertTicksToLabels(l?nI(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=LY(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,n,r;this.isHorizontal()?(n=this.left,r=this.right):(n=this.top,r=this.bottom,e=!e),this._startPixel=n,this._endPixel=r,this._reversePixels=e,this._length=r-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ft(this.options.afterUpdate,[this])}beforeSetDimensions(){ft(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ft(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),ft(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ft(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const n=this.options.ticks;let r,i,s;for(r=0,i=e.length;r<i;r++)s=e[r],s.label=ft(n.callback,[s.value,r,e],this)}afterTickToLabelConversion(){ft(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ft(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,n=e.ticks,r=tI(this.ticks.length,e.ticks.maxTicksLimit),i=n.minRotation||0,s=n.maxRotation;let a=i,o,l,u;if(!this._isVisible()||!n.display||i>=s||r<=1||!this.isHorizontal()){this.labelRotation=i;return}const c=this._getLabelSizes(),d=c.widest.width,h=c.highest.height,m=wr(this.chart.width-d,0,this.maxWidth);o=e.offset?this.maxWidth/r:m/(r-1),d+6>o&&(o=m/(r-(e.offset?.5:1)),l=this.maxHeight-Sc(e.grid)-n.padding-rI(e.title,this.chart.options.font),u=Math.sqrt(d*d+h*h),a=zG(Math.min(Math.asin(wr((c.highest.height+6)/o,-1,1)),Math.asin(wr(l/u,-1,1))-Math.asin(wr(h/u,-1,1)))),a=Math.max(i,Math.min(s,a))),this.labelRotation=a}afterCalculateLabelRotation(){ft(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ft(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:n,options:{ticks:r,title:i,grid:s}}=this,a=this._isVisible(),o=this.isHorizontal();if(a){const l=rI(i,n.options.font);if(o?(e.width=this.maxWidth,e.height=Sc(s)+l):(e.height=this.maxHeight,e.width=Sc(s)+l),r.display&&this.ticks.length){const{first:u,last:c,widest:d,highest:h}=this._getLabelSizes(),m=r.padding*2,g=bo(this.labelRotation),w=Math.cos(g),x=Math.sin(g);if(o){const v=r.mirror?0:x*d.width+w*h.height;e.height=Math.min(this.maxHeight,e.height+v+m)}else{const v=r.mirror?0:w*d.width+x*h.height;e.width=Math.min(this.maxWidth,e.width+v+m)}this._calculatePadding(u,c,x,w)}}this._handleMargins(),o?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,n,r,i){const{ticks:{align:s,padding:a},position:o}=this.options,l=this.labelRotation!==0,u=o!=="top"&&this.axis==="x";if(this.isHorizontal()){const c=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,m=0;l?u?(h=i*e.width,m=r*n.height):(h=r*e.height,m=i*n.width):s==="start"?m=n.width:s==="end"?h=e.width:s!=="inner"&&(h=e.width/2,m=n.width/2),this.paddingLeft=Math.max((h-c+a)*this.width/(this.width-c),0),this.paddingRight=Math.max((m-d+a)*this.width/(this.width-d),0)}else{let c=n.height/2,d=e.height/2;s==="start"?(c=0,d=e.height):s==="end"&&(c=n.height,d=0),this.paddingTop=c+a,this.paddingBottom=d+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ft(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:n}=this.options;return n==="top"||n==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let n,r;for(n=0,r=e.length;n<r;n++)dt(e[n].label)&&(e.splice(n,1),r--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const n=this.options.ticks.sampleSize;let r=this.ticks;n<r.length&&(r=nI(r,n)),this._labelSizes=e=this._computeLabelSizes(r,r.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,n,r){const{ctx:i,_longestTextCache:s}=this,a=[],o=[],l=Math.floor(n/tI(n,r));let u=0,c=0,d,h,m,g,w,x,v,y,E,$,R;for(d=0;d<n;d+=l){if(g=e[d].label,w=this._resolveTickFontOptions(d),i.font=x=w.string,v=s[x]=s[x]||{data:{},gc:[]},y=w.lineHeight,E=$=0,!dt(g)&&!tn(g))E=NS(i,v.data,v.gc,E,g),$=y;else if(tn(g))for(h=0,m=g.length;h<m;++h)R=g[h],!dt(R)&&!tn(R)&&(E=NS(i,v.data,v.gc,E,R),$+=y);a.push(E),o.push($),u=Math.max(E,u),c=Math.max($,c)}HY(s,n);const D=a.indexOf(u),k=o.indexOf(c),_=A=>({width:a[A]||0,height:o[A]||0});return{first:_(0),last:_(n-1),widest:_(D),highest:_(k),widths:a,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,n){return NaN}getValueForPixel(e){}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const n=this._startPixel+e*this._length;return BG(this._alignToPixels?to(this.chart,n,0):n)}getDecimalForPixel(e){const n=(e-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:n}=this;return e<0&&n<0?n:e>0&&n>0?e:0}getContext(e){const n=this.ticks||[];if(e>=0&&e<n.length){const r=n[e];return r.$context||(r.$context=GY(this.getContext(),e,r))}return this.$context||(this.$context=qY(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,n=bo(this.labelRotation),r=Math.abs(Math.cos(n)),i=Math.abs(Math.sin(n)),s=this._getLabelSizes(),a=e.autoSkipPadding||0,o=s?s.widest.width+a:0,l=s?s.highest.height+a:0;return this.isHorizontal()?l*r>o*i?o/r:l/i:l*i<o*r?l/r:o/i}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const n=this.axis,r=this.chart,i=this.options,{grid:s,position:a,border:o}=i,l=s.offset,u=this.isHorizontal(),d=this.ticks.length+(l?1:0),h=Sc(s),m=[],g=o.setContext(this.getContext()),w=g.display?g.width:0,x=w/2,v=function(ie){return to(r,ie,w)};let y,E,$,R,D,k,_,A,N,L,V,M;if(a==="top")y=v(this.bottom),k=this.bottom-h,A=y-x,L=v(e.top)+x,M=e.bottom;else if(a==="bottom")y=v(this.top),L=e.top,M=v(e.bottom)-x,k=y+x,A=this.top+h;else if(a==="left")y=v(this.right),D=this.right-h,_=y-x,N=v(e.left)+x,V=e.right;else if(a==="right")y=v(this.left),N=e.left,V=v(e.right)-x,D=y+x,_=this.left+h;else if(n==="x"){if(a==="center")y=v((e.top+e.bottom)/2+.5);else if(We(a)){const ie=Object.keys(a)[0],de=a[ie];y=v(this.chart.scales[ie].getPixelForValue(de))}L=e.top,M=e.bottom,k=y+x,A=k+h}else if(n==="y"){if(a==="center")y=v((e.left+e.right)/2);else if(We(a)){const ie=Object.keys(a)[0],de=a[ie];y=v(this.chart.scales[ie].getPixelForValue(de))}D=y-x,_=D-h,N=e.left,V=e.right}const B=Be(i.ticks.maxTicksLimit,d),Z=Math.max(1,Math.ceil(d/B));for(E=0;E<d;E+=Z){const ie=this.getContext(E),de=s.setContext(ie),ee=o.setContext(ie),Y=de.lineWidth,J=de.color,G=ee.dash||[],H=ee.dashOffset,oe=de.tickWidth,ue=de.tickColor,Ne=de.tickBorderDash||[],rt=de.tickBorderDashOffset;$=WY(this,E,l),$!==void 0&&(R=to(r,$,Y),u?D=_=N=V=R:k=A=L=M=R,m.push({tx1:D,ty1:k,tx2:_,ty2:A,x1:N,y1:L,x2:V,y2:M,width:Y,color:J,borderDash:G,borderDashOffset:H,tickWidth:oe,tickColor:ue,tickBorderDash:Ne,tickBorderDashOffset:rt}))}return this._ticksLength=d,this._borderValue=y,m}_computeLabelItems(e){const n=this.axis,r=this.options,{position:i,ticks:s}=r,a=this.isHorizontal(),o=this.ticks,{align:l,crossAlign:u,padding:c,mirror:d}=s,h=Sc(r.grid),m=h+c,g=d?-c:m,w=-bo(this.labelRotation),x=[];let v,y,E,$,R,D,k,_,A,N,L,V,M="middle";if(i==="top")D=this.bottom-g,k=this._getXAxisLabelAlignment();else if(i==="bottom")D=this.top+g,k=this._getXAxisLabelAlignment();else if(i==="left"){const Z=this._getYAxisLabelAlignment(h);k=Z.textAlign,R=Z.x}else if(i==="right"){const Z=this._getYAxisLabelAlignment(h);k=Z.textAlign,R=Z.x}else if(n==="x"){if(i==="center")D=(e.top+e.bottom)/2+m;else if(We(i)){const Z=Object.keys(i)[0],ie=i[Z];D=this.chart.scales[Z].getPixelForValue(ie)+m}k=this._getXAxisLabelAlignment()}else if(n==="y"){if(i==="center")R=(e.left+e.right)/2-m;else if(We(i)){const Z=Object.keys(i)[0],ie=i[Z];R=this.chart.scales[Z].getPixelForValue(ie)}k=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?M="top":l==="end"&&(M="bottom"));const B=this._getLabelSizes();for(v=0,y=o.length;v<y;++v){E=o[v],$=E.label;const Z=s.setContext(this.getContext(v));_=this.getPixelForTick(v)+s.labelOffset,A=this._resolveTickFontOptions(v),N=A.lineHeight,L=tn($)?$.length:1;const ie=L/2,de=Z.color,ee=Z.textStrokeColor,Y=Z.textStrokeWidth;let J=k;a?(R=_,k==="inner"&&(v===y-1?J=this.options.reverse?"left":"right":v===0?J=this.options.reverse?"right":"left":J="center"),i==="top"?u==="near"||w!==0?V=-L*N+N/2:u==="center"?V=-B.highest.height/2-ie*N+N:V=-B.highest.height+N/2:u==="near"||w!==0?V=N/2:u==="center"?V=B.highest.height/2-ie*N:V=B.highest.height-L*N,d&&(V*=-1),w!==0&&!Z.showLabelBackdrop&&(R+=N/2*Math.sin(w))):(D=_,V=(1-L)*N/2);let G;if(Z.showLabelBackdrop){const H=ei(Z.backdropPadding),oe=B.heights[v],ue=B.widths[v];let Ne=V-H.top,rt=0-H.left;switch(M){case"middle":Ne-=oe/2;break;case"bottom":Ne-=oe;break}switch(k){case"center":rt-=ue/2;break;case"right":rt-=ue;break;case"inner":v===y-1?rt-=ue:v>0&&(rt-=ue/2);break}G={left:rt,top:Ne,width:ue+H.width,height:oe+H.height,color:Z.backdropColor}}x.push({label:$,font:A,textOffset:V,options:{rotation:w,color:de,strokeColor:ee,strokeWidth:Y,textAlign:J,textBaseline:M,translation:[R,D],backdrop:G}})}return x}_getXAxisLabelAlignment(){const{position:e,ticks:n}=this.options;if(-bo(this.labelRotation))return e==="top"?"left":"right";let i="center";return n.align==="start"?i="left":n.align==="end"?i="right":n.align==="inner"&&(i="inner"),i}_getYAxisLabelAlignment(e){const{position:n,ticks:{crossAlign:r,mirror:i,padding:s}}=this.options,a=this._getLabelSizes(),o=e+s,l=a.widest.width;let u,c;return n==="left"?i?(c=this.right+s,r==="near"?u="left":r==="center"?(u="center",c+=l/2):(u="right",c+=l)):(c=this.right-o,r==="near"?u="right":r==="center"?(u="center",c-=l/2):(u="left",c=this.left)):n==="right"?i?(c=this.left+s,r==="near"?u="right":r==="center"?(u="center",c-=l/2):(u="left",c-=l)):(c=this.left+o,r==="near"?u="left":r==="center"?(u="center",c+=l/2):(u="right",c=this.right)):u="right",{textAlign:u,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:n},left:r,top:i,width:s,height:a}=this;n&&(e.save(),e.fillStyle=n,e.fillRect(r,i,s,a),e.restore())}getLineWidthForValue(e){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const i=this.ticks.findIndex(s=>s.value===e);return i>=0?n.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){const n=this.options.grid,r=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,a;const o=(l,u,c)=>{!c.width||!c.color||(r.save(),r.lineWidth=c.width,r.strokeStyle=c.color,r.setLineDash(c.borderDash||[]),r.lineDashOffset=c.borderDashOffset,r.beginPath(),r.moveTo(l.x,l.y),r.lineTo(u.x,u.y),r.stroke(),r.restore())};if(n.display)for(s=0,a=i.length;s<a;++s){const l=i[s];n.drawOnChartArea&&o({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&o({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:n,options:{border:r,grid:i}}=this,s=r.setContext(this.getContext()),a=r.display?s.width:0;if(!a)return;const o=i.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let u,c,d,h;this.isHorizontal()?(u=to(e,this.left,a)-a/2,c=to(e,this.right,o)+o/2,d=h=l):(d=to(e,this.top,a)-a/2,h=to(e,this.bottom,o)+o/2,u=c=l),n.save(),n.lineWidth=s.width,n.strokeStyle=s.color,n.beginPath(),n.moveTo(u,d),n.lineTo(c,h),n.stroke(),n.restore()}drawLabels(e){if(!this.options.ticks.display)return;const r=this.ctx,i=this._computeLabelArea();i&&zg(r,i);const s=this.getLabelItems(e);for(const a of s){const o=a.options,l=a.font,u=a.label,c=a.textOffset;zm(r,u,0,c,l,o)}i&&Vg(r)}drawTitle(){const{ctx:e,options:{position:n,title:r,reverse:i}}=this;if(!r.display)return;const s=qn(r.font),a=ei(r.padding),o=r.align;let l=s.lineHeight/2;n==="bottom"||n==="center"||We(n)?(l+=a.bottom,tn(r.text)&&(l+=s.lineHeight*(r.text.length-1))):l+=a.top;const{titleX:u,titleY:c,maxWidth:d,rotation:h}=YY(this,l,n,o);zm(e,r.text,0,0,s,{color:r.color,maxWidth:d,rotation:h,textAlign:KY(o,n,i),textBaseline:"middle",translation:[u,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,n=e.ticks&&e.ticks.z||0,r=Be(e.grid&&e.grid.z,-1),i=Be(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Fu.prototype.draw?[{z:n,draw:s=>{this.draw(s)}}]:[{z:r,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:n,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(e){const n=this.chart.getSortedVisibleDatasetMetas(),r=this.axis+"AxisID",i=[];let s,a;for(s=0,a=n.length;s<a;++s){const o=n[s];o[r]===this.id&&(!e||o.type===e)&&i.push(o)}return i}_resolveTickFontOptions(e){const n=this.options.ticks.setContext(this.getContext(e));return qn(n.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class Yf{constructor(e,n,r){this.type=e,this.scope=n,this.override=r,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const n=Object.getPrototypeOf(e);let r;JY(n)&&(r=this.register(n));const i=this.items,s=e.id,a=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in i||(i[s]=e,QY(e,a,r),this.override&&Mt.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const n=this.items,r=e.id,i=this.scope;r in n&&delete n[r],i&&r in Mt[i]&&(delete Mt[i][r],this.override&&delete Bo[r])}}function QY(t,e,n){const r=sh(Object.create(null),[n?Mt.get(n):{},Mt.get(e),t.defaults]);Mt.set(e,r),t.defaultRoutes&&XY(e,t.defaultRoutes),t.descriptors&&Mt.describe(e,t.descriptors)}function XY(t,e){Object.keys(e).forEach(n=>{const r=n.split("."),i=r.pop(),s=[t].concat(r).join("."),a=e[n].split("."),o=a.pop(),l=a.join(".");Mt.route(s,i,l,o)})}function JY(t){return"id"in t&&"defaults"in t}class ZY{constructor(){this.controllers=new Yf(Ed,"datasets",!0),this.elements=new Yf(Aa,"elements"),this.plugins=new Yf(Object,"plugins"),this.scales=new Yf(Fu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,n,r){[...n].forEach(i=>{const s=r||this._getRegistryForType(i);r||s.isForType(i)||s===this.plugins&&i.id?this._exec(e,s,i):tt(i,a=>{const o=r||this._getRegistryForType(a);this._exec(e,o,a)})})}_exec(e,n,r){const i=bx(e);ft(r["before"+i],[],r),n[e](r),ft(r["after"+i],[],r)}_getRegistryForType(e){for(let n=0;n<this._typedRegistries.length;n++){const r=this._typedRegistries[n];if(r.isForType(e))return r}return this.plugins}_get(e,n,r){const i=n.get(e);if(i===void 0)throw new Error('"'+e+'" is not a registered '+r+".");return i}}var _i=new ZY;class eQ{constructor(){this._init=void 0}notify(e,n,r,i){if(n==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),this._init===void 0)return;const s=i?this._descriptors(e).filter(i):this._descriptors(e),a=this._notify(s,e,n,r);return n==="afterDestroy"&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),a}_notify(e,n,r,i){i=i||{};for(const s of e){const a=s.plugin,o=a[r],l=[n,i,s.options];if(ft(o,l,a)===!1&&i.cancelable)return!1}return!0}invalidate(){dt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),n}_createDescriptors(e,n){const r=e&&e.config,i=Be(r.options&&r.options.plugins,{}),s=tQ(r);return i===!1&&!n?[]:rQ(e,s,i,n)}_notifyStateChanges(e){const n=this._oldCache||[],r=this._cache,i=(s,a)=>s.filter(o=>!a.some(l=>o.plugin.id===l.plugin.id));this._notify(i(n,r),e,"stop"),this._notify(i(r,n),e,"start")}}function tQ(t){const e={},n=[],r=Object.keys(_i.plugins.items);for(let s=0;s<r.length;s++)n.push(_i.getPlugin(r[s]));const i=t.plugins||[];for(let s=0;s<i.length;s++){const a=i[s];n.indexOf(a)===-1&&(n.push(a),e[a.id]=!0)}return{plugins:n,localIds:e}}function nQ(t,e){return!e&&t===!1?null:t===!0?{}:t}function rQ(t,{plugins:e,localIds:n},r,i){const s=[],a=t.getContext();for(const o of e){const l=o.id,u=nQ(r[l],i);u!==null&&s.push({plugin:o,options:iQ(t.config,{plugin:o,local:n[l]},u,a)})}return s}function iQ(t,{plugin:e,local:n},r,i){const s=t.pluginScopeKeys(e),a=t.getOptionScopes(r,s);return n&&e.defaults&&a.push(e.defaults),t.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Uw(t,e){const n=Mt.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||n.indexAxis||"x"}function sQ(t,e){let n=t;return t==="_index_"?n=e:t==="_value_"&&(n=e==="x"?"y":"x"),n}function aQ(t,e){return t===e?"_index_":"_value_"}function iI(t){if(t==="x"||t==="y"||t==="r")return t}function oQ(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function jw(t,...e){if(iI(t))return t;for(const n of e){const r=n.axis||oQ(n.position)||t.length>1&&iI(t[0].toLowerCase());if(r)return r}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function sI(t,e,n){if(n[e+"AxisID"]===t)return{axis:e}}function lQ(t,e){if(e.data&&e.data.datasets){const n=e.data.datasets.filter(r=>r.xAxisID===t||r.yAxisID===t);if(n.length)return sI(t,"x",n[0])||sI(t,"y",n[0])}return{}}function uQ(t,e){const n=Bo[t.type]||{scales:{}},r=e.scales||{},i=Uw(t.type,e),s=Object.create(null);return Object.keys(r).forEach(a=>{const o=r[a];if(!We(o))return console.error(`Invalid scale configuration for scale: ${a}`);if(o._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const l=jw(a,o,lQ(a,t),Mt.scales[o.type]),u=aQ(l,i),c=n.scales||{};s[a]=wd(Object.create(null),[{axis:l},o,c[l],c[u]])}),t.data.datasets.forEach(a=>{const o=a.type||t.type,l=a.indexAxis||Uw(o,e),c=(Bo[o]||{}).scales||{};Object.keys(c).forEach(d=>{const h=sQ(d,l),m=a[h+"AxisID"]||h;s[m]=s[m]||Object.create(null),wd(s[m],[{axis:h},r[m],c[d]])})}),Object.keys(s).forEach(a=>{const o=s[a];wd(o,[Mt.scales[o.type],Mt.scale])}),s}function gD(t){const e=t.options||(t.options={});e.plugins=Be(e.plugins,{}),e.scales=uQ(t,e)}function yD(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function cQ(t){return t=t||{},t.data=yD(t.data),gD(t),t}const aI=new Map,_D=new Set;function Qf(t,e){let n=aI.get(t);return n||(n=e(),aI.set(t,n),_D.add(n)),n}const Ic=(t,e,n)=>{const r=Dm(e,n);r!==void 0&&t.add(r)};class dQ{constructor(e){this._config=cQ(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=yD(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),gD(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Qf(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,n){return Qf(`${e}.transition.${n}`,()=>[[`datasets.${e}.transitions.${n}`,`transitions.${n}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,n){return Qf(`${e}-${n}`,()=>[[`datasets.${e}.elements.${n}`,`datasets.${e}`,`elements.${n}`,""]])}pluginScopeKeys(e){const n=e.id,r=this.type;return Qf(`${r}-plugin-${n}`,()=>[[`plugins.${n}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,n){const r=this._scopeCache;let i=r.get(e);return(!i||n)&&(i=new Map,r.set(e,i)),i}getOptionScopes(e,n,r){const{options:i,type:s}=this,a=this._cachedScopes(e,r),o=a.get(n);if(o)return o;const l=new Set;n.forEach(c=>{e&&(l.add(e),c.forEach(d=>Ic(l,e,d))),c.forEach(d=>Ic(l,i,d)),c.forEach(d=>Ic(l,Bo[s]||{},d)),c.forEach(d=>Ic(l,Mt,d)),c.forEach(d=>Ic(l,Vw,d))});const u=Array.from(l);return u.length===0&&u.push(Object.create(null)),_D.has(n)&&a.set(n,u),u}chartOptionScopes(){const{options:e,type:n}=this;return[e,Bo[n]||{},Mt.datasets[n]||{},{type:n},Mt,Vw]}resolveNamedOptions(e,n,r,i=[""]){const s={$shared:!0},{resolver:a,subPrefixes:o}=oI(this._resolverCache,e,i);let l=a;if(fQ(a,n)){s.$shared=!1,r=Ca(r)?r():r;const u=this.createResolver(e,r,o);l=xu(a,r,u)}for(const u of n)s[u]=l[u];return s}createResolver(e,n,r=[""],i){const{resolver:s}=oI(this._resolverCache,e,r);return We(n)?xu(s,n,void 0,i):s}}function oI(t,e,n){let r=t.get(e);r||(r=new Map,t.set(e,r));const i=n.join();let s=r.get(i);return s||(s={resolver:Ex(e,n),subPrefixes:n.filter(o=>!o.toLowerCase().includes("hover"))},r.set(i,s)),s}const hQ=t=>We(t)&&Object.getOwnPropertyNames(t).some(e=>Ca(t[e]));function fQ(t,e){const{isScriptable:n,isIndexable:r}=XO(t);for(const i of e){const s=n(i),a=r(i),o=(a||s)&&t[i];if(s&&(Ca(o)||hQ(o))||a&&tn(o))return!0}return!1}var pQ="4.5.1";const mQ=["top","bottom","left","right","chartArea"];function lI(t,e){return t==="top"||t==="bottom"||mQ.indexOf(t)===-1&&e==="x"}function uI(t,e){return function(n,r){return n[t]===r[t]?n[e]-r[e]:n[t]-r[t]}}function cI(t){const e=t.chart,n=e.options.animation;e.notifyPlugins("afterRender"),ft(n&&n.onComplete,[t],e)}function gQ(t){const e=t.chart,n=e.options.animation;ft(n&&n.onProgress,[t],e)}function wD(t){return kx()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const Lp={},dI=t=>{const e=wD(t);return Object.values(Lp).filter(n=>n.canvas===e).pop()};function yQ(t,e,n){const r=Object.keys(t);for(const i of r){const s=+i;if(s>=e){const a=t[i];delete t[i],(n>0||s>e)&&(t[s+n]=a)}}}function _Q(t,e,n,r){return!n||t.type==="mouseout"?null:r?e:t}var Bs;let Ug=(Bs=class{static register(...e){_i.add(...e),hI()}static unregister(...e){_i.remove(...e),hI()}constructor(e,n){const r=this.config=new dQ(n),i=wD(e),s=dI(i);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const a=r.createResolver(r.chartOptionScopes(),this.getContext());this.platform=new(r.platform||MY(i)),this.platform.updateConfig(r);const o=this.platform.acquireContext(i,a.aspectRatio),l=o&&o.canvas,u=l&&l.height,c=l&&l.width;if(this.id=SG(),this.ctx=o,this.canvas=l,this.width=c,this.height=u,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new eQ,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=qG(d=>this.update(d),a.resizeDelay||0),this._dataChanges=[],Lp[this.id]=this,!o||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Zi.listen(this,"complete",cI),Zi.listen(this,"progress",gQ),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:n},width:r,height:i,_aspectRatio:s}=this;return dt(e)?n&&s?s:i?r/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return _i}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():LS(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return OS(this.canvas,this.ctx),this}stop(){return Zi.stop(this),this}resize(e,n){Zi.running(this)?this._resizeBeforeDraw={width:e,height:n}:this._resize(e,n)}_resize(e,n){const r=this.options,i=this.canvas,s=r.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(i,e,n,s),o=r.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,LS(this,o,!0)&&(this.notifyPlugins("resize",{size:a}),ft(r.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};tt(n,(r,i)=>{r.id=i})}buildOrUpdateScales(){const e=this.options,n=e.scales,r=this.scales,i=Object.keys(r).reduce((a,o)=>(a[o]=!1,a),{});let s=[];n&&(s=s.concat(Object.keys(n).map(a=>{const o=n[a],l=jw(a,o),u=l==="r",c=l==="x";return{options:o,dposition:u?"chartArea":c?"bottom":"left",dtype:u?"radialLinear":c?"category":"linear"}}))),tt(s,a=>{const o=a.options,l=o.id,u=jw(l,o),c=Be(o.type,a.dtype);(o.position===void 0||lI(o.position,u)!==lI(a.dposition))&&(o.position=a.dposition),i[l]=!0;let d=null;if(l in r&&r[l].type===c)d=r[l];else{const h=_i.getScale(c);d=new h({id:l,type:c,ctx:this.ctx,chart:this}),r[d.id]=d}d.init(o,e)}),tt(i,(a,o)=>{a||delete r[o]}),tt(r,a=>{ra.configure(this,a,a.options),ra.addBox(this,a)})}_updateMetasets(){const e=this._metasets,n=this.data.datasets.length,r=e.length;if(e.sort((i,s)=>i.index-s.index),r>n){for(let i=n;i<r;++i)this._destroyDatasetMeta(i);e.splice(n,r-n)}this._sortedMetasets=e.slice(0).sort(uI("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:n}}=this;e.length>n.length&&delete this._stacks,e.forEach((r,i)=>{n.filter(s=>s===r._dataset).length===0&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){const e=[],n=this.data.datasets;let r,i;for(this._removeUnreferencedMetasets(),r=0,i=n.length;r<i;r++){const s=n[r];let a=this.getDatasetMeta(r);const o=s.type||this.config.type;if(a.type&&a.type!==o&&(this._destroyDatasetMeta(r),a=this.getDatasetMeta(r)),a.type=o,a.indexAxis=s.indexAxis||Uw(o,this.options),a.order=s.order||0,a.index=r,a.label=""+s.label,a.visible=this.isDatasetVisible(r),a.controller)a.controller.updateIndex(r),a.controller.linkScales();else{const l=_i.getController(o),{datasetElementType:u,dataElementType:c}=Mt.datasets[o];Object.assign(l,{dataElementType:_i.getElement(c),datasetElementType:u&&_i.getElement(u)}),a.controller=new l(this,r),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){tt(this.data.datasets,(e,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const n=this.config;n.update();const r=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!r.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let u=0,c=this.data.datasets.length;u<c;u++){const{controller:d}=this.getDatasetMeta(u),h=!i&&s.indexOf(d)===-1;d.buildOrUpdateElements(h),a=Math.max(+d.getMaxOverflow(),a)}a=this._minPadding=r.layout.autoPadding?a:0,this._updateLayout(a),i||tt(s,u=>{u.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(uI("z","_idx"));const{_active:o,_lastEvent:l}=this;l?this._eventHandler(l,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){tt(this.scales,e=>{ra.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,n=new Set(Object.keys(this._listeners)),r=new Set(e.events);(!ES(n,r)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,n=this._getUniformDataChanges()||[];for(const{method:r,start:i,count:s}of n){const a=r==="_removeElements"?-s:s;yQ(e,i,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const n=this.data.datasets.length,r=s=>new Set(e.filter(a=>a[0]===s).map((a,o)=>o+","+a.splice(1).join(","))),i=r(0);for(let s=1;s<n;s++)if(!ES(i,r(s)))return;return Array.from(i).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ra.update(this,this.width,this.height,e);const n=this.chartArea,r=n.width<=0||n.height<=0;this._layers=[],tt(this.boxes,i=>{r&&i.position==="chartArea"||(i.configure&&i.configure(),this._layers.push(...i._layers()))},this),this._layers.forEach((i,s)=>{i._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let n=0,r=this.data.datasets.length;n<r;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,r=this.data.datasets.length;n<r;++n)this._updateDataset(n,Ca(e)?e({datasetIndex:n}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,n){const r=this.getDatasetMeta(e),i={meta:r,index:e,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",i)!==!1&&(r.controller._update(n),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Zi.has(this)?this.attached&&!Zi.running(this)&&Zi.start(this):(this.draw(),cI({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:r,height:i}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(r,i)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(e=0;e<n.length&&n[e].z<=0;++e)n[e].draw(this.chartArea);for(this._drawDatasets();e<n.length;++e)n[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const n=this._sortedMetasets,r=[];let i,s;for(i=0,s=n.length;i<s;++i){const a=n[i];(!e||a.visible)&&r.push(a)}return r}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let n=e.length-1;n>=0;--n)this._drawDataset(e[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const n=this.ctx,r={meta:e,index:e.index,cancelable:!0},i=oD(this,e);this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(i&&zg(n,i),e.controller.draw(),i&&Vg(n),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return oh(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,n,r,i){const s=mY.modes[n];return typeof s=="function"?s(this,e,r,i):[]}getDatasetMeta(e){const n=this.data.datasets[e],r=this._metasets;let i=r.filter(s=>s&&s._dataset===n).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:e,_dataset:n,_parsed:[],_sorted:!1},r.push(i)),i}getContext(){return this.$context||(this.$context=Jo(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const n=this.data.datasets[e];if(!n)return!1;const r=this.getDatasetMeta(e);return typeof r.hidden=="boolean"?!r.hidden:!n.hidden}setDatasetVisibility(e,n){const r=this.getDatasetMeta(e);r.hidden=!n}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,n,r){const i=r?"show":"hide",s=this.getDatasetMeta(e),a=s.controller._resolveAnimations(void 0,i);Mm(n)?(s.data[n].hidden=!r,this.update()):(this.setDatasetVisibility(e,r),a.update(s,{visible:r}),this.update(o=>o.datasetIndex===e?i:void 0))}hide(e,n){this._updateVisibility(e,n,!1)}show(e,n){this._updateVisibility(e,n,!0)}_destroyDatasetMeta(e){const n=this._metasets[e];n&&n.controller&&n.controller._destroy(),delete this._metasets[e]}_stop(){let e,n;for(this.stop(),Zi.remove(this),e=0,n=this.data.datasets.length;e<n;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:n}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),OS(e,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete Lp[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,n=this.platform,r=(s,a)=>{n.addEventListener(this,s,a),e[s]=a},i=(s,a,o)=>{s.offsetX=a,s.offsetY=o,this._eventHandler(s)};tt(this.options.events,s=>r(s,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,n=this.platform,r=(l,u)=>{n.addEventListener(this,l,u),e[l]=u},i=(l,u)=>{e[l]&&(n.removeEventListener(this,l,u),delete e[l])},s=(l,u)=>{this.canvas&&this.resize(l,u)};let a;const o=()=>{i("attach",o),this.attached=!0,this.resize(),r("resize",s),r("detach",a)};a=()=>{this.attached=!1,i("resize",s),this._stop(),this._resize(0,0),r("attach",o)},n.isAttached(this.canvas)?o():a()}unbindEvents(){tt(this._listeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._listeners={},tt(this._responsiveListeners,(e,n)=>{this.platform.removeEventListener(this,n,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,n,r){const i=r?"set":"remove";let s,a,o,l;for(n==="dataset"&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+i+"DatasetHoverStyle"]()),o=0,l=e.length;o<l;++o){a=e[o];const u=a&&this.getDatasetMeta(a.datasetIndex).controller;u&&u[i+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const n=this._active||[],r=e.map(({datasetIndex:s,index:a})=>{const o=this.getDatasetMeta(s);if(!o)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:o.data[a],index:a}});!Nm(r,n)&&(this._active=r,this._lastEvent=null,this._updateHoverStyles(r,n))}notifyPlugins(e,n,r){return this._plugins.notify(this,e,n,r)}isPluginEnabled(e){return this._plugins._cache.filter(n=>n.plugin.id===e).length===1}_updateHoverStyles(e,n,r){const i=this.options.hover,s=(l,u)=>l.filter(c=>!u.some(d=>c.datasetIndex===d.datasetIndex&&c.index===d.index)),a=s(n,e),o=r?e:s(e,n);a.length&&this.updateHoverStyle(a,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(e,n){const r={event:e,replay:n,cancelable:!0,inChartArea:this.isPointInArea(e)},i=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",r,i)===!1)return;const s=this._handleEvent(e,n,r.inChartArea);return r.cancelable=!1,this.notifyPlugins("afterEvent",r,i),(s||r.changed)&&this.render(),this}_handleEvent(e,n,r){const{_active:i=[],options:s}=this,a=n,o=this._getActiveElements(e,i,r,a),l=RG(e),u=_Q(e,this._lastEvent,r,l);r&&(this._lastEvent=null,ft(s.onHover,[e,o,this],this),l&&ft(s.onClick,[e,o,this],this));const c=!Nm(o,i);return(c||n)&&(this._active=o,this._updateHoverStyles(o,i,n)),this._lastEvent=u,c}_getActiveElements(e,n,r,i){if(e.type==="mouseout")return[];if(!r)return n;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,i)}},re(Bs,"defaults",Mt),re(Bs,"instances",Lp),re(Bs,"overrides",Bo),re(Bs,"registry",_i),re(Bs,"version",pQ),re(Bs,"getChart",dI),Bs);function hI(){return tt(Ug.instances,t=>t._plugins.invalidate())}function vD(t,e,n=e){t.lineCap=Be(n.borderCapStyle,e.borderCapStyle),t.setLineDash(Be(n.borderDash,e.borderDash)),t.lineDashOffset=Be(n.borderDashOffset,e.borderDashOffset),t.lineJoin=Be(n.borderJoinStyle,e.borderJoinStyle),t.lineWidth=Be(n.borderWidth,e.borderWidth),t.strokeStyle=Be(n.borderColor,e.borderColor)}function wQ(t,e,n){t.lineTo(n.x,n.y)}function vQ(t){return t.stepped?aK:t.tension||t.cubicInterpolationMode==="monotone"?oK:wQ}function bD(t,e,n={}){const r=t.length,{start:i=0,end:s=r-1}=n,{start:a,end:o}=e,l=Math.max(i,a),u=Math.min(s,o),c=i<a&&s<a||i>o&&s>o;return{count:r,start:l,loop:e.loop,ilen:u<l&&!c?r+u-l:u-l}}function bQ(t,e,n,r){const{points:i,options:s}=e,{count:a,start:o,loop:l,ilen:u}=bD(i,n,r),c=vQ(s);let{move:d=!0,reverse:h}=r||{},m,g,w;for(m=0;m<=u;++m)g=i[(o+(h?u-m:m))%a],!g.skip&&(d?(t.moveTo(g.x,g.y),d=!1):c(t,w,g,h,s.stepped),w=g);return l&&(g=i[(o+(h?u:0))%a],c(t,w,g,h,s.stepped)),!!l}function xQ(t,e,n,r){const i=e.points,{count:s,start:a,ilen:o}=bD(i,n,r),{move:l=!0,reverse:u}=r||{};let c=0,d=0,h,m,g,w,x,v;const y=$=>(a+(u?o-$:$))%s,E=()=>{w!==x&&(t.lineTo(c,x),t.lineTo(c,w),t.lineTo(c,v))};for(l&&(m=i[y(0)],t.moveTo(m.x,m.y)),h=0;h<=o;++h){if(m=i[y(h)],m.skip)continue;const $=m.x,R=m.y,D=$|0;D===g?(R<w?w=R:R>x&&(x=R),c=(d*c+$)/++d):(E(),t.lineTo($,R),g=D,d=0,w=x=R),v=R}E()}function Ww(t){const e=t.options,n=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!n?xQ:bQ}function TQ(t){return t.stepped?FK:t.tension||t.cubicInterpolationMode==="monotone"?BK:ho}function EQ(t,e,n,r){let i=e._path;i||(i=e._path=new Path2D,e.path(i,n,r)&&i.closePath()),vD(t,e.options),t.stroke(i)}function SQ(t,e,n,r){const{segments:i,options:s}=e,a=Ww(e);for(const o of i)vD(t,s,o.style),t.beginPath(),a(t,e,o,{start:n,end:n+r-1})&&t.closePath(),t.stroke()}const IQ=typeof Path2D=="function";function kQ(t,e,n,r){IQ&&!e.options.segment?EQ(t,e,n,r):SQ(t,e,n,r)}class ia extends Aa{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,n){const r=this.options;if((r.tension||r.cubicInterpolationMode==="monotone")&&!r.stepped&&!this._pointsUpdated){const i=r.spanGaps?this._loop:this._fullLoop;PK(this._points,r,e,i,n),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=GK(this,this.options.segment))}first(){const e=this.segments,n=this.points;return e.length&&n[e[0].start]}last(){const e=this.segments,n=this.points,r=e.length;return r&&n[e[r-1].end]}interpolate(e,n){const r=this.options,i=e[n],s=this.points,a=aD(this,{property:n,start:i,end:i});if(!a.length)return;const o=[],l=TQ(r);let u,c;for(u=0,c=a.length;u<c;++u){const{start:d,end:h}=a[u],m=s[d],g=s[h];if(m===g){o.push(m);continue}const w=Math.abs((i-m[n])/(g[n]-m[n])),x=l(m,g,w,r.stepped);x[n]=e[n],o.push(x)}return o.length===1?o[0]:o}pathSegment(e,n,r){return Ww(this)(e,this,n,r)}path(e,n,r){const i=this.segments,s=Ww(this);let a=this._loop;n=n||0,r=r||this.points.length-n;for(const o of i)a&=s(e,this,o,{start:n,end:n+r-1});return!!a}draw(e,n,r,i){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),kQ(e,this,r,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}re(ia,"id","line"),re(ia,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),re(ia,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),re(ia,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"});function fI(t,e,n,r){const i=t.options,{[n]:s}=t.getProps([n],r);return Math.abs(e-s)<i.radius+i.hitRadius}class zp extends Aa{constructor(n){super();re(this,"parsed");re(this,"skip");re(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,r,i){const s=this.options,{x:a,y:o}=this.getProps(["x","y"],i);return Math.pow(n-a,2)+Math.pow(r-o,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(n,r){return fI(this,n,"x",r)}inYRange(n,r){return fI(this,n,"y",r)}getCenterPoint(n){const{x:r,y:i}=this.getProps(["x","y"],n);return{x:r,y:i}}size(n){n=n||this.options||{};let r=n.radius||0;r=Math.max(r,r&&n.hoverRadius||0);const i=r&&n.borderWidth||0;return(r+i)*2}draw(n,r){const i=this.options;this.skip||i.radius<.1||!oh(this,r,this.size(i)/2)||(n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.fillStyle=i.backgroundColor,Fw(n,i,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}re(zp,"id","point"),re(zp,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),re(zp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function $Q(t,e,n){const r=t.segments,i=t.points,s=e.points,a=[];for(const o of r){let{start:l,end:u}=o;u=jg(l,u,i);const c=Hw(n,i[l],i[u],o.loop);if(!e.segments){a.push({source:o,target:c,start:i[l],end:i[u]});continue}const d=aD(e,c);for(const h of d){const m=Hw(n,s[h.start],s[h.end],h.loop),g=sD(o,i,m);for(const w of g)a.push({source:w,target:h,start:{[n]:pI(c,m,"start",Math.max)},end:{[n]:pI(c,m,"end",Math.min)}})}}return a}function Hw(t,e,n,r){if(r)return;let i=e[t],s=n[t];return t==="angle"&&(i=vi(i),s=vi(s)),{property:t,start:i,end:s}}function CQ(t,e){const{x:n=null,y:r=null}=t||{},i=e.points,s=[];return e.segments.forEach(({start:a,end:o})=>{o=jg(a,o,i);const l=i[a],u=i[o];r!==null?(s.push({x:l.x,y:r}),s.push({x:u.x,y:r})):n!==null&&(s.push({x:n,y:l.y}),s.push({x:n,y:u.y}))}),s}function jg(t,e,n){for(;e>t;e--){const r=n[e];if(!isNaN(r.x)&&!isNaN(r.y))break}return e}function pI(t,e,n,r){return t&&e?r(t[n],e[n]):t?t[n]:e?e[n]:0}function xD(t,e){let n=[],r=!1;return tn(t)?(r=!0,n=t):n=CQ(t,e),n.length?new ia({points:n,options:{tension:0},_loop:r,_fullLoop:r}):null}function mI(t){return t&&t.fill!==!1}function AQ(t,e,n){let i=t[e].fill;const s=[e];let a;if(!n)return i;for(;i!==!1&&s.indexOf(i)===-1;){if(!Tn(i))return i;if(a=t[i],!a)return!1;if(a.visible)return i;s.push(i),i=a.fill}return!1}function RQ(t,e,n){const r=DQ(t);if(We(r))return isNaN(r.value)?!1:r;let i=parseFloat(r);return Tn(i)&&Math.floor(i)===i?PQ(r[0],e,i,n):["origin","start","end","stack","shape"].indexOf(r)>=0&&r}function PQ(t,e,n,r){return(t==="-"||t==="+")&&(n=e+n),n===e||n<0||n>=r?!1:n}function NQ(t,e){let n=null;return t==="start"?n=e.bottom:t==="end"?n=e.top:We(t)?n=e.getPixelForValue(t.value):e.getBasePixel&&(n=e.getBasePixel()),n}function OQ(t,e,n){let r;return t==="start"?r=n:t==="end"?r=e.options.reverse?e.min:e.max:We(t)?r=t.value:r=e.getBaseValue(),r}function DQ(t){const e=t.options,n=e.fill;let r=Be(n&&n.target,n);return r===void 0&&(r=!!e.backgroundColor),r===!1||r===null?!1:r===!0?"origin":r}function MQ(t){const{scale:e,index:n,line:r}=t,i=[],s=r.segments,a=r.points,o=LQ(e,n);o.push(xD({x:null,y:e.bottom},r));for(let l=0;l<s.length;l++){const u=s[l];for(let c=u.start;c<=u.end;c++)zQ(i,a[c],o)}return new ia({points:i,options:{}})}function LQ(t,e){const n=[],r=t.getMatchingVisibleMetas("line");for(let i=0;i<r.length;i++){const s=r[i];if(s.index===e)break;s.hidden||n.unshift(s.dataset)}return n}function zQ(t,e,n){const r=[];for(let i=0;i<n.length;i++){const s=n[i],{first:a,last:o,point:l}=VQ(s,e,"x");if(!(!l||a&&o)){if(a)r.unshift(l);else if(t.push(l),!o)break}}t.push(...r)}function VQ(t,e,n){const r=t.interpolate(e,n);if(!r)return{};const i=r[n],s=t.segments,a=t.points;let o=!1,l=!1;for(let u=0;u<s.length;u++){const c=s[u],d=a[c.start][n],h=a[c.end][n];if(Wl(i,d,h)){o=i===d,l=i===h;break}}return{first:o,last:l,point:r}}class TD{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,n,r){const{x:i,y:s,radius:a}=this;return n=n||{start:0,end:Kr},e.arc(i,s,a,n.end,n.start,!0),!r.bounds}interpolate(e){const{x:n,y:r,radius:i}=this,s=e.angle;return{x:n+Math.cos(s)*i,y:r+Math.sin(s)*i,angle:s}}}function FQ(t){const{chart:e,fill:n,line:r}=t;if(Tn(n))return BQ(e,n);if(n==="stack")return MQ(t);if(n==="shape")return!0;const i=UQ(t);return i instanceof TD?i:xD(i,r)}function BQ(t,e){const n=t.getDatasetMeta(e);return n&&t.isDatasetVisible(e)?n.dataset:null}function UQ(t){return(t.scale||{}).getPointPositionForValue?WQ(t):jQ(t)}function jQ(t){const{scale:e={},fill:n}=t,r=NQ(n,e);if(Tn(r)){const i=e.isHorizontal();return{x:i?r:null,y:i?null:r}}return null}function WQ(t){const{scale:e,fill:n}=t,r=e.options,i=e.getLabels().length,s=r.reverse?e.max:e.min,a=OQ(n,e,s),o=[];if(r.grid.circular){const l=e.getPointPositionForValue(0,s);return new TD({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(a)})}for(let l=0;l<i;++l)o.push(e.getPointPositionForValue(l,a));return o}function c_(t,e,n){const r=FQ(e),{chart:i,index:s,line:a,scale:o,axis:l}=e,u=a.options,c=u.fill,d=u.backgroundColor,{above:h=d,below:m=d}=c||{},g=i.getDatasetMeta(s),w=oD(i,g);r&&a.points.length&&(zg(t,n),HQ(t,{line:a,target:r,above:h,below:m,area:n,scale:o,axis:l,clip:w}),Vg(t))}function HQ(t,e){const{line:n,target:r,above:i,below:s,area:a,scale:o,clip:l}=e,u=n._loop?"angle":e.axis;t.save();let c=s;s!==i&&(u==="x"?(gI(t,r,a.top),d_(t,{line:n,target:r,color:i,scale:o,property:u,clip:l}),t.restore(),t.save(),gI(t,r,a.bottom)):u==="y"&&(yI(t,r,a.left),d_(t,{line:n,target:r,color:s,scale:o,property:u,clip:l}),t.restore(),t.save(),yI(t,r,a.right),c=i)),d_(t,{line:n,target:r,color:c,scale:o,property:u,clip:l}),t.restore()}function gI(t,e,n){const{segments:r,points:i}=e;let s=!0,a=!1;t.beginPath();for(const o of r){const{start:l,end:u}=o,c=i[l],d=i[jg(l,u,i)];s?(t.moveTo(c.x,c.y),s=!1):(t.lineTo(c.x,n),t.lineTo(c.x,c.y)),a=!!e.pathSegment(t,o,{move:a}),a?t.closePath():t.lineTo(d.x,n)}t.lineTo(e.first().x,n),t.closePath(),t.clip()}function yI(t,e,n){const{segments:r,points:i}=e;let s=!0,a=!1;t.beginPath();for(const o of r){const{start:l,end:u}=o,c=i[l],d=i[jg(l,u,i)];s?(t.moveTo(c.x,c.y),s=!1):(t.lineTo(n,c.y),t.lineTo(c.x,c.y)),a=!!e.pathSegment(t,o,{move:a}),a?t.closePath():t.lineTo(n,d.y)}t.lineTo(n,e.first().y),t.closePath(),t.clip()}function d_(t,e){const{line:n,target:r,property:i,color:s,scale:a,clip:o}=e,l=$Q(n,r,i);for(const{source:u,target:c,start:d,end:h}of l){const{style:{backgroundColor:m=s}={}}=u,g=r!==!0;t.save(),t.fillStyle=m,qQ(t,a,o,g&&Hw(i,d,h)),t.beginPath();const w=!!n.pathSegment(t,u);let x;if(g){w?t.closePath():_I(t,r,h,i);const v=!!r.pathSegment(t,c,{move:w,reverse:!0});x=w&&v,x||_I(t,r,d,i)}t.closePath(),t.fill(x?"evenodd":"nonzero"),t.restore()}}function qQ(t,e,n,r){const i=e.chart.chartArea,{property:s,start:a,end:o}=r||{};if(s==="x"||s==="y"){let l,u,c,d;s==="x"?(l=a,u=i.top,c=o,d=i.bottom):(l=i.left,u=a,c=i.right,d=o),t.beginPath(),n&&(l=Math.max(l,n.left),c=Math.min(c,n.right),u=Math.max(u,n.top),d=Math.min(d,n.bottom)),t.rect(l,u,c-l,d-u),t.clip()}}function _I(t,e,n,r){const i=e.interpolate(n,r);i&&t.lineTo(i.x,i.y)}var GQ={id:"filler",afterDatasetsUpdate(t,e,n){const r=(t.data.datasets||[]).length,i=[];let s,a,o,l;for(a=0;a<r;++a)s=t.getDatasetMeta(a),o=s.dataset,l=null,o&&o.options&&o instanceof ia&&(l={visible:t.isDatasetVisible(a),index:a,fill:RQ(o,a,r),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:o}),s.$filler=l,i.push(l);for(a=0;a<r;++a)l=i[a],!(!l||l.fill===!1)&&(l.fill=AQ(i,a,n.propagate))},beforeDraw(t,e,n){const r=n.drawTime==="beforeDraw",i=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let a=i.length-1;a>=0;--a){const o=i[a].$filler;o&&(o.line.updateControlPoints(s,o.axis),r&&o.fill&&c_(t.ctx,o,s))}},beforeDatasetsDraw(t,e,n){if(n.drawTime!=="beforeDatasetsDraw")return;const r=t.getSortedVisibleDatasetMetas();for(let i=r.length-1;i>=0;--i){const s=r[i].$filler;mI(s)&&c_(t.ctx,s,t.chartArea)}},beforeDatasetDraw(t,e,n){const r=e.meta.$filler;!mI(r)||n.drawTime!=="beforeDatasetDraw"||c_(t.ctx,r,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const wI=(t,e)=>{let{boxHeight:n=e,boxWidth:r=e}=t;return t.usePointStyle&&(n=Math.min(n,e),r=t.pointStyleWidth||Math.min(r,e)),{boxWidth:r,boxHeight:n,itemHeight:Math.max(e,n)}},KQ=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class vI extends Aa{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,n,r){this.maxWidth=e,this.maxHeight=n,this._margins=r,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let n=ft(e.generateLabels,[this.chart],this)||[];e.filter&&(n=n.filter(r=>e.filter(r,this.chart.data))),e.sort&&(n=n.sort((r,i)=>e.sort(r,i,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:e,ctx:n}=this;if(!e.display){this.width=this.height=0;return}const r=e.labels,i=qn(r.font),s=i.size,a=this._computeTitleHeight(),{boxWidth:o,itemHeight:l}=wI(r,s);let u,c;n.font=i.string,this.isHorizontal()?(u=this.maxWidth,c=this._fitRows(a,s,o,l)+10):(c=this.maxHeight,u=this._fitCols(a,i,o,l)+10),this.width=Math.min(u,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,n,r,i){const{ctx:s,maxWidth:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],u=this.lineWidths=[0],c=i+o;let d=e;s.textAlign="left",s.textBaseline="middle";let h=-1,m=-c;return this.legendItems.forEach((g,w)=>{const x=r+n/2+s.measureText(g.text).width;(w===0||u[u.length-1]+x+2*o>a)&&(d+=c,u[u.length-(w>0?0:1)]=0,m+=c,h++),l[w]={left:0,top:m,row:h,width:x,height:i},u[u.length-1]+=x+o}),d}_fitCols(e,n,r,i){const{ctx:s,maxHeight:a,options:{labels:{padding:o}}}=this,l=this.legendHitBoxes=[],u=this.columnSizes=[],c=a-e;let d=o,h=0,m=0,g=0,w=0;return this.legendItems.forEach((x,v)=>{const{itemWidth:y,itemHeight:E}=YQ(r,n,s,x,i);v>0&&m+E+2*o>c&&(d+=h+o,u.push({width:h,height:m}),g+=h+o,w++,h=m=0),l[v]={left:g,top:m,col:w,width:y,height:E},h=Math.max(h,y),m+=E+o}),d+=h,u.push({width:h,height:m}),d}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:r,labels:{padding:i},rtl:s}}=this,a=au(s,this.left,this.width);if(this.isHorizontal()){let o=0,l=er(r,this.left+i,this.right-this.lineWidths[o]);for(const u of n)o!==u.row&&(o=u.row,l=er(r,this.left+i,this.right-this.lineWidths[o])),u.top+=this.top+e+i,u.left=a.leftForLtr(a.x(l),u.width),l+=u.width+i}else{let o=0,l=er(r,this.top+e+i,this.bottom-this.columnSizes[o].height);for(const u of n)u.col!==o&&(o=u.col,l=er(r,this.top+e+i,this.bottom-this.columnSizes[o].height)),u.top=l,u.left+=this.left+i,u.left=a.leftForLtr(a.x(u.left),u.width),l+=u.height+i}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;zg(e,this),this._draw(),Vg(e)}}_draw(){const{options:e,columnSizes:n,lineWidths:r,ctx:i}=this,{align:s,labels:a}=e,o=Mt.color,l=au(e.rtl,this.left,this.width),u=qn(a.font),{padding:c}=a,d=u.size,h=d/2;let m;this.drawTitle(),i.textAlign=l.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=u.string;const{boxWidth:g,boxHeight:w,itemHeight:x}=wI(a,d),v=function(D,k,_){if(isNaN(g)||g<=0||isNaN(w)||w<0)return;i.save();const A=Be(_.lineWidth,1);if(i.fillStyle=Be(_.fillStyle,o),i.lineCap=Be(_.lineCap,"butt"),i.lineDashOffset=Be(_.lineDashOffset,0),i.lineJoin=Be(_.lineJoin,"miter"),i.lineWidth=A,i.strokeStyle=Be(_.strokeStyle,o),i.setLineDash(Be(_.lineDash,[])),a.usePointStyle){const N={radius:w*Math.SQRT2/2,pointStyle:_.pointStyle,rotation:_.rotation,borderWidth:A},L=l.xPlus(D,g/2),V=k+h;YO(i,N,L,V,a.pointStyleWidth&&g)}else{const N=k+Math.max((d-w)/2,0),L=l.leftForLtr(D,g),V=Td(_.borderRadius);i.beginPath(),Object.values(V).some(M=>M!==0)?Bw(i,{x:L,y:N,w:g,h:w,radius:V}):i.rect(L,N,g,w),i.fill(),A!==0&&i.stroke()}i.restore()},y=function(D,k,_){zm(i,_.text,D,k+x/2,u,{strikethrough:_.hidden,textAlign:l.textAlign(_.textAlign)})},E=this.isHorizontal(),$=this._computeTitleHeight();E?m={x:er(s,this.left+c,this.right-r[0]),y:this.top+c+$,line:0}:m={x:this.left+c,y:er(s,this.top+$+c,this.bottom-n[0].height),line:0},nD(this.ctx,e.textDirection);const R=x+c;this.legendItems.forEach((D,k)=>{i.strokeStyle=D.fontColor,i.fillStyle=D.fontColor;const _=i.measureText(D.text).width,A=l.textAlign(D.textAlign||(D.textAlign=a.textAlign)),N=g+h+_;let L=m.x,V=m.y;l.setWidth(this.width),E?k>0&&L+N+c>this.right&&(V=m.y+=R,m.line++,L=m.x=er(s,this.left+c,this.right-r[m.line])):k>0&&V+R>this.bottom&&(L=m.x=L+n[m.line].width+c,m.line++,V=m.y=er(s,this.top+$+c,this.bottom-n[m.line].height));const M=l.x(L);if(v(M,V,D),L=GG(A,L+g+h,E?L+N:this.right,e.rtl),y(l.x(L),V,D),E)m.x+=N+c;else if(typeof D.text!="string"){const B=u.lineHeight;m.y+=ED(D,B)+c}else m.y+=R}),rD(this.ctx,e.textDirection)}drawTitle(){const e=this.options,n=e.title,r=qn(n.font),i=ei(n.padding);if(!n.display)return;const s=au(e.rtl,this.left,this.width),a=this.ctx,o=n.position,l=r.size/2,u=i.top+l;let c,d=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),c=this.top+u,d=er(e.align,d,this.right-h);else{const g=this.columnSizes.reduce((w,x)=>Math.max(w,x.height),0);c=u+er(e.align,this.top,this.bottom-g-e.labels.padding-this._computeTitleHeight())}const m=er(o,d,d+h);a.textAlign=s.textAlign(qO(o)),a.textBaseline="middle",a.strokeStyle=n.color,a.fillStyle=n.color,a.font=r.string,zm(a,n.text,m,c,r)}_computeTitleHeight(){const e=this.options.title,n=qn(e.font),r=ei(e.padding);return e.display?n.lineHeight+r.height:0}_getLegendItemAt(e,n){let r,i,s;if(Wl(e,this.left,this.right)&&Wl(n,this.top,this.bottom)){for(s=this.legendHitBoxes,r=0;r<s.length;++r)if(i=s[r],Wl(e,i.left,i.left+i.width)&&Wl(n,i.top,i.top+i.height))return this.legendItems[r]}return null}handleEvent(e){const n=this.options;if(!JQ(e.type,n))return;const r=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const i=this._hoveredItem,s=KQ(i,r);i&&!s&&ft(n.onLeave,[e,i,this],this),this._hoveredItem=r,r&&!s&&ft(n.onHover,[e,r,this],this)}else r&&ft(n.onClick,[e,r,this],this)}}function YQ(t,e,n,r,i){const s=QQ(r,t,e,n),a=XQ(i,r,e.lineHeight);return{itemWidth:s,itemHeight:a}}function QQ(t,e,n,r){let i=t.text;return i&&typeof i!="string"&&(i=i.reduce((s,a)=>s.length>a.length?s:a)),e+n.size/2+r.measureText(i).width}function XQ(t,e,n){let r=t;return typeof e.text!="string"&&(r=ED(e,n)),r}function ED(t,e){const n=t.text?t.text.length:0;return e*n}function JQ(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var ZQ={id:"legend",_element:vI,start(t,e,n){const r=t.legend=new vI({ctx:t.ctx,options:n,chart:t});ra.configure(t,r,n),ra.addBox(t,r)},stop(t){ra.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,n){const r=t.legend;ra.configure(t,r,n),r.options=n},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,n){const r=e.datasetIndex,i=n.chart;i.isDatasetVisible(r)?(i.hide(r),e.hidden=!0):(i.show(r),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:n,pointStyle:r,textAlign:i,color:s,useBorderRadius:a,borderRadius:o}}=t.legend.options;return t._getSortedDatasetMetas().map(l=>{const u=l.controller.getStyle(n?0:void 0),c=ei(u.borderWidth);return{text:e[l.index].label,fillStyle:u.backgroundColor,fontColor:s,hidden:!l.visible,lineCap:u.borderCapStyle,lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:u.borderColor,pointStyle:r||u.pointStyle,rotation:u.rotation,textAlign:i||u.textAlign,borderRadius:a&&(o||u.borderRadius),datasetIndex:l.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};const Jc={average(t){if(!t.length)return!1;let e,n,r=new Set,i=0,s=0;for(e=0,n=t.length;e<n;++e){const o=t[e].element;if(o&&o.hasValue()){const l=o.tooltipPosition();r.add(l.x),i+=l.y,++s}}return s===0||r.size===0?!1:{x:[...r].reduce((o,l)=>o+l)/r.size,y:i/s}},nearest(t,e){if(!t.length)return!1;let n=e.x,r=e.y,i=Number.POSITIVE_INFINITY,s,a,o;for(s=0,a=t.length;s<a;++s){const l=t[s].element;if(l&&l.hasValue()){const u=l.getCenterPoint(),c=zw(e,u);c<i&&(i=c,o=l)}}if(o){const l=o.tooltipPosition();n=l.x,r=l.y}return{x:n,y:r}}};function gi(t,e){return e&&(tn(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function es(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function eX(t,e){const{element:n,datasetIndex:r,index:i}=e,s=t.getDatasetMeta(r).controller,{label:a,value:o}=s.getLabelAndValue(i);return{chart:t,label:a,parsed:s.getParsed(i),raw:t.data.datasets[r].data[i],formattedValue:o,dataset:s.getDataset(),dataIndex:i,datasetIndex:r,element:n}}function bI(t,e){const n=t.chart.ctx,{body:r,footer:i,title:s}=t,{boxWidth:a,boxHeight:o}=e,l=qn(e.bodyFont),u=qn(e.titleFont),c=qn(e.footerFont),d=s.length,h=i.length,m=r.length,g=ei(e.padding);let w=g.height,x=0,v=r.reduce(($,R)=>$+R.before.length+R.lines.length+R.after.length,0);if(v+=t.beforeBody.length+t.afterBody.length,d&&(w+=d*u.lineHeight+(d-1)*e.titleSpacing+e.titleMarginBottom),v){const $=e.displayColors?Math.max(o,l.lineHeight):l.lineHeight;w+=m*$+(v-m)*l.lineHeight+(v-1)*e.bodySpacing}h&&(w+=e.footerMarginTop+h*c.lineHeight+(h-1)*e.footerSpacing);let y=0;const E=function($){x=Math.max(x,n.measureText($).width+y)};return n.save(),n.font=u.string,tt(t.title,E),n.font=l.string,tt(t.beforeBody.concat(t.afterBody),E),y=e.displayColors?a+2+e.boxPadding:0,tt(r,$=>{tt($.before,E),tt($.lines,E),tt($.after,E)}),y=0,n.font=c.string,tt(t.footer,E),n.restore(),x+=g.width,{width:x,height:w}}function tX(t,e){const{y:n,height:r}=e;return n<r/2?"top":n>t.height-r/2?"bottom":"center"}function nX(t,e,n,r){const{x:i,width:s}=r,a=n.caretSize+n.caretPadding;if(t==="left"&&i+s+a>e.width||t==="right"&&i-s-a<0)return!0}function rX(t,e,n,r){const{x:i,width:s}=n,{width:a,chartArea:{left:o,right:l}}=t;let u="center";return r==="center"?u=i<=(o+l)/2?"left":"right":i<=s/2?u="left":i>=a-s/2&&(u="right"),nX(u,t,e,n)&&(u="center"),u}function xI(t,e,n){const r=n.yAlign||e.yAlign||tX(t,n);return{xAlign:n.xAlign||e.xAlign||rX(t,e,n,r),yAlign:r}}function iX(t,e){let{x:n,width:r}=t;return e==="right"?n-=r:e==="center"&&(n-=r/2),n}function sX(t,e,n){let{y:r,height:i}=t;return e==="top"?r+=n:e==="bottom"?r-=i+n:r-=i/2,r}function TI(t,e,n,r){const{caretSize:i,caretPadding:s,cornerRadius:a}=t,{xAlign:o,yAlign:l}=n,u=i+s,{topLeft:c,topRight:d,bottomLeft:h,bottomRight:m}=Td(a);let g=iX(e,o);const w=sX(e,l,u);return l==="center"?o==="left"?g+=u:o==="right"&&(g-=u):o==="left"?g-=Math.max(c,h)+i:o==="right"&&(g+=Math.max(d,m)+i),{x:wr(g,0,r.width-e.width),y:wr(w,0,r.height-e.height)}}function Xf(t,e,n){const r=ei(n.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-r.right:t.x+r.left}function EI(t){return gi([],es(t))}function aX(t,e,n){return Jo(t,{tooltip:e,tooltipItems:n,type:"tooltip"})}function SI(t,e){const n=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return n?t.override(n):t}const SD={beforeTitle:Xi,title(t){if(t.length>0){const e=t[0],n=e.chart.data.labels,r=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(r>0&&e.dataIndex<r)return n[e.dataIndex]}return""},afterTitle:Xi,beforeBody:Xi,beforeLabel:Xi,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const n=t.formattedValue;return dt(n)||(e+=n),e},labelColor(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const n=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Xi,afterBody:Xi,beforeFooter:Xi,footer:Xi,afterFooter:Xi};function Vn(t,e,n,r){const i=t[e].call(n,r);return typeof i>"u"?SD[e].call(n,r):i}class qw extends Aa{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const n=this.chart,r=this.options.setContext(this.getContext()),i=r.enabled&&n.options.animation&&r.animations,s=new lD(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=aX(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,n){const{callbacks:r}=n,i=Vn(r,"beforeTitle",this,e),s=Vn(r,"title",this,e),a=Vn(r,"afterTitle",this,e);let o=[];return o=gi(o,es(i)),o=gi(o,es(s)),o=gi(o,es(a)),o}getBeforeBody(e,n){return EI(Vn(n.callbacks,"beforeBody",this,e))}getBody(e,n){const{callbacks:r}=n,i=[];return tt(e,s=>{const a={before:[],lines:[],after:[]},o=SI(r,s);gi(a.before,es(Vn(o,"beforeLabel",this,s))),gi(a.lines,Vn(o,"label",this,s)),gi(a.after,es(Vn(o,"afterLabel",this,s))),i.push(a)}),i}getAfterBody(e,n){return EI(Vn(n.callbacks,"afterBody",this,e))}getFooter(e,n){const{callbacks:r}=n,i=Vn(r,"beforeFooter",this,e),s=Vn(r,"footer",this,e),a=Vn(r,"afterFooter",this,e);let o=[];return o=gi(o,es(i)),o=gi(o,es(s)),o=gi(o,es(a)),o}_createItems(e){const n=this._active,r=this.chart.data,i=[],s=[],a=[];let o=[],l,u;for(l=0,u=n.length;l<u;++l)o.push(eX(this.chart,n[l]));return e.filter&&(o=o.filter((c,d,h)=>e.filter(c,d,h,r))),e.itemSort&&(o=o.sort((c,d)=>e.itemSort(c,d,r))),tt(o,c=>{const d=SI(e.callbacks,c);i.push(Vn(d,"labelColor",this,c)),s.push(Vn(d,"labelPointStyle",this,c)),a.push(Vn(d,"labelTextColor",this,c))}),this.labelColors=i,this.labelPointStyles=s,this.labelTextColors=a,this.dataPoints=o,o}update(e,n){const r=this.options.setContext(this.getContext()),i=this._active;let s,a=[];if(!i.length)this.opacity!==0&&(s={opacity:0});else{const o=Jc[r.position].call(this,i,this._eventPosition);a=this._createItems(r),this.title=this.getTitle(a,r),this.beforeBody=this.getBeforeBody(a,r),this.body=this.getBody(a,r),this.afterBody=this.getAfterBody(a,r),this.footer=this.getFooter(a,r);const l=this._size=bI(this,r),u=Object.assign({},o,l),c=xI(this.chart,r,u),d=TI(r,u,c,this.chart);this.xAlign=c.xAlign,this.yAlign=c.yAlign,s={opacity:1,x:d.x,y:d.y,width:l.width,height:l.height,caretX:o.x,caretY:o.y}}this._tooltipItems=a,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(e,n,r,i){const s=this.getCaretPosition(e,r,i);n.lineTo(s.x1,s.y1),n.lineTo(s.x2,s.y2),n.lineTo(s.x3,s.y3)}getCaretPosition(e,n,r){const{xAlign:i,yAlign:s}=this,{caretSize:a,cornerRadius:o}=r,{topLeft:l,topRight:u,bottomLeft:c,bottomRight:d}=Td(o),{x:h,y:m}=e,{width:g,height:w}=n;let x,v,y,E,$,R;return s==="center"?($=m+w/2,i==="left"?(x=h,v=x-a,E=$+a,R=$-a):(x=h+g,v=x+a,E=$-a,R=$+a),y=x):(i==="left"?v=h+Math.max(l,c)+a:i==="right"?v=h+g-Math.max(u,d)-a:v=this.caretX,s==="top"?(E=m,$=E-a,x=v-a,y=v+a):(E=m+w,$=E+a,x=v+a,y=v-a),R=E),{x1:x,x2:v,x3:y,y1:E,y2:$,y3:R}}drawTitle(e,n,r){const i=this.title,s=i.length;let a,o,l;if(s){const u=au(r.rtl,this.x,this.width);for(e.x=Xf(this,r.titleAlign,r),n.textAlign=u.textAlign(r.titleAlign),n.textBaseline="middle",a=qn(r.titleFont),o=r.titleSpacing,n.fillStyle=r.titleColor,n.font=a.string,l=0;l<s;++l)n.fillText(i[l],u.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+o,l+1===s&&(e.y+=r.titleMarginBottom-o)}}_drawColorBox(e,n,r,i,s){const a=this.labelColors[r],o=this.labelPointStyles[r],{boxHeight:l,boxWidth:u}=s,c=qn(s.bodyFont),d=Xf(this,"left",s),h=i.x(d),m=l<c.lineHeight?(c.lineHeight-l)/2:0,g=n.y+m;if(s.usePointStyle){const w={radius:Math.min(u,l)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},x=i.leftForLtr(h,u)+u/2,v=g+l/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,Fw(e,w,x,v),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,Fw(e,w,x,v)}else{e.lineWidth=We(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const w=i.leftForLtr(h,u),x=i.leftForLtr(i.xPlus(h,1),u-2),v=Td(a.borderRadius);Object.values(v).some(y=>y!==0)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,Bw(e,{x:w,y:g,w:u,h:l,radius:v}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),Bw(e,{x,y:g+1,w:u-2,h:l-2,radius:v}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(w,g,u,l),e.strokeRect(w,g,u,l),e.fillStyle=a.backgroundColor,e.fillRect(x,g+1,u-2,l-2))}e.fillStyle=this.labelTextColors[r]}drawBody(e,n,r){const{body:i}=this,{bodySpacing:s,bodyAlign:a,displayColors:o,boxHeight:l,boxWidth:u,boxPadding:c}=r,d=qn(r.bodyFont);let h=d.lineHeight,m=0;const g=au(r.rtl,this.x,this.width),w=function(_){n.fillText(_,g.x(e.x+m),e.y+h/2),e.y+=h+s},x=g.textAlign(a);let v,y,E,$,R,D,k;for(n.textAlign=a,n.textBaseline="middle",n.font=d.string,e.x=Xf(this,x,r),n.fillStyle=r.bodyColor,tt(this.beforeBody,w),m=o&&x!=="right"?a==="center"?u/2+c:u+2+c:0,$=0,D=i.length;$<D;++$){for(v=i[$],y=this.labelTextColors[$],n.fillStyle=y,tt(v.before,w),E=v.lines,o&&E.length&&(this._drawColorBox(n,e,$,g,r),h=Math.max(d.lineHeight,l)),R=0,k=E.length;R<k;++R)w(E[R]),h=d.lineHeight;tt(v.after,w)}m=0,h=d.lineHeight,tt(this.afterBody,w),e.y-=s}drawFooter(e,n,r){const i=this.footer,s=i.length;let a,o;if(s){const l=au(r.rtl,this.x,this.width);for(e.x=Xf(this,r.footerAlign,r),e.y+=r.footerMarginTop,n.textAlign=l.textAlign(r.footerAlign),n.textBaseline="middle",a=qn(r.footerFont),n.fillStyle=r.footerColor,n.font=a.string,o=0;o<s;++o)n.fillText(i[o],l.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+r.footerSpacing}}drawBackground(e,n,r,i){const{xAlign:s,yAlign:a}=this,{x:o,y:l}=e,{width:u,height:c}=r,{topLeft:d,topRight:h,bottomLeft:m,bottomRight:g}=Td(i.cornerRadius);n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,n.lineWidth=i.borderWidth,n.beginPath(),n.moveTo(o+d,l),a==="top"&&this.drawCaret(e,n,r,i),n.lineTo(o+u-h,l),n.quadraticCurveTo(o+u,l,o+u,l+h),a==="center"&&s==="right"&&this.drawCaret(e,n,r,i),n.lineTo(o+u,l+c-g),n.quadraticCurveTo(o+u,l+c,o+u-g,l+c),a==="bottom"&&this.drawCaret(e,n,r,i),n.lineTo(o+m,l+c),n.quadraticCurveTo(o,l+c,o,l+c-m),a==="center"&&s==="left"&&this.drawCaret(e,n,r,i),n.lineTo(o,l+d),n.quadraticCurveTo(o,l,o+d,l),n.closePath(),n.fill(),i.borderWidth>0&&n.stroke()}_updateAnimationTarget(e){const n=this.chart,r=this.$animations,i=r&&r.x,s=r&&r.y;if(i||s){const a=Jc[e.position].call(this,this._active,this._eventPosition);if(!a)return;const o=this._size=bI(this,e),l=Object.assign({},a,this._size),u=xI(n,e,l),c=TI(e,l,u,n);(i._to!==c.x||s._to!==c.y)&&(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=o.width,this.height=o.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(e){const n=this.options.setContext(this.getContext());let r=this.opacity;if(!r)return;this._updateAnimationTarget(n);const i={width:this.width,height:this.height},s={x:this.x,y:this.y};r=Math.abs(r)<.001?0:r;const a=ei(n.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&o&&(e.save(),e.globalAlpha=r,this.drawBackground(s,e,i,n),nD(e,n.textDirection),s.y+=a.top,this.drawTitle(s,e,n),this.drawBody(s,e,n),this.drawFooter(s,e,n),rD(e,n.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,n){const r=this._active,i=e.map(({datasetIndex:o,index:l})=>{const u=this.chart.getDatasetMeta(o);if(!u)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:u.data[l],index:l}}),s=!Nm(r,i),a=this._positionChanged(i,n);(s||a)&&(this._active=i,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,n,r=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,s=this._active||[],a=this._getActiveElements(e,s,n,r),o=this._positionChanged(a,e),l=n||!Nm(a,s)||o;return l&&(this._active=a,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,n))),l}_getActiveElements(e,n,r,i){const s=this.options;if(e.type==="mouseout")return[];if(!i)return n.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,s.mode,s,r);return s.reverse&&a.reverse(),a}_positionChanged(e,n){const{caretX:r,caretY:i,options:s}=this,a=Jc[s.position].call(this,e,n);return a!==!1&&(r!==a.x||i!==a.y)}}re(qw,"positioners",Jc);var oX={id:"tooltip",_element:qw,positioners:Jc,afterInit(t,e,n){n&&(t.tooltip=new qw({chart:t,options:n}))},beforeUpdate(t,e,n){t.tooltip&&t.tooltip.initialize(n)},reset(t,e,n){t.tooltip&&t.tooltip.initialize(n)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const n={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",n)}},afterEvent(t,e){if(t.tooltip){const n=e.replay;t.tooltip.handleEvent(e.event,n,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:SD},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const lX=(t,e,n,r)=>(typeof e=="string"?(n=t.push(e)-1,r.unshift({index:n,label:e})):isNaN(e)&&(n=null),n);function uX(t,e,n,r){const i=t.indexOf(e);if(i===-1)return lX(t,e,n,r);const s=t.lastIndexOf(e);return i!==s?n:i}const cX=(t,e)=>t===null?null:wr(Math.round(t),0,e);function II(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class Gw extends Fu{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const n=this._addedLabels;if(n.length){const r=this.getLabels();for(const{index:i,label:s}of n)r[i]===s&&r.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,n){if(dt(e))return null;const r=this.getLabels();return n=isFinite(n)&&r[n]===e?n:uX(r,e,Be(n,e),this._addedLabels),cX(n,r.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:n}=this.getUserBounds();let{min:r,max:i}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(r=0),n||(i=this.getLabels().length-1)),this.min=r,this.max=i}buildTicks(){const e=this.min,n=this.max,r=this.options.offset,i=[];let s=this.getLabels();s=e===0&&n===s.length-1?s:s.slice(e,n+1),this._valueRange=Math.max(s.length-(r?0:1),1),this._startValue=this.min-(r?.5:0);for(let a=e;a<=n;a++)i.push({value:a});return i}getLabelForValue(e){return II.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const n=this.ticks;return e<0||e>n.length-1?null:this.getPixelForValue(n[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}re(Gw,"id","category"),re(Gw,"defaults",{ticks:{callback:II}});function dX(t,e){const n=[],{bounds:i,step:s,min:a,max:o,precision:l,count:u,maxTicks:c,maxDigits:d,includeBounds:h}=t,m=s||1,g=c-1,{min:w,max:x}=e,v=!dt(a),y=!dt(o),E=!dt(u),$=(x-w)/(d+1);let R=IS((x-w)/g/m)*m,D,k,_,A;if(R<1e-14&&!v&&!y)return[{value:w},{value:x}];A=Math.ceil(x/R)-Math.floor(w/R),A>g&&(R=IS(A*R/g/m)*m),dt(l)||(D=Math.pow(10,l),R=Math.ceil(R*D)/D),i==="ticks"?(k=Math.floor(w/R)*R,_=Math.ceil(x/R)*R):(k=w,_=x),v&&y&&s&&MG((o-a)/s,R/1e3)?(A=Math.round(Math.min((o-a)/R,c)),R=(o-a)/A,k=a,_=o):E?(k=v?a:k,_=y?o:_,A=u-1,R=(_-k)/A):(A=(_-k)/R,vd(A,Math.round(A),R/1e3)?A=Math.round(A):A=Math.ceil(A));const N=Math.max(kS(R),kS(k));D=Math.pow(10,dt(l)?N:l),k=Math.round(k*D)/D,_=Math.round(_*D)/D;let L=0;for(v&&(h&&k!==a?(n.push({value:a}),k<a&&L++,vd(Math.round((k+L*R)*D)/D,a,kI(a,$,t))&&L++):k<a&&L++);L<A;++L){const V=Math.round((k+L*R)*D)/D;if(y&&V>o)break;n.push({value:V})}return y&&h&&_!==o?n.length&&vd(n[n.length-1].value,o,kI(o,$,t))?n[n.length-1].value=o:n.push({value:o}):(!y||_===o)&&n.push({value:_}),n}function kI(t,e,{horizontal:n,minRotation:r}){const i=bo(r),s=(n?Math.sin(i):Math.cos(i))||.001,a=.75*e*(""+t).length;return Math.min(e/s,a)}class hX extends Fu{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,n){return dt(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:n,maxDefined:r}=this.getUserBounds();let{min:i,max:s}=this;const a=l=>i=n?i:l,o=l=>s=r?s:l;if(e){const l=bu(i),u=bu(s);l<0&&u<0?o(0):l>0&&u>0&&a(0)}if(i===s){let l=s===0?1:Math.abs(s*.05);o(s+l),e||a(i-l)}this.min=i,this.max=s}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:n,stepSize:r}=e,i;return r?(i=Math.ceil(this.max/r)-Math.floor(this.min/r)+1,i>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${r} would result generating up to ${i} ticks. Limiting to 1000.`),i=1e3)):(i=this.computeTickLimit(),n=n||11),n&&(i=Math.min(n,i)),i}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,n=e.ticks;let r=this.getTickLimit();r=Math.max(2,r);const i={maxTicks:r,bounds:e.bounds,min:e.min,max:e.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},s=this._range||this,a=dX(i,s);return e.bounds==="ticks"&&LG(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const e=this.ticks;let n=this.min,r=this.max;if(super.configure(),this.options.offset&&e.length){const i=(r-n)/Math.max(e.length-1,1)/2;n-=i,r+=i}this._startValue=n,this._endValue=r,this._valueRange=r-n}getLabelForValue(e){return GO(e,this.chart.options.locale,this.options.ticks.format)}}class Kw extends hX{determineDataLimits(){const{min:e,max:n}=this.getMinMax(!0);this.min=Tn(e)?e:0,this.max=Tn(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),n=e?this.width:this.height,r=bo(this.options.ticks.minRotation),i=(e?Math.sin(r):Math.cos(r))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,s.lineHeight/i))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}re(Kw,"id","linear"),re(Kw,"defaults",{ticks:{callback:KO.formatters.numeric}});const Wg={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Wn=Object.keys(Wg);function $I(t,e){return t-e}function CI(t,e){if(dt(e))return null;const n=t._adapter,{parser:r,round:i,isoWeekday:s}=t._parseOpts;let a=e;return typeof r=="function"&&(a=r(a)),Tn(a)||(a=typeof r=="string"?n.parse(a,r):n.parse(a)),a===null?null:(i&&(a=i==="week"&&(ah(s)||s===!0)?n.startOf(a,"isoWeek",s):n.startOf(a,i)),+a)}function AI(t,e,n,r){const i=Wn.length;for(let s=Wn.indexOf(t);s<i-1;++s){const a=Wg[Wn[s]],o=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((n-e)/(o*a.size))<=r)return Wn[s]}return Wn[i-1]}function fX(t,e,n,r,i){for(let s=Wn.length-1;s>=Wn.indexOf(n);s--){const a=Wn[s];if(Wg[a].common&&t._adapter.diff(i,r,a)>=e-1)return a}return Wn[n?Wn.indexOf(n):0]}function pX(t){for(let e=Wn.indexOf(t)+1,n=Wn.length;e<n;++e)if(Wg[Wn[e]].common)return Wn[e]}function RI(t,e,n){if(!n)t[e]=!0;else if(n.length){const{lo:r,hi:i}=xx(n,e),s=n[r]>=e?n[r]:n[i];t[s]=!0}}function mX(t,e,n,r){const i=t._adapter,s=+i.startOf(e[0].value,r),a=e[e.length-1].value;let o,l;for(o=s;o<=a;o=+i.add(o,1,r))l=n[o],l>=0&&(e[l].major=!0);return e}function PI(t,e,n){const r=[],i={},s=e.length;let a,o;for(a=0;a<s;++a)o=e[a],i[o]=a,r.push({value:o,major:!1});return s===0||!n?r:mX(t,r,i,n)}class uh extends Fu{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,n={}){const r=e.time||(e.time={}),i=this._adapter=new cD._date(e.adapters.date);i.init(n),wd(r.displayFormats,i.formats()),this._parseOpts={parser:r.parser,round:r.round,isoWeekday:r.isoWeekday},super.init(e),this._normalized=n.normalized}parse(e,n){return e===void 0?null:CI(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,n=this._adapter,r=e.time.unit||"day";let{min:i,max:s,minDefined:a,maxDefined:o}=this.getUserBounds();function l(u){!a&&!isNaN(u.min)&&(i=Math.min(i,u.min)),!o&&!isNaN(u.max)&&(s=Math.max(s,u.max))}(!a||!o)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),i=Tn(i)&&!isNaN(i)?i:+n.startOf(Date.now(),r),s=Tn(s)&&!isNaN(s)?s:+n.endOf(Date.now(),r)+1,this.min=Math.min(i,s-1),this.max=Math.max(i+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return e.length&&(n=e[0],r=e[e.length-1]),{min:n,max:r}}buildTicks(){const e=this.options,n=e.time,r=e.ticks,i=r.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const s=this.min,a=this.max,o=jG(i,s,a);return this._unit=n.unit||(r.autoSkip?AI(n.minUnit,this.min,this.max,this._getLabelCapacity(s)):fX(this,o.length,n.minUnit,this.min,this.max)),this._majorUnit=!r.major.enabled||this._unit==="year"?void 0:pX(this._unit),this.initOffsets(i),e.reverse&&o.reverse(),PI(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let n=0,r=0,i,s;this.options.offset&&e.length&&(i=this.getDecimalForValue(e[0]),e.length===1?n=1-i:n=(this.getDecimalForValue(e[1])-i)/2,s=this.getDecimalForValue(e[e.length-1]),e.length===1?r=s:r=(s-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;n=wr(n,0,a),r=wr(r,0,a),this._offsets={start:n,end:r,factor:1/(n+1+r)}}_generate(){const e=this._adapter,n=this.min,r=this.max,i=this.options,s=i.time,a=s.unit||AI(s.minUnit,n,r,this._getLabelCapacity(n)),o=Be(i.ticks.stepSize,1),l=a==="week"?s.isoWeekday:!1,u=ah(l)||l===!0,c={};let d=n,h,m;if(u&&(d=+e.startOf(d,"isoWeek",l)),d=+e.startOf(d,u?"day":a),e.diff(r,n,a)>1e5*o)throw new Error(n+" and "+r+" are too far apart with stepSize of "+o+" "+a);const g=i.ticks.source==="data"&&this.getDataTimestamps();for(h=d,m=0;h<r;h=+e.add(h,o,a),m++)RI(c,h,g);return(h===r||i.bounds==="ticks"||m===1)&&RI(c,h,g),Object.keys(c).sort($I).map(w=>+w)}getLabelForValue(e){const n=this._adapter,r=this.options.time;return r.tooltipFormat?n.format(e,r.tooltipFormat):n.format(e,r.displayFormats.datetime)}format(e,n){const i=this.options.time.displayFormats,s=this._unit,a=n||i[s];return this._adapter.format(e,a)}_tickFormatFunction(e,n,r,i){const s=this.options,a=s.ticks.callback;if(a)return ft(a,[e,n,r],this);const o=s.time.displayFormats,l=this._unit,u=this._majorUnit,c=l&&o[l],d=u&&o[u],h=r[n],m=u&&d&&h&&h.major;return this._adapter.format(e,i||(m?d:c))}generateTickLabels(e){let n,r,i;for(n=0,r=e.length;n<r;++n)i=e[n],i.label=this._tickFormatFunction(i.value,n,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const n=this._offsets,r=this.getDecimalForValue(e);return this.getPixelForDecimal((n.start+r)*n.factor)}getValueForPixel(e){const n=this._offsets,r=this.getDecimalForPixel(e)/n.factor-n.end;return this.min+r*(this.max-this.min)}_getLabelSize(e){const n=this.options.ticks,r=this.ctx.measureText(e).width,i=bo(this.isHorizontal()?n.maxRotation:n.minRotation),s=Math.cos(i),a=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:r*s+o*a,h:r*a+o*s}}_getLabelCapacity(e){const n=this.options.time,r=n.displayFormats,i=r[n.unit]||r.millisecond,s=this._tickFormatFunction(e,0,PI(this,[e],this._majorUnit),i),a=this._getLabelSize(s),o=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return o>0?o:1}getDataTimestamps(){let e=this._cache.data||[],n,r;if(e.length)return e;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(n=0,r=i.length;n<r;++n)e=e.concat(i[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let n,r;if(e.length)return e;const i=this.getLabels();for(n=0,r=i.length;n<r;++n)e.push(CI(this,i[n]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return HG(e.sort($I))}}re(uh,"id","time"),re(uh,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Jf(t,e,n){let r=0,i=t.length-1,s,a,o,l;n?(e>=t[r].pos&&e<=t[i].pos&&({lo:r,hi:i}=xo(t,"pos",e)),{pos:s,time:o}=t[r],{pos:a,time:l}=t[i]):(e>=t[r].time&&e<=t[i].time&&({lo:r,hi:i}=xo(t,"time",e)),{time:s,pos:o}=t[r],{time:a,pos:l}=t[i]);const u=a-s;return u?o+(l-o)*(e-s)/u:o}class NI extends uh{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(e);this._minPos=Jf(n,this.min),this._tableRange=Jf(n,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:n,max:r}=this,i=[],s=[];let a,o,l,u,c;for(a=0,o=e.length;a<o;++a)u=e[a],u>=n&&u<=r&&i.push(u);if(i.length<2)return[{time:n,pos:0},{time:r,pos:1}];for(a=0,o=i.length;a<o;++a)c=i[a+1],l=i[a-1],u=i[a],Math.round((c+l)/2)!==u&&s.push({time:u,pos:a/(o-1)});return s}_generate(){const e=this.min,n=this.max;let r=super.getDataTimestamps();return(!r.includes(e)||!r.length)&&r.splice(0,0,e),(!r.includes(n)||r.length===1)&&r.push(n),r.sort((i,s)=>i-s)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const n=this.getDataTimestamps(),r=this.getLabelTimestamps();return n.length&&r.length?e=this.normalize(n.concat(r)):e=n.length?n:r,e=this._cache.all=e,e}getDecimalForValue(e){return(Jf(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const n=this._offsets,r=this.getDecimalForPixel(e)/n.factor-n.end;return Jf(this._table,r*this._tableRange+this._minPos,!0)}}re(NI,"id","timeseries"),re(NI,"defaults",uh.defaults);const ID=6048e5,gX=864e5,Ah=6e4,Rh=36e5,yX=1e3,OI=Symbol.for("constructDateFrom");function At(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&OI in t?t[OI](e):t instanceof Date?new t.constructor(e):new Date(e)}function Ce(t,e){return At(e||t,t)}function Hg(t,e,n){const r=Ce(t,n==null?void 0:n.in);return isNaN(e)?At((n==null?void 0:n.in)||t,NaN):(e&&r.setDate(r.getDate()+e),r)}function Ax(t,e,n){const r=Ce(t,n==null?void 0:n.in);if(isNaN(e))return At(t,NaN);if(!e)return r;const i=r.getDate(),s=At(t,r.getTime());s.setMonth(r.getMonth()+e+1,0);const a=s.getDate();return i>=a?s:(r.setFullYear(s.getFullYear(),s.getMonth(),i),r)}function Rx(t,e,n){return At(t,+Ce(t)+e)}function _X(t,e,n){return Rx(t,e*Rh)}let wX={};function Zo(){return wX}function Li(t,e){var o,l,u,c;const n=Zo(),r=(e==null?void 0:e.weekStartsOn)??((l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)??n.weekStartsOn??((c=(u=n.locale)==null?void 0:u.options)==null?void 0:c.weekStartsOn)??0,i=Ce(t,e==null?void 0:e.in),s=i.getDay(),a=(s<r?7:0)+s-r;return i.setDate(i.getDate()-a),i.setHours(0,0,0,0),i}function Eu(t,e){return Li(t,{...e,weekStartsOn:1})}function kD(t,e){const n=Ce(t,e==null?void 0:e.in),r=n.getFullYear(),i=At(n,0);i.setFullYear(r+1,0,4),i.setHours(0,0,0,0);const s=Eu(i),a=At(n,0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);const o=Eu(a);return n.getTime()>=s.getTime()?r+1:n.getTime()>=o.getTime()?r:r-1}function Bm(t){const e=Ce(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function el(t,...e){const n=At.bind(null,e.find(r=>typeof r=="object"));return e.map(n)}function Yw(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setHours(0,0,0,0),n}function $D(t,e,n){const[r,i]=el(n==null?void 0:n.in,t,e),s=Yw(r),a=Yw(i),o=+s-Bm(s),l=+a-Bm(a);return Math.round((o-l)/gX)}function vX(t,e){const n=kD(t,e),r=At(t,0);return r.setFullYear(n,0,4),r.setHours(0,0,0,0),Eu(r)}function bX(t,e,n){const r=Ce(t,n==null?void 0:n.in);return r.setTime(r.getTime()+e*Ah),r}function xX(t,e,n){return Ax(t,e*3,n)}function TX(t,e,n){return Rx(t,e*1e3)}function EX(t,e,n){return Hg(t,e*7,n)}function SX(t,e,n){return Ax(t,e*12,n)}function Sd(t,e){const n=+Ce(t)-+Ce(e);return n<0?-1:n>0?1:n}function IX(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function CD(t){return!(!IX(t)&&typeof t!="number"||isNaN(+Ce(t)))}function kX(t,e,n){const[r,i]=el(n==null?void 0:n.in,t,e),s=r.getFullYear()-i.getFullYear(),a=r.getMonth()-i.getMonth();return s*12+a}function $X(t,e,n){const[r,i]=el(n==null?void 0:n.in,t,e);return r.getFullYear()-i.getFullYear()}function AD(t,e,n){const[r,i]=el(n==null?void 0:n.in,t,e),s=DI(r,i),a=Math.abs($D(r,i));r.setDate(r.getDate()-s*a);const o=+(DI(r,i)===-s),l=s*(a-o);return l===0?0:l}function DI(t,e){const n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}function Ph(t){return e=>{const r=(t?Math[t]:Math.trunc)(e);return r===0?0:r}}function CX(t,e,n){const[r,i]=el(n==null?void 0:n.in,t,e),s=(+r-+i)/Rh;return Ph(n==null?void 0:n.roundingMethod)(s)}function Px(t,e){return+Ce(t)-+Ce(e)}function AX(t,e,n){const r=Px(t,e)/Ah;return Ph(n==null?void 0:n.roundingMethod)(r)}function RD(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setHours(23,59,59,999),n}function PD(t,e){const n=Ce(t,e==null?void 0:e.in),r=n.getMonth();return n.setFullYear(n.getFullYear(),r+1,0),n.setHours(23,59,59,999),n}function RX(t,e){const n=Ce(t,e==null?void 0:e.in);return+RD(n,e)==+PD(n,e)}function ND(t,e,n){const[r,i,s]=el(n==null?void 0:n.in,t,t,e),a=Sd(i,s),o=Math.abs(kX(i,s));if(o<1)return 0;i.getMonth()===1&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-a*o);let l=Sd(i,s)===-a;RX(r)&&o===1&&Sd(r,s)===1&&(l=!1);const u=a*(o-+l);return u===0?0:u}function PX(t,e,n){const r=ND(t,e,n)/3;return Ph(n==null?void 0:n.roundingMethod)(r)}function NX(t,e,n){const r=Px(t,e)/1e3;return Ph(n==null?void 0:n.roundingMethod)(r)}function OX(t,e,n){const r=AD(t,e,n)/7;return Ph(n==null?void 0:n.roundingMethod)(r)}function DX(t,e,n){const[r,i]=el(n==null?void 0:n.in,t,e),s=Sd(r,i),a=Math.abs($X(r,i));r.setFullYear(1584),i.setFullYear(1584);const o=Sd(r,i)===-s,l=s*(a-+o);return l===0?0:l}function MX(t,e){const n=Ce(t,e==null?void 0:e.in),r=n.getMonth(),i=r-r%3;return n.setMonth(i,1),n.setHours(0,0,0,0),n}function LX(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setDate(1),n.setHours(0,0,0,0),n}function zX(t,e){const n=Ce(t,e==null?void 0:e.in),r=n.getFullYear();return n.setFullYear(r+1,0,0),n.setHours(23,59,59,999),n}function OD(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}function VX(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setMinutes(59,59,999),n}function FX(t,e){var o,l;const n=Zo(),r=n.weekStartsOn??((l=(o=n.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)??0,i=Ce(t,e==null?void 0:e.in),s=i.getDay(),a=(s<r?-7:0)+6-(s-r);return i.setDate(i.getDate()+a),i.setHours(23,59,59,999),i}function BX(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setSeconds(59,999),n}function UX(t,e){const n=Ce(t,e==null?void 0:e.in),r=n.getMonth(),i=r-r%3+3;return n.setMonth(i,0),n.setHours(23,59,59,999),n}function jX(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setMilliseconds(999),n}const WX={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},HX=(t,e,n)=>{let r;const i=WX[t];return typeof i=="string"?r=i:e===1?r=i.one:r=i.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function h_(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const qX={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},GX={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},KX={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},YX={date:h_({formats:qX,defaultWidth:"full"}),time:h_({formats:GX,defaultWidth:"full"}),dateTime:h_({formats:KX,defaultWidth:"full"})},QX={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},XX=(t,e,n,r)=>QX[t];function kc(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let i;if(r==="formatting"&&t.formattingValues){const a=t.defaultFormattingWidth||t.defaultWidth,o=n!=null&&n.width?String(n.width):a;i=t.formattingValues[o]||t.formattingValues[a]}else{const a=t.defaultWidth,o=n!=null&&n.width?String(n.width):t.defaultWidth;i=t.values[o]||t.values[a]}const s=t.argumentCallback?t.argumentCallback(e):e;return i[s]}}const JX={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ZX={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},eJ={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},tJ={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},nJ={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},rJ={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},iJ=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},sJ={ordinalNumber:iJ,era:kc({values:JX,defaultWidth:"wide"}),quarter:kc({values:ZX,defaultWidth:"wide",argumentCallback:t=>t-1}),month:kc({values:eJ,defaultWidth:"wide"}),day:kc({values:tJ,defaultWidth:"wide"}),dayPeriod:kc({values:nJ,defaultWidth:"wide",formattingValues:rJ,defaultFormattingWidth:"wide"})};function $c(t){return(e,n={})=>{const r=n.width,i=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;const a=s[0],o=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(o)?oJ(o,d=>d.test(a)):aJ(o,d=>d.test(a));let u;u=t.valueCallback?t.valueCallback(l):l,u=n.valueCallback?n.valueCallback(u):u;const c=e.slice(a.length);return{value:u,rest:c}}}function aJ(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function oJ(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function lJ(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const i=r[0],s=e.match(t.parsePattern);if(!s)return null;let a=t.valueCallback?t.valueCallback(s[0]):s[0];a=n.valueCallback?n.valueCallback(a):a;const o=e.slice(i.length);return{value:a,rest:o}}}const uJ=/^(\d+)(th|st|nd|rd)?/i,cJ=/\d+/i,dJ={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},hJ={any:[/^b/i,/^(a|c)/i]},fJ={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},pJ={any:[/1/i,/2/i,/3/i,/4/i]},mJ={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},gJ={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},yJ={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},_J={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},wJ={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},vJ={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},bJ={ordinalNumber:lJ({matchPattern:uJ,parsePattern:cJ,valueCallback:t=>parseInt(t,10)}),era:$c({matchPatterns:dJ,defaultMatchWidth:"wide",parsePatterns:hJ,defaultParseWidth:"any"}),quarter:$c({matchPatterns:fJ,defaultMatchWidth:"wide",parsePatterns:pJ,defaultParseWidth:"any",valueCallback:t=>t+1}),month:$c({matchPatterns:mJ,defaultMatchWidth:"wide",parsePatterns:gJ,defaultParseWidth:"any"}),day:$c({matchPatterns:yJ,defaultMatchWidth:"wide",parsePatterns:_J,defaultParseWidth:"any"}),dayPeriod:$c({matchPatterns:wJ,defaultMatchWidth:"any",parsePatterns:vJ,defaultParseWidth:"any"})},DD={code:"en-US",formatDistance:HX,formatLong:YX,formatRelative:XX,localize:sJ,match:bJ,options:{weekStartsOn:0,firstWeekContainsDate:1}};function xJ(t,e){const n=Ce(t,e==null?void 0:e.in);return $D(n,OD(n))+1}function MD(t,e){const n=Ce(t,e==null?void 0:e.in),r=+Eu(n)-+vX(n);return Math.round(r/ID)+1}function Nx(t,e){var c,d,h,m;const n=Ce(t,e==null?void 0:e.in),r=n.getFullYear(),i=Zo(),s=(e==null?void 0:e.firstWeekContainsDate)??((d=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??i.firstWeekContainsDate??((m=(h=i.locale)==null?void 0:h.options)==null?void 0:m.firstWeekContainsDate)??1,a=At((e==null?void 0:e.in)||t,0);a.setFullYear(r+1,0,s),a.setHours(0,0,0,0);const o=Li(a,e),l=At((e==null?void 0:e.in)||t,0);l.setFullYear(r,0,s),l.setHours(0,0,0,0);const u=Li(l,e);return+n>=+o?r+1:+n>=+u?r:r-1}function TJ(t,e){var o,l,u,c;const n=Zo(),r=(e==null?void 0:e.firstWeekContainsDate)??((l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.firstWeekContainsDate)??n.firstWeekContainsDate??((c=(u=n.locale)==null?void 0:u.options)==null?void 0:c.firstWeekContainsDate)??1,i=Nx(t,e),s=At((e==null?void 0:e.in)||t,0);return s.setFullYear(i,0,r),s.setHours(0,0,0,0),Li(s,e)}function LD(t,e){const n=Ce(t,e==null?void 0:e.in),r=+Li(n,e)-+TJ(n,e);return Math.round(r/ID)+1}function Ze(t,e){const n=t<0?"-":"",r=Math.abs(t).toString().padStart(e,"0");return n+r}const Ls={y(t,e){const n=t.getFullYear(),r=n>0?n:1-n;return Ze(e==="yy"?r%100:r,e.length)},M(t,e){const n=t.getMonth();return e==="M"?String(n+1):Ze(n+1,2)},d(t,e){return Ze(t.getDate(),e.length)},a(t,e){const n=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,e){return Ze(t.getHours()%12||12,e.length)},H(t,e){return Ze(t.getHours(),e.length)},m(t,e){return Ze(t.getMinutes(),e.length)},s(t,e){return Ze(t.getSeconds(),e.length)},S(t,e){const n=e.length,r=t.getMilliseconds(),i=Math.trunc(r*Math.pow(10,n-3));return Ze(i,e.length)}},El={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},MI={G:function(t,e,n){const r=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(t,e,n){if(e==="yo"){const r=t.getFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return Ls.y(t,e)},Y:function(t,e,n,r){const i=Nx(t,r),s=i>0?i:1-i;if(e==="YY"){const a=s%100;return Ze(a,2)}return e==="Yo"?n.ordinalNumber(s,{unit:"year"}):Ze(s,e.length)},R:function(t,e){const n=kD(t);return Ze(n,e.length)},u:function(t,e){const n=t.getFullYear();return Ze(n,e.length)},Q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Ze(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(t,e,n){const r=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Ze(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(t,e,n){const r=t.getMonth();switch(e){case"M":case"MM":return Ls.M(t,e);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(t,e,n){const r=t.getMonth();switch(e){case"L":return String(r+1);case"LL":return Ze(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(t,e,n,r){const i=LD(t,r);return e==="wo"?n.ordinalNumber(i,{unit:"week"}):Ze(i,e.length)},I:function(t,e,n){const r=MD(t);return e==="Io"?n.ordinalNumber(r,{unit:"week"}):Ze(r,e.length)},d:function(t,e,n){return e==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):Ls.d(t,e)},D:function(t,e,n){const r=xJ(t);return e==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Ze(r,e.length)},E:function(t,e,n){const r=t.getDay();switch(e){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(t,e,n,r){const i=t.getDay(),s=(i-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(s);case"ee":return Ze(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(t,e,n,r){const i=t.getDay(),s=(i-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(s);case"cc":return Ze(s,e.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(t,e,n){const r=t.getDay(),i=r===0?7:r;switch(e){case"i":return String(i);case"ii":return Ze(i,e.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(t,e,n){const i=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,e,n){const r=t.getHours();let i;switch(r===12?i=El.noon:r===0?i=El.midnight:i=r/12>=1?"pm":"am",e){case"b":case"bb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,e,n){const r=t.getHours();let i;switch(r>=17?i=El.evening:r>=12?i=El.afternoon:r>=4?i=El.morning:i=El.night,e){case"B":case"BB":case"BBB":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,e,n){if(e==="ho"){let r=t.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return Ls.h(t,e)},H:function(t,e,n){return e==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):Ls.H(t,e)},K:function(t,e,n){const r=t.getHours()%12;return e==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Ze(r,e.length)},k:function(t,e,n){let r=t.getHours();return r===0&&(r=24),e==="ko"?n.ordinalNumber(r,{unit:"hour"}):Ze(r,e.length)},m:function(t,e,n){return e==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):Ls.m(t,e)},s:function(t,e,n){return e==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):Ls.s(t,e)},S:function(t,e){return Ls.S(t,e)},X:function(t,e,n){const r=t.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return zI(r);case"XXXX":case"XX":return fo(r);case"XXXXX":case"XXX":default:return fo(r,":")}},x:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"x":return zI(r);case"xxxx":case"xx":return fo(r);case"xxxxx":case"xxx":default:return fo(r,":")}},O:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+LI(r,":");case"OOOO":default:return"GMT"+fo(r,":")}},z:function(t,e,n){const r=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+LI(r,":");case"zzzz":default:return"GMT"+fo(r,":")}},t:function(t,e,n){const r=Math.trunc(+t/1e3);return Ze(r,e.length)},T:function(t,e,n){return Ze(+t,e.length)}};function LI(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Math.trunc(r/60),s=r%60;return s===0?n+String(i):n+String(i)+e+Ze(s,2)}function zI(t,e){return t%60===0?(t>0?"-":"+")+Ze(Math.abs(t)/60,2):fo(t,e)}function fo(t,e=""){const n=t>0?"-":"+",r=Math.abs(t),i=Ze(Math.trunc(r/60),2),s=Ze(r%60,2);return n+i+e+s}const VI=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},zD=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},EJ=(t,e)=>{const n=t.match(/(P+)(p+)?/)||[],r=n[1],i=n[2];if(!i)return VI(t,e);let s;switch(r){case"P":s=e.dateTime({width:"short"});break;case"PP":s=e.dateTime({width:"medium"});break;case"PPP":s=e.dateTime({width:"long"});break;case"PPPP":default:s=e.dateTime({width:"full"});break}return s.replace("{{date}}",VI(r,e)).replace("{{time}}",zD(i,e))},Qw={p:zD,P:EJ},SJ=/^D+$/,IJ=/^Y+$/,kJ=["D","DD","YY","YYYY"];function VD(t){return SJ.test(t)}function FD(t){return IJ.test(t)}function Xw(t,e,n){const r=$J(t,e,n);if(console.warn(r),kJ.includes(t))throw new RangeError(r)}function $J(t,e,n){const r=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const CJ=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,AJ=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,RJ=/^'([^]*?)'?$/,PJ=/''/g,NJ=/[a-zA-Z]/;function OJ(t,e,n){var c,d,h,m,g,w,x,v;const r=Zo(),i=(n==null?void 0:n.locale)??r.locale??DD,s=(n==null?void 0:n.firstWeekContainsDate)??((d=(c=n==null?void 0:n.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((m=(h=r.locale)==null?void 0:h.options)==null?void 0:m.firstWeekContainsDate)??1,a=(n==null?void 0:n.weekStartsOn)??((w=(g=n==null?void 0:n.locale)==null?void 0:g.options)==null?void 0:w.weekStartsOn)??r.weekStartsOn??((v=(x=r.locale)==null?void 0:x.options)==null?void 0:v.weekStartsOn)??0,o=Ce(t,n==null?void 0:n.in);if(!CD(o))throw new RangeError("Invalid time value");let l=e.match(AJ).map(y=>{const E=y[0];if(E==="p"||E==="P"){const $=Qw[E];return $(y,i.formatLong)}return y}).join("").match(CJ).map(y=>{if(y==="''")return{isToken:!1,value:"'"};const E=y[0];if(E==="'")return{isToken:!1,value:DJ(y)};if(MI[E])return{isToken:!0,value:y};if(E.match(NJ))throw new RangeError("Format string contains an unescaped latin alphabet character `"+E+"`");return{isToken:!1,value:y}});i.localize.preprocessor&&(l=i.localize.preprocessor(o,l));const u={firstWeekContainsDate:s,weekStartsOn:a,locale:i};return l.map(y=>{if(!y.isToken)return y.value;const E=y.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&FD(E)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&VD(E))&&Xw(E,e,String(t));const $=MI[E[0]];return $(o,E,i.localize,u)}).join("")}function DJ(t){const e=t.match(RJ);return e?e[1].replace(PJ,"'"):t}function MJ(){return Object.assign({},Zo())}function LJ(t,e){const n=Ce(t,e==null?void 0:e.in).getDay();return n===0?7:n}function zJ(t,e){const n=VJ(e)?new e(0):At(e,0);return n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),n.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),n}function VJ(t){var e;return typeof t=="function"&&((e=t.prototype)==null?void 0:e.constructor)===t}const FJ=10;class BD{constructor(){re(this,"subPriority",0)}validate(e,n){return!0}}class BJ extends BD{constructor(e,n,r,i,s){super(),this.value=e,this.validateValue=n,this.setValue=r,this.priority=i,s&&(this.subPriority=s)}validate(e,n){return this.validateValue(e,this.value,n)}set(e,n,r){return this.setValue(e,n,this.value,r)}}class UJ extends BD{constructor(n,r){super();re(this,"priority",FJ);re(this,"subPriority",-1);this.context=n||(i=>At(r,i))}set(n,r){return r.timestampIsSet?n:At(n,zJ(n,this.context))}}class Ye{run(e,n,r,i){const s=this.parse(e,n,r,i);return s?{setter:new BJ(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}:null}validate(e,n,r){return!0}}class jJ extends Ye{constructor(){super(...arguments);re(this,"priority",140);re(this,"incompatibleTokens",["R","u","t","T"])}parse(n,r,i){switch(r){case"G":case"GG":case"GGG":return i.era(n,{width:"abbreviated"})||i.era(n,{width:"narrow"});case"GGGGG":return i.era(n,{width:"narrow"});case"GGGG":default:return i.era(n,{width:"wide"})||i.era(n,{width:"abbreviated"})||i.era(n,{width:"narrow"})}}set(n,r,i){return r.era=i,n.setFullYear(i,0,1),n.setHours(0,0,0,0),n}}const Lt={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},xi={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function zt(t,e){return t&&{value:e(t.value),rest:t.rest}}function vt(t,e){const n=e.match(t);return n?{value:parseInt(n[0],10),rest:e.slice(n[0].length)}:null}function Ti(t,e){const n=e.match(t);if(!n)return null;if(n[0]==="Z")return{value:0,rest:e.slice(1)};const r=n[1]==="+"?1:-1,i=n[2]?parseInt(n[2],10):0,s=n[3]?parseInt(n[3],10):0,a=n[5]?parseInt(n[5],10):0;return{value:r*(i*Rh+s*Ah+a*yX),rest:e.slice(n[0].length)}}function UD(t){return vt(Lt.anyDigitsSigned,t)}function Rt(t,e){switch(t){case 1:return vt(Lt.singleDigit,e);case 2:return vt(Lt.twoDigits,e);case 3:return vt(Lt.threeDigits,e);case 4:return vt(Lt.fourDigits,e);default:return vt(new RegExp("^\\d{1,"+t+"}"),e)}}function Um(t,e){switch(t){case 1:return vt(Lt.singleDigitSigned,e);case 2:return vt(Lt.twoDigitsSigned,e);case 3:return vt(Lt.threeDigitsSigned,e);case 4:return vt(Lt.fourDigitsSigned,e);default:return vt(new RegExp("^-?\\d{1,"+t+"}"),e)}}function Ox(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function jD(t,e){const n=e>0,r=n?e:1-e;let i;if(r<=50)i=t||100;else{const s=r+50,a=Math.trunc(s/100)*100,o=t>=s%100;i=t+a-(o?100:0)}return n?i:1-i}function WD(t){return t%400===0||t%4===0&&t%100!==0}class WJ extends Ye{constructor(){super(...arguments);re(this,"priority",130);re(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(n,r,i){const s=a=>({year:a,isTwoDigitYear:r==="yy"});switch(r){case"y":return zt(Rt(4,n),s);case"yo":return zt(i.ordinalNumber(n,{unit:"year"}),s);default:return zt(Rt(r.length,n),s)}}validate(n,r){return r.isTwoDigitYear||r.year>0}set(n,r,i){const s=n.getFullYear();if(i.isTwoDigitYear){const o=jD(i.year,s);return n.setFullYear(o,0,1),n.setHours(0,0,0,0),n}const a=!("era"in r)||r.era===1?i.year:1-i.year;return n.setFullYear(a,0,1),n.setHours(0,0,0,0),n}}class HJ extends Ye{constructor(){super(...arguments);re(this,"priority",130);re(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(n,r,i){const s=a=>({year:a,isTwoDigitYear:r==="YY"});switch(r){case"Y":return zt(Rt(4,n),s);case"Yo":return zt(i.ordinalNumber(n,{unit:"year"}),s);default:return zt(Rt(r.length,n),s)}}validate(n,r){return r.isTwoDigitYear||r.year>0}set(n,r,i,s){const a=Nx(n,s);if(i.isTwoDigitYear){const l=jD(i.year,a);return n.setFullYear(l,0,s.firstWeekContainsDate),n.setHours(0,0,0,0),Li(n,s)}const o=!("era"in r)||r.era===1?i.year:1-i.year;return n.setFullYear(o,0,s.firstWeekContainsDate),n.setHours(0,0,0,0),Li(n,s)}}class qJ extends Ye{constructor(){super(...arguments);re(this,"priority",130);re(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(n,r){return Um(r==="R"?4:r.length,n)}set(n,r,i){const s=At(n,0);return s.setFullYear(i,0,4),s.setHours(0,0,0,0),Eu(s)}}class GJ extends Ye{constructor(){super(...arguments);re(this,"priority",130);re(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(n,r){return Um(r==="u"?4:r.length,n)}set(n,r,i){return n.setFullYear(i,0,1),n.setHours(0,0,0,0),n}}class KJ extends Ye{constructor(){super(...arguments);re(this,"priority",120);re(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"Q":case"QQ":return Rt(r.length,n);case"Qo":return i.ordinalNumber(n,{unit:"quarter"});case"QQQ":return i.quarter(n,{width:"abbreviated",context:"formatting"})||i.quarter(n,{width:"narrow",context:"formatting"});case"QQQQQ":return i.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(n,{width:"wide",context:"formatting"})||i.quarter(n,{width:"abbreviated",context:"formatting"})||i.quarter(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=1&&r<=4}set(n,r,i){return n.setMonth((i-1)*3,1),n.setHours(0,0,0,0),n}}class YJ extends Ye{constructor(){super(...arguments);re(this,"priority",120);re(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"q":case"qq":return Rt(r.length,n);case"qo":return i.ordinalNumber(n,{unit:"quarter"});case"qqq":return i.quarter(n,{width:"abbreviated",context:"standalone"})||i.quarter(n,{width:"narrow",context:"standalone"});case"qqqqq":return i.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(n,{width:"wide",context:"standalone"})||i.quarter(n,{width:"abbreviated",context:"standalone"})||i.quarter(n,{width:"narrow",context:"standalone"})}}validate(n,r){return r>=1&&r<=4}set(n,r,i){return n.setMonth((i-1)*3,1),n.setHours(0,0,0,0),n}}class QJ extends Ye{constructor(){super(...arguments);re(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);re(this,"priority",110)}parse(n,r,i){const s=a=>a-1;switch(r){case"M":return zt(vt(Lt.month,n),s);case"MM":return zt(Rt(2,n),s);case"Mo":return zt(i.ordinalNumber(n,{unit:"month"}),s);case"MMM":return i.month(n,{width:"abbreviated",context:"formatting"})||i.month(n,{width:"narrow",context:"formatting"});case"MMMMM":return i.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(n,{width:"wide",context:"formatting"})||i.month(n,{width:"abbreviated",context:"formatting"})||i.month(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=0&&r<=11}set(n,r,i){return n.setMonth(i,1),n.setHours(0,0,0,0),n}}class XJ extends Ye{constructor(){super(...arguments);re(this,"priority",110);re(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(n,r,i){const s=a=>a-1;switch(r){case"L":return zt(vt(Lt.month,n),s);case"LL":return zt(Rt(2,n),s);case"Lo":return zt(i.ordinalNumber(n,{unit:"month"}),s);case"LLL":return i.month(n,{width:"abbreviated",context:"standalone"})||i.month(n,{width:"narrow",context:"standalone"});case"LLLLL":return i.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(n,{width:"wide",context:"standalone"})||i.month(n,{width:"abbreviated",context:"standalone"})||i.month(n,{width:"narrow",context:"standalone"})}}validate(n,r){return r>=0&&r<=11}set(n,r,i){return n.setMonth(i,1),n.setHours(0,0,0,0),n}}function JJ(t,e,n){const r=Ce(t,n==null?void 0:n.in),i=LD(r,n)-e;return r.setDate(r.getDate()-i*7),Ce(r,n==null?void 0:n.in)}class ZJ extends Ye{constructor(){super(...arguments);re(this,"priority",100);re(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(n,r,i){switch(r){case"w":return vt(Lt.week,n);case"wo":return i.ordinalNumber(n,{unit:"week"});default:return Rt(r.length,n)}}validate(n,r){return r>=1&&r<=53}set(n,r,i,s){return Li(JJ(n,i,s),s)}}function eZ(t,e,n){const r=Ce(t,n==null?void 0:n.in),i=MD(r,n)-e;return r.setDate(r.getDate()-i*7),r}class tZ extends Ye{constructor(){super(...arguments);re(this,"priority",100);re(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(n,r,i){switch(r){case"I":return vt(Lt.week,n);case"Io":return i.ordinalNumber(n,{unit:"week"});default:return Rt(r.length,n)}}validate(n,r){return r>=1&&r<=53}set(n,r,i){return Eu(eZ(n,i))}}const nZ=[31,28,31,30,31,30,31,31,30,31,30,31],rZ=[31,29,31,30,31,30,31,31,30,31,30,31];class iZ extends Ye{constructor(){super(...arguments);re(this,"priority",90);re(this,"subPriority",1);re(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"d":return vt(Lt.date,n);case"do":return i.ordinalNumber(n,{unit:"date"});default:return Rt(r.length,n)}}validate(n,r){const i=n.getFullYear(),s=WD(i),a=n.getMonth();return s?r>=1&&r<=rZ[a]:r>=1&&r<=nZ[a]}set(n,r,i){return n.setDate(i),n.setHours(0,0,0,0),n}}class sZ extends Ye{constructor(){super(...arguments);re(this,"priority",90);re(this,"subpriority",1);re(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(n,r,i){switch(r){case"D":case"DD":return vt(Lt.dayOfYear,n);case"Do":return i.ordinalNumber(n,{unit:"date"});default:return Rt(r.length,n)}}validate(n,r){const i=n.getFullYear();return WD(i)?r>=1&&r<=366:r>=1&&r<=365}set(n,r,i){return n.setMonth(0,i),n.setHours(0,0,0,0),n}}function Dx(t,e,n){var d,h,m,g;const r=Zo(),i=(n==null?void 0:n.weekStartsOn)??((h=(d=n==null?void 0:n.locale)==null?void 0:d.options)==null?void 0:h.weekStartsOn)??r.weekStartsOn??((g=(m=r.locale)==null?void 0:m.options)==null?void 0:g.weekStartsOn)??0,s=Ce(t,n==null?void 0:n.in),a=s.getDay(),l=(e%7+7)%7,u=7-i,c=e<0||e>6?e-(a+u)%7:(l+u)%7-(a+u)%7;return Hg(s,c,n)}class aZ extends Ye{constructor(){super(...arguments);re(this,"priority",90);re(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(n,r,i){switch(r){case"E":case"EE":case"EEE":return i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"EEEEE":return i.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"EEEE":default:return i.day(n,{width:"wide",context:"formatting"})||i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=0&&r<=6}set(n,r,i,s){return n=Dx(n,i,s),n.setHours(0,0,0,0),n}}class oZ extends Ye{constructor(){super(...arguments);re(this,"priority",90);re(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(n,r,i,s){const a=o=>{const l=Math.floor((o-1)/7)*7;return(o+s.weekStartsOn+6)%7+l};switch(r){case"e":case"ee":return zt(Rt(r.length,n),a);case"eo":return zt(i.ordinalNumber(n,{unit:"day"}),a);case"eee":return i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"eeeee":return i.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"});case"eeee":default:return i.day(n,{width:"wide",context:"formatting"})||i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"})}}validate(n,r){return r>=0&&r<=6}set(n,r,i,s){return n=Dx(n,i,s),n.setHours(0,0,0,0),n}}class lZ extends Ye{constructor(){super(...arguments);re(this,"priority",90);re(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(n,r,i,s){const a=o=>{const l=Math.floor((o-1)/7)*7;return(o+s.weekStartsOn+6)%7+l};switch(r){case"c":case"cc":return zt(Rt(r.length,n),a);case"co":return zt(i.ordinalNumber(n,{unit:"day"}),a);case"ccc":return i.day(n,{width:"abbreviated",context:"standalone"})||i.day(n,{width:"short",context:"standalone"})||i.day(n,{width:"narrow",context:"standalone"});case"ccccc":return i.day(n,{width:"narrow",context:"standalone"});case"cccccc":return i.day(n,{width:"short",context:"standalone"})||i.day(n,{width:"narrow",context:"standalone"});case"cccc":default:return i.day(n,{width:"wide",context:"standalone"})||i.day(n,{width:"abbreviated",context:"standalone"})||i.day(n,{width:"short",context:"standalone"})||i.day(n,{width:"narrow",context:"standalone"})}}validate(n,r){return r>=0&&r<=6}set(n,r,i,s){return n=Dx(n,i,s),n.setHours(0,0,0,0),n}}function uZ(t,e,n){const r=Ce(t,n==null?void 0:n.in),i=LJ(r,n),s=e-i;return Hg(r,s,n)}class cZ extends Ye{constructor(){super(...arguments);re(this,"priority",90);re(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(n,r,i){const s=a=>a===0?7:a;switch(r){case"i":case"ii":return Rt(r.length,n);case"io":return i.ordinalNumber(n,{unit:"day"});case"iii":return zt(i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"}),s);case"iiiii":return zt(i.day(n,{width:"narrow",context:"formatting"}),s);case"iiiiii":return zt(i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"}),s);case"iiii":default:return zt(i.day(n,{width:"wide",context:"formatting"})||i.day(n,{width:"abbreviated",context:"formatting"})||i.day(n,{width:"short",context:"formatting"})||i.day(n,{width:"narrow",context:"formatting"}),s)}}validate(n,r){return r>=1&&r<=7}set(n,r,i){return n=uZ(n,i),n.setHours(0,0,0,0),n}}class dZ extends Ye{constructor(){super(...arguments);re(this,"priority",80);re(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(n,r,i){switch(r){case"a":case"aa":case"aaa":return i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaaa":return i.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(n,{width:"wide",context:"formatting"})||i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,r,i){return n.setHours(Ox(i),0,0,0),n}}class hZ extends Ye{constructor(){super(...arguments);re(this,"priority",80);re(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(n,r,i){switch(r){case"b":case"bb":case"bbb":return i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbbb":return i.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(n,{width:"wide",context:"formatting"})||i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,r,i){return n.setHours(Ox(i),0,0,0),n}}class fZ extends Ye{constructor(){super(...arguments);re(this,"priority",80);re(this,"incompatibleTokens",["a","b","t","T"])}parse(n,r,i){switch(r){case"B":case"BB":case"BBB":return i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBBB":return i.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(n,{width:"wide",context:"formatting"})||i.dayPeriod(n,{width:"abbreviated",context:"formatting"})||i.dayPeriod(n,{width:"narrow",context:"formatting"})}}set(n,r,i){return n.setHours(Ox(i),0,0,0),n}}class pZ extends Ye{constructor(){super(...arguments);re(this,"priority",70);re(this,"incompatibleTokens",["H","K","k","t","T"])}parse(n,r,i){switch(r){case"h":return vt(Lt.hour12h,n);case"ho":return i.ordinalNumber(n,{unit:"hour"});default:return Rt(r.length,n)}}validate(n,r){return r>=1&&r<=12}set(n,r,i){const s=n.getHours()>=12;return s&&i<12?n.setHours(i+12,0,0,0):!s&&i===12?n.setHours(0,0,0,0):n.setHours(i,0,0,0),n}}class mZ extends Ye{constructor(){super(...arguments);re(this,"priority",70);re(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(n,r,i){switch(r){case"H":return vt(Lt.hour23h,n);case"Ho":return i.ordinalNumber(n,{unit:"hour"});default:return Rt(r.length,n)}}validate(n,r){return r>=0&&r<=23}set(n,r,i){return n.setHours(i,0,0,0),n}}class gZ extends Ye{constructor(){super(...arguments);re(this,"priority",70);re(this,"incompatibleTokens",["h","H","k","t","T"])}parse(n,r,i){switch(r){case"K":return vt(Lt.hour11h,n);case"Ko":return i.ordinalNumber(n,{unit:"hour"});default:return Rt(r.length,n)}}validate(n,r){return r>=0&&r<=11}set(n,r,i){return n.getHours()>=12&&i<12?n.setHours(i+12,0,0,0):n.setHours(i,0,0,0),n}}class yZ extends Ye{constructor(){super(...arguments);re(this,"priority",70);re(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(n,r,i){switch(r){case"k":return vt(Lt.hour24h,n);case"ko":return i.ordinalNumber(n,{unit:"hour"});default:return Rt(r.length,n)}}validate(n,r){return r>=1&&r<=24}set(n,r,i){const s=i<=24?i%24:i;return n.setHours(s,0,0,0),n}}class _Z extends Ye{constructor(){super(...arguments);re(this,"priority",60);re(this,"incompatibleTokens",["t","T"])}parse(n,r,i){switch(r){case"m":return vt(Lt.minute,n);case"mo":return i.ordinalNumber(n,{unit:"minute"});default:return Rt(r.length,n)}}validate(n,r){return r>=0&&r<=59}set(n,r,i){return n.setMinutes(i,0,0),n}}class wZ extends Ye{constructor(){super(...arguments);re(this,"priority",50);re(this,"incompatibleTokens",["t","T"])}parse(n,r,i){switch(r){case"s":return vt(Lt.second,n);case"so":return i.ordinalNumber(n,{unit:"second"});default:return Rt(r.length,n)}}validate(n,r){return r>=0&&r<=59}set(n,r,i){return n.setSeconds(i,0),n}}class vZ extends Ye{constructor(){super(...arguments);re(this,"priority",30);re(this,"incompatibleTokens",["t","T"])}parse(n,r){const i=s=>Math.trunc(s*Math.pow(10,-r.length+3));return zt(Rt(r.length,n),i)}set(n,r,i){return n.setMilliseconds(i),n}}class bZ extends Ye{constructor(){super(...arguments);re(this,"priority",10);re(this,"incompatibleTokens",["t","T","x"])}parse(n,r){switch(r){case"X":return Ti(xi.basicOptionalMinutes,n);case"XX":return Ti(xi.basic,n);case"XXXX":return Ti(xi.basicOptionalSeconds,n);case"XXXXX":return Ti(xi.extendedOptionalSeconds,n);case"XXX":default:return Ti(xi.extended,n)}}set(n,r,i){return r.timestampIsSet?n:At(n,n.getTime()-Bm(n)-i)}}class xZ extends Ye{constructor(){super(...arguments);re(this,"priority",10);re(this,"incompatibleTokens",["t","T","X"])}parse(n,r){switch(r){case"x":return Ti(xi.basicOptionalMinutes,n);case"xx":return Ti(xi.basic,n);case"xxxx":return Ti(xi.basicOptionalSeconds,n);case"xxxxx":return Ti(xi.extendedOptionalSeconds,n);case"xxx":default:return Ti(xi.extended,n)}}set(n,r,i){return r.timestampIsSet?n:At(n,n.getTime()-Bm(n)-i)}}class TZ extends Ye{constructor(){super(...arguments);re(this,"priority",40);re(this,"incompatibleTokens","*")}parse(n){return UD(n)}set(n,r,i){return[At(n,i*1e3),{timestampIsSet:!0}]}}class EZ extends Ye{constructor(){super(...arguments);re(this,"priority",20);re(this,"incompatibleTokens","*")}parse(n){return UD(n)}set(n,r,i){return[At(n,i),{timestampIsSet:!0}]}}const SZ={G:new jJ,y:new WJ,Y:new HJ,R:new qJ,u:new GJ,Q:new KJ,q:new YJ,M:new QJ,L:new XJ,w:new ZJ,I:new tZ,d:new iZ,D:new sZ,E:new aZ,e:new oZ,c:new lZ,i:new cZ,a:new dZ,b:new hZ,B:new fZ,h:new pZ,H:new mZ,K:new gZ,k:new yZ,m:new _Z,s:new wZ,S:new vZ,X:new bZ,x:new xZ,t:new TZ,T:new EZ},IZ=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,kZ=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$Z=/^'([^]*?)'?$/,CZ=/''/g,AZ=/\S/,RZ=/[a-zA-Z]/;function PZ(t,e,n,r){var x,v,y,E,$,R,D,k;const i=()=>At((r==null?void 0:r.in)||n,NaN),s=MJ(),a=(r==null?void 0:r.locale)??s.locale??DD,o=(r==null?void 0:r.firstWeekContainsDate)??((v=(x=r==null?void 0:r.locale)==null?void 0:x.options)==null?void 0:v.firstWeekContainsDate)??s.firstWeekContainsDate??((E=(y=s.locale)==null?void 0:y.options)==null?void 0:E.firstWeekContainsDate)??1,l=(r==null?void 0:r.weekStartsOn)??((R=($=r==null?void 0:r.locale)==null?void 0:$.options)==null?void 0:R.weekStartsOn)??s.weekStartsOn??((k=(D=s.locale)==null?void 0:D.options)==null?void 0:k.weekStartsOn)??0;if(!e)return t?i():Ce(n,r==null?void 0:r.in);const u={firstWeekContainsDate:o,weekStartsOn:l,locale:a},c=[new UJ(r==null?void 0:r.in,n)],d=e.match(kZ).map(_=>{const A=_[0];if(A in Qw){const N=Qw[A];return N(_,a.formatLong)}return _}).join("").match(IZ),h=[];for(let _ of d){!(r!=null&&r.useAdditionalWeekYearTokens)&&FD(_)&&Xw(_,e,t),!(r!=null&&r.useAdditionalDayOfYearTokens)&&VD(_)&&Xw(_,e,t);const A=_[0],N=SZ[A];if(N){const{incompatibleTokens:L}=N;if(Array.isArray(L)){const M=h.find(B=>L.includes(B.token)||B.token===A);if(M)throw new RangeError(`The format string mustn't contain \`${M.fullToken}\` and \`${_}\` at the same time`)}else if(N.incompatibleTokens==="*"&&h.length>0)throw new RangeError(`The format string mustn't contain \`${_}\` and any other token at the same time`);h.push({token:A,fullToken:_});const V=N.run(t,_,a.match,u);if(!V)return i();c.push(V.setter),t=V.rest}else{if(A.match(RZ))throw new RangeError("Format string contains an unescaped latin alphabet character `"+A+"`");if(_==="''"?_="'":A==="'"&&(_=NZ(_)),t.indexOf(_)===0)t=t.slice(_.length);else return i()}}if(t.length>0&&AZ.test(t))return i();const m=c.map(_=>_.priority).sort((_,A)=>A-_).filter((_,A,N)=>N.indexOf(_)===A).map(_=>c.filter(A=>A.priority===_).sort((A,N)=>N.subPriority-A.subPriority)).map(_=>_[0]);let g=Ce(n,r==null?void 0:r.in);if(isNaN(+g))return i();const w={};for(const _ of m){if(!_.validate(g,u))return i();const A=_.set(g,w,u);Array.isArray(A)?(g=A[0],Object.assign(w,A[1])):g=A}return g}function NZ(t){return t.match($Z)[1].replace(CZ,"'")}function OZ(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setMinutes(0,0,0),n}function DZ(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setSeconds(0,0),n}function MZ(t,e){const n=Ce(t,e==null?void 0:e.in);return n.setMilliseconds(0),n}function LZ(t,e){const n=()=>At(e==null?void 0:e.in,NaN),r=(e==null?void 0:e.additionalDigits)??2,i=BZ(t);let s;if(i.date){const u=UZ(i.date,r);s=jZ(u.restDateString,u.year)}if(!s||isNaN(+s))return n();const a=+s;let o=0,l;if(i.time&&(o=WZ(i.time),isNaN(o)))return n();if(i.timezone){if(l=HZ(i.timezone),isNaN(l))return n()}else{const u=new Date(a+o),c=Ce(0,e==null?void 0:e.in);return c.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),c.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),c}return Ce(a+o+l,e==null?void 0:e.in)}const Zf={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},zZ=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,VZ=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,FZ=/^([+-])(\d{2})(?::?(\d{2}))?$/;function BZ(t){const e={},n=t.split(Zf.dateTimeDelimiter);let r;if(n.length>2)return e;if(/:/.test(n[0])?r=n[0]:(e.date=n[0],r=n[1],Zf.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Zf.timeZoneDelimiter)[0],r=t.substr(e.date.length,t.length))),r){const i=Zf.timezone.exec(r);i?(e.time=r.replace(i[1],""),e.timezone=i[1]):e.time=r}return e}function UZ(t,e){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=t.match(n);if(!r)return{year:NaN,restDateString:""};const i=r[1]?parseInt(r[1]):null,s=r[2]?parseInt(r[2]):null;return{year:s===null?i:s*100,restDateString:t.slice((r[1]||r[2]).length)}}function jZ(t,e){if(e===null)return new Date(NaN);const n=t.match(zZ);if(!n)return new Date(NaN);const r=!!n[4],i=Cc(n[1]),s=Cc(n[2])-1,a=Cc(n[3]),o=Cc(n[4]),l=Cc(n[5])-1;if(r)return QZ(e,o,l)?qZ(e,o,l):new Date(NaN);{const u=new Date(0);return!KZ(e,s,a)||!YZ(e,i)?new Date(NaN):(u.setUTCFullYear(e,s,Math.max(i,a)),u)}}function Cc(t){return t?parseInt(t):1}function WZ(t){const e=t.match(VZ);if(!e)return NaN;const n=f_(e[1]),r=f_(e[2]),i=f_(e[3]);return XZ(n,r,i)?n*Rh+r*Ah+i*1e3:NaN}function f_(t){return t&&parseFloat(t.replace(",","."))||0}function HZ(t){if(t==="Z")return 0;const e=t.match(FZ);if(!e)return 0;const n=e[1]==="+"?-1:1,r=parseInt(e[2]),i=e[3]&&parseInt(e[3])||0;return JZ(r,i)?n*(r*Rh+i*Ah):NaN}function qZ(t,e,n){const r=new Date(0);r.setUTCFullYear(t,0,4);const i=r.getUTCDay()||7,s=(e-1)*7+n+1-i;return r.setUTCDate(r.getUTCDate()+s),r}const GZ=[31,null,31,30,31,30,31,31,30,31,30,31];function HD(t){return t%400===0||t%4===0&&t%100!==0}function KZ(t,e,n){return e>=0&&e<=11&&n>=1&&n<=(GZ[e]||(HD(t)?29:28))}function YZ(t,e){return e>=1&&e<=(HD(t)?366:365)}function QZ(t,e,n){return e>=1&&e<=53&&n>=0&&n<=6}function XZ(t,e,n){return t===24?e===0&&n===0:n>=0&&n<60&&e>=0&&e<60&&t>=0&&t<25}function JZ(t,e){return e>=0&&e<=59}/*!
 * chartjs-adapter-date-fns v3.0.0
 * https://www.chartjs.org
 * (c) 2022 chartjs-adapter-date-fns Contributors
 * Released under the MIT license
 */const ZZ={datetime:"MMM d, yyyy, h:mm:ss aaaa",millisecond:"h:mm:ss.SSS aaaa",second:"h:mm:ss aaaa",minute:"h:mm aaaa",hour:"ha",day:"MMM d",week:"PP",month:"MMM yyyy",quarter:"qqq - yyyy",year:"yyyy"};cD._date.override({_id:"date-fns",formats:function(){return ZZ},parse:function(t,e){if(t===null||typeof t>"u")return null;const n=typeof t;return n==="number"||t instanceof Date?t=Ce(t):n==="string"&&(typeof e=="string"?t=PZ(t,e,new Date,this.options):t=LZ(t,this.options)),CD(t)?t.getTime():null},format:function(t,e){return OJ(t,e,this.options)},add:function(t,e,n){switch(n){case"millisecond":return Rx(t,e);case"second":return TX(t,e);case"minute":return bX(t,e);case"hour":return _X(t,e);case"day":return Hg(t,e);case"week":return EX(t,e);case"month":return Ax(t,e);case"quarter":return xX(t,e);case"year":return SX(t,e);default:return t}},diff:function(t,e,n){switch(n){case"millisecond":return Px(t,e);case"second":return NX(t,e);case"minute":return AX(t,e);case"hour":return CX(t,e);case"day":return AD(t,e);case"week":return OX(t,e);case"month":return ND(t,e);case"quarter":return PX(t,e);case"year":return DX(t,e);default:return 0}},startOf:function(t,e,n){switch(e){case"second":return MZ(t);case"minute":return DZ(t);case"hour":return OZ(t);case"day":return Yw(t);case"week":return Li(t);case"isoWeek":return Li(t,{weekStartsOn:+n});case"month":return LX(t);case"quarter":return MX(t);case"year":return OD(t);default:return t}},endOf:function(t,e){switch(e){case"second":return jX(t);case"minute":return BX(t);case"hour":return VX(t);case"day":return RD(t);case"week":return FX(t);case"month":return PD(t);case"quarter":return UX(t);case"year":return zX(t);default:return t}}});const qD="label";function FI(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function eee(t,e){const n=t.options;n&&e&&Object.assign(n,e)}function GD(t,e){t.labels=e}function KD(t,e,n=qD){const r=[];t.datasets=e.map(i=>{const s=t.datasets.find(a=>a[n]===i[n]);return!s||!i.data||r.includes(s)?{...i}:(r.push(s),Object.assign(s,i),s)})}function tee(t,e=qD){const n={labels:[],datasets:[]};return GD(n,t.labels),KD(n,t.datasets,e),n}function nee(t,e){const{height:n=150,width:r=300,redraw:i=!1,datasetIdKey:s,type:a,data:o,options:l,plugins:u=[],fallbackContent:c,updateMode:d,...h}=t,m=j.useRef(null),g=j.useRef(null),w=()=>{m.current&&(g.current=new Ug(m.current,{type:a,data:tee(o,s),options:l&&{...l},plugins:u}),FI(e,g.current))},x=()=>{FI(e,null),g.current&&(g.current.destroy(),g.current=null)};return j.useEffect(()=>{!i&&g.current&&l&&eee(g.current,l)},[i,l]),j.useEffect(()=>{!i&&g.current&&GD(g.current.config.data,o.labels)},[i,o.labels]),j.useEffect(()=>{!i&&g.current&&o.datasets&&KD(g.current.config.data,o.datasets,s)},[i,o.datasets]),j.useEffect(()=>{g.current&&(i?(x(),setTimeout(w)):g.current.update(d))},[i,l,o.labels,o.datasets,d]),j.useEffect(()=>{g.current&&(x(),setTimeout(w))},[a]),j.useEffect(()=>(w(),()=>x()),[]),P.jsx("canvas",{ref:m,role:"img",height:n,width:r,...h,children:c})}const ree=j.forwardRef(nee);function iee(t,e){return Ug.register(e),j.forwardRef((n,r)=>P.jsx(ree,{...n,ref:r,type:t}))}const see=iee("line",Dp);Ug.register(Gw,Kw,zp,ia,oX,ZQ,uh,GQ);const YD=({data:t})=>{const e={labels:t.map(r=>r.timestamp),datasets:[{label:"Velocity (m/s)",data:t.map(r=>r.velocity),borderColor:"#0EA5E9",backgroundColor:"rgba(14,165,233,0.1)",tension:.3,fill:!0,pointRadius:2}]},n={responsive:!0,plugins:{legend:{position:"top"},tooltip:{intersect:!1,mode:"index"}},scales:{x:{type:"time",time:{unit:"minute"}},y:{title:{display:!0,text:"m/s"}}}};return P.jsx(see,{options:n,data:e})},Bu=({columns:t,rows:e})=>P.jsx("div",{className:"overflow-x-auto",children:P.jsxs("table",{className:"min-w-full text-left text-sm",children:[P.jsx("thead",{children:P.jsx("tr",{className:"text-slate-600",children:t.map(n=>P.jsx("th",{className:"px-3 py-2 border-b border-slate-200 font-medium",children:n.header},n.header))})}),P.jsxs("tbody",{children:[e.map((n,r)=>P.jsx("tr",{className:"border-b border-slate-100",children:t.map(i=>P.jsx("td",{className:"px-3 py-2 text-slate-800",children:i.accessor(n)},i.header))},r)),e.length===0&&P.jsx("tr",{children:P.jsx("td",{colSpan:t.length,className:"px-3 py-4 text-center text-slate-500",children:"No data"})})]})]})}),aee=()=>{var t;return(t=Al.currentUser)==null?void 0:t.uid},Tr=()=>aee()||"guest",sr=()=>new Date().toISOString(),Er=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),jm=async(t,e,n=15e3)=>{const r=OO(DO,t),i=new AbortController,s=setTimeout(()=>i.abort("upload-timeout"),n);try{return await Promise.race([H7(r,e,{contentType:e.type}),new Promise((o,l)=>i.signal.addEventListener("abort",()=>l(new Error("Upload timed out"))))]),await NO(r)}finally{clearTimeout(s)}},BI=async(t,e)=>{const r=(await Zr(Fi(Vt(bt,t),Bi(e,"desc"),Vu(1)))).docs.at(0);return r?r.data():null},UI={upload:async t=>{const e=Er(),n=`videos/${e}-${t.name}`,r=await jm(n,t,6e4),i={id:e,name:t.name,url:r,storagePath:n,contentType:t.type,size:t.size,createdAt:sr(),userId:Tr()};return await Mi(Vt(bt,"videos"),i),{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"videos"),Bi("createdAt","desc")))).docs.map(n=>n.data())}})},Vp={upload:async t=>{const e=Er(),n=`datasets/${e}-${t.name}`,r=await jm(n,t,45e3),i={id:e,name:t.name,url:r,storagePath:n,contentType:t.type,size:t.size,createdAt:sr(),userId:Tr()};return await Mi(Vt(bt,"datasets"),i),{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"datasets"),Bi("createdAt","desc")))).docs.map(n=>n.data())}})},Jw={create:async(t,e,n)=>{const i={id:Er(),velocity:t,source:e,timestamp:n||sr(),userId:Tr()};return await Mi(Vt(bt,"velocity_logs"),i),{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"velocity_logs"),Bi("timestamp","desc"),Vu(200)))).docs.map(n=>n.data())}})},ch={create:async(t,e,n)=>{const i={id:Er(),threshold:t,velocity:e,status:n,triggeredAt:sr(),userId:Tr()};if(await Mi(Vt(bt,"alerts"),i),n==="danger")try{await Mi(Vt(bt,"notifications"),{id:Er(),type:"municipality_alert",message:`High flood alert: velocity ${e} m/s (threshold ${t} m/s)`,channel:"simulated",delivered:!0,createdAt:sr(),userId:Tr()}),console.info("Simulated notification dispatched to municipality")}catch(s){console.error("Notification write failed",s)}return{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"alerts"),Bi("triggeredAt","desc"),Vu(200)))).docs.map(n=>n.data())}})},Id={velocity:async(t,e)=>{const n=await BI("models","uploadedAt"),r=await BI("datasets","createdAt");let i=+"2.5";const s=void 0;let a=s?Number(s):i*1.5;n&&(i*=.95,a*=.95),r!=null&&r.size&&r.size>3e6&&(i*=.9,a*=.9);let o="normal";t>=a?o="danger":t>=i&&(o="warning");const l=Math.min(1,Math.max(0,t/a)),u={velocity:t,source:e,label:o,score:l,thresholds:{warn:i,danger:a},explanation:`Heuristic: warn >= ${i.toFixed(2)} m/s, danger >= ${a.toFixed(2)} m/s${n?` | model: ${n.name}`:""}${r?` | dataset: ${r.name}`:""}`};try{await Mi(Vt(bt,"inference_logs"),{id:Er(),...u,...n?{modelId:n.id}:{},...r?{datasetId:r.id}:{},userId:Tr(),createdAt:sr()})}catch(c){console.error("Inference log write failed",c)}if(o==="warning")try{await ch.create(i,t,"warning")}catch(c){console.error("Alert write failed (warning)",c)}if(o==="danger")try{await ch.create(a,t,"danger")}catch(c){console.error("Alert write failed (danger)",c)}return{data:{data:u}}}},p_={upload:async(t,e,n)=>{const r=Er(),i=e||`v-${new Date().toISOString()}`,s=`models/${r}-${t.name}`,a=await jm(s,t),o={id:r,name:t.name,version:i,status:"staged",uploadedAt:sr(),sourceUrl:a,mainFilePath:s,notes:n,userId:Tr()};return await hS(Ow(bt,"models",r),o),{data:{data:o}}},uploadBundle:async(t,e,n)=>{var u;const r=Er(),i=e||`v-${new Date().toISOString()}`,s=[".onnx",".json",".bin",".tflite"],a=[];for(const c of t){const d=c.webkitRelativePath||c.name,h=`models/${r}/${d}`,m=await jm(h,c);a.push({name:c.name,path:h,size:c.size,contentType:c.type,url:m})}const o=a.find(c=>s.some(d=>c.name.toLowerCase().endsWith(d)))||a[0],l={id:r,name:(o==null?void 0:o.name)||((u=t[0])==null?void 0:u.name)||"bundle",version:i,status:"staged",uploadedAt:sr(),sourceUrl:o==null?void 0:o.url,mainFilePath:o==null?void 0:o.path,files:a.map(({url:c,...d})=>d),notes:n,userId:Tr()};return await hS(Ow(bt,"models",r),l),{data:{data:l}}},list:async()=>{try{const e=(await Zr(Fi(Vt(bt,"models"),Bi("uploadedAt","desc")))).docs.map(n=>n.data());if(e.length)return{data:{data:e}}}catch(t){console.error("Model list failed (ordered), retrying unordered",t)}try{const e=(await Zr(Vt(bt,"models"))).docs.map(n=>n.data());if(e.length)return{data:{data:e}}}catch(t){console.error("Model list failed (unordered)",t)}try{const t=OO(DO,"models"),e=await q7(t);return{data:{data:await Promise.all(e.items.map(async r=>{const i=await NO(r),s=r.name;return{id:r.fullPath,name:s,version:"unknown",status:"staged",uploadedAt:sr(),sourceUrl:i,mainFilePath:r.fullPath}}))}}}catch(t){return console.error("Storage fallback list failed",t),{data:{data:[]}}}}},Zw={create:async(t,e="simulated",n="test")=>{const i={id:Er(),type:n,message:t,channel:e,delivered:!0,createdAt:sr(),userId:Tr()};return await Mi(Vt(bt,"notifications"),i),{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"notifications"),Bi("createdAt","desc"),Vu(200)))).docs.map(n=>n.data())}})},jI={seed:async()=>{const t=Er(),e={id:t,name:`Site ${t.slice(0,4)}`,location:"Sample River Bend",lat:0,lon:0,status:"online",alertStatus:"normal",lastVelocity:Math.random()*3,lastWaterLevel:.4+Math.random()*.6,lastRainRate:Math.random()*10,lastHeartbeat:sr(),userId:Tr()};return await Mi(Vt(bt,"sites"),e),{data:{data:e}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"sites"),Bi("lastHeartbeat","desc")))).docs.map(n=>n.data())}})},QD={create:async(t,e,n)=>{const i={id:Er(),siteId:e,level:t,timestamp:n||sr(),userId:Tr()};return await Mi(Vt(bt,"water_levels"),i),{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"water_levels"),Bi("timestamp","desc"),Vu(200)))).docs.map(n=>n.data())}})},XD={create:async(t,e,n)=>{const i={id:Er(),siteId:e,rate:t,timestamp:n||sr(),userId:Tr()};return await Mi(Vt(bt,"rain_logs"),i),{data:{data:i}}},list:async()=>({data:{data:(await Zr(Fi(Vt(bt,"rain_logs"),Bi("timestamp","desc"),Vu(200)))).docs.map(n=>n.data())}})},oee=()=>{var x,v,y;const[t,e]=j.useState([]),[n,r]=j.useState([]),[i,s]=j.useState([]),[a,o]=j.useState([]),[l,u]=j.useState(!1);j.useEffect(()=>{(async()=>{u(!0);try{const[$,R,D,k]=await Promise.all([Jw.list(),ch.list(),QD.list(),XD.list()]);e($.data.data||[]),r(R.data.data||[]),s(D.data.data||[]),o(k.data.data||[])}catch($){console.error($)}finally{u(!1)}})()},[]);const c=((x=t.at(0))==null?void 0:x.velocity)??0,d=((v=i.at(0))==null?void 0:v.level)??0,h=((y=a.at(0))==null?void 0:y.rate)??0,m=c>0?"Online":"Offline",g=j.useMemo(()=>n.length===0?"Normal":n[0].status,[n]),w=j.useMemo(()=>{const E=c,$=d,R=h,D=E*.5+$*.3+R*.2;return D>6?"danger":D>3?"warning":"normal"},[c,d,h]);return P.jsxs("div",{className:"space-y-6",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Overview"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Realtime snapshot of water velocity system"})]}),l&&P.jsx("span",{className:"text-sm text-slate-500",children:"Refreshing..."})]}),P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[P.jsx(xl,{title:"System Status",value:m,hint:"Derived from latest reading",tone:m==="Online"?"success":"warning"}),P.jsx(xl,{title:"Latest Velocity",value:`${c.toFixed(2)} m/s`}),P.jsx(xl,{title:"Alert State",value:g,hint:"Most recent alert",tone:g==="danger"?"danger":g==="warning"?"warning":"default"})]}),P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[P.jsx(xl,{title:"Water Level",value:`${d.toFixed(2)} m`,hint:"Latest water level"}),P.jsx(xl,{title:"Rainfall",value:`${h.toFixed(1)} mm/hr`,hint:"Latest rain rate"}),P.jsx(xl,{title:"Fused Risk",value:w,hint:"Velocity + water + rain",tone:w==="danger"?"danger":w==="warning"?"warning":"default"})]}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsxs("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Velocity over time"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Recent 50 readings"})]}),P.jsx(YD,{data:t.slice(0,50).reverse()})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Recent alerts"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Last 5"})]}),P.jsx(Bu,{columns:[{header:"Status",accessor:E=>E.status},{header:"Velocity",accessor:E=>`${E.velocity} m/s`},{header:"Threshold",accessor:E=>`${E.threshold} m/s`},{header:"At",accessor:E=>new Date(E.triggeredAt).toLocaleString()}],rows:n.slice(0,5)})]})]})]})},Mx=({label:t,accept:e,multiple:n,allowDirectory:r,onChange:i,onChangeFiles:s})=>P.jsxs("label",{className:"flex flex-col items-center justify-center border-2 border-dashed border-slate-300 rounded-lg p-6 text-center hover:border-sky-400 cursor-pointer bg-white",children:[P.jsx("p",{className:"text-sm text-slate-700",children:t}),P.jsxs("p",{className:"text-xs text-slate-500",children:["Click to choose file",n||r?"s/folder":""]}),P.jsx("input",{type:"file",accept:e,className:"hidden",multiple:n,...r?{webkitdirectory:"",directory:""}:{},onChange:a=>{const o=a.target.files?Array.from(a.target.files):[];o.length!==0&&(s?s(o):i&&i(o[0]))}})]});/*!
 * ONNX Runtime Web v1.24.1
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var Lx=Object.defineProperty,lee=Object.getOwnPropertyDescriptor,uee=Object.getOwnPropertyNames,cee=Object.prototype.hasOwnProperty,dee=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),se=(t,e)=>()=>(t&&(e=t(t=0)),e),Uu=(t,e)=>{for(var n in e)Lx(t,n,{get:e[n],enumerable:!0})},hee=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of uee(e))!cee.call(t,i)&&i!==n&&Lx(t,i,{get:()=>e[i],enumerable:!(r=lee(e,i))||r.enumerable});return t},dh=t=>hee(Lx({},"__esModule",{value:!0}),t),Ac,zs,Hl,WI,JD,ZD=se(()=>{Ac=new Map,zs=[],Hl=(t,e,n)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let r=Ac.get(t);if(r===void 0)Ac.set(t,{backend:e,priority:n});else{if(r.priority>n)return;if(r.priority===n&&r.backend!==e)throw new Error(`cannot register backend "${t}" using priority ${n}`)}if(n>=0){let i=zs.indexOf(t);i!==-1&&zs.splice(i,1);for(let s=0;s<zs.length;s++)if(Ac.get(zs[s]).priority<=n){zs.splice(s,0,t);return}zs.push(t)}return}throw new TypeError("not a valid backend")},WI=async t=>{let e=Ac.get(t);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let n=!!e.initPromise;try{return n||(e.initPromise=e.backend.init(t)),await e.initPromise,e.initialized=!0,e.backend}catch(r){return n||(e.error=`${r}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},JD=async t=>{let e=t.executionProviders||[],n=e.map(l=>typeof l=="string"?l:l.name),r=n.length===0?zs:n,i,s=[],a=new Set;for(let l of r){let u=await WI(l);typeof u=="string"?s.push({name:l,err:u}):(i||(i=u),i===u&&a.add(l))}if(!i)throw new Error(`no available backend found. ERR: ${s.map(l=>`[${l.name}] ${l.err}`).join(", ")}`);for(let{name:l,err:u}of s)n.includes(l)&&console.warn(`removing requested execution provider "${l}" from session options because it is not available: ${u}`);let o=e.filter(l=>a.has(typeof l=="string"?l:l.name));return[i,new Proxy(t,{get:(l,u)=>u==="executionProviders"?o:Reflect.get(l,u)})]}}),fee=se(()=>{ZD()}),eM,pee=se(()=>{eM="1.24.1"}),m_,Xt,tM=se(()=>{pee(),m_="warning",Xt={wasm:{},webgl:{},webgpu:{},versions:{common:eM},set logLevel(t){if(t!==void 0){if(typeof t!="string"||["verbose","info","warning","error","fatal"].indexOf(t)===-1)throw new Error(`Unsupported logging level: ${t}`);m_=t}},get logLevel(){return m_}},Object.defineProperty(Xt,"logLevel",{enumerable:!0})}),et,mee=se(()=>{tM(),et=Xt}),nM,rM,gee=se(()=>{nM=(t,e)=>{let n=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);n.width=t.dims[3],n.height=t.dims[2];let r=n.getContext("2d");if(r!=null){let i,s;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],s=t.dims[3]):(i=t.dims[3],s=t.dims[2]);let a=(e==null?void 0:e.format)!==void 0?e.format:"RGB",o=e==null?void 0:e.norm,l,u;o===void 0||o.mean===void 0?l=[255,255,255,255]:typeof o.mean=="number"?l=[o.mean,o.mean,o.mean,o.mean]:(l=[o.mean[0],o.mean[1],o.mean[2],0],o.mean[3]!==void 0&&(l[3]=o.mean[3])),o===void 0||o.bias===void 0?u=[0,0,0,0]:typeof o.bias=="number"?u=[o.bias,o.bias,o.bias,o.bias]:(u=[o.bias[0],o.bias[1],o.bias[2],0],o.bias[3]!==void 0&&(u[3]=o.bias[3]));let c=s*i,d=0,h=c,m=c*2,g=-1;a==="RGBA"?(d=0,h=c,m=c*2,g=c*3):a==="RGB"?(d=0,h=c,m=c*2):a==="RBG"&&(d=0,m=c,h=c*2);for(let w=0;w<s;w++)for(let x=0;x<i;x++){let v=(t.data[d++]-u[0])*l[0],y=(t.data[h++]-u[1])*l[1],E=(t.data[m++]-u[2])*l[2],$=g===-1?255:(t.data[g++]-u[3])*l[3];r.fillStyle="rgba("+v+","+y+","+E+","+$+")",r.fillRect(x,w,1,1)}if("toDataURL"in n)return n.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},rM=(t,e)=>{let n=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),r;if(n!=null){let i,s,a;(e==null?void 0:e.tensorLayout)!==void 0&&e.tensorLayout==="NHWC"?(i=t.dims[2],s=t.dims[1],a=t.dims[3]):(i=t.dims[3],s=t.dims[2],a=t.dims[1]);let o=e!==void 0&&e.format!==void 0?e.format:"RGB",l=e==null?void 0:e.norm,u,c;l===void 0||l.mean===void 0?u=[255,255,255,255]:typeof l.mean=="number"?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],255],l.mean[3]!==void 0&&(u[3]=l.mean[3])),l===void 0||l.bias===void 0?c=[0,0,0,0]:typeof l.bias=="number"?c=[l.bias,l.bias,l.bias,l.bias]:(c=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(c[3]=l.bias[3]));let d=s*i;if(e!==void 0&&(e.format!==void 0&&a===4&&e.format!=="RGBA"||a===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let h=4,m=0,g=1,w=2,x=3,v=0,y=d,E=d*2,$=-1;o==="RGBA"?(v=0,y=d,E=d*2,$=d*3):o==="RGB"?(v=0,y=d,E=d*2):o==="RBG"&&(v=0,E=d,y=d*2),r=n.createImageData(i,s);for(let R=0;R<s*i;m+=h,g+=h,w+=h,x+=h,R++)r.data[m]=(t.data[v++]-c[0])*u[0],r.data[g]=(t.data[y++]-c[1])*u[1],r.data[w]=(t.data[E++]-c[2])*u[2],r.data[x]=$===-1?255:(t.data[$++]-c[3])*u[3]}else throw new Error("Can not access image data");return r}}),ep,iM,sM,aM,oM,lM,yee=se(()=>{zx(),ep=(t,e)=>{if(t===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:n,width:r}=e,i=e.norm??{mean:255,bias:0},s,a;typeof i.mean=="number"?s=[i.mean,i.mean,i.mean,i.mean]:s=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?a=[i.bias,i.bias,i.bias,i.bias]:a=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let o=e.format!==void 0?e.format:"RGBA",l=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",u=n*r,c=l==="RGBA"?new Float32Array(u*4):new Float32Array(u*3),d=4,h=0,m=1,g=2,w=3,x=0,v=u,y=u*2,E=-1;o==="RGB"&&(d=3,h=0,m=1,g=2,w=-1),l==="RGBA"?E=u*3:l==="RBG"?(x=0,y=u,v=u*2):l==="BGR"&&(y=0,v=u,x=u*2);for(let $=0;$<u;$++,h+=d,g+=d,m+=d,w+=d)c[x++]=(t[h]+a[0])/s[0],c[v++]=(t[m]+a[1])/s[1],c[y++]=(t[g]+a[2])/s[2],E!==-1&&w!==-1&&(c[E++]=(t[w]+a[3])/s[3]);return l==="RGBA"?new nr("float32",c,[1,4,n,r]):new nr("float32",c,[1,3,n,r])},iM=async(t,e)=>{let n=typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement,r=typeof ImageData<"u"&&t instanceof ImageData,i=typeof ImageBitmap<"u"&&t instanceof ImageBitmap,s=typeof t=="string",a,o=e??{},l=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},u=c=>typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||c instanceof OffscreenCanvas?c.getContext("2d"):null;if(n){let c=l();c.width=t.width,c.height=t.height;let d=u(c);if(d!=null){let h=t.height,m=t.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(h=e.resizedHeight,m=e.resizedWidth),e!==void 0){if(o=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");o.tensorFormat="RGBA",o.height=h,o.width=m}else o.tensorFormat="RGBA",o.height=h,o.width=m;d.drawImage(t,0,0),a=d.getImageData(0,0,m,h).data}else throw new Error("Can not access image data")}else if(r){let c,d;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(c=e.resizedHeight,d=e.resizedWidth):(c=t.height,d=t.width),e!==void 0&&(o=e),o.format="RGBA",o.height=c,o.width=d,e!==void 0){let h=l();h.width=d,h.height=c;let m=u(h);if(m!=null)m.putImageData(t,0,0),a=m.getImageData(0,0,d,c).data;else throw new Error("Can not access image data")}else a=t.data}else if(i){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let c=l();c.width=t.width,c.height=t.height;let d=u(c);if(d!=null){let h=t.height,m=t.width;return d.drawImage(t,0,0,m,h),a=d.getImageData(0,0,m,h).data,o.height=h,o.width=m,ep(a,o)}else throw new Error("Can not access image data")}else{if(s)return new Promise((c,d)=>{let h=l(),m=u(h);if(!t||!m)return d();let g=new Image;g.crossOrigin="Anonymous",g.src=t,g.onload=()=>{h.width=g.width,h.height=g.height,m.drawImage(g,0,0,h.width,h.height);let w=m.getImageData(0,0,h.width,h.height);o.height=h.height,o.width=h.width,c(ep(w.data,o))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(a!==void 0)return ep(a,o);throw new Error("Input data provided is not supported - aborted tensor creation")},sM=(t,e)=>{let{width:n,height:r,download:i,dispose:s}=e,a=[1,r,n,4];return new nr({location:"texture",type:"float32",texture:t,dims:a,download:i,dispose:s})},aM=(t,e)=>{let{dataType:n,dims:r,download:i,dispose:s}=e;return new nr({location:"gpu-buffer",type:n??"float32",gpuBuffer:t,dims:r,download:i,dispose:s})},oM=(t,e)=>{let{dataType:n,dims:r,download:i,dispose:s}=e;return new nr({location:"ml-tensor",type:n??"float32",mlTensor:t,dims:r,download:i,dispose:s})},lM=(t,e,n)=>new nr({location:"cpu-pinned",type:t,data:e,dims:n??[e.length]})}),po,Zc,g_,uM,_ee=se(()=>{po=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Zc=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),g_=!1,uM=()=>{if(!g_){g_=!0;let t=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,n=globalThis.Float16Array,r=typeof n<"u"&&n.from;t&&(po.set("int64",BigInt64Array),Zc.set(BigInt64Array,"int64")),e&&(po.set("uint64",BigUint64Array),Zc.set(BigUint64Array,"uint64")),r?(po.set("float16",n),Zc.set(n,"float16")):po.set("float16",Uint16Array)}}}),cM,dM,wee=se(()=>{zx(),cM=t=>{let e=1;for(let n=0;n<t.length;n++){let r=t[n];if(typeof r!="number"||!Number.isSafeInteger(r))throw new TypeError(`dims[${n}] must be an integer, got: ${r}`);if(r<0)throw new RangeError(`dims[${n}] must be a non-negative integer, got: ${r}`);e*=r}return e},dM=(t,e)=>{switch(t.location){case"cpu":return new nr(t.type,t.data,e);case"cpu-pinned":return new nr({location:"cpu-pinned",data:t.data,type:t.type,dims:e});case"texture":return new nr({location:"texture",texture:t.texture,type:t.type,dims:e});case"gpu-buffer":return new nr({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:e});case"ml-tensor":return new nr({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),nr,zx=se(()=>{gee(),yee(),_ee(),wee(),nr=class{constructor(t,e,n){uM();let r,i;if(typeof t=="object"&&"location"in t)switch(this.dataLocation=t.location,r=t.type,i=t.dims,t.location){case"cpu-pinned":{let a=po.get(r);if(!a)throw new TypeError(`unsupported type "${r}" to create tensor from pinned buffer`);if(!(t.data instanceof a))throw new TypeError(`buffer should be of type ${a.name}`);this.cpuData=t.data;break}case"texture":{if(r!=="float32")throw new TypeError(`unsupported type "${r}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break}case"gpu-buffer":{if(r!=="float32"&&r!=="float16"&&r!=="int32"&&r!=="int64"&&r!=="uint32"&&r!=="uint8"&&r!=="bool"&&r!=="uint4"&&r!=="int4")throw new TypeError(`unsupported type "${r}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break}case"ml-tensor":{if(r!=="float32"&&r!=="float16"&&r!=="int32"&&r!=="int64"&&r!=="uint32"&&r!=="uint64"&&r!=="int8"&&r!=="uint8"&&r!=="bool"&&r!=="uint4"&&r!=="int4")throw new TypeError(`unsupported type "${r}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let a,o;if(typeof t=="string")if(r=t,o=n,t==="string"){if(!Array.isArray(e))throw new TypeError("A string tensor's data must be a string array.");a=e}else{let l=po.get(t);if(l===void 0)throw new TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(e)){if(t==="float16"&&l===Uint16Array||t==="uint4"||t==="int4")throw new TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${l.name} as data.`);t==="uint64"||t==="int64"?a=l.from(e,BigInt):a=l.from(e)}else if(e instanceof l)a=e;else if(e instanceof Uint8ClampedArray)if(t==="uint8")a=Uint8Array.from(e);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(t==="float16"&&e instanceof Uint16Array&&l!==Uint16Array)a=new globalThis.Float16Array(e.buffer,e.byteOffset,e.length);else throw new TypeError(`A ${r} tensor's data must be type of ${l}`)}else if(o=e,Array.isArray(t)){if(t.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let l=typeof t[0];if(l==="string")r="string",a=t;else if(l==="boolean")r="bool",a=Uint8Array.from(t);else throw new TypeError(`Invalid element type of data array: ${l}.`)}else if(t instanceof Uint8ClampedArray)r="uint8",a=Uint8Array.from(t);else{let l=Zc.get(t.constructor);if(l===void 0)throw new TypeError(`Unsupported type for tensor data: ${t.constructor}.`);r=l,a=t}if(o===void 0)o=[a.length];else if(!Array.isArray(o))throw new TypeError("A tensor's dims must be a number array");i=o,this.cpuData=a,this.dataLocation="cpu"}let s=cM(i);if(this.cpuData&&s!==this.cpuData.length&&!((r==="uint4"||r==="int4")&&Math.ceil(s/2)===this.cpuData.length))throw new Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=r,this.dims=i,this.size=s}static async fromImage(t,e){return iM(t,e)}static fromTexture(t,e){return sM(t,e)}static fromGpuBuffer(t,e){return aM(t,e)}static fromMLTensor(t,e){return oM(t,e)}static fromPinnedBuffer(t,e,n){return lM(t,e,n)}toDataURL(t){return nM(this,t)}toImageData(t){return rM(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let e=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=e,t&&this.disposer&&(this.disposer(),this.disposer=void 0),e}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return dM(this,t)}}}),yr,hM=se(()=>{zx(),yr=nr}),Wm,y_,zi,Yr,ko,$o,fM=se(()=>{tM(),Wm=(t,e)=>{(typeof Xt.trace>"u"?!Xt.wasm.trace:!Xt.trace)||console.timeStamp(`${t}::ORT::${e}`)},y_=(t,e)=>{var i;let n=((i=new Error().stack)==null?void 0:i.split(/\r\n|\r|\n/g))||[],r=!1;for(let s=0;s<n.length;s++){if(r&&!n[s].includes("TRACE_FUNC")){let a=`FUNC_${t}::${n[s].trim().split(" ")[1]}`;e&&(a+=`::${e}`),Wm("CPU",a);return}n[s].includes("TRACE_FUNC")&&(r=!0)}},zi=t=>{(typeof Xt.trace>"u"?!Xt.wasm.trace:!Xt.trace)||y_("BEGIN",t)},Yr=t=>{(typeof Xt.trace>"u"?!Xt.wasm.trace:!Xt.trace)||y_("END",t)},ko=t=>{(typeof Xt.trace>"u"?!Xt.wasm.trace:!Xt.trace)||console.time(`ORT::${t}`)},$o=t=>{(typeof Xt.trace>"u"?!Xt.wasm.trace:!Xt.trace)||console.timeEnd(`ORT::${t}`)}}),pM,vee=se(()=>{ZD(),hM(),fM(),pM=class mM{constructor(e){this.handler=e}async run(e,n,r){zi(),ko("InferenceSession.run");let i={},s={};if(typeof e!="object"||e===null||e instanceof yr||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let a=!0;if(typeof n=="object"){if(n===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(n instanceof yr)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(n)){if(n.length===0)throw new TypeError("'fetches' cannot be an empty array.");a=!1;for(let u of n){if(typeof u!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(u)===-1)throw new RangeError(`'fetches' contains invalid output name: ${u}.`);i[u]=null}if(typeof r=="object"&&r!==null)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else{let u=!1,c=Object.getOwnPropertyNames(n);for(let d of this.outputNames)if(c.indexOf(d)!==-1){let h=n[d];(h===null||h instanceof yr)&&(u=!0,a=!1,i[d]=h)}if(u){if(typeof r=="object"&&r!==null)s=r;else if(typeof r<"u")throw new TypeError("'options' must be an object.")}else s=n}}else if(typeof n<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let u of this.inputNames)if(typeof e[u]>"u")throw new Error(`input '${u}' is missing in 'feeds'.`);if(a)for(let u of this.outputNames)i[u]=null;let o=await this.handler.run(e,i,s),l={};for(let u in o)if(Object.hasOwnProperty.call(o,u)){let c=o[u];c instanceof yr?l[u]=c:l[u]=new yr(c.type,c.data,c.dims)}return $o("InferenceSession.run"),Yr(),l}async release(){return this.handler.dispose()}static async create(e,n,r,i){zi(),ko("InferenceSession.create");let s,a={};if(typeof e=="string"){if(s=e,typeof n=="object"&&n!==null)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(s=e,typeof n=="object"&&n!==null)a=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let c=e,d=0,h=e.byteLength;if(typeof n=="object"&&n!==null)a=n;else if(typeof n=="number"){if(d=n,!Number.isSafeInteger(d))throw new RangeError("'byteOffset' must be an integer.");if(d<0||d>=c.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${c.byteLength}).`);if(h=e.byteLength-d,typeof r=="number"){if(h=r,!Number.isSafeInteger(h))throw new RangeError("'byteLength' must be an integer.");if(h<=0||d+h>c.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${c.byteLength-d}].`);if(typeof i=="object"&&i!==null)a=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof r<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof n<"u")throw new TypeError("'options' must be an object.");s=new Uint8Array(c,d,h)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[o,l]=await JD(a),u=await o.createInferenceSessionHandler(s,l);return $o("InferenceSession.create"),Yr(),new mM(u)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Vx,bee=se(()=>{vee(),Vx=pM}),xee=se(()=>{}),Tee=se(()=>{}),Eee=se(()=>{}),See=se(()=>{}),Iee={};Uu(Iee,{InferenceSession:()=>Vx,TRACE:()=>Wm,TRACE_EVENT_BEGIN:()=>ko,TRACE_EVENT_END:()=>$o,TRACE_FUNC_BEGIN:()=>zi,TRACE_FUNC_END:()=>Yr,Tensor:()=>yr,env:()=>et,registerBackend:()=>Hl});var Sr=se(()=>{fee(),mee(),bee(),hM(),xee(),Tee(),fM(),Eee(),See()}),Fx=se(()=>{}),gM={};Uu(gM,{default:()=>yM});var __,w_,yM,kee=se(()=>{var t;xz(),tl(),Bx(),__="ort-wasm-proxy-worker",w_=((t=globalThis.self)==null?void 0:t.name)===__,w_&&(self.onmessage=e=>{let{type:n,in:r}=e.data;try{switch(n){case"init-wasm":Ux(r.wasm).then(()=>{s1(r).then(()=>{postMessage({type:n})},i=>{postMessage({type:n,err:i})})},i=>{postMessage({type:n,err:i})});break;case"init-ep":{let{epName:i,env:s}=r;a1(s,i).then(()=>{postMessage({type:n})},a=>{postMessage({type:n,err:a})});break}case"copy-from":{let{buffer:i}=r,s=Xm(i);postMessage({type:n,out:s});break}case"create":{let{model:i,options:s}=r;o1(i,s).then(a=>{postMessage({type:n,out:a})},a=>{postMessage({type:n,err:a})});break}case"release":l1(r),postMessage({type:n});break;case"run":{let{sessionId:i,inputIndices:s,inputs:a,outputIndices:o,options:l}=r;u1(i,s,a,o,new Array(o.length).fill(null),l).then(u=>{u.some(c=>c[3]!=="cpu")?postMessage({type:n,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:n,out:u},d1([...a,...u]))},u=>{postMessage({type:n,err:u})});break}case"end-profiling":c1(r),postMessage({type:n});break;default:}}catch(i){postMessage({type:n,err:i})}}),yM=w_?null:e=>new Worker(e??Zn,{type:"module",name:__})}),_M={};Uu(_M,{default:()=>wM});async function HI(t={}){var y2,_2;var e=t,n=!!globalThis.window,r=!!globalThis.WorkerGlobalScope,i=r&&((y2=self.name)==null?void 0:y2.startsWith("em-pthread"));e.mountExternalData=(p,b)=>{p.startsWith("./")&&(p=p.substring(2)),(e.Zc||(e.Zc=new Map)).set(p,b)},e.unmountExternalData=()=>{delete e.Zc},globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ae:!0}).buffer.constructor;let s=p=>async(...b)=>{var I;try{if(e.$c)throw Error("Session already started");let S=e.$c={Nd:b[0],errors:[]},O=await p(...b);if(e.$c!==S)throw Error("Session mismatch");(I=e.gd)==null||I.flush();let F=S.errors;if(0<F.length){let U=await Promise.all(F);if(U=U.filter(Q=>Q),0<U.length)throw Error(U.join(`
`))}return O}finally{e.$c=null}};e.jsepInit=(p,b)=>{if(p==="webgpu"){[e.gd,e.Dd,e.Hd,e.jd,e.Gd,e.ac,e.Id,e.Kd,e.Ed,e.Fd,e.Jd]=b;let I=e.gd;e.jsepRegisterBuffer=(S,O,F,U)=>I.registerBuffer(S,O,F,U),e.jsepGetBuffer=S=>I.getBuffer(S),e.jsepCreateDownloader=(S,O,F)=>I.createDownloader(S,O,F),e.jsepOnCreateSession=S=>{I.onCreateSession(S)},e.jsepOnReleaseSession=S=>{I.onReleaseSession(S)},e.jsepOnRunStart=S=>I.onRunStart(S),e.Ld=(S,O)=>{I.upload(S,O)}}else if(p==="webnn"){let I=b[0];[e.Zd,e.vd,e.webnnEnsureTensor,e.xd,e.webnnDownloadTensor,e.Yd,e.webnnEnableTraceEvent]=b.slice(1),e.webnnReleaseTensorId=e.vd,e.webnnUploadTensor=e.xd,e.webnnRegisterMLContext=e.Yd,e.webnnOnRunStart=S=>I.onRunStart(S),e.webnnOnRunEnd=I.onRunEnd.bind(I),e.webnnOnReleaseSession=S=>{I.onReleaseSession(S)},e.webnnCreateMLTensorDownloader=(S,O)=>I.createMLTensorDownloader(S,O),e.webnnRegisterMLTensor=(S,O,F,U)=>I.registerMLTensor(S,O,F,U),e.webnnCreateMLContext=S=>I.createMLContext(S),e.webnnRegisterMLConstant=(S,O,F,U,Q,le)=>I.registerMLConstant(S,O,F,U,Q,e.Zc,le),e.webnnRegisterGraphInput=I.registerGraphInput.bind(I),e.webnnIsGraphInput=I.isGraphInput.bind(I),e.webnnRegisterGraphOutput=I.registerGraphOutput.bind(I),e.webnnIsGraphOutput=I.isGraphOutput.bind(I),e.webnnCreateTemporaryTensor=I.createTemporaryTensor.bind(I),e.webnnIsGraphInputOutputTypeSupported=I.isGraphInputOutputTypeSupported.bind(I)}};let a=()=>{let p=b=>(...I)=>{let S=zn;return I=b(...I),zn!=S?new Promise((O,F)=>{ot={resolve:O,reject:F}}):I};(()=>{for(let b of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])e[b]=p(e[b])})(),s!==void 0&&(e._OrtRun=s(e._OrtRun),e._OrtRunWithBinding=s(e._OrtRunWithBinding)),a=void 0};e.asyncInit=()=>{a==null||a()};var o,l,u=(p,b)=>{throw b},c=import.meta.url,d="";if(n||r){try{d=new URL(".",c).href}catch{}r&&(l=p=>{var b=new XMLHttpRequest;return b.open("GET",p,!1),b.responseType="arraybuffer",b.send(null),new Uint8Array(b.response)}),o=async p=>{if(k(p))return new Promise((I,S)=>{var O=new XMLHttpRequest;O.open("GET",p,!0),O.responseType="arraybuffer",O.onload=()=>{O.status==200||O.status==0&&O.response?I(O.response):S(O.status)},O.onerror=S,O.send(null)});var b=await fetch(p,{credentials:"same-origin"});if(b.ok)return b.arrayBuffer();throw Error(b.status+" : "+b.url)}}var h,m,g,w,x,v,y=console.log.bind(console),E=console.error.bind(console),$=y,R=E,D=!1,k=p=>p.startsWith("file://");function _(){$r.buffer!=N.buffer&&H()}if(i){let p=function(b){try{var I=b.data,S=I.Uc;if(S==="load"){let O=[];self.onmessage=F=>O.push(F),v=()=>{postMessage({Uc:"loaded"});for(let F of O)p(F);self.onmessage=p};for(let F of I.Ad)e[F]&&!e[F].proxy||(e[F]=(...U)=>{postMessage({Uc:"callHandler",zd:F,args:U})},F=="print"&&($=e[F]),F=="printErr"&&(R=e[F]));$r=I.Vd,H(),m=I.Wd,rt(),ff()}else if(S==="run"){(function(O){var F=(_(),Z)[O+52>>>2>>>0];O=(_(),Z)[O+56>>>2>>>0],I1(F,F-O),Re(F)})(I.Tc),ay(I.Tc,0,0,1,0,0),ju(),dl(I.Tc),A||(v1(),A=!0);try{Dh(I.Pd,I.dd)}catch(O){if(O!="unwind")throw O}}else I.target!=="setimmediate"&&(S==="checkMailbox"?A&&Ya():S&&(R(`worker: received unknown command ${S}`),R(I)))}catch(O){throw b1(),O}};var A=!1;self.onunhandledrejection=b=>{throw b.reason||b},self.onmessage=p}var N,L,V,M,B,Z,ie,de,ee,Y,J,G=!1;function H(){var p=$r.buffer;e.HEAP8=N=new Int8Array(p),V=new Int16Array(p),e.HEAPU8=L=new Uint8Array(p),M=new Uint16Array(p),e.HEAP32=B=new Int32Array(p),e.HEAPU32=Z=new Uint32Array(p),ie=new Float32Array(p),de=new Float64Array(p),ee=new BigInt64Array(p),Y=new BigUint64Array(p)}function oe(){G=!0,i?v():Qi.tb()}function ue(p){throw R(p="Aborted("+p+")"),D=!0,p=new WebAssembly.RuntimeError(p+". Build with -sASSERTIONS for more info."),x==null||x(p),p}function Ne(){return{a:{ma:Vz,hb:zz,g:Gg,J:Mh,f:Lh,o:sl,h:zh,ha:ja,b:Vh,T:sn,Ia:ks,n:Wa,_:Uh,Ya:Ha,Ea:Hu,Ga:qu,Za:al,Wa:$s,Pa:jh,Va:Ar,ka:Gu,Fa:Ku,Ca:ol,Xa:ll,Da:Yu,cb:Kg,ea:Gi,xa:Xu,va:qh,da:Yg,O:ni,H:dr,wa:Ju,Z:Jg,ya:Zg,Sa:ey,Aa:Yh,Ja:Qh,ta:Rs,fa:ty,Ra:dl,$a:ny,R:Jh,s:Ja,c:ul,ib:tf,y:tc,M:yl,D:nf,m:_l,t:rf,jb:sf,I:Za,S:af,j:of,v:nc,r:rc,l:lf,Ma:wl,Na:uf,Oa:cf,Ka:ac,La:oc,ua:lc,eb:df,bb:f,u:z,aa:W,ga:K,ab:Ns,V:ce,_a:Ae,Ba:Nt,F:$n,U:Xe,la:Jn,za:vl,gb:di,fb:uc,Ta:f1,Ua:p1,Ha:ji,$:m1,ja:g1,Qa:y1,ia:_1,lb:xV,na:mV,mb:bV,oa:pV,G:sV,d:jz,q:Bz,w:Fz,B:Zz,pb:dV,K:nV,x:Hz,pa:hV,X:gV,ba:cV,nb:vV,ob:wV,ra:aV,qa:uV,qb:oV,N:rV,Y:fV,e:Wz,A:qz,k:Uz,kb:TV,p:Kz,z:Yz,C:Gz,E:Qz,L:eV,rb:iV,Q:yV,ca:tV,W:_V,sb:Jz,sa:Xz,P:lV,i:Mz,a:$r,db:Sn}}}async function rt(){function p(S,O){var F=Qi=S.exports;S={};for(let[U,Q]of Object.entries(F))typeof Q=="function"?(F=si(Q),S[U]=F):S[U]=Q;return Qi=S,Qi=function(){var U=Qi,Q=he=>ke=>he(ke)>>>0,le=he=>()=>he()>>>0;return(U=Object.assign({},U)).ub=Q(U.ub),U.Yb=le(U.Yb),U._b=Q(U._b),U.mc=Q(U.mc),U.nc=le(U.nc),U.rc=Q(U.rc),U}(),Qt.push(Qi.$b),w1=(S=Qi).ub,v1=S.vb,e._OrtInit=S.wb,e._OrtGetLastError=S.xb,e._OrtCreateSessionOptions=S.yb,e._OrtAppendExecutionProvider=S.zb,e._OrtAddFreeDimensionOverride=S.Ab,e._OrtAddSessionConfigEntry=S.Bb,e._OrtReleaseSessionOptions=S.Cb,e._OrtCreateSession=S.Db,e._OrtReleaseSession=S.Eb,e._OrtGetInputOutputCount=S.Fb,e._OrtGetInputOutputMetadata=S.Gb,e._OrtFree=S.Hb,e._OrtCreateTensor=S.Ib,e._OrtGetTensorData=S.Jb,e._OrtReleaseTensor=S.Kb,e._OrtCreateRunOptions=S.Lb,e._OrtAddRunConfigEntry=S.Mb,e._OrtReleaseRunOptions=S.Nb,e._OrtCreateBinding=S.Ob,e._OrtBindInput=S.Pb,e._OrtBindOutput=S.Qb,e._OrtClearBoundOutputs=S.Rb,e._OrtReleaseBinding=S.Sb,e._OrtRunWithBinding=S.Tb,e._OrtRun=S.Ub,e._OrtEndProfiling=S.Vb,e._JsepOutput=S.Wb,e._JsepGetNodeName=S.Xb,hf=S.Yb,hi=e._free=S.Zb,cc=e._malloc=S._b,ay=S.bc,b1=S.cc,x1=S.dc,T1=S.ec,oy=S.fc,E1=S.gc,S1=S.hc,Oe=S.ic,dc=S.jc,I1=S.kc,Re=S.lc,ly=S.mc,Pe=S.nc,k1=S.oc,uy=S.pc,$1=S.qc,C1=S.rc,A1=S.sc,cy=S.tc,R1=S.uc,P1=S.vc,N1=S.wc,O1=S.xc,D1=S.yc,M1=S.zc,L1=S.Ac,z1=S.Bc,V1=S.Cc,F1=S.Dc,B1=S.Ec,U1=S.Fc,j1=S.Gc,W1=S.Hc,H1=S.Ic,q1=S.Jc,G1=S.Kc,K1=S.Lc,Y1=S.Mc,Q1=S.Nc,X1=S.Oc,J1=S.Pc,Z1=S.Rc,e2=S.Sc,t2=S.bd,n2=S.cd,r2=S.hd,i2=S.kd,s2=S.ld,a2=S.md,o2=S.nd,l2=S.od,u2=S.pd,c2=S.qd,d2=S.rd,h2=S.wd,f2=S.Rd,p2=S.Sd,m2=S.Td,g2=S.Ud,m=O,Qi}var b,I=Ne();return e.instantiateWasm?new Promise(S=>{e.instantiateWasm(I,(O,F)=>{S(p(O,F))})}):i?p(new WebAssembly.Instance(m,Ne()),m):(J??(J=e.locateFile?e.locateFile?e.locateFile("ort-wasm-simd-threaded.jsep.wasm",d):d+"ort-wasm-simd-threaded.jsep.wasm":new URL("/assets/ort-wasm-simd-threaded.jsep-6MnTkKum.wasm",import.meta.url).href),b=await async function(S){var O=J;if(!h&&!k(O))try{var F=fetch(O,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(F,S)}catch(U){R(`wasm streaming compile failed: ${U}`),R("falling back to ArrayBuffer instantiation")}return async function(U,Q){try{var le=await async function(he){if(!h)try{var ke=await o(he);return new Uint8Array(ke)}catch{}if(he==J&&h)he=new Uint8Array(h);else{if(!l)throw"both async and sync fetching of the wasm failed";he=l(he)}return he}(U);return await WebAssembly.instantiate(le,Q)}catch(he){R(`failed to asynchronously prepare wasm: ${he}`),ue(he)}}(O,S)}(I),p(b.instance,b.module))}class rn{constructor(b){re(this,"name","ExitStatus");this.message=`Program terminated with exit(${b})`,this.status=b}}var Ui=p=>{p.terminate(),p.onmessage=()=>{}},Ba=[],En=0,hn=null,Ir=p=>{kr.length==0&&(Es(),Oh(kr[0]));var b=kr.pop();if(!b)return 6;kt.push(b),cr[p.Tc]=b,b.Tc=p.Tc;var I={Uc:"run",Pd:p.Od,dd:p.dd,Tc:p.Tc};return b.postMessage(I,p.ud),0},Ke=0,be=(p,b,...I)=>{var S,O=16*I.length,F=Pe(),U=ly(O),Q=U>>>3;for(S of I)typeof S=="bigint"?((_(),ee)[Q++>>>0]=1n,(_(),ee)[Q++>>>0]=S):((_(),ee)[Q++>>>0]=0n,(_(),de)[Q++>>>0]=S);return p=x1(p,0,O,U,b),Re(F),p};function Sn(p){if(i)return be(0,1,p);if(g=p,!(0<Ke)){for(var b of kt)Ui(b);for(b of kr)Ui(b);kr=[],kt=[],cr={},D=!0}u(0,new rn(p))}function Ts(p){if(i)return be(1,0,p);ji(p)}var ji=p=>{if(g=p,i)throw Ts(p),"unwind";Sn(p)},kr=[],kt=[],Qt=[],cr={},Nh=p=>{var b=p.Tc;delete cr[b],kr.push(p),kt.splice(kt.indexOf(p),1),p.Tc=0,T1(b)};function ju(){Qt.forEach(p=>p())}var Oh=p=>new Promise(b=>{p.onmessage=O=>{var F=O.data;if(O=F.Uc,F.ad&&F.ad!=hf()){var U=cr[F.ad];U?U.postMessage(F,F.ud):R(`Internal error! Worker sent a message "${O}" to target pthread ${F.ad}, but that thread no longer exists!`)}else O==="checkMailbox"?Ya():O==="spawnThread"?Ir(F):O==="cleanupThread"?ii(()=>{Nh(cr[F.Qd])}):O==="loaded"?(p.loaded=!0,b(p)):F.target==="setimmediate"?p.postMessage(F):O==="uncaughtException"?p.onerror(F.error):O==="callHandler"?e[F.zd](...F.args):O&&R(`worker sent an unknown command ${O}`)},p.onerror=O=>{throw R(`worker sent an error! ${O.filename}:${O.lineno}: ${O.message}`),O};var I,S=[];for(I of[])e.propertyIsEnumerable(I)&&S.push(I);p.postMessage({Uc:"load",Ad:S,Vd:$r,Wd:m})});function Es(){var p=new Worker((()=>{let b=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new b("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});kr.push(p)}var $r,Dh=(p,b)=>{Ke=0,p=cy(p,b),0<Ke?g=p:oy(p)},Ss=[],rl=0;function Gg(p){var b=new Ua(p>>>=0);return(_(),N)[b.Vc+12>>>0]==0&&(Is(b,!0),rl--),il(b,!1),Ss.push(b),C1(p)}var Wi=0,Mh=()=>{Oe(0,0);var p=Ss.pop();k1(p.ed),Wi=0};function Is(p,b){b=b?1:0,(_(),N)[p.Vc+12>>>0]=b}function il(p,b){b=b?1:0,(_(),N)[p.Vc+13>>>0]=b}class Ua{constructor(b){this.ed=b,this.Vc=b-24}}var Cr=p=>{var b=Wi;if(!b)return dc(0),0;var I=new Ua(b);(_(),Z)[I.Vc+16>>>2>>>0]=b;var S=(_(),Z)[I.Vc+4>>>2>>>0];if(!S)return dc(0),b;for(var O of p){if(O===0||O===S)break;if($1(O,S,I.Vc+16))return dc(O),b}return dc(S),b};function Lh(){return Cr([])}function sl(p){return Cr([p>>>0])}function zh(p,b,I,S){return Cr([p>>>0,b>>>0,I>>>0,S>>>0])}var ja=()=>{var p=Ss.pop();p||ue("no exception to throw");var b=p.ed;throw(_(),N)[p.Vc+13>>>0]==0&&(Ss.push(p),il(p,!0),Is(p,!1),rl++),uy(b),Wi=b};function Vh(p,b,I){var S=new Ua(p>>>=0);throw b>>>=0,I>>>=0,(_(),Z)[S.Vc+16>>>2>>>0]=0,(_(),Z)[S.Vc+4>>>2>>>0]=b,(_(),Z)[S.Vc+8>>>2>>>0]=I,uy(p),rl++,Wi=p}var sn=()=>rl;function Wu(p,b,I,S){return i?be(2,1,p,b,I,S):ks(p,b,I,S)}function ks(p,b,I,S){if(p>>>=0,b>>>=0,I>>>=0,S>>>=0,!globalThis.SharedArrayBuffer)return 6;var O=[];return i&&O.length===0?Wu(p,b,I,S):(p={Od:I,Tc:p,dd:S,ud:O},i?(p.Uc="spawnThread",postMessage(p,O),0):Ir(p))}function Wa(p){throw Wi||(Wi=p>>>0),Wi}var Fh=globalThis.TextDecoder&&new TextDecoder,Bh=(p,b,I,S)=>{if(I=b+I,S)return I;for(;p[b]&&!(b>=I);)++b;return b},Hi=(p,b=0,I,S)=>{if(16<(I=Bh(p,b>>>=0,I,S))-b&&p.buffer&&Fh)return Fh.decode(p.buffer instanceof ArrayBuffer?p.subarray(b,I):p.slice(b,I));for(S="";b<I;){var O=p[b++];if(128&O){var F=63&p[b++];if((224&O)==192)S+=String.fromCharCode((31&O)<<6|F);else{var U=63&p[b++];65536>(O=(240&O)==224?(15&O)<<12|F<<6|U:(7&O)<<18|F<<12|U<<6|63&p[b++])?S+=String.fromCharCode(O):(O-=65536,S+=String.fromCharCode(55296|O>>10,56320|1023&O))}}else S+=String.fromCharCode(O)}return S},_t=(p,b,I)=>(p>>>=0)?Hi((_(),L),p,b,I):"";function Uh(p,b,I){return i?be(3,1,p,b,I):0}function Ha(p,b){if(i)return be(4,1,p,b)}function Hu(p,b){if(i)return be(5,1,p,b)}function qu(p,b,I){if(i)return be(6,1,p,b,I)}function al(p,b,I){return i?be(7,1,p,b,I):0}function $s(p,b){if(i)return be(8,1,p,b)}function jh(p,b,I){if(i)return be(9,1,p,b,I)}function Ar(p,b,I,S){if(i)return be(10,1,p,b,I,S)}function Gu(p,b,I,S){if(i)return be(11,1,p,b,I,S)}function Ku(p,b,I,S){if(i)return be(12,1,p,b,I,S)}function ol(p){if(i)return be(13,1,p)}function ll(p,b){if(i)return be(14,1,p,b)}function Yu(p,b,I){if(i)return be(15,1,p,b,I)}var Kg=()=>ue(""),Qn=p=>{p>>>=0;for(var b="";;){var I=(_(),L)[p++>>>0];if(!I)return b;b+=String.fromCharCode(I)}},Qu={},Cs={},qi=class extends Error{constructor(p){super(p),this.name="BindingError"}};function Xn(p,b,I={}){return function(S,O,F={}){var U=O.name;if(!S)throw new qi(`type "${U}" must have a positive integer typeid pointer`);if(Cs.hasOwnProperty(S)){if(F.Bd)return;throw new qi(`Cannot register type '${U}' twice`)}Cs[S]=O,Qu.hasOwnProperty(S)&&(O=Qu[S],delete Qu[S],O.forEach(Q=>Q()))}(p,b,I)}var As=(p,b,I)=>{switch(b){case 1:return I?S=>(_(),N)[S>>>0]:S=>(_(),L)[S>>>0];case 2:return I?S=>(_(),V)[S>>>1>>>0]:S=>(_(),M)[S>>>1>>>0];case 4:return I?S=>(_(),B)[S>>>2>>>0]:S=>(_(),Z)[S>>>2>>>0];case 8:return I?S=>(_(),ee)[S>>>3>>>0]:S=>(_(),Y)[S>>>3>>>0];default:throw new TypeError(`invalid integer width (${b}): ${p}`)}};function Gi(p,b,I,S,O){p>>>=0,I>>>=0,b=Qn(b>>>0);let F=U=>U;if(S=S===0n){let U=8*I;F=Q=>BigInt.asUintN(U,Q),O=F(O)}Xn(p,{name:b,Qc:F,Xc:(U,Q)=>(typeof Q=="number"&&(Q=BigInt(Q)),Q),Wc:As(b,I,!S),Yc:null})}function Xu(p,b,I,S){Xn(p>>>=0,{name:b=Qn(b>>>0),Qc:function(O){return!!O},Xc:function(O,F){return F?I:S},Wc:function(O){return this.Qc((_(),L)[O>>>0])},Yc:null})}var Wh=[],ti=[0,1,,1,null,1,!0,1,!1,1];function ul(p){9<(p>>>=0)&&--ti[p+1]==0&&(ti[p]=void 0,Wh.push(p))}var In=p=>{if(!p)throw new qi(`Cannot use deleted val. handle = ${p}`);return ti[p]},kn=p=>{switch(p){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let b=Wh.pop()||ti.length;return ti[b]=p,ti[b+1]=1,b}};function qa(p){return this.Qc((_(),Z)[p>>>2>>>0])}var Hh={name:"emscripten::val",Qc:p=>{var b=In(p);return ul(p),b},Xc:(p,b)=>kn(b),Wc:qa,Yc:null};function qh(p){return Xn(p>>>0,Hh)}var Gh=(p,b)=>{switch(b){case 4:return function(I){return this.Qc((_(),ie)[I>>>2>>>0])};case 8:return function(I){return this.Qc((_(),de)[I>>>3>>>0])};default:throw new TypeError(`invalid float width (${b}): ${p}`)}};function Yg(p,b,I){I>>>=0,Xn(p>>>=0,{name:b=Qn(b>>>0),Qc:S=>S,Xc:(S,O)=>O,Wc:Gh(b,I),Yc:null})}function ni(p,b,I,S,O){p>>>=0,I>>>=0,b=Qn(b>>>0);let F=Q=>Q;if(S===0){var U=32-8*I;F=Q=>Q<<U>>>U,O=F(O)}Xn(p,{name:b,Qc:F,Xc:(Q,le)=>le,Wc:As(b,I,S!==0),Yc:null})}function dr(p,b,I){function S(F){var U=(_(),Z)[F>>>2>>>0];return F=(_(),Z)[F+4>>>2>>>0],new O((_(),N).buffer,F,U)}var O=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][b];Xn(p>>>=0,{name:I=Qn(I>>>0),Qc:S,Wc:S},{Bd:!0})}var Ln=(p,b,I)=>{var S=(_(),L);if(b>>>=0,0<I){var O=b;I=b+I-1;for(var F=0;F<p.length;++F){var U=p.codePointAt(F);if(127>=U){if(b>=I)break;S[b++>>>0]=U}else if(2047>=U){if(b+1>=I)break;S[b++>>>0]=192|U>>6,S[b++>>>0]=128|63&U}else if(65535>=U){if(b+2>=I)break;S[b++>>>0]=224|U>>12,S[b++>>>0]=128|U>>6&63,S[b++>>>0]=128|63&U}else{if(b+3>=I)break;S[b++>>>0]=240|U>>18,S[b++>>>0]=128|U>>12&63,S[b++>>>0]=128|U>>6&63,S[b++>>>0]=128|63&U,F++}}S[b>>>0]=0,p=b-O}else p=0;return p},ri=p=>{for(var b=0,I=0;I<p.length;++I){var S=p.charCodeAt(I);127>=S?b++:2047>=S?b+=2:55296<=S&&57343>=S?(b+=4,++I):b+=3}return b};function Ju(p,b){Xn(p>>>=0,{name:b=Qn(b>>>0),Qc(I){var S=(_(),Z)[I>>>2>>>0];return S=_t(I+4,S,!0),hi(I),S},Xc(I,S){S instanceof ArrayBuffer&&(S=new Uint8Array(S));var O=typeof S=="string";if(!(O||ArrayBuffer.isView(S)&&S.BYTES_PER_ELEMENT==1))throw new qi("Cannot pass non-string to std::string");var F=O?ri(S):S.length,U=cc(4+F+1),Q=U+4;return(_(),Z)[U>>>2>>>0]=F,O?Ln(S,Q,F+1):(_(),L).set(S,Q>>>0),I!==null&&I.push(hi,U),U},Wc:qa,Yc(I){hi(I)}})}var it=globalThis.TextDecoder?new TextDecoder("utf-16le"):void 0,cl=(p,b,I)=>{if(p>>>=1,16<(b=Bh((_(),M),p,b/2,I))-p&&it)return it.decode((_(),M).slice(p,b));for(I="";p<b;++p){var S=(_(),M)[p>>>0];I+=String.fromCharCode(S)}return I},Ga=(p,b,I)=>{if(I??(I=2147483647),2>I)return 0;var S=b;I=(I-=2)<2*p.length?I/2:p.length;for(var O=0;O<I;++O){var F=p.charCodeAt(O);(_(),V)[b>>>1>>>0]=F,b+=2}return(_(),V)[b>>>1>>>0]=0,b-S},Ka=p=>2*p.length,Qg=(p,b,I)=>{var S="";p>>>=2;for(var O=0;!(O>=b/4);O++){var F=(_(),Z)[p+O>>>0];if(!F&&!I)break;S+=String.fromCodePoint(F)}return S},Kh=(p,b,I)=>{if(b>>>=0,I??(I=2147483647),4>I)return 0;var S=b;I=S+I-4;for(var O=0;O<p.length;++O){var F=p.codePointAt(O);if(65535<F&&O++,(_(),B)[b>>>2>>>0]=F,(b+=4)+4>I)break}return(_(),B)[b>>>2>>>0]=0,b-S},Xg=p=>{for(var b=0,I=0;I<p.length;++I)65535<p.codePointAt(I)&&I++,b+=4;return b};function Jg(p,b,I){if(p>>>=0,b>>>=0,I=Qn(I>>>=0),b===2)var S=cl,O=Ga,F=Ka;else S=Qg,O=Kh,F=Xg;Xn(p,{name:I,Qc:U=>{var Q=(_(),Z)[U>>>2>>>0];return Q=S(U+4,Q*b,!0),hi(U),Q},Xc:(U,Q)=>{if(typeof Q!="string")throw new qi(`Cannot pass non-string to C++ string type ${I}`);var le=F(Q),he=cc(4+le+b);return(_(),Z)[he>>>2>>>0]=le/b,O(Q,he+4,le+b),U!==null&&U.push(hi,he),he},Wc:qa,Yc(U){hi(U)}})}function Zg(p,b){Xn(p>>>=0,{Cd:!0,name:b=Qn(b>>>0),Qc:()=>{},Xc:()=>{}})}function ey(p){ay(p>>>0,!r,1,!n,131072,!1),ju()}var ii=p=>{if(!D)try{if(p(),!(0<Ke))try{i?hf()&&oy(g):ji(g)}catch(b){b instanceof rn||b=="unwind"||u(0,b)}}catch(b){b instanceof rn||b=="unwind"||u(0,b)}},Ki=!Atomics.waitAsync||((_2=globalThis.navigator)==null?void 0:_2.userAgent)&&91>Number((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)||[])[2]);function dl(p){p>>>=0,Ki||(Atomics.waitAsync((_(),B),p>>>2,p).value.then(Ya),p+=128,Atomics.store((_(),B),p>>>2,1))}var Ya=()=>ii(()=>{var p=hf();p&&(dl(p),S1())});function Yh(p,b){(p>>>=0)==b>>>0?setTimeout(Ya):i?postMessage({ad:p,Uc:"checkMailbox"}):(p=cr[p])&&p.postMessage({Uc:"checkMailbox"})}var hl=[];function Qh(p,b,I,S,O){for(b>>>=0,O>>>=0,hl.length=0,I=O>>>3,S=O+S>>>3;I<S;){var F;F=(_(),ee)[I++>>>0]?(_(),ee)[I++>>>0]:(_(),de)[I++>>>0],hl.push(F)}return(b?dy[b]:Lz[p])(...hl)}var Rs=()=>{Ke=0};function ty(p){p>>>=0,i?postMessage({Uc:"cleanupThread",Qd:p}):Nh(cr[p])}function ny(p){}var fl=p=>{try{p()}catch(b){ue(b)}};function si(p){var b=(...I)=>{Xa.push(p);try{return p(...I)}finally{D||(Xa.pop(),zn&&ai===1&&Xa.length===0&&(ai=0,Ke+=1,fl(p2),typeof Fibers<"u"&&Fibers.ce()))}};return Zu.set(p,b),b}var ai=0,zn=null,Qa=0,Xa=[],Yi=new Map,Ps=new Map,Zu=new Map,ec=0,ot=null,ry=[],Xh=p=>function(b){if(!D){if(ai===0){var I=!1,S=!1;b((O=0)=>{if(!D&&(Qa=O,I=!0,S)){ai=2,fl(()=>m2(zn)),typeof MainLoop<"u"&&MainLoop.yd&&MainLoop.resume(),O=!1;try{var F=function(){var le=(_(),B)[zn+8>>>2>>>0];return le=Ps.get(le),le=Zu.get(le),--Ke,le()}()}catch(le){F=le,O=!0}var U=!1;if(!zn){var Q=ot;Q&&(ot=null,(O?Q.reject:Q.resolve)(F),U=!0)}if(O&&!U)throw F}}),S=!0,I||(ai=1,zn=function(){var O=cc(65548),F=O+12;if((_(),Z)[O>>>2>>>0]=F,(_(),Z)[O+4>>>2>>>0]=F+65536,F=Xa[0],!Yi.has(F)){var U=ec++;Yi.set(F,U),Ps.set(U,F)}return F=Yi.get(F),(_(),B)[O+8>>>2>>>0]=F,O}(),typeof MainLoop<"u"&&MainLoop.yd&&MainLoop.pause(),fl(()=>f2(zn)))}else ai===2?(ai=0,fl(g2),hi(zn),zn=null,ry.forEach(ii)):ue(`invalid state: ${ai}`);return Qa}}(b=>{p().then(b)});function Jh(p){return p>>>=0,Xh(async()=>{var b=await In(p);return kn(b)})}var pl=[],Zh=p=>{var b=pl.length;return pl.push(p),b},ml=(p,b)=>{for(var I=Array(p),S=0;S<p;++S){var O=S,F=(_(),Z)[b+4*S>>>2>>>0],U=Cs[F];if(U===void 0)throw p=`parameter ${S}`,F=w1(F),b=Qn(F),hi(F),new qi(`${p} has unknown type ${b}`);I[O]=U}return I},oi=(p,b,I)=>{var S=[];return p=p(S,I),S.length&&((_(),Z)[b>>>2>>>0]=kn(S)),p},ef={},gl=p=>{var b=ef[p];return b===void 0?Qn(p):b};function Ja(p,b,I){var[S,...O]=ml(p,b>>>0);b=S.Xc.bind(S);var F=O.map(le=>le.Wc.bind(le));p--;var U={toValue:In};switch(p=F.map((le,he)=>{var ke=`argFromPtr${he}`;return U[ke]=le,`${ke}(args${he?"+"+8*he:""})`}),I){case 0:var Q="toValue(handle)";break;case 2:Q="new (toValue(handle))";break;case 3:Q="";break;case 1:U.getStringOrSymbol=gl,Q="toValue(handle)[getStringOrSymbol(methodName)]"}return Q+=`(${p})`,S.Cd||(U.toReturnWire=b,U.emval_returnValue=oi,Q=`return emval_returnValue(toReturnWire, destructorsRef, ${Q})`),Q=`return function (handle, methodName, destructorsRef, args) {
  ${Q}
  }`,I=new Function(Object.keys(U),Q)(...Object.values(U)),Q=`methodCaller<(${O.map(le=>le.name)}) => ${S.name}>`,Zh(Object.defineProperty(I,"name",{value:Q}))}function tf(p,b){return b>>>=0,(p=In(p>>>0))==In(b)}function tc(p){return(p>>>=0)?(p=gl(p),kn(globalThis[p])):kn(globalThis)}function yl(p){return p=gl(p>>>0),kn(e[p])}function nf(p,b){return b>>>=0,p=In(p>>>0),b=In(b),kn(p[b])}function _l(p){9<(p>>>=0)&&(ti[p+1]+=1)}function rf(p,b,I,S,O){return pl[p>>>0](b>>>0,I>>>0,S>>>0,O>>>0)}function sf(p,b,I,S,O){return rf(p>>>0,b>>>0,I>>>0,S>>>0,O>>>0)}function Za(){return kn([])}function af(p){p=In(p>>>0);for(var b=Array(p.length),I=0;I<p.length;I++)b[I]=p[I];return kn(b)}function of(p){return kn(gl(p>>>0))}function nc(){return kn({})}function rc(p){for(var b=In(p>>>=0);b.length;){var I=b.pop();b.pop()(I)}ul(p)}function lf(p,b,I){b>>>=0,I>>>=0,p=In(p>>>0),b=In(b),I=In(I),p[b]=I}function wl(p,b){p=-9007199254740992>p||9007199254740992<p?NaN:Number(p),b>>>=0,p=new Date(1e3*p),(_(),B)[b>>>2>>>0]=p.getUTCSeconds(),(_(),B)[b+4>>>2>>>0]=p.getUTCMinutes(),(_(),B)[b+8>>>2>>>0]=p.getUTCHours(),(_(),B)[b+12>>>2>>>0]=p.getUTCDate(),(_(),B)[b+16>>>2>>>0]=p.getUTCMonth(),(_(),B)[b+20>>>2>>>0]=p.getUTCFullYear()-1900,(_(),B)[b+24>>>2>>>0]=p.getUTCDay(),p=(p.getTime()-Date.UTC(p.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,(_(),B)[b+28>>>2>>>0]=p}var ic=p=>p%4==0&&(p%100!=0||p%400==0),sc=[0,31,60,91,121,152,182,213,244,274,305,335],li=[0,31,59,90,120,151,181,212,243,273,304,334];function uf(p,b){p=-9007199254740992>p||9007199254740992<p?NaN:Number(p),b>>>=0,p=new Date(1e3*p),(_(),B)[b>>>2>>>0]=p.getSeconds(),(_(),B)[b+4>>>2>>>0]=p.getMinutes(),(_(),B)[b+8>>>2>>>0]=p.getHours(),(_(),B)[b+12>>>2>>>0]=p.getDate(),(_(),B)[b+16>>>2>>>0]=p.getMonth(),(_(),B)[b+20>>>2>>>0]=p.getFullYear()-1900,(_(),B)[b+24>>>2>>>0]=p.getDay();var I=(ic(p.getFullYear())?sc:li)[p.getMonth()]+p.getDate()-1|0;(_(),B)[b+28>>>2>>>0]=I,(_(),B)[b+36>>>2>>>0]=-60*p.getTimezoneOffset(),I=new Date(p.getFullYear(),6,1).getTimezoneOffset();var S=new Date(p.getFullYear(),0,1).getTimezoneOffset();p=0|(I!=S&&p.getTimezoneOffset()==Math.min(S,I)),(_(),B)[b+32>>>2>>>0]=p}function cf(p){p>>>=0;var b=new Date((_(),B)[p+20>>>2>>>0]+1900,(_(),B)[p+16>>>2>>>0],(_(),B)[p+12>>>2>>>0],(_(),B)[p+8>>>2>>>0],(_(),B)[p+4>>>2>>>0],(_(),B)[p>>>2>>>0],0),I=(_(),B)[p+32>>>2>>>0],S=b.getTimezoneOffset(),O=new Date(b.getFullYear(),6,1).getTimezoneOffset(),F=new Date(b.getFullYear(),0,1).getTimezoneOffset(),U=Math.min(F,O);return 0>I?(_(),B)[p+32>>>2>>>0]=+(O!=F&&U==S):0<I!=(U==S)&&(O=Math.max(F,O),b.setTime(b.getTime()+6e4*((0<I?U:O)-S))),(_(),B)[p+24>>>2>>>0]=b.getDay(),I=(ic(b.getFullYear())?sc:li)[b.getMonth()]+b.getDate()-1|0,(_(),B)[p+28>>>2>>>0]=I,(_(),B)[p>>>2>>>0]=b.getSeconds(),(_(),B)[p+4>>>2>>>0]=b.getMinutes(),(_(),B)[p+8>>>2>>>0]=b.getHours(),(_(),B)[p+12>>>2>>>0]=b.getDate(),(_(),B)[p+16>>>2>>>0]=b.getMonth(),(_(),B)[p+20>>>2>>>0]=b.getYear(),p=b.getTime(),BigInt(isNaN(p)?-1:p/1e3)}function ac(p,b,I,S,O,F,U){return i?be(16,1,p,b,I,S,O,F,U):-52}function oc(p,b,I,S,O,F){if(i)return be(17,1,p,b,I,S,O,F)}var ui={},$n=()=>performance.timeOrigin+performance.now();function lc(p,b){if(i)return be(18,1,p,b);if(ui[p]&&(clearTimeout(ui[p].id),delete ui[p]),!b)return 0;var I=setTimeout(()=>{delete ui[p],ii(()=>E1(p,performance.timeOrigin+performance.now()))},b);return ui[p]={id:I,be:b},0}function df(p,b,I,S){p>>>=0,b>>>=0,I>>>=0,S>>>=0;var O=new Date().getFullYear(),F=new Date(O,0,1).getTimezoneOffset();O=new Date(O,6,1).getTimezoneOffset();var U=Math.max(F,O);(_(),Z)[p>>>2>>>0]=60*U,(_(),B)[b>>>2>>>0]=+(F!=O),p=(b=Q=>{var le=Math.abs(Q);return`UTC${0<=Q?"-":"+"}${String(Math.floor(le/60)).padStart(2,"0")}${String(le%60).padStart(2,"0")}`})(F),b=b(O),O<F?(Ln(p,I,17),Ln(b,S,17)):(Ln(p,S,17),Ln(b,I,17))}var Ns=()=>Date.now();function f(p,b,I){return I>>>=0,0<=p&&3>=p?(p===0?p=Date.now():p=performance.timeOrigin+performance.now(),p=Math.round(1e6*p),(_(),ee)[I>>>3>>>0]=BigInt(p),0):28}var T=[],C=(p,b)=>{T.length=0;for(var I;I=(_(),L)[p++>>>0];){var S=I!=105;b+=(S&=I!=112)&&b%8?4:0,T.push(I==112?(_(),Z)[b>>>2>>>0]:I==106?(_(),ee)[b>>>3>>>0]:I==105?(_(),B)[b>>>2>>>0]:(_(),de)[b>>>3>>>0]),b+=S?8:4}return T};function z(p,b,I){return p>>>=0,b=C(b>>>0,I>>>0),dy[p](...b)}function W(p,b,I){return p>>>=0,b=C(b>>>0,I>>>0),dy[p](...b)}var K=()=>{};function ce(p,b){return R(_t(p>>>0,b>>>0))}var Ae=()=>{throw Ke+=1,"unwind"};function Nt(){return 4294901760}var Xe=()=>navigator.hardwareConcurrency,lt={},Cn=p=>{var b;return(b=/\bwasm-function\[\d+\]:(0x[0-9a-f]+)/.exec(p))?+b[1]:(b=/:(\d+):\d+(?:\)|$)/.exec(p))?2147483648|+b[1]:0},ci=p=>{for(var b of p)(p=Cn(b))&&(lt[p]=b)};function di(){var p=Error().stack.toString().split(`
`);return p[0]=="Error"&&p.shift(),ci(p),lt.sd=Cn(p[3]),lt.Md=p,lt.sd}function Jn(p){if(!(p=lt[p>>>0]))return 0;var b;if(b=/^\s+at .*\.wasm\.(.*) \(.*\)$/.exec(p))p=b[1];else if(b=/^\s+at (.*) \(.*\)$/.exec(p))p=b[1];else{if(!(b=/^(.+?)@/.exec(p)))return 0;p=b[1]}hi(Jn.td??0),b=ri(p)+1;var I=cc(b);return I&&Ln(p,I,b),Jn.td=I,Jn.td}function vl(p){p>>>=0;var b=(_(),L).length;if(p<=b||4294901760<p)return!1;for(var I=1;4>=I;I*=2){var S=b*(1+.2/I);S=Math.min(S,p+100663296);e:{S=(Math.min(4294901760,65536*Math.ceil(Math.max(p,S)/65536))-$r.buffer.byteLength+65535)/65536|0;try{$r.grow(S),H();var O=1;break e}catch{}O=void 0}if(O)return!0}return!1}function uc(p,b,I){if(p>>>=0,b>>>=0,lt.sd==p)var S=lt.Md;else(S=Error().stack.toString().split(`
`))[0]=="Error"&&S.shift(),ci(S);for(var O=3;S[O]&&Cn(S[O])!=p;)++O;for(p=0;p<I&&S[p+O];++p)(_(),B)[b+4*p>>>2>>>0]=Cn(S[p+O]);return p}var iy,sy={},h1=()=>{var S;if(!iy){var p,b={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(((S=globalThis.navigator)==null?void 0:S.language)??"C").replace("-","_")+".UTF-8",_:"./this.program"};for(p in sy)sy[p]===void 0?delete b[p]:b[p]=sy[p];var I=[];for(p in b)I.push(`${p}=${b[p]}`);iy=I}return iy};function f1(p,b){if(i)return be(19,1,p,b);p>>>=0,b>>>=0;var I,S=0,O=0;for(I of h1()){var F=b+S;(_(),Z)[p+O>>>2>>>0]=F,S+=Ln(I,F,1/0)+1,O+=4}return 0}function p1(p,b){if(i)return be(20,1,p,b);p>>>=0,b>>>=0;var I=h1();for(var S of((_(),Z)[p>>>2>>>0]=I.length,p=0,I))p+=ri(S)+1;return(_(),Z)[b>>>2>>>0]=p,0}function m1(p){return i?be(21,1,p):52}function g1(p,b,I,S){return i?be(22,1,p,b,I,S):52}function y1(p,b,I,S){return i?be(23,1,p,b,I,S):70}var Dz=[null,[],[]];function _1(p,b,I,S){if(i)return be(24,1,p,b,I,S);b>>>=0,I>>>=0,S>>>=0;for(var O=0,F=0;F<I;F++){var U=(_(),Z)[b>>>2>>>0],Q=(_(),Z)[b+4>>>2>>>0];b+=8;for(var le=0;le<Q;le++){var he=p,ke=(_(),L)[U+le>>>0],Fe=Dz[he];ke===0||ke===10?((he===1?$:R)(Hi(Fe)),Fe.length=0):Fe.push(ke)}O+=Q}return(_(),Z)[S>>>2>>>0]=O,0}function Mz(p){return p>>>0}i||function(){for(var p=e.numThreads-1;p--;)Es();Ba.push(async()=>{var b=async function(){if(!i)return Promise.all(kr.map(Oh))}();En++,await b,--En==0&&hn&&(b=hn,hn=null,b())})}(),i||($r=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),H()),e.wasmBinary&&(h=e.wasmBinary),e.stackSave=()=>Pe(),e.stackRestore=p=>Re(p),e.stackAlloc=p=>ly(p),e.setValue=function(p,b,I="i8"){switch(I.endsWith("*")&&(I="*"),I){case"i1":case"i8":(_(),N)[p>>>0]=b;break;case"i16":(_(),V)[p>>>1>>>0]=b;break;case"i32":(_(),B)[p>>>2>>>0]=b;break;case"i64":(_(),ee)[p>>>3>>>0]=BigInt(b);break;case"float":(_(),ie)[p>>>2>>>0]=b;break;case"double":(_(),de)[p>>>3>>>0]=b;break;case"*":(_(),Z)[p>>>2>>>0]=b;break;default:ue(`invalid type for setValue: ${I}`)}},e.getValue=function(p,b="i8"){switch(b.endsWith("*")&&(b="*"),b){case"i1":case"i8":return(_(),N)[p>>>0];case"i16":return(_(),V)[p>>>1>>>0];case"i32":return(_(),B)[p>>>2>>>0];case"i64":return(_(),ee)[p>>>3>>>0];case"float":return(_(),ie)[p>>>2>>>0];case"double":return(_(),de)[p>>>3>>>0];case"*":return(_(),Z)[p>>>2>>>0];default:ue(`invalid type for getValue: ${b}`)}},e.UTF8ToString=_t,e.stringToUTF8=Ln,e.lengthBytesUTF8=ri;var w1,v1,hf,hi,cc,ay,b1,x1,T1,oy,E1,S1,Oe,dc,I1,Re,ly,Pe,k1,uy,$1,C1,A1,cy,R1,P1,N1,O1,D1,M1,L1,z1,V1,F1,B1,U1,j1,W1,H1,q1,G1,K1,Y1,Q1,X1,J1,Z1,e2,t2,n2,r2,i2,s2,a2,o2,l2,u2,c2,d2,h2,f2,p2,m2,g2,Qi,Lz=[Sn,Ts,Wu,Uh,Ha,Hu,qu,al,$s,jh,Ar,Gu,Ku,ol,ll,Yu,ac,oc,lc,f1,p1,m1,g1,y1,_1],dy={927244:(p,b,I,S,O)=>{if(e===void 0||!e.Zc)return 1;if((p=_t(Number(p>>>0))).startsWith("./")&&(p=p.substring(2)),!(p=e.Zc.get(p)))return 2;if(b=Number(b>>>0),I=Number(I>>>0),S=Number(S>>>0),b+I>p.byteLength)return 3;try{let F=p.subarray(b,b+I);switch(O){case 0:(_(),L).set(F,S>>>0);break;case 1:e.Xd?e.Xd(S,F):e.Ld(S,F);break;default:return 4}return 0}catch{return 4}},928068:(p,b,I)=>{e.xd(p,(_(),L).subarray(b>>>0,b+I>>>0))},928132:()=>e.Zd(),928174:p=>{e.vd(p)},928211:()=>{e.Ed()},928242:()=>{e.Fd()},928271:()=>{e.Jd()},928296:p=>e.Dd(p),928329:p=>e.Hd(p),928361:(p,b,I)=>{e.jd(Number(p),Number(b),Number(I),!0)},928424:(p,b,I)=>{e.jd(Number(p),Number(b),Number(I))},928481:()=>typeof wasmOffsetConverter<"u",928538:p=>{e.ac("Abs",p,void 0)},928589:p=>{e.ac("Neg",p,void 0)},928640:p=>{e.ac("Floor",p,void 0)},928693:p=>{e.ac("Ceil",p,void 0)},928745:p=>{e.ac("Reciprocal",p,void 0)},928803:p=>{e.ac("Sqrt",p,void 0)},928855:p=>{e.ac("Exp",p,void 0)},928906:p=>{e.ac("Erf",p,void 0)},928957:p=>{e.ac("Sigmoid",p,void 0)},929012:(p,b,I)=>{e.ac("HardSigmoid",p,{alpha:b,beta:I})},929091:p=>{e.ac("Log",p,void 0)},929142:p=>{e.ac("Sin",p,void 0)},929193:p=>{e.ac("Cos",p,void 0)},929244:p=>{e.ac("Tan",p,void 0)},929295:p=>{e.ac("Asin",p,void 0)},929347:p=>{e.ac("Acos",p,void 0)},929399:p=>{e.ac("Atan",p,void 0)},929451:p=>{e.ac("Sinh",p,void 0)},929503:p=>{e.ac("Cosh",p,void 0)},929555:p=>{e.ac("Asinh",p,void 0)},929608:p=>{e.ac("Acosh",p,void 0)},929661:p=>{e.ac("Atanh",p,void 0)},929714:p=>{e.ac("Tanh",p,void 0)},929766:p=>{e.ac("Not",p,void 0)},929817:(p,b,I)=>{e.ac("Clip",p,{min:b,max:I})},929886:p=>{e.ac("Clip",p,void 0)},929938:(p,b)=>{e.ac("Elu",p,{alpha:b})},929996:p=>{e.ac("Gelu",p,void 0)},930048:p=>{e.ac("Relu",p,void 0)},930100:(p,b)=>{e.ac("LeakyRelu",p,{alpha:b})},930164:(p,b)=>{e.ac("ThresholdedRelu",p,{alpha:b})},930234:(p,b)=>{e.ac("Cast",p,{to:b})},930292:p=>{e.ac("Add",p,void 0)},930343:p=>{e.ac("Sub",p,void 0)},930394:p=>{e.ac("Mul",p,void 0)},930445:p=>{e.ac("Div",p,void 0)},930496:p=>{e.ac("Pow",p,void 0)},930547:p=>{e.ac("Equal",p,void 0)},930600:p=>{e.ac("Greater",p,void 0)},930655:p=>{e.ac("GreaterOrEqual",p,void 0)},930717:p=>{e.ac("Less",p,void 0)},930769:p=>{e.ac("LessOrEqual",p,void 0)},930828:(p,b,I,S,O)=>{e.ac("ReduceMean",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},931003:(p,b,I,S,O)=>{e.ac("ReduceMax",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},931177:(p,b,I,S,O)=>{e.ac("ReduceMin",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},931351:(p,b,I,S,O)=>{e.ac("ReduceProd",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},931526:(p,b,I,S,O)=>{e.ac("ReduceSum",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},931700:(p,b,I,S,O)=>{e.ac("ReduceL1",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},931873:(p,b,I,S,O)=>{e.ac("ReduceL2",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},932046:(p,b,I,S,O)=>{e.ac("ReduceLogSum",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},932223:(p,b,I,S,O)=>{e.ac("ReduceSumSquare",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},932403:(p,b,I,S,O)=>{e.ac("ReduceLogSumExp",p,{keepDims:!!b,noopWithEmptyAxes:!!I,axes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},932583:p=>{e.ac("Where",p,void 0)},932636:(p,b,I)=>{e.ac("Transpose",p,{perm:b?Array.from((_(),B).subarray(Number(b)>>>0,Number(I)>>>0)):[]})},932760:(p,b,I,S)=>{e.ac("DepthToSpace",p,{blocksize:b,mode:_t(I),format:S?"NHWC":"NCHW"})},932893:(p,b,I,S)=>{e.ac("DepthToSpace",p,{blocksize:b,mode:_t(I),format:S?"NHWC":"NCHW"})},933026:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at,Os)=>{e.ac("ConvTranspose",p,{format:le?"NHWC":"NCHW",autoPad:b,dilations:[I],group:S,kernelShape:[O],pads:[F,U],strides:[Q],wIsConst:()=>!!(_(),N)[he>>>0],outputPadding:ke?Array.from((_(),B).subarray(Number(ke)>>>0,Number(Fe)>>>0)):[],outputShape:Je?Array.from((_(),B).subarray(Number(Je)>>>0,Number(at)>>>0)):[],activation:_t(Os)})},933459:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at)=>{e.ac("ConvTranspose",p,{format:Q?"NHWC":"NCHW",autoPad:b,dilations:Array.from((_(),B).subarray(Number(I)>>>0,2+(Number(I)>>>0)>>>0)),group:S,kernelShape:Array.from((_(),B).subarray(Number(O)>>>0,2+(Number(O)>>>0)>>>0)),pads:Array.from((_(),B).subarray(Number(F)>>>0,4+(Number(F)>>>0)>>>0)),strides:Array.from((_(),B).subarray(Number(U)>>>0,2+(Number(U)>>>0)>>>0)),wIsConst:()=>!!(_(),N)[le>>>0],outputPadding:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],outputShape:Fe?Array.from((_(),B).subarray(Number(Fe)>>>0,Number(Je)>>>0)):[],activation:_t(at)})},934120:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at,Os)=>{e.ac("ConvTranspose",p,{format:le?"NHWC":"NCHW",autoPad:b,dilations:[I],group:S,kernelShape:[O],pads:[F,U],strides:[Q],wIsConst:()=>!!(_(),N)[he>>>0],outputPadding:ke?Array.from((_(),B).subarray(Number(ke)>>>0,Number(Fe)>>>0)):[],outputShape:Je?Array.from((_(),B).subarray(Number(Je)>>>0,Number(at)>>>0)):[],activation:_t(Os)})},934553:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at)=>{e.ac("ConvTranspose",p,{format:Q?"NHWC":"NCHW",autoPad:b,dilations:Array.from((_(),B).subarray(Number(I)>>>0,2+(Number(I)>>>0)>>>0)),group:S,kernelShape:Array.from((_(),B).subarray(Number(O)>>>0,2+(Number(O)>>>0)>>>0)),pads:Array.from((_(),B).subarray(Number(F)>>>0,4+(Number(F)>>>0)>>>0)),strides:Array.from((_(),B).subarray(Number(U)>>>0,2+(Number(U)>>>0)>>>0)),wIsConst:()=>!!(_(),N)[le>>>0],outputPadding:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],outputShape:Fe?Array.from((_(),B).subarray(Number(Fe)>>>0,Number(Je)>>>0)):[],activation:_t(at)})},935214:(p,b)=>{e.ac("GlobalAveragePool",p,{format:b?"NHWC":"NCHW"})},935305:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at)=>{e.ac("AveragePool",p,{format:at?"NHWC":"NCHW",auto_pad:b,ceil_mode:I,count_include_pad:S,storage_order:O,dilations:F?Array.from((_(),B).subarray(Number(F)>>>0,Number(U)>>>0)):[],kernel_shape:Q?Array.from((_(),B).subarray(Number(Q)>>>0,Number(le)>>>0)):[],pads:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],strides:Fe?Array.from((_(),B).subarray(Number(Fe)>>>0,Number(Je)>>>0)):[]})},935784:(p,b)=>{e.ac("GlobalAveragePool",p,{format:b?"NHWC":"NCHW"})},935875:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at)=>{e.ac("AveragePool",p,{format:at?"NHWC":"NCHW",auto_pad:b,ceil_mode:I,count_include_pad:S,storage_order:O,dilations:F?Array.from((_(),B).subarray(Number(F)>>>0,Number(U)>>>0)):[],kernel_shape:Q?Array.from((_(),B).subarray(Number(Q)>>>0,Number(le)>>>0)):[],pads:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],strides:Fe?Array.from((_(),B).subarray(Number(Fe)>>>0,Number(Je)>>>0)):[]})},936354:(p,b)=>{e.ac("GlobalMaxPool",p,{format:b?"NHWC":"NCHW"})},936441:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at)=>{e.ac("MaxPool",p,{format:at?"NHWC":"NCHW",auto_pad:b,ceil_mode:I,count_include_pad:S,storage_order:O,dilations:F?Array.from((_(),B).subarray(Number(F)>>>0,Number(U)>>>0)):[],kernel_shape:Q?Array.from((_(),B).subarray(Number(Q)>>>0,Number(le)>>>0)):[],pads:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],strides:Fe?Array.from((_(),B).subarray(Number(Fe)>>>0,Number(Je)>>>0)):[]})},936916:(p,b)=>{e.ac("GlobalMaxPool",p,{format:b?"NHWC":"NCHW"})},937003:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at)=>{e.ac("MaxPool",p,{format:at?"NHWC":"NCHW",auto_pad:b,ceil_mode:I,count_include_pad:S,storage_order:O,dilations:F?Array.from((_(),B).subarray(Number(F)>>>0,Number(U)>>>0)):[],kernel_shape:Q?Array.from((_(),B).subarray(Number(Q)>>>0,Number(le)>>>0)):[],pads:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],strides:Fe?Array.from((_(),B).subarray(Number(Fe)>>>0,Number(Je)>>>0)):[]})},937478:(p,b,I,S,O)=>{e.ac("Gemm",p,{alpha:b,beta:I,transA:S,transB:O})},937582:p=>{e.ac("MatMul",p,void 0)},937636:(p,b,I,S)=>{e.ac("ArgMax",p,{keepDims:!!b,selectLastIndex:!!I,axis:S})},937744:(p,b,I,S)=>{e.ac("ArgMin",p,{keepDims:!!b,selectLastIndex:!!I,axis:S})},937852:(p,b)=>{e.ac("Softmax",p,{axis:b})},937915:(p,b)=>{e.ac("Concat",p,{axis:b})},937975:(p,b,I,S,O)=>{e.ac("Split",p,{axis:b,numOutputs:I,splitSizes:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},938131:p=>{e.ac("Expand",p,void 0)},938185:(p,b)=>{e.ac("Gather",p,{axis:Number(b)})},938256:(p,b)=>{e.ac("GatherElements",p,{axis:Number(b)})},938335:(p,b)=>{e.ac("GatherND",p,{batch_dims:Number(b)})},938414:(p,b,I,S,O,F,U,Q,le,he,ke)=>{e.ac("Resize",p,{antialias:b,axes:I?Array.from((_(),B).subarray(Number(I)>>>0,Number(S)>>>0)):[],coordinateTransformMode:_t(O),cubicCoeffA:F,excludeOutside:U,extrapolationValue:Q,keepAspectRatioPolicy:_t(le),mode:_t(he),nearestMode:_t(ke)})},938776:(p,b,I,S,O,F,U)=>{e.ac("Slice",p,{starts:b?Array.from((_(),B).subarray(Number(b)>>>0,Number(I)>>>0)):[],ends:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[],axes:F?Array.from((_(),B).subarray(Number(F)>>>0,Number(U)>>>0)):[]})},939040:p=>{e.ac("Tile",p,void 0)},939092:(p,b,I)=>{e.ac("InstanceNormalization",p,{epsilon:b,format:I?"NHWC":"NCHW"})},939206:(p,b,I)=>{e.ac("InstanceNormalization",p,{epsilon:b,format:I?"NHWC":"NCHW"})},939320:p=>{e.ac("Range",p,void 0)},939373:(p,b)=>{e.ac("Einsum",p,{equation:_t(b)})},939454:(p,b,I,S,O)=>{e.ac("Pad",p,{mode:b,value:I,pads:S?Array.from((_(),B).subarray(Number(S)>>>0,Number(O)>>>0)):[]})},939597:(p,b,I,S,O,F)=>{e.ac("BatchNormalization",p,{epsilon:b,momentum:I,spatial:!!O,trainingMode:!!S,format:F?"NHWC":"NCHW"})},939766:(p,b,I,S,O,F)=>{e.ac("BatchNormalization",p,{epsilon:b,momentum:I,spatial:!!O,trainingMode:!!S,format:F?"NHWC":"NCHW"})},939935:(p,b,I)=>{e.ac("CumSum",p,{exclusive:Number(b),reverse:Number(I)})},940032:(p,b,I)=>{e.ac("DequantizeLinear",p,{axis:b,blockSize:I})},940122:(p,b,I,S,O)=>{e.ac("GridSample",p,{align_corners:b,mode:_t(I),padding_mode:_t(S),format:O?"NHWC":"NCHW"})},940292:(p,b,I,S,O)=>{e.ac("GridSample",p,{align_corners:b,mode:_t(I),padding_mode:_t(S),format:O?"NHWC":"NCHW"})},940462:(p,b)=>{e.ac("ScatterND",p,{reduction:_t(b)})},940547:(p,b,I,S,O,F,U,Q,le)=>{e.ac("Attention",p,{numHeads:b,isUnidirectional:I,maskFilterValue:S,scale:O,doRotary:F,qkvHiddenSizes:U?Array.from((_(),B).subarray(Number(Q)>>>0,Number(Q)+U>>>0)):[],pastPresentShareBuffer:!!le})},940819:p=>{e.ac("BiasAdd",p,void 0)},940874:p=>{e.ac("BiasSplitGelu",p,void 0)},940935:p=>{e.ac("FastGelu",p,void 0)},940991:(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at,Os,hy)=>{e.ac("Conv",p,{format:Fe?"NHWC":"NCHW",auto_pad:b,dilations:I?Array.from((_(),B).subarray(Number(I)>>>0,Number(S)>>>0)):[],group:O,kernel_shape:F?Array.from((_(),B).subarray(Number(F)>>>0,Number(U)>>>0)):[],pads:Q?Array.from((_(),B).subarray(Number(Q)>>>0,Number(le)>>>0)):[],strides:he?Array.from((_(),B).subarray(Number(he)>>>0,Number(ke)>>>0)):[],w_is_const:()=>!!(_(),N)[Number(Je)>>>0],activation:_t(at),activation_params:Os?Array.from((_(),ie).subarray(Number(Os)>>>0,Number(hy)>>>0)):[]})},941575:p=>{e.ac("Gelu",p,void 0)},941627:(p,b,I,S,O,F,U,Q,le)=>{e.ac("GroupQueryAttention",p,{numHeads:b,kvNumHeads:I,scale:S,softcap:O,doRotary:F,rotaryInterleaved:U,smoothSoftmax:Q,localWindowSize:le})},941844:(p,b,I,S)=>{e.ac("LayerNormalization",p,{axis:b,epsilon:I,simplified:!!S})},941955:(p,b,I,S)=>{e.ac("LayerNormalization",p,{axis:b,epsilon:I,simplified:!!S})},942066:(p,b,I,S,O,F)=>{e.ac("MatMulNBits",p,{k:b,n:I,accuracyLevel:S,bits:O,blockSize:F})},942193:(p,b,I,S,O,F)=>{e.ac("MultiHeadAttention",p,{numHeads:b,isUnidirectional:I,maskFilterValue:S,scale:O,doRotary:F})},942352:(p,b)=>{e.ac("QuickGelu",p,{alpha:b})},942416:(p,b,I,S,O)=>{e.ac("RotaryEmbedding",p,{interleaved:!!b,numHeads:I,rotaryEmbeddingDim:S,scale:O})},942555:(p,b,I)=>{e.ac("SkipLayerNormalization",p,{epsilon:b,simplified:!!I})},942657:(p,b,I)=>{e.ac("SkipLayerNormalization",p,{epsilon:b,simplified:!!I})},942759:(p,b,I,S)=>{e.ac("GatherBlockQuantized",p,{gatherAxis:b,quantizeAxis:I,blockSize:S})},942880:p=>{e.Id(p)},942914:(p,b)=>e.Kd(Number(p),Number(b),e.$c.Nd,e.$c.errors)};function zz(p,b,I){return Xh(async()=>{await e.Gd(Number(p),Number(b),Number(I))})}function Vz(){return typeof wasmOffsetConverter<"u"}function Fz(p,b,I,S){var O=Pe();try{return z1(p,b,I,S)}catch(F){if(Re(O),F!==F+0)throw F;Oe(1,0)}}function Bz(p,b,I){var S=Pe();try{return O1(p,b,I)}catch(O){if(Re(S),O!==O+0)throw O;Oe(1,0)}}function Uz(p,b,I){var S=Pe();try{A1(p,b,I)}catch(O){if(Re(S),O!==O+0)throw O;Oe(1,0)}}function jz(p,b){var I=Pe();try{return cy(p,b)}catch(S){if(Re(I),S!==S+0)throw S;Oe(1,0)}}function Wz(p){var b=Pe();try{R1(p)}catch(I){if(Re(b),I!==I+0)throw I;Oe(1,0)}}function Hz(p,b,I,S,O,F,U){var Q=Pe();try{return M1(p,b,I,S,O,F,U)}catch(le){if(Re(Q),le!==le+0)throw le;Oe(1,0)}}function qz(p,b){var I=Pe();try{V1(p,b)}catch(S){if(Re(I),S!==S+0)throw S;Oe(1,0)}}function Gz(p,b,I,S,O,F){var U=Pe();try{P1(p,b,I,S,O,F)}catch(Q){if(Re(U),Q!==Q+0)throw Q;Oe(1,0)}}function Kz(p,b,I,S){var O=Pe();try{L1(p,b,I,S)}catch(F){if(Re(O),F!==F+0)throw F;Oe(1,0)}}function Yz(p,b,I,S,O){var F=Pe();try{N1(p,b,I,S,O)}catch(U){if(Re(F),U!==U+0)throw U;Oe(1,0)}}function Qz(p,b,I,S,O,F,U){var Q=Pe();try{B1(p,b,I,S,O,F,U)}catch(le){if(Re(Q),le!==le+0)throw le;Oe(1,0)}}function Xz(p,b,I,S,O,F,U){var Q=Pe();try{U1(p,b,I,S,O,F,U)}catch(le){if(Re(Q),le!==le+0)throw le;Oe(1,0)}}function Jz(p,b,I,S,O,F,U,Q){var le=Pe();try{q1(p,b,I,S,O,F,U,Q)}catch(he){if(Re(le),he!==he+0)throw he;Oe(1,0)}}function Zz(p,b,I,S,O){var F=Pe();try{return F1(p,b,I,S,O)}catch(U){if(Re(F),U!==U+0)throw U;Oe(1,0)}}function eV(p,b,I,S,O,F,U,Q){var le=Pe();try{G1(p,b,I,S,O,F,U,Q)}catch(he){if(Re(le),he!==he+0)throw he;Oe(1,0)}}function tV(p,b,I,S,O,F,U,Q,le,he,ke,Fe){var Je=Pe();try{j1(p,b,I,S,O,F,U,Q,le,he,ke,Fe)}catch(at){if(Re(Je),at!==at+0)throw at;Oe(1,0)}}function nV(p,b,I,S,O,F){var U=Pe();try{return W1(p,b,I,S,O,F)}catch(Q){if(Re(U),Q!==Q+0)throw Q;Oe(1,0)}}function rV(p,b,I){var S=Pe();try{return K1(p,b,I)}catch(O){if(Re(S),O!==O+0)throw O;return Oe(1,0),0n}}function iV(p,b,I,S,O,F,U,Q,le){var he=Pe();try{D1(p,b,I,S,O,F,U,Q,le)}catch(ke){if(Re(he),ke!==ke+0)throw ke;Oe(1,0)}}function sV(p){var b=Pe();try{return Y1(p)}catch(I){if(Re(b),I!==I+0)throw I;Oe(1,0)}}function aV(p,b,I){var S=Pe();try{return Q1(p,b,I)}catch(O){if(Re(S),O!==O+0)throw O;Oe(1,0)}}function oV(p,b){var I=Pe();try{return h2(p,b)}catch(S){if(Re(I),S!==S+0)throw S;return Oe(1,0),0n}}function lV(p,b,I,S,O){var F=Pe();try{X1(p,b,I,S,O)}catch(U){if(Re(F),U!==U+0)throw U;Oe(1,0)}}function uV(p){var b=Pe();try{return J1(p)}catch(I){if(Re(b),I!==I+0)throw I;return Oe(1,0),0n}}function cV(p,b,I,S,O,F){var U=Pe();try{return i2(p,b,I,S,O,F)}catch(Q){if(Re(U),Q!==Q+0)throw Q;Oe(1,0)}}function dV(p,b,I,S,O,F){var U=Pe();try{return s2(p,b,I,S,O,F)}catch(Q){if(Re(U),Q!==Q+0)throw Q;Oe(1,0)}}function hV(p,b,I,S,O,F,U,Q){var le=Pe();try{return H1(p,b,I,S,O,F,U,Q)}catch(he){if(Re(le),he!==he+0)throw he;Oe(1,0)}}function fV(p,b,I,S,O){var F=Pe();try{return a2(p,b,I,S,O)}catch(U){if(Re(F),U!==U+0)throw U;return Oe(1,0),0n}}function pV(p,b,I,S){var O=Pe();try{return o2(p,b,I,S)}catch(F){if(Re(O),F!==F+0)throw F;Oe(1,0)}}function mV(p,b,I,S){var O=Pe();try{return l2(p,b,I,S)}catch(F){if(Re(O),F!==F+0)throw F;Oe(1,0)}}function gV(p,b,I,S,O,F,U,Q,le,he,ke,Fe){var Je=Pe();try{return u2(p,b,I,S,O,F,U,Q,le,he,ke,Fe)}catch(at){if(Re(Je),at!==at+0)throw at;Oe(1,0)}}function yV(p,b,I,S,O,F,U,Q,le,he,ke){var Fe=Pe();try{n2(p,b,I,S,O,F,U,Q,le,he,ke)}catch(Je){if(Re(Fe),Je!==Je+0)throw Je;Oe(1,0)}}function _V(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at,Os,hy){var EV=Pe();try{r2(p,b,I,S,O,F,U,Q,le,he,ke,Fe,Je,at,Os,hy)}catch(fy){if(Re(EV),fy!==fy+0)throw fy;Oe(1,0)}}function wV(p,b,I,S){var O=Pe();try{return c2(p,b,I,S)}catch(F){if(Re(O),F!==F+0)throw F;Oe(1,0)}}function vV(p,b,I,S,O){var F=Pe();try{return d2(p,b,I,S,O)}catch(U){if(Re(F),U!==U+0)throw U;Oe(1,0)}}function bV(p,b,I){var S=Pe();try{return Z1(p,b,I)}catch(O){if(Re(S),O!==O+0)throw O;Oe(1,0)}}function xV(p,b,I){var S=Pe();try{return e2(p,b,I)}catch(O){if(Re(S),O!==O+0)throw O;Oe(1,0)}}function TV(p,b,I,S){var O=Pe();try{t2(p,b,I,S)}catch(F){if(Re(O),F!==F+0)throw F;Oe(1,0)}}function ff(){if(0<En)hn=ff;else if(i)w==null||w(e),oe();else{for(var p=Ba;0<p.length;)p.shift()(e);0<En?hn=ff:(e.calledRun=!0,D||(oe(),w==null||w(e)))}}return i||(Qi=await rt(),ff()),e.PTR_SIZE=4,G?e:new Promise((p,b)=>{w=p,x=b})}var wM,qI,$ee=se(()=>{var t,e;wM=HI,qI=(e=(t=globalThis.self)==null?void 0:t.name)==null?void 0:e.startsWith("em-pthread"),qI&&HI()}),v_,ev,GI,Zn,vM,tp,KI,YI,b_,QI,x_,bM,T_,xM,Bx=se(()=>{Fx(),v_=typeof location>"u"?void 0:location.origin,ev=import.meta.url>"file:"&&import.meta.url<"file;",GI=()=>{{if(ev){let t=URL;return new URL(new t("ort.bundle.min.mjs",import.meta.url).href,v_).href}return import.meta.url}},Zn=GI(),vM=()=>{if(Zn&&!Zn.startsWith("blob:"))return Zn.substring(0,Zn.lastIndexOf("/")+1)},tp=(t,e)=>{try{let n=e??Zn;return(n?new URL(t,n):new URL(t)).origin===v_}catch{return!1}},KI=(t,e)=>{let n=e??Zn;try{return(n?new URL(t,n):new URL(t)).href}catch{return}},YI=(t,e)=>`${e??"./"}${t}`,b_=async t=>{let e=await(await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(e)},QI=async t=>(await import(t)).default,x_=(kee(),dh(gM)).default,bM=async()=>{if(!Zn)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(tp(Zn))return[void 0,x_()];let t=await b_(Zn);return[t,x_(t)]},T_=($ee(),dh(_M)).default,xM=async(t,e,n,r)=>{let i=T_&&!(t||e);if(i)if(Zn)i=tp(Zn);else if(r&&!n)i=!0;else throw new Error("cannot determine the script source URL.");if(i)return[void 0,T_];{let s="ort-wasm-simd-threaded.jsep.mjs",a=t??KI(s,e),o=n&&a&&!tp(a,e),l=o?await b_(a):a??YI(s,e);return[o?l:void 0,await QI(l)]}}}),E_,np,Rc,S_,XI,JI,ZI,Ux,st,tl=se(()=>{Bx(),np=!1,Rc=!1,S_=!1,XI=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},JI=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ZI=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Ux=async t=>{if(np)return Promise.resolve();if(Rc)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(S_)throw new Error("previous call to 'initializeWebAssembly()' failed.");Rc=!0;let e=t.initTimeout,n=t.numThreads;if(t.simd!==!1){if(t.simd==="relaxed"){if(!ZI())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!JI())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let r=XI();n>1&&!r&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+n+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=n=1);let i=t.wasmPaths,s=typeof i=="string"?i:void 0,a=i==null?void 0:i.mjs,o=(a==null?void 0:a.href)??a,l=i==null?void 0:i.wasm,u=(l==null?void 0:l.href)??l,c=t.wasmBinary,[d,h]=await xM(o,s,n>1,!!c||!!u),m=!1,g=[];if(e>0&&g.push(new Promise(w=>{setTimeout(()=>{m=!0,w()},e)})),g.push(new Promise((w,x)=>{let v={numThreads:n};if(c)v.wasmBinary=c;else if(u||s)v.locateFile=y=>u??s+y;else if(o&&o.indexOf("blob:")!==0)v.locateFile=y=>new URL(y,o).href;else if(d){let y=vM();y&&(v.locateFile=E=>y+E)}h(v).then(y=>{Rc=!1,np=!0,E_=y,w(),d&&URL.revokeObjectURL(d)},y=>{Rc=!1,S_=!0,x(y)})})),await Promise.race(g),m)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},st=()=>{if(np&&E_)return E_;throw new Error("WebAssembly is not initialized yet.")}}),Br,Hm,Ge,jx=se(()=>{tl(),Br=(t,e)=>{let n=st(),r=n.lengthBytesUTF8(t)+1,i=n._malloc(r);return n.stringToUTF8(t,i,r),e.push(i),i},Hm=(t,e,n,r)=>{if(typeof t=="object"&&t!==null){if(n.has(t))throw new Error("Circular reference in options");n.add(t)}Object.entries(t).forEach(([i,s])=>{let a=e?e+i:i;if(typeof s=="object")Hm(s,a+".",n,r);else if(typeof s=="string"||typeof s=="number")r(a,s.toString());else if(typeof s=="boolean")r(a,s?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof s}`)})},Ge=t=>{let e=st(),n=e.stackSave();try{let r=e.PTR_SIZE,i=e.stackAlloc(2*r);e._OrtGetLastError(i,i+r);let s=Number(e.getValue(i,r===4?"i32":"i64")),a=e.getValue(i+r,"*"),o=a?e.UTF8ToString(a):"";throw new Error(`${t} ERROR_CODE: ${s}, ERROR_MESSAGE: ${o}`)}finally{e.stackRestore(n)}}}),TM,Cee=se(()=>{tl(),jx(),TM=t=>{let e=st(),n=0,r=[],i=t||{};try{if((t==null?void 0:t.logSeverityLevel)===void 0)i.logSeverityLevel=2;else if(typeof t.logSeverityLevel!="number"||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${t.logSeverityLevel}`);if((t==null?void 0:t.logVerbosityLevel)===void 0)i.logVerbosityLevel=0;else if(typeof t.logVerbosityLevel!="number"||!Number.isInteger(t.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);(t==null?void 0:t.terminate)===void 0&&(i.terminate=!1);let s=0;return(t==null?void 0:t.tag)!==void 0&&(s=Br(t.tag,r)),n=e._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,s),n===0&&Ge("Can't create run options."),(t==null?void 0:t.extra)!==void 0&&Hm(t.extra,"",new WeakSet,(a,o)=>{let l=Br(a,r),u=Br(o,r);e._OrtAddRunConfigEntry(n,l,u)!==0&&Ge(`Can't set a run config entry: ${a} - ${o}.`)}),[n,r]}catch(s){throw n!==0&&e._OrtReleaseRunOptions(n),r.forEach(a=>e._free(a)),s}}}),ek,tk,nk,Pc,rk,EM,Aee=se(()=>{tl(),jx(),ek=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${t}`)}},tk=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${t}`)}},nk=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let e=t.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(n=>(typeof n=="string"?n:n.name)==="webgpu")&&(t.enableMemPattern=!1)},Pc=(t,e,n,r)=>{let i=Br(e,r),s=Br(n,r);st()._OrtAddSessionConfigEntry(t,i,s)!==0&&Ge(`Can't set a session config entry: ${e} - ${n}.`)},rk=async(t,e,n)=>{let r=e.executionProviders;for(let i of r){let s=typeof i=="string"?i:i.name,a=[];switch(s){case"webnn":if(s="WEBNN",typeof i!="string"){let d=i==null?void 0:i.deviceType;d&&Pc(t,"deviceType",d,n)}break;case"webgpu":if(s="JS",typeof i!="string"){let d=i;if(d!=null&&d.preferredLayout){if(d.preferredLayout!=="NCHW"&&d.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${d.preferredLayout}`);Pc(t,"preferredLayout",d.preferredLayout,n)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${s}`)}let o=Br(s,n),l=a.length,u=0,c=0;if(l>0){u=st()._malloc(l*st().PTR_SIZE),n.push(u),c=st()._malloc(l*st().PTR_SIZE),n.push(c);for(let d=0;d<l;d++)st().setValue(u+d*st().PTR_SIZE,a[d][0],"*"),st().setValue(c+d*st().PTR_SIZE,a[d][1],"*")}await st()._OrtAppendExecutionProvider(t,o,u,c,l)!==0&&Ge(`Can't append execution provider: ${s}.`)}},EM=async t=>{let e=st(),n=0,r=[],i=t||{};nk(i);try{let s=ek(i.graphOptimizationLevel??"all"),a=tk(i.executionMode??"sequential"),o=typeof i.logId=="string"?Br(i.logId,r):0,l=i.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw new Error(`log severity level is not valid: ${l}`);let u=i.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw new Error(`log verbosity level is not valid: ${u}`);let c=typeof i.optimizedModelFilePath=="string"?Br(i.optimizedModelFilePath,r):0;if(n=e._OrtCreateSessionOptions(s,!!i.enableCpuMemArena,!!i.enableMemPattern,a,!!i.enableProfiling,0,o,l,u,c),n===0&&Ge("Can't create session options."),i.executionProviders&&await rk(n,i,r),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Pc(n,"enableGraphCapture",i.enableGraphCapture.toString(),r)}if(i.freeDimensionOverrides)for(let[d,h]of Object.entries(i.freeDimensionOverrides)){if(typeof d!="string")throw new Error(`free dimension override name must be a string: ${d}`);if(typeof h!="number"||!Number.isInteger(h)||h<0)throw new Error(`free dimension override value must be a non-negative integer: ${h}`);let m=Br(d,r);e._OrtAddFreeDimensionOverride(n,m,h)!==0&&Ge(`Can't set a free dimension override: ${d} - ${h}.`)}return i.extra!==void 0&&Hm(i.extra,"",new WeakSet,(d,h)=>{Pc(n,d,h,r)}),[n,r]}catch(s){throw n!==0&&e._OrtReleaseSessionOptions(n)!==0&&Ge("Can't release session options."),r.forEach(a=>e._free(a)),s}}}),mo,is,go,qg,qm,Wx,Hx,tv,ve=se(()=>{mo=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${t}`)}},is=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${t}`)}},go=(t,e)=>{let n=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],r=typeof e=="number"?e:e.reduce((i,s)=>i*s,1);return n>0?Math.ceil(r*n):void 0},qg=t=>{switch(t){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${t}`)}},qm=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${t}`)}},Wx=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",Hx=t=>t==="float32"||t==="float16"||t==="int32"||t==="int64"||t==="uint32"||t==="uint64"||t==="int8"||t==="uint8"||t==="bool"||t==="uint4"||t==="int4",tv=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${t}`)}}}),qx,SM=se(()=>{Fx(),qx=async t=>{if(typeof t=="string"){let e=await fetch(t);if(!e.ok)throw new Error(`failed to load external data file: ${t}`);let n=e.headers.get("Content-Length"),r=n?parseInt(n,10):0;if(r<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${t}, no response body.`);let i=e.body.getReader(),s;try{s=new ArrayBuffer(r)}catch(o){if(o instanceof RangeError){let l=Math.ceil(r/65536);s=new WebAssembly.Memory({initial:l,maximum:l}).buffer}else throw o}let a=0;for(;;){let{done:o,value:l}=await i.read();if(o)break;let u=l.byteLength;new Uint8Array(s,a,u).set(l),a+=u}return new Uint8Array(s,0,r)}}else return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t)}}),ik,sk,ak,ok,Gx,lk,De,xs=se(()=>{ve(),ik=["V","I","W","E","F"],sk=(t,e)=>{console.log(`[${ik[t]},${new Date().toISOString()}]${e}`)},Gx=(t,e)=>{ak=t,ok=e},lk=(t,e)=>{let n=qm(t),r=qm(ak);n>=r&&sk(n,typeof e=="function"?e():e)},De=(...t)=>{ok&&lk(...t)}}),uk,Su,q,Gm,IM,kM,$M,Ee=se(()=>{uk=class{static calcMatMulShape(t,e){return t[1]!==e[0]?void 0:[t[0],e[1]]}},Su=class{static calcShape(t,e,n=!1){let r=t.length,i=e.length;if(r===0)return e;if(i===0)return t;let s=Math.max(t.length,e.length),a=new Array(s);if(n){if(r<2||i<2)return;let o=uk.calcMatMulShape([t[r-2],t[r-1]],[e[i-2],e[i-1]]);if(o===void 0)return;[a[s-2],a[s-1]]=o}for(let o=n?3:1;o<=s;o++){let l=r-o<0?1:t[r-o],u=i-o<0?1:e[i-o];if(l!==u&&l>1&&u>1)return;let c=Math.max(l,u);if(l&&u)a[s-o]=Math.max(l,u);else{if(c>1)return;a[s-o]=0}}return a}static isValidBroadcast(t,e){let n=t.length,r=e.length;if(n>r)return!1;for(let i=1;i<=n;i++)if(t[n-i]!==1&&t[n-i]!==e[r-i])return!1;return!0}},q=class Fp{static size(e){return Fp.getSizeFromDimensionRange(e,0,e.length)}static convertShape(e,n=4){let r=e.length;if(r===0)return[];let i=new Array(r),s=r-1;for(;s>=0;){if(e[s]%n===0){i[s]=e[s]/n;break}if(n%e[s]!==0)throw new Error("cannot convert shape");i[s]=1,n/=e[s],s--}for(s--;s>=0;s--)i[s]=e[s];return i}static sizeFromDimension(e,n){if(n<0||n>e.length)throw new Error(`invalid dimension of ${n} for sizeFromDimension as Tensor has ${e.length} dimensions.`);return Fp.getSizeFromDimensionRange(e,n,e.length)}static sizeToDimension(e,n){if(n<0||n>e.length)throw new Error(`invalid dimension of ${n} for sizeToDimension as Tensor has ${e.length} dimensions.`);return Fp.getSizeFromDimensionRange(e,0,n)}static getSizeFromDimensionRange(e,n,r){let i=1;for(let s=n;s<r;s++){if(e[s]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(e[s])}return i}static computeStrides(e){let n=e.length;if(n===0)return[];if(n===1)return[1];let r=new Array(n);r[n-1]=1,r[n-2]=e[n-1];for(let i=n-3;i>=0;--i)r[i]=r[i+1]*e[i+1];return r}static normalizeAxis(e,n){if(e<-n&&e>=n)throw new Error("unsupported axis for this operation.");return e<0?e+n:e}static normalizeAxes(e,n){return e.map(r=>this.normalizeAxis(r,n??e.length))}static sortBasedOnPerm(e,n){return n?n.map(r=>e[r]):e.slice().reverse()}static padShape(e,n){let r=e.length;return e.map((i,s)=>i+n[s]+n[s+r])}static areEqual(e,n){return e.length!==n.length?!1:e.every((r,i)=>r===n[i])}},Gm=class ed{static adjustPoolAttributes(e,n,r,i,s,a){if(!e&&r.length!==n.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(e)for(let o=0;o<n.length-2;o++)o>=r.length?r.push(n[o+2]):r[o]=n[o+2];for(let o=0;o<r.length;o++)if(o<i.length){if(i[o]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let o=0;o<r.length;o++)if(o<s.length){if(s[o]<0)throw new Error("dilations should be greater than or equal to 1")}else s.push(1);for(let o=0;o<r.length*2;o++)if(o<a.length){if(a[o]<0)throw new Error("pad should be greater than or equal to 1")}else a.push(0);for(let o=0;o<r.length;o++){if(r[o]<=0)throw new Error("kernel shapes need to be greater than 0");if(a[o]>=r[o]||a[o+r.length]>=r[o])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(e,n,r,i,s,a,o){if(o){if(s.length!==2*(e.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(n.length!==e.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==e.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let l=0;l<e.length-2;l++)ed.adjustPadAndReturnShape(e[l+(a?1:2)],n[l],r[l],i[l],s,l,l+e.length-2,o)}}static computePoolOutputShape(e,n,r,i,s,a,o){if(n.length<=0)throw new Error("input shape must be of size greater than 0");let l=[n[0],n[1]];return ed.computeShapeHelper(e,n,l,r,i,s,a,o),l}static computeConvOutputShape(e,n,r,i,s,a,o){if(e.length<=0||n.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let l=[e[0],n[0]];return ed.computeShapeHelper(!1,e,l,r,i,s,a,o),l}static computeShapeHelper(e,n,r,i,s,a,o,l){if(e)for(let u=0;u<n.length-2;u++)r.push(1);else for(let u=0;u<n.length-2;u++)r.push(ed.adjustPadAndReturnShape(n[u+2],i[u],s[u],a[u],o,u,u+n.length-2,l))}static adjustPadAndReturnShape(e,n,r,i,s,a,o,l){let u=r*(i-1)+1;if(l&&l!=="NOTSET")switch(l){case"VALID":return s[a]=0,s[o]=0,Math.floor((e-u)/n+1);case"SAME_LOWER":case"SAME_UPPER":if(r!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let c=((e+n-1)/n-1)*n+i-e;return s[a]=Math.floor(l==="SAME_LOWER"?(c+1)/2:c/2),s[o]=c-s[a],Math.floor((e+c-i)/n+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((e+s[a]+s[o]-u)/n+1)}},IM=class{static getShapeOfGemmResult(t,e,n,r,i){if(t.length!==2||n.length!==2)throw new Error("shape need to be of size 2");let s,a,o;e?(s=t[1],a=t[0]):(s=t[0],a=t[1]);let l=-1;if(r?(o=n[0],l=1):(o=n[1],l=0),n[l]!==a)throw new Error("dimension mismatch");if(s<=0||o<=0||a<=0)throw new Error("invalid shape specified");if(i&&!Su.isValidBroadcast(i,[s,o]))throw new Error("gemm: invalid bias shape for broadcast");return[s,o,a]}},kM=-34028234663852886e22,$M=34028234663852886e22}),Kx,CM=se(()=>{ve(),Kx=(t,e)=>new(qg(e))(t)}),I_,nv,k_,ck,$_,dk,C_,A_,R_,hk,AM,Ree=se(()=>{ve(),xs(),I_=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),nv=(t,e)=>{if(e==="int32")return t;let n=I_.get(e);if(!n)throw new Error(`WebNN backend does not support data type: ${e}`);let r=n/8;if(t.byteLength%r!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${r}.`);let i=t.byteLength/r,s=new(qg(e))(t.buffer,t.byteOffset,i);switch(e){case"int64":case"uint64":{let a=new Int32Array(i);for(let o=0;o<i;o++){let l=s[o];if(l>2147483647n||l<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");a[o]=Number(l)}return new Uint8Array(a.buffer)}case"int8":case"uint8":case"uint32":{if(e==="uint32"&&s.some(o=>o>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let a=Int32Array.from(s,Number);return new Uint8Array(a.buffer)}default:throw new Error(`Unsupported data conversion from ${e} to 'int32'`)}},k_=(t,e)=>{if(e==="int32")return t;if(t.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let n=t.byteLength/4,r=new Int32Array(t.buffer,t.byteOffset,n);switch(e){case"int64":{let i=BigInt64Array.from(r,BigInt);return new Uint8Array(i.buffer)}case"uint64":{if(r.some(s=>s<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let i=BigUint64Array.from(r,BigInt);return new Uint8Array(i.buffer)}case"int8":{if(r.some(s=>s<-128||s>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let i=Int8Array.from(r,Number);return new Uint8Array(i.buffer)}case"uint8":{if(r.some(i=>i<0||i>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(r,Number)}case"uint32":{if(r.some(s=>s<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let i=Uint32Array.from(r,Number);return new Uint8Array(i.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${e}`)}},ck=1,$_=()=>ck++,dk=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),C_=(t,e)=>{let n=I_.get(t);if(!n)throw new Error(`WebNN backend does not support data type: ${t}`);return e.length>0?Math.ceil(e.reduce((r,i)=>r*i)*n/8):0},A_=class{constructor(t){this.isDataConverted=!1;let{sessionId:e,context:n,tensor:r,dataType:i,shape:s,fallbackDataType:a}=t;this.sessionId=e,this.mlContext=n,this.mlTensor=r,this.dataType=i,this.tensorShape=s,this.fallbackDataType=a}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return C_(this.dataType,this.tensorShape)}destroy(){De("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(this.fallbackDataType){let e=await this.mlContext.readTensor(this.mlTensor),n=k_(new Uint8Array(e),this.dataType);if(t){(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(n);return}else return n.buffer}else return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(t,e,n){return this.mlContext===t&&this.dataType===e&&this.tensorShape.length===n.length&&this.tensorShape.every((r,i)=>r===n[i])}setIsDataConverted(t){this.isDataConverted=t}},R_=class{constructor(t,e){this.tensorManager=t,this.wrapper=e}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,e,n,r){let i=this.tensorManager.getMLContext(t),s=this.tensorManager.getMLOpSupportLimits(t),a;if(!(s!=null&&s.input.dataTypes.includes(e))){if(a=dk.get(e),!a||(s==null?void 0:s.input.dataTypes.includes(a)))throw new Error(`WebNN backend does not support data type: ${e}`);De("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${e} to ${a}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(i,e,n))return this.wrapper.tensor;if(r){if(this.wrapper.byteLength!==C_(e,n))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,e,n,o,!0,!0,a),r&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let e=t;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")e=nv(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength){this.wrapper.write(e);return}else De("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(e):this.activeUpload=new Uint8Array(e)}async download(t){var e,n;if(this.activeUpload){let r=(e=this.wrapper)!=null&&e.isDataConverted?k_(this.activeUpload,(n=this.wrapper)==null?void 0:n.type):this.activeUpload;if(t){t instanceof ArrayBuffer?new Uint8Array(t).set(r):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(r);return}else return r.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},hk=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let e=this.backend.getMLContext(t);if(!e)throw new Error("MLContext not found for session.");return e}getMLOpSupportLimits(t){return this.backend.getMLOpSupportLimits(t)}reserveTensorId(){let t=$_();return this.tensorTrackersById.set(t,new R_(this)),t}releaseTensorId(t){let e=this.tensorTrackersById.get(t);e&&(this.tensorTrackersById.delete(t),e.tensorWrapper&&this.releaseTensor(e.tensorWrapper))}async ensureTensor(t,e,n,r,i){De("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${e}, dataType: ${n}, shape: ${r}, copyOld: ${i}}`);let s=this.tensorTrackersById.get(e);if(!s)throw new Error("Tensor not found.");return s.ensureTensor(t,n,r,i)}upload(t,e){let n=this.tensorTrackersById.get(t);if(!n)throw new Error("Tensor not found.");n.upload(e)}async download(t,e){De("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${e==null?void 0:e.byteLength}}`);let n=this.tensorTrackersById.get(t);if(!n)throw new Error("Tensor not found.");return n.download(e)}releaseTensorsForSession(t){for(let e of this.freeTensors)e.sessionId===t&&e.destroy();this.freeTensors=this.freeTensors.filter(e=>e.sessionId!==t)}registerTensor(t,e,n,r){let i=this.getMLContext(t),s=$_(),a=new A_({sessionId:t,context:i,tensor:e,dataType:n,shape:r});return this.tensorTrackersById.set(s,new R_(this,a)),this.externalTensors.add(a),s}async getCachedTensor(t,e,n,r,i,s,a){let o=this.getMLContext(t);for(let[u,c]of this.freeTensors.entries())if(c.canReuseTensor(o,e,n)){De("verbose",()=>`[WebNN] Reusing tensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${n}`);let d=this.freeTensors.splice(u,1)[0];return d.sessionId=t,d}De("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${e}, ${a?`fallbackDataType: ${a},`:""} shape: ${n}}`);let l=await o.createTensor({dataType:a??e,shape:n,dimensions:n,usage:r,writable:i,readable:s});return new A_({sessionId:t,context:o,tensor:l,dataType:e,shape:n,fallbackDataType:a})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},AM=(...t)=>new hk(...t)}),Nc,fk,RM,Pee=se(()=>{ve(),tl(),CM(),Ree(),xs(),Nc=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),fk=(t,e)=>{if(t===e)return!0;if(t===void 0||e===void 0)return!1;let n=Object.keys(t).sort(),r=Object.keys(e).sort();return n.length===r.length&&n.every((i,s)=>i===r[s]&&t[i]===e[i])},RM=class{constructor(t){this.tensorManager=AM(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,this.mlOpSupportLimitsBySessionId=new Map,Gx(t.logLevel,!!t.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(t){De("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){De("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let e=this.temporarySessionTensorIds.get(t);if(e){for(let n of e)De("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${n}}`),this.tensorManager.releaseTensorId(n);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let n=this.mlContextCache.findIndex(r=>r.gpuDevice===t);if(n!==-1)return this.mlContextCache[n].mlContext;{let r=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:r}),r}}else if(t===void 0){let n=this.mlContextCache.findIndex(r=>r.options===void 0&&r.gpuDevice===void 0);if(n!==-1)return this.mlContextCache[n].mlContext;{let r=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:r}),r}}let e=this.mlContextCache.findIndex(n=>fk(n.options,t));if(e!==-1)return this.mlContextCache[e].mlContext;{let n=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:n}),n}}registerMLContext(t,e){this.mlContextBySessionId.set(t,e);let n=this.sessionIdsByMLContext.get(e);n||(n=new Set,this.sessionIdsByMLContext.set(e,n)),n.add(t),this.mlOpSupportLimitsBySessionId.has(t)||this.mlOpSupportLimitsBySessionId.set(t,e.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let e=this.mlContextBySessionId.get(t);if(!e)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t),this.mlOpSupportLimitsBySessionId.delete(t);let n=this.sessionIdsByMLContext.get(e);if(n.delete(t),n.size===0){this.sessionIdsByMLContext.delete(e);let r=this.mlContextCache.findIndex(i=>i.mlContext===e);r!==-1&&this.mlContextCache.splice(r,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}getMLOpSupportLimits(t){return this.mlOpSupportLimitsBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){De("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,e,n,r,i){let s=Nc.get(n);if(!s)throw new Error(`Unsupported ONNX data type: ${n}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,e,s,r,i)}async createTemporaryTensor(t,e,n){De("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${e}, shape: ${n}}`);let r=Nc.get(e);if(!r)throw new Error(`Unsupported ONNX data type: ${e}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,i,r,n,!1);let s=this.temporarySessionTensorIds.get(t);return s?s.push(i):this.temporarySessionTensorIds.set(t,[i]),i}uploadTensor(t,e){if(!st().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");De("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${e.byteLength}}`),this.tensorManager.upload(t,e)}async downloadTensor(t,e){return this.tensorManager.download(t,e)}createMLTensorDownloader(t,e){return async()=>{let n=await this.tensorManager.download(t);return Kx(n,e)}}registerMLTensor(t,e,n,r){let i=Nc.get(n);if(!i)throw new Error(`Unsupported ONNX data type: ${n}`);let s=this.tensorManager.registerTensor(t,e,i,r);return De("verbose",()=>`[WebNN] registerMLTensor {tensor: ${e}, dataType: ${i}, dimensions: ${r}} -> {tensorId: ${s}}`),s}registerMLConstant(t,e,n,r,i,s,a=!1){if(!s)throw new Error("External mounted files are not available.");let o=t;t.startsWith("./")&&(o=t.substring(2));let l=s.get(o);if(!l)throw new Error(`File with name ${o} not found in preloaded files.`);if(e+n>l.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let u=l.slice(e,e+n).buffer,c;switch(i.dataType){case"float32":c=new Float32Array(u);break;case"float16":c=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(u):new Uint16Array(u);break;case"int32":c=new Int32Array(u);break;case"uint32":c=new Uint32Array(u);break;case"int64":if(a){let d=nv(new Uint8Array(u),"int64");c=new Int32Array(d.buffer),i.dataType="int32"}else c=new BigInt64Array(u);break;case"uint64":c=new BigUint64Array(u);break;case"int8":c=new Int8Array(u);break;case"int4":case"uint4":case"uint8":c=new Uint8Array(u);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return De("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${a?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),r.constant(i,c)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,e){let n=this.sessionGraphInputs.get(t);return n?n.includes(e):!1}isGraphOutput(t,e){let n=this.sessionGraphOutputs.get(t);return n?n.includes(e):!1}isGraphInputOutputTypeSupported(t,e,n=!0){let r=Nc.get(mo(e)),i=this.mlOpSupportLimitsBySessionId.get(t);return typeof r>"u"?!1:n?!!(i!=null&&i.input.dataTypes.includes(r)):!!(i!=null&&i.output.dataTypes.includes(r))}flush(){}}}),Yx=se(()=>{}),P_,rp,ip,pk,mk,N_,rv,gk,PM,Nee=se(()=>{xs(),Yx(),P_=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),rp=[],ip=t=>Math.ceil(Number(t)/16)*16,pk=t=>{for(let e=0;e<rp.length;e++){let n=rp[e];if(t<=n)return n}return Math.ceil(t/16)*16},mk=1,N_=()=>mk++,rv=async(t,e,n,r)=>{let i=ip(n),s=t.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let a=t.getCommandEncoder();t.endComputePass(),a.copyBufferToBuffer(e,0,s,0,i),t.flush(),await s.mapAsync(GPUMapMode.READ);let o=s.getMappedRange();if(r){let l=r();return l.set(new Uint8Array(o,0,n)),l}else return new Uint8Array(o.slice(0,n))}finally{s.destroy()}},gk=class{constructor(t){this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[e]of P_)rp.push(e),this.freeBuffers.set(e,[]),this.freeUniformBuffers.set(e,[]);this.sessionCount=0}upload(t,e){let n=e.buffer,r=e.byteOffset,i=e.byteLength,s=ip(i),a=this.storageCache.get(t);if(!a)throw new Error("gpu data for uploading does not exist");if(Number(a.originalSize)!==i)throw new Error(`inconsistent data size. gpu data size=${a.originalSize}, data size=${i}`);let o=this.backend.device.createBuffer({mappedAtCreation:!0,size:s,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),l=o.getMappedRange();new Uint8Array(l).set(new Uint8Array(n,r,i)),o.unmap();let u=this.backend.device.createCommandEncoder();u.copyBufferToBuffer(o,0,a.gpuData.buffer,0,s),this.backend.device.queue.submit([u.finish()]),o.destroy(),De("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,e){let n=this.storageCache.get(t);if(!n)throw new Error("source gpu data for memcpy does not exist");let r=this.storageCache.get(e);if(!r)throw new Error("destination gpu data for memcpy does not exist");if(n.originalSize!==r.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=ip(n.originalSize),s=this.backend.getCommandEncoder();this.backend.endComputePass(),s.copyBufferToBuffer(n.gpuData.buffer,0,r.gpuData.buffer,0,i)}registerExternalBuffer(t,e,n){let r;if(n){if(r=n[0],t===n[1])return De("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${r}, buffer is the same, skip.`),r;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else r=N_();return this.storageCache.set(r,{gpuData:{id:r,type:0,buffer:t},originalSize:e}),De("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${e}) => id=${r}, registered.`),r}unregisterExternalBuffer(t){t!==void 0&&(this.storageCache.delete(t),De("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let n=pk(t),r,i=(e&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,s=(e&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||s){let o=(i?this.freeBuffers:this.freeUniformBuffers).get(n);o?o.length>0?r=o.pop():r=this.backend.device.createBuffer({size:n,usage:e}):r=this.backend.device.createBuffer({size:n,usage:e})}else r=this.backend.device.createBuffer({size:n,usage:e});let a={id:N_(),type:0,buffer:r};return this.storageCache.set(a.id,{gpuData:a,originalSize:Number(t)}),De("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${a.id}`),a}get(t){var e;return(e=this.storageCache.get(t))==null?void 0:e.gpuData}release(t){let e=typeof t=="bigint"?Number(t):t,n=this.storageCache.get(e);if(!n){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return De("verbose",()=>`[WebGPU] GpuDataManager.release(id=${e}), gpuDataId=${n.gpuData.id}`),this.storageCache.delete(e),this.buffersPending.push(n.gpuData.buffer),n.originalSize}async download(t,e){let n=this.storageCache.get(Number(t));if(!n)throw new Error("data does not exist");await rv(this.backend,n.gpuData.buffer,n.originalSize,e)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let t of this.buffersPending){let e=P_.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let n=this.freeBuffers.get(t.size)||[];e===void 0||n.length>=e?t.destroy():n.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let n=this.freeUniformBuffers.get(t.size)||[];e===void 0||n.length>=e?t.destroy():n.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t));for(let e of this.buffersPending)t.push(e);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(e=>{e.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let e=this.capturedPendingBuffers.get(t);e&&(e.forEach(n=>{n.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,this.sessionCount===0&&(De("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(n=>{n.gpuData.buffer.destroy()}),this.storageCache=new Map)}},PM=(...t)=>new gk(...t)}),yk,qe,It=se(()=>{yk=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},qe=t=>new yk(t)}),Iu,sp,Yt,gn,_e,yt,iv,ql,Ra,ye,Oc,X,me,NM,Qx,_k,OM,Se=se(()=>{ve(),Ee(),Iu=64,sp=(t,e)=>{if(e===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return e>1?`vec${e}<f16>`:"f16";case 1:return e>1?`vec${e}<f32>`:"f32";case 6:return e>1?`vec${e}<i32>`:"i32";case 12:return e>1?`vec${e}<u32>`:"u32";case 7:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(e>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(e!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${t}`)}},Yt=(t,e=1)=>{let n=sp(t,e);return typeof n=="string"?n:n[0]},gn=(t,e=1)=>{let n=sp(t,e);return typeof n=="string"?n:n[1]},_e=(...t)=>{let e=[];return t.forEach(n=>{n.length!==0&&e.push({type:12,data:n},{type:12,data:q.computeStrides(n)})}),e},yt=t=>t%4===0?4:t%2===0?2:1,iv=(t="f32",e,n="0")=>!e||e===1?`${t}(${n})`:`vec${e}<${t}>(${n})`,ql=(t,e,n)=>t==="f32"?n:e===1?`f32(${n})`:`vec${e}<f32>(${n})`,Ra=(t,e)=>e===4?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:e===2?`(${t}.x + ${t}.y)`:e===3?`(${t}.x + ${t}.y + ${t}.z)`:t,ye=(t,e,n,r)=>t.startsWith("uniforms.")&&n>4?typeof e=="string"?r==="f16"?`${t}[(${e}) / 8][(${e}) % 8 / 4][(${e}) % 8 % 4]`:`${t}[(${e}) / 4][(${e}) % 4]`:r==="f16"?`${t}[${Math.floor(e/8)}][${Math.floor(e%8/4)}][${e%8%4}]`:`${t}[${Math.floor(e/4)}][${e%4}]`:n>1?`${t}[${e}]`:t,Oc=(t,e,n,r,i)=>{let s=typeof n=="number",a=s?n:n.length,o=[...new Array(a).keys()],l=a<2?"u32":a<=4?`vec${a}<u32>`:`array<u32, ${a}>`,u=sp(e,i),c=typeof u=="string"?u:u[1],d=typeof u=="string"?u:u[0],h={indices:l,value:c,storage:d,tensor:e},m=G=>typeof G=="string"?G:`${G}u`,g={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},w=s?"uniforms.":"",x=`${w}${t}_shape`,v=`${w}${t}_strides`,y="";for(let G=0;G<a-1;G++)y+=`
    let dim${G} = current / ${ye(v,G,a)};
    let rest${G} = current % ${ye(v,G,a)};
    indices[${G}] = dim${G};
    current = rest${G};
    `;y+=`indices[${a-1}] = current;`;let E=a<2?"":`
  fn o2i_${t}(offset: u32) -> ${h.indices} {
    var indices: ${h.indices};
    var current = offset;
    ${y}
    return indices;
  }`,$=G=>(g.offsetToIndices=!0,a<2?G:`o2i_${t}(${G})`),R=[];if(a>=2)for(let G=a-1;G>=0;G--)R.push(`${ye(v,G,a)} * (indices[${G}])`);let D=a<2?"":`
  fn i2o_${t}(indices: ${h.indices}) -> u32 {
    return ${R.join("+")};
  }`,k=G=>(g.indicesToOffset=!0,a<2?G:`i2o_${t}(${G})`),_=(...G)=>a===0?"0u":`${h.indices}(${G.map(m).join(",")})`,A=(G,H)=>a<2?`${G}`:`${ye(G,H,a)}`,N=(G,H,oe)=>a<2?`${G}=${oe};`:`${ye(G,H,a)}=${oe};`,L={},V=(G,H)=>{g.broadcastedIndicesToOffset=!0;let oe=`${H.name}broadcastedIndicesTo${t}Offset`;if(oe in L)return`${oe}(${G})`;let ue=[];for(let Ne=a-1;Ne>=0;Ne--){let rt=H.indicesGet("outputIndices",Ne+H.rank-a);ue.push(`${A(v,Ne)} * (${rt} % ${A(x,Ne)})`)}return L[oe]=`fn ${oe}(outputIndices: ${H.type.indices}) -> u32 {
             return ${ue.length>0?ue.join("+"):"0u"};
           }`,`${oe}(${G})`},M=(G,H)=>(()=>{if(h.storage===h.value)return`${t}[${G}]=${H};`;if(h.storage==="vec2<u32>"&&h.value==="i32")return`${t}[${G}]=vec2<u32>(u32(${H}), select(0u, 0xFFFFFFFFu, ${H} < 0));`;if(h.storage==="vec2<u32>"&&h.value==="u32")return`${t}[${G}]=vec2<u32>(u32(${H}), 0u);`;if(h.storage==="u32"&&h.value==="vec4<bool>")return`${t}[${G}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${H}));`;throw new Error(`not supported combination of storage type ${h.storage} and value type ${h.value} yet`)})(),B=G=>(()=>{if(h.storage===h.value)return`${t}[${G}]`;if(h.storage==="vec2<u32>"&&h.value==="i32")return`i32(${t}[${G}].x)`;if(h.storage==="vec2<u32>"&&h.value==="u32")return`u32(${t}[${G}].x)`;if(h.storage==="u32"&&h.value==="vec4<bool>")return`vec4<bool>(bool(${t}[${G}] & 0xFFu), bool(${t}[${G}] & 0xFF00u), bool(${t}[${G}] & 0xFF0000u), bool(${t}[${G}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${h.storage} and value type ${h.value} yet`)})(),Z=a<2?"":`
  fn get_${t}ByIndices(indices: ${h.indices}) -> ${c} {
    return ${B(`i2o_${t}(indices)`)};
  }`,ie=a<2?"":(()=>{let G=o.map(oe=>`d${oe}: u32`).join(", "),H=o.map(oe=>`d${oe}`).join(", ");return`
  fn get_${t}(${G}) -> ${c} {
    return get_${t}ByIndices(${_(H)});
  }`})(),de=(...G)=>{if(G.length!==a)throw new Error(`indices length must be ${a}`);let H=G.map(m).join(",");return a===0?B("0u"):a===1?B(H[0]):(g.get=!0,g.getByIndices=!0,g.indicesToOffset=!0,`get_${t}(${H})`)},ee=G=>a<2?B(G):(g.getByIndices=!0,g.indicesToOffset=!0,`get_${t}ByIndices(${G})`),Y=a<2?"":`
  fn set_${t}ByIndices(indices: ${h.indices}, value: ${c}) {
    ${M(`i2o_${t}(indices)`,"value")}
  }`,J=a<2?"":(()=>{let G=o.map(oe=>`d${oe}: u32`).join(", "),H=o.map(oe=>`d${oe}`).join(", ");return`
  fn set_${t}(${G}, value: ${c}) {
    set_${t}ByIndices(${_(H)}, value);
  }`})();return{impl:()=>{let G=[],H=!1;return g.offsetToIndices&&(G.push(E),H=!0),g.indicesToOffset&&(G.push(D),H=!0),g.broadcastedIndicesToOffset&&(Object.values(L).forEach(oe=>G.push(oe)),H=!0),g.set&&(G.push(J),H=!0),g.setByIndices&&(G.push(Y),H=!0),g.get&&(G.push(ie),H=!0),g.getByIndices&&(G.push(Z),H=!0),!s&&H&&G.unshift(`const ${x} = ${h.indices}(${n.join(",")});`,`const ${v} = ${h.indices}(${q.computeStrides(n).join(",")});`),G.join(`
`)},type:h,offsetToIndices:$,indicesToOffset:k,broadcastedIndicesToOffset:V,indices:_,indicesGet:A,indicesSet:N,set:(...G)=>{if(G.length!==a+1)throw new Error(`indices length must be ${a}`);let H=G[a];if(typeof H!="string")throw new Error("value must be string");let oe=G.slice(0,a).map(m).join(",");return a===0?M("0u",H):a===1?M(oe[0],H):(g.set=!0,g.setByIndices=!0,g.indicesToOffset=!0,`set_${t}(${oe}, ${H})`)},setByOffset:M,setByIndices:(G,H)=>a<2?M(G,H):(g.setByIndices=!0,g.indicesToOffset=!0,`set_${t}ByIndices(${G}, ${H});`),get:de,getByOffset:B,getByIndices:ee,usage:r,name:t,strides:v,shape:x,rank:a}},X=(t,e,n,r=1)=>Oc(t,e,n,"input",r),me=(t,e,n,r=1)=>Oc(t,e,n,"output",r),NM=(t,e,n)=>Oc(t,e,n,"atomicOutput",1),Qx=(t,e,n,r=1)=>Oc(t,e,n,"internal",r),_k=class{constructor(t,e){this.normalizedDispatchGroup=t,this.limits=e,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${typeof t=="number"?`${t}u`:t}) { return; }`}mainStart(t=Iu){let e=typeof t=="number"?t:t[0],n=typeof t=="number"?1:t[1],r=typeof t=="number"?1:t[2];if(e>this.limits.maxComputeWorkgroupSizeX||n>this.limits.maxComputeWorkgroupSizeY||r>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${e}, ${n}, ${r}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(e*n*r>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${e}, ${n}, ${r}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let i=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,s=i?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,a=i?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${e*n*r}u + local_idx;`;return`@compute @workgroup_size(${e}, ${n}, ${r})
  fn main(${s}) {
    ${a}
  `}appendVariableUniforms(t){t.rank!==0&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,e){if(t.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let n=t.usage==="input"?"read":"read_write",r=t.usage==="atomicOutput"?"atomic<i32>":t.type.storage;return`@group(0) @binding(${e}) var<storage, ${n}> ${t.name}: array<${r}>;`}declareVariables(...t){return t.map(e=>this.declareVariable(e,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if(t.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(e=>this.registerInternalVariable(e)),this}registerUniform(t,e,n=1){return this.uniforms.push({name:t,type:e,length:n}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let t=[];for(let{name:e,type:n,length:r}of this.uniforms)if(r&&r>4)n==="f16"?t.push(`@align(16) ${e}:array<mat2x4<${n}>, ${Math.ceil(r/8)}>`):t.push(`${e}:array<vec4<${n}>, ${Math.ceil(r/4)}>`);else{let i=r==null||r===1?n:`vec${r}<${n}>`;t.push(`${e}:${i}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let t=e=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(e)];return this.uniforms.map(e=>[t(e.type),e.length??1])}},OM=(t,e)=>new _k(t,e)}),wk,O_,vk,bk,xk,Tk,ar,DM,MM,Fa=se(()=>{ve(),Ee(),It(),Se(),wk=(t,e)=>{if(!t||t.length!==1)throw new Error("Transpose requires 1 input.");if(e.length!==0&&e.length!==t[0].dims.length)throw new Error(`perm size ${e.length} does not match input rank ${t[0].dims.length}`)},O_=(t,e)=>e.length!==0?e:[...new Array(t).keys()].reverse(),vk=(t,e)=>q.sortBasedOnPerm(t,O_(t.length,e)),bk=(t,e,n,r)=>{let i=`fn perm(i: ${r.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`;for(let s=0;s<e;++s)i+=`a[${t[s]}]=i[${s}];`;return i+="return a;}"},xk=(t,e)=>{let n=[],r=[];for(let i=0;i<t.length;++i)t[i]!==1&&n.push(t[i]),t[e[i]]!==1&&r.push(e[i]);return{newShape:n,newPerm:r}},Tk=(t,e)=>{let n=0;for(let r=0;r<t.length;++r)if(e[t[r]]!==1){if(t[r]<n)return!1;n=t[r]}return!0},ar=(t,e)=>{let n=t.dataType,r=t.dims.length,i=O_(r,e),s=vk(t.dims,i),a=t.dims,o=s,l=r<2||Tk(i,t.dims),u;if(l)return u=g=>{let w=X("input",n,a,4),x=me("output",n,o,4);return`
  ${g.registerUniform("output_size","u32").declareVariables(w,x)}
  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let g=q.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(g/64/4)},programUniforms:[{type:12,data:Math.ceil(g/4)}]}},getShaderSource:u};let{newShape:c,newPerm:d}=xk(t.dims,i),h=q.areEqual(d,[2,3,1]),m=q.areEqual(d,[3,1,2]);if(c.length===2||h||m){a=h?[c[0],c[1]*c[2]]:m?[c[0]*c[1],c[2]]:c,o=[a[1],a[0]];let g=16;return u=w=>{let x=X("a",n,a.length),v=me("output",n,o.length);return`
  ${w.registerUniform("output_size","u32").declareVariables(x,v)}
  var<workgroup> tile : array<array<${v.type.value}, ${g+1}>, ${g}>;
  ${w.mainStart([g,g,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${g} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${g}u + local_id.x;
    let input_row = workgroup_id_x * ${g}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${x.getByIndices(`${x.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${g}u + local_id.x;
    let output_row = workgroup_id_y * ${g}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${v.setByIndices(`${v.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let w=q.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(o[1]/g),y:Math.ceil(o[0]/g)},programUniforms:[{type:12,data:w},..._e(a,o)]}},getShaderSource:u}}return u=g=>{let w=X("a",n,a.length),x=me("output",n,o.length);return`
  ${g.registerUniform("output_size","u32").declareVariables(w,x)}

  ${bk(i,r,w,x)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${x.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${x.setByOffset("global_idx",w.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${e}`,inputDependencies:["rank"]},getRunData:()=>{let g=q.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:[{type:12,data:g},..._e(a,o)]}},getShaderSource:u}},DM=(t,e)=>{wk(t.inputs,e.perm),t.compute(ar(t.inputs[0],e.perm))},MM=t=>qe({perm:t.perm})}),Ek,Sk,Ik,kk,$k,Ck,Ak,Rk,Pk,Nk,Pr,LM,zM,VM,FM,BM,UM,jM,WM,HM,qM,Oee=se(()=>{ve(),Ee(),Se(),Xx(),Fa(),Ek={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},Sk={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Ik={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},kk={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},$k=(t,e)=>{let n=[];for(let r=e-t;r<e;++r)n.push(r);return n},Ck=(t,e)=>{let n=[],r=t.length;for(let s=0;s<r;s++)e.indexOf(s)===-1&&n.push(t[s]);let i=e.map(s=>t[s]);return[n,i]},Ak=(t,e)=>{let n=t.length+e.length,r=[],i=0;for(let s=0;s<n;s++)e.indexOf(s)===-1?r.push(t[i++]):r.push(1);return r},Rk=(t,e)=>{for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0},Pk=(t,e)=>{let n=[];if(!Rk(t,e)){for(let r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);t.forEach(r=>n.push(r))}return n},Nk=(t,e,n,r,i,s,a)=>{let o=n[0].dims,l=q.size(s),u=q.size(a),c=X("_A",n[0].dataType,o),d=me("output",i,s),h=64;l===1&&(h=256);let m=`
          var<workgroup> aBestValues : array<f32, ${h}>;
       `,g=w=>`
        ${w.registerUniform("reduceSize","u32").declareVariables(c,d)}
        ${m}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${w.mainStart(h)}

          let outputIndex = global_idx / ${h};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Ik[r]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${h}) {
           let candidate = f32(${c.getByOffset("offset + k")});
           bestValue = ${Ek[r]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${h}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${Sk[r]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${d.setByOffset("outputIndex",`${r==="mean"?`${d.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${d.type.storage}(${kk[r]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${e};${h}`,inputDependencies:["type"]},getShaderSource:g,getRunData:()=>({outputs:[{dims:s,dataType:i}],dispatchGroup:{x:l},programUniforms:[{type:12,data:u}]})}},Pr=(t,e,n,r)=>{let i=t.inputs.length===1?n:sv(t.inputs,n),s=i.axes;s.length===0&&!i.noopWithEmptyAxes&&(s=t.inputs[0].dims.map((m,g)=>g));let a=q.normalizeAxes(s,t.inputs[0].dims.length),o=a,l=t.inputs[0],u=Pk(o,t.inputs[0].dims.length);u.length>0&&(l=t.compute(ar(t.inputs[0],u),{inputs:[0],outputs:[-1]})[0],o=$k(o.length,l.dims.length));let[c,d]=Ck(l.dims,o),h=c;i.keepDims&&(h=Ak(c,a)),t.compute(Nk(e,i.cacheKey,[l],r,t.inputs[0].dataType,h,d),{inputs:[l]})},LM=(t,e)=>{Pr(t,"ReduceMeanShared",e,"mean")},zM=(t,e)=>{Pr(t,"ReduceL1Shared",e,"l1")},VM=(t,e)=>{Pr(t,"ReduceL2Shared",e,"l2")},FM=(t,e)=>{Pr(t,"ReduceLogSumExpShared",e,"logSumExp")},BM=(t,e)=>{Pr(t,"ReduceMaxShared",e,"max")},UM=(t,e)=>{Pr(t,"ReduceMinShared",e,"min")},jM=(t,e)=>{Pr(t,"ReduceProdShared",e,"prod")},WM=(t,e)=>{Pr(t,"ReduceSumShared",e,"sum")},HM=(t,e)=>{Pr(t,"ReduceSumSquareShared",e,"sumSquare")},qM=(t,e)=>{Pr(t,"ReduceLogSumShared",e,"logSum")}}),Nr,Ok,Km,sv,Or,Dk,Mk,Lk,zk,Vk,Fk,Bk,Uk,jk,Wk,Dr,GM,KM,YM,QM,XM,JM,ZM,e4,t4,n4,Xx=se(()=>{ve(),Ee(),It(),Se(),Oee(),Nr=t=>{if(!t||t.length===0||t.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(t.length===2&&t[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Ok=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],Km=(t,e,n,r,i,s,a=!1,o=!1)=>{let l=[],u=n[0].dims,c=u.length,d=q.normalizeAxes(i,c),h=!o&&d.length===0;u.forEach((w,x)=>{h||d.indexOf(x)>=0?a&&l.push(1):l.push(w)});let m=l.length,g=q.size(l);return{name:t,shaderCache:e,getShaderSource:w=>{let x=[],v=X("_A",n[0].dataType,c),y=me("output",s,m),E=r(v,y,d),$=E[2];for(let R=0,D=0;R<c;R++)h||d.indexOf(R)>=0?(a&&D++,$=`for(var j${R}: u32 = 0; j${R} < ${u[R]}; j${R}++) {
                  ${E[2].includes("last_index")?`let last_index = j${R};`:""}
                  ${v.indicesSet("input_indices",R,`j${R}`)}
                  ${$}
                }`):(x.push(`${v.indicesSet("input_indices",R,y.indicesGet("output_indices",D))};`),D++);return`

        ${w.registerUniform("output_size","u32").declareVariables(v,y)}

        ${w.mainStart()}
          ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${v.type.indices};
          let output_indices = ${y.offsetToIndices("global_idx")};

          ${x.join(`
`)}
          ${E[0]}       // init ops for reduce max/min
          ${E[1]}
          ${$}
          ${E[3]}
          ${E.length===4?y.setByOffset("global_idx","value"):E.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:[{type:12,data:g},..._e(u,l)]})}},sv=(t,e)=>{let n=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(r=>n.push(Number(r))),qe({axes:n,keepDims:e.keepDims,noopWithEmptyAxes:e.noopWithEmptyAxes})},Or=(t,e,n,r)=>{let i=t.inputs,s=i.length===1?n:sv(i,n);t.compute(Km(e,{hint:s.cacheKey,inputDependencies:["rank"]},[i[0]],s.noopWithEmptyAxes&&s.axes.length===0?Ok:r,s.axes,i[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},Dk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceLogSum",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,"value = log(value);"])},Mk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceL1",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += abs(${n.getByIndices("input_indices")});`,""])},Lk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceL2",e,(n,r)=>[`var t = ${r.type.value}(0); var value = ${r.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},zk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceLogSumExp",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += exp(${n.getByIndices("input_indices")});`,"value = log(value);"])},Vk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceMax",e,(n,r,i)=>{let s=[];for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&s.push(n.indicesSet("input_indices",a,0));return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = max(value, ${n.getByIndices("input_indices")});`,""]})},Fk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceMean",e,(n,r,i)=>{let s=1;for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&(s*=t.inputs[0].dims[a]);return["var sum = f32(0);","",`sum += f32(${n.getByIndices("input_indices")});`,`let value = ${r.type.value}(sum / ${s});`]})},Bk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceMin",e,(n,r,i)=>{let s=[];for(let a=0;a<n.rank;a++)(i.indexOf(a)>=0||i.length===0)&&s.push(`input_indices[${a}] = 0;`);return[`${s.join(`
`)}`,`var value = ${n.getByIndices("input_indices")};`,`value = min(value, ${n.getByIndices("input_indices")});`,""]})},Uk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceProd",e,(n,r)=>[`var value = ${r.type.storage}(1);`,"",`value *= ${n.getByIndices("input_indices")};`,""])},jk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceSum",e,(n,r)=>[`var value = ${r.type.storage}(0);`,"",`value += ${n.getByIndices("input_indices")};`,""])},Wk=(t,e)=>{Nr(t.inputs),Or(t,"ReduceSumSquare",e,(n,r)=>[`var t = ${r.type.value}(0); var value = ${r.type.value}(0);`,"",`t = ${n.getByIndices("input_indices")}; value += t * t;`,""])},Dr=(t,e,n)=>{if(e.length===0)return n;let r=1,i=1;for(let s=0;s<e.length;s++)e.indexOf(s)===-1?r*=t[s]:i*=t[s];return i<32&&r>1024},GM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Fk(t,e):LM(t,e)},KM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Mk(t,e):zM(t,e)},YM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Lk(t,e):VM(t,e)},QM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?zk(t,e):FM(t,e)},XM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Vk(t,e):BM(t,e)},JM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Bk(t,e):UM(t,e)},ZM=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Uk(t,e):jM(t,e)},e4=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?jk(t,e):WM(t,e)},t4=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Wk(t,e):HM(t,e)},n4=(t,e)=>{Dr(t.inputs[0].dims,e.axes,e.noopWithEmptyAxes)?Dk(t,e):qM(t,e)}}),D_,r4,i4,av,Dee=se(()=>{ve(),It(),Xx(),D_=t=>{if(!t||t.length===0||t.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(t[0].dataType!==1)throw new Error("Invalid input type.")},r4=(t,e)=>{D_(t.inputs);let n=(r,i,s)=>{let a=[];for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${r.getByIndices("input_indices")} ${e.selectLastIndex>0?"<=":"<"} value) {
         value = ${r.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};t.compute(Km("ArgMin",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],n,[e.axis],7,e.keepDims),{inputs:[0]})},i4=(t,e)=>{D_(t.inputs);let n=(r,i,s)=>{let a=[];for(let o=0;o<r.rank;o++)(s.indexOf(o)>=0||s.length===0)&&a.push(`input_indices[${o}] = 0;`);return[`${a.join(`
`)}`,`var value = ${r.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${r.getByIndices("input_indices")} ${e.selectLastIndex>0?">=":">"} value) {
         value = ${r.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};t.compute(Km("argMax",{hint:e.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],n,[e.axis],7,e.keepDims),{inputs:[0]})},av=t=>qe(t)}),Hk,ap,qk,Gk,Kk,hh,Yk,s4,Jx=se(()=>{ve(),Ee(),Yx(),Se(),Hk=(t,e)=>{let n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5];if(a&&o)throw new Error("Attention cannot have both past and attention_bias");if(n.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let l=n.dims[0],u=n.dims[1],c=n.dims[2];if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(r.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(r.dims[0]!==c)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==r.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let d=i.dims[0]/3,h=d,m=h;if(e.qkvHiddenSizes.length>0){if(e.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let E of e.qkvHiddenSizes)if(E%e.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");d=e.qkvHiddenSizes[0],h=e.qkvHiddenSizes[1],m=e.qkvHiddenSizes[2]}let g=u;if(d!==h)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==d+h+m)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let w=0;if(a){if(h!==m)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(a.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(a.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(a.dims[1]!==l)throw new Error('Input "past" second dimension must be batch_size');if(a.dims[2]!==e.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(a.dims[4]!==h/e.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');e.pastPresentShareBuffer||(w=a.dims[3])}let x=g+w,v=-1,y=0;if(s)throw new Error("Mask not supported");if(a)throw new Error("past is not supported");if(o){if(o.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(o.dims[0]!==l||o.dims[1]!==e.numHeads||o.dims[2]!==u||o.dims[3]!==x)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:l,sequenceLength:u,pastSequenceLength:w,kvSequenceLength:g,totalSequenceLength:x,maxSequenceLength:v,inputHiddenSize:c,hiddenSize:d,vHiddenSize:m,headSize:Math.floor(d/e.numHeads),vHeadSize:Math.floor(m/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:y,scale:e.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},ap=(t,e,n)=>e&&t?`
      let total_sequence_length_input = u32(${e.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t==null?void 0:t.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${n?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,qk=(t,e,n,r,i,s,a,o)=>{let l=yt(a?1:s),u=64,c=s/l;c<u&&(u=32);let d=Math.ceil(s/l/u),h=[{type:12,data:e},{type:12,data:n},{type:12,data:r},{type:12,data:i},{type:12,data:c},{type:12,data:d}],m=Yt(t.dataType,l),g=gn(1,l),w=["type"];a&&w.push("type"),o&&w.push("type");let x=v=>{let y=me("x",t.dataType,t.dims,l),E=[y],$=a?X("seq_lens",a.dataType,a.dims):void 0;$&&E.push($);let R=o?X("total_sequence_length_input",o.dataType,o.dims):void 0;R&&E.push(R);let D=gn(t.dataType),k=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${u}>;
  var<workgroup> thread_sum: array<f32, ${u}>;
  ${v.registerUniforms(k).declareVariables(...E)}
  ${v.mainStart([u,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${ap($,R,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${u}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${a?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${g}(-3.4028234663852886e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${g}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(l){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.4028234663852886e+38f);
    for (var i = 0u; i < ${u}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${g}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${g}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(l){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${l}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${u}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${y.type.value}(${D}(1.0) / ${D}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${g}(x[offset + i]);
        x[offset + i] = ${y.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${a?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${y.type.value}(${D}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${u};${m};${l}`,inputDependencies:w},getShaderSource:x,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:i,z:e*n},programUniforms:h})}},Gk=(t,e,n,r,i,s,a,o,l)=>{let u=a+s.kvSequenceLength,c=[s.batchSize,s.numHeads,s.sequenceLength,u],d=t>1&&r,h=s.kvNumHeads?s.kvNumHeads:s.numHeads,m=d?[s.batchSize,h,u,s.headSize]:void 0,g=s.nReps?s.nReps:1,w=s.scale===0?1/Math.sqrt(s.headSize):s.scale,x=yt(s.headSize),v=s.headSize/x,y=12,E={x:Math.ceil(u/y),y:Math.ceil(s.sequenceLength/y),z:s.batchSize*s.numHeads},$=[{type:12,data:s.sequenceLength},{type:12,data:v},{type:12,data:u},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:1,data:w},{type:12,data:a},{type:12,data:s.kvSequenceLength},{type:12,data:g}],R=d&&r&&q.size(r.dims)>0,D=["type","type"];R&&D.push("type"),i&&D.push("type"),o&&D.push("type"),l&&D.push("type");let k=[{dims:c,dataType:e.dataType,gpuDataType:0}];d&&k.push({dims:m,dataType:e.dataType,gpuDataType:0});let _=A=>{let N=X("q",e.dataType,e.dims,x),L=X("key",n.dataType,n.dims,x),V=[N,L];if(R){let Y=X("past_key",r.dataType,r.dims,x);V.push(Y)}i&&V.push(X("attention_bias",i.dataType,i.dims));let M=o?X("seq_lens",o.dataType,o.dims):void 0;M&&V.push(M);let B=l?X("total_sequence_length_input",l.dataType,l.dims):void 0;B&&V.push(B);let Z=me("output",e.dataType,c),ie=[Z];d&&ie.push(me("present_key",e.dataType,m,x));let de=gn(1,x),ee=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;

  var<workgroup> tileQ: array<${N.type.storage}, ${y*y}>;
  var<workgroup> tileK: array<${N.type.storage}, ${y*y}>;
  ${A.registerUniforms(ee).declareVariables(...V,...ie)}
  ${A.mainStart([y,y,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${g===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${g===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${ap(M,B,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${R&&d?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${d?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${de}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${R&&d?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${d?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${de}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(x){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${x}`)}})()};
        output[outputIdx] = ${Z.type.value} (sum * uniforms.alpha) + ${i?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${x};${i!==void 0};${r!==void 0};${t}`,inputDependencies:D},getRunData:()=>({outputs:k,dispatchGroup:E,programUniforms:$}),getShaderSource:_}},Kk=(t,e,n,r,i,s,a=void 0,o=void 0)=>{let l=s+i.kvSequenceLength,u=i.nReps?i.nReps:1,c=i.vHiddenSize*u,d=t>1&&r,h=i.kvNumHeads?i.kvNumHeads:i.numHeads,m=d?[i.batchSize,h,l,i.headSize]:void 0,g=[i.batchSize,i.sequenceLength,c],w=12,x={x:Math.ceil(i.vHeadSize/w),y:Math.ceil(i.sequenceLength/w),z:i.batchSize*i.numHeads},v=[{type:12,data:i.sequenceLength},{type:12,data:l},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:c},{type:12,data:s},{type:12,data:i.kvSequenceLength},{type:12,data:u}],y=d&&r&&q.size(r.dims)>0,E=["type","type"];y&&E.push("type"),a&&E.push("type"),o&&E.push("type");let $=[{dims:g,dataType:e.dataType,gpuDataType:0}];d&&$.push({dims:m,dataType:e.dataType,gpuDataType:0});let R=D=>{let k=X("probs",e.dataType,e.dims),_=X("v",n.dataType,n.dims),A=[k,_];y&&A.push(X("past_value",r.dataType,r.dims));let N=a?X("seq_lens",a.dataType,a.dims):void 0;a&&A.push(N);let L=o?X("total_sequence_length_input",o.dataType,o.dims):void 0;o&&A.push(L);let V=[me("output",e.dataType,g)];d&&V.push(me("present_value",e.dataType,m));let M=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${w}u;
  var<workgroup> tileQ: array<${k.type.value}, ${w*w}>;
  var<workgroup> tileV: array<${k.type.value}, ${w*w}>;
  ${D.registerUniforms(M).declareVariables(...A,...V)}
  ${D.mainStart([w,w,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${u===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${u===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${ap(N,L,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${y&&d?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${d?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${k.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${y&&d?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${d?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${r!==void 0};${t}`,inputDependencies:E},getRunData:()=>({outputs:$,dispatchGroup:x,programUniforms:v}),getShaderSource:R}},hh=(t,e,n,r,i,s,a,o,l,u,c=void 0,d=void 0)=>{let h=Math.min(t.outputCount,1+(a?1:0)+(o?1:0)),m=h>1?u.pastSequenceLength:0,g=m+u.kvSequenceLength,w=l&&q.size(l.dims)>0?l:void 0,x=[e,n];h>1&&a&&q.size(a.dims)>0&&x.push(a),w&&x.push(w),c&&x.push(c),d&&x.push(d);let v=t.compute(Gk(h,e,n,a,w,u,m,c,d),{inputs:x,outputs:h>1?[-1,1]:[-1]})[0];t.compute(qk(v,u.batchSize,u.numHeads,m,u.sequenceLength,g,c,d),{inputs:c&&d?[v,c,d]:[v],outputs:[]});let y=[v,r];h>1&&o&&q.size(o.dims)>0&&y.push(o),c&&y.push(c),d&&y.push(d),t.compute(Kk(h,v,r,o,u,m,c,d),{inputs:y,outputs:h>1?[0,2]:[0]})},Yk=(t,e)=>{let n=[e.batchSize,e.numHeads,e.sequenceLength,e.headSize],r=e.sequenceLength,i=e.inputHiddenSize,s=e.headSize,a=12,o={x:Math.ceil(e.headSize/a),y:Math.ceil(e.sequenceLength/a),z:e.batchSize*e.numHeads},l=[t.inputs[0],t.inputs[1],t.inputs[2]],u=[{type:12,data:r},{type:12,data:i},{type:12,data:s},{type:12,data:e.numHeads},{type:12,data:e.headSize},{type:12,data:e.hiddenSize},{type:12,data:e.hiddenSize+e.hiddenSize+e.vHiddenSize}],c=d=>{let h=me("output_q",l[0].dataType,n),m=me("output_k",l[0].dataType,n),g=me("output_v",l[0].dataType,n),w=X("input",l[0].dataType,l[0].dims),x=X("weight",l[1].dataType,l[1].dims),v=X("bias",l[2].dataType,l[2].dims),y=w.type.storage,E=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${a}u;
  var<workgroup> tileInput: array<${y}, ${a*a}>;
  var<workgroup> tileWeightQ: array<${y}, ${a*a}>;
  var<workgroup> tileWeightK: array<${y}, ${a*a}>;
  var<workgroup> tileWeightV: array<${y}, ${a*a}>;
  ${d.registerUniforms(E).declareVariables(w,x,v,h,m,g)}
  ${d.mainStart([a,a,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${y}(0);
    var valueK = ${y}(0);
    var valueV = ${y}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:n,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:o,programUniforms:u}),getShaderSource:c},{inputs:l,outputs:[-1,-1,-1]})},s4=(t,e)=>{let n=Hk(t.inputs,e),[r,i,s]=Yk(t,n);return hh(t,r,i,s,t.inputs[4],void 0,void 0,void 0,t.inputs[5],n)}}),Qk,Xk,Jk,a4,Mee=se(()=>{Sr(),ve(),Ee(),It(),Se(),Qk=(t,e)=>{if(!t||t.length!==5)throw new Error("BatchNormalization requires 5 inputs");let n=(r,i,s)=>{let a=i.length;if(a!==r.length)throw new Error(`${s}: num dimensions != ${a}`);i.forEach((o,l)=>{if(o!==r[l])throw new Error(`${s}: dim[${l}] do not match`)})};if(t[0].dims.length>1){let r=e.format==="NHWC"?e.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,e.spatial?2:void 0);n(t[1].dims,r,"Invalid input scale"),n(t[2].dims,r,"Invalid input B"),n(t[3].dims,r,"Invalid input mean"),n(t[4].dims,r,"Invalid input var")}else n(t[1].dims,[1],"Invalid input scale"),n(t[2].dims,[1],"Invalid input B"),n(t[3].dims,[1],"Invalid input mean"),n(t[4].dims,[1],"Invalid input var")},Xk=(t,e)=>{let{epsilon:n,spatial:r,format:i}=e,s=t[0].dims,a=r?yt(s[s.length-1]):1,o=i==="NHWC"&&s.length>1?a:1,l=q.size(s)/a,u=r,c=u?s.length:s,d=X("x",t[0].dataType,t[0].dims,a),h=X("scale",t[1].dataType,t[1].dims,o),m=X("bias",t[2].dataType,t[2].dims,o),g=X("inputMean",t[3].dataType,t[3].dims,o),w=X("inputVar",t[4].dataType,t[4].dims,o),x=me("y",t[0].dataType,c,a),v=()=>{let E="";if(r)E=`let cOffset = ${s.length===1?"0u":i==="NHWC"?`outputIndices[${s.length-1}] / ${a}`:"outputIndices[1]"};`;else if(i==="NCHW")E=`
            ${x.indicesSet("outputIndices","0","0")}
            let cOffset = ${x.indicesToOffset("outputIndices")};`;else{E=`var cIndices = ${h.type.indices}(0);
                       cIndices[0] = outputIndices[${s.length-1}];`;for(let $=1;$<h.rank;$++)E+=`cIndices[${$}] = outputIndices[${$}];`;E+=`let cOffset = ${h.indicesToOffset("cIndices")};`}return E},y=E=>`
  const epsilon = ${n};
  ${E.registerUniform("outputSize","u32").declareVariables(d,h,m,g,w,x)}
  ${E.mainStart()}
  ${E.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${x.offsetToIndices(`global_idx * ${a}`)};
    ${v()}
    let scale = ${h.getByOffset("cOffset")};
    let bias = ${m.getByOffset("cOffset")};
    let inputMean = ${g.getByOffset("cOffset")};
    let inputVar = ${w.getByOffset("cOffset")};
    let x = ${d.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${x.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${e.epsilon}_${e.format}_${r}_${a}`,inputDependencies:u?["rank","type","type","type","type"]:void 0},getShaderSource:y,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u?[{type:12,data:l},..._e(s)]:[{type:12,data:l}]})}},Jk=t=>qe(t),a4=(t,e)=>{let{inputs:n,outputCount:r}=t,i=Jk({...e,outputCount:r});if(et.webgpu.validateInputContent&&Qk(n,i),e.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");t.compute(Xk(n,i))}}),Zk,e$,o4,Lee=se(()=>{Ee(),Se(),Zk=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},e$=t=>{let e=t[0].dims,n=t[0].dims[2],r=q.size(e)/4,i=t[0].dataType,s=X("input",i,e,4),a=X("bias",i,[n],4),o=X("residual",i,e,4),l=me("output",i,e,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(r/64)}}),getShaderSource:u=>`
  const channels = ${n}u / 4;
  ${u.declareVariables(s,a,o,l)}

  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes(r)}
    let value = ${s.getByOffset("global_idx")}
      + ${a.getByOffset("global_idx % channels")} + ${o.getByOffset("global_idx")};
    ${l.setByOffset("global_idx","value")}
  }`}},o4=t=>{Zk(t.inputs),t.compute(e$(t.inputs))}}),t$,je,l4,u4,c4,d4,h4,f4,p4,m4,g4,n$,y4,_4,w4,v4,td,b4,Bp,x4,T4,E4,S4,I4,k4,$4,C4,A4,R4,P4,N4,O4,D4,M4,L4,M_,z4,ov,lv,V4,F4,B4,r$,i$,U4,Zx=se(()=>{ve(),Ee(),It(),Se(),t$=(t,e,n,r,i,s,a)=>{let o=Math.ceil(e/4),l="";typeof i=="string"?l=`${i}(a)`:l=i("a");let u=X("inputData",n,[o],4),c=me("outputData",r,[o],4),d=[{name:"vec_size",type:"u32"}];return a&&d.push(...a),`
      ${t.registerUniforms(d).declareVariables(u,c)}

  ${s??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${u.getByOffset("global_idx")};
    ${c.setByOffset("global_idx",l)}
  }`},je=(t,e,n,r,i,s=t.dataType,a,o)=>{let l=[{type:12,data:Math.ceil(q.size(t.dims)/4)}];return a&&l.push(...a),{name:e,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:u=>t$(u,q.size(t.dims),t.dataType,s,n,r,o),getRunData:u=>({outputs:[{dims:t.dims,dataType:s}],dispatchGroup:{x:Math.ceil(q.size(u[0].dims)/64/4)},programUniforms:l})}},l4=t=>{t.compute(je(t.inputs[0],"Abs","abs"))},u4=t=>{t.compute(je(t.inputs[0],"Acos","acos"))},c4=t=>{t.compute(je(t.inputs[0],"Acosh","acosh"))},d4=t=>{t.compute(je(t.inputs[0],"Asin","asin"))},h4=t=>{t.compute(je(t.inputs[0],"Asinh","asinh"))},f4=t=>{t.compute(je(t.inputs[0],"Atan","atan"))},p4=t=>{t.compute(je(t.inputs[0],"Atanh","atanh"))},m4=t=>qe(t),g4=(t,e)=>{let n;switch(e.to){case 10:n="vec4<f16>";break;case 1:n="vec4<f32>";break;case 12:n="vec4<u32>";break;case 6:n="vec4<i32>";break;case 9:n="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${e.to}`)}t.compute(je(t.inputs[0],"Cast",n,void 0,e.cacheKey,e.to))},n$=t=>{let e,n,r=t.length>=2&&t[1].data!==0,i=t.length>=3&&t[2].data!==0;switch(t[0].dataType){case 1:e=r?t[1].getFloat32Array()[0]:-34028234663852886e22,n=i?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:e=r?t[1].getUint16Array()[0]:64511,n=i?t[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return qe({min:e,max:n})},y4=(t,e)=>{let n=e||n$(t.inputs),r=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"Clip",i=>`clamp(${i}, vec4<${r}>(uniforms.min), vec4<${r}>(uniforms.max))`,void 0,n.cacheKey,void 0,[{type:t.inputs[0].dataType,data:n.min},{type:t.inputs[0].dataType,data:n.max}],[{name:"min",type:r},{name:"max",type:r}]),{inputs:[0]})},_4=t=>{t.compute(je(t.inputs[0],"Ceil","ceil"))},w4=t=>{t.compute(je(t.inputs[0],"Cos","cos"))},v4=t=>{t.compute(je(t.inputs[0],"Cosh","cosh"))},td=t=>qe(t),b4=(t,e)=>{let n=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"Elu",r=>`elu_vf32(${r})`,`
  const elu_alpha_ = ${n}(${e.alpha});

  fn elu_f32(a: ${n}) -> ${n} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${n}>) -> vec4<${n}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,e.cacheKey))},Bp=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,x4=t=>{let e=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"Erf",n=>`erf_vf32(${n})`,Bp(e)))},T4=t=>{t.compute(je(t.inputs[0],"Exp","exp"))},E4=t=>{t.compute(je(t.inputs[0],"Floor","floor"))},S4=t=>{let e=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"Gelu",n=>`0.5 * ${n} * (1.0 + erf_vf32(${n} * 0.7071067811865475))`,Bp(e)))},I4=(t,e)=>{let n=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"LeakyRelu",r=>`select(leaky_relu_alpha_ * ${r}, ${r}, ${r} >= vec4<${n}>(0.0))`,`const leaky_relu_alpha_ = ${n}(${e.alpha});`,e.cacheKey))},k4=t=>{t.compute(je(t.inputs[0],"Not",e=>`!${e}`))},$4=t=>{t.compute(je(t.inputs[0],"Neg",e=>`-${e}`))},C4=t=>{t.compute(je(t.inputs[0],"Reciprocal",e=>`1.0/${e}`))},A4=t=>{let e=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"Relu",n=>`select(vec4<${e}>(0.0), ${n}, ${n} > vec4<${e}>(0.0))`))},R4=t=>{t.compute(je(t.inputs[0],"Sigmoid",e=>`(1.0 / (1.0 + exp(-${e})))`))},P4=t=>qe(t),N4=(t,e)=>{let n=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"HardSigmoid",r=>`max(vec4<${n}>(0.0), min(vec4<${n}>(1.0), ${e.alpha} * ${r} + vec4<${n}>(${e.beta})))`,void 0,e.cacheKey))},O4=t=>{t.compute(je(t.inputs[0],"Sin","sin"))},D4=t=>{t.compute(je(t.inputs[0],"Sinh","sinh"))},M4=t=>{t.compute(je(t.inputs[0],"Sqrt","sqrt"))},L4=t=>{t.compute(je(t.inputs[0],"Tan","tan"))},M_=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,z4=t=>{t.compute(je(t.inputs[0],"Tanh",M_))},ov=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${M_("v")};
}
`,lv=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,V4=t=>{let e=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"FastGelu",lv,ov(e),void 0,t.inputs[0].dataType))},F4=(t,e)=>{let n=gn(t.inputs[0].dataType);return t.compute(je(t.inputs[0],"ThresholdedRelu",r=>`select(vec4<${n}>(0.0), ${r}, ${r} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${n}>(${e.alpha});`,e.cacheKey)),0},B4=t=>{t.compute(je(t.inputs[0],"Log","log"))},r$=(t,e)=>`
const alpha = vec4<${t}>(${e});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,i$=t=>`quick_gelu_impl(${t})`,U4=(t,e)=>{let n=gn(t.inputs[0].dataType);t.compute(je(t.inputs[0],"QuickGelu",i$,r$(n,e.alpha),e.cacheKey,t.inputs[0].dataType))}}),s$,a$,j4,zee=se(()=>{Ee(),Se(),Zx(),s$=t=>{if(t[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(t[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw new Error("last dimension of input and bias are not the same")},a$=t=>{let e=t[0].dims.slice();e[2]=e[2]/2;let n=X("input",t[0].dataType,t[0].dims,4),r=X("bias",t[0].dataType,[t[0].dims[2]],4),i=me("output",t[0].dataType,e,4),s=q.size(e)/4,a=Yt(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:e,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:o=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${o.declareVariables(n,r,i)}

  ${Bp(a)}

  ${o.mainStart()}
    ${o.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${i.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},j4=t=>{s$(t.inputs),t.compute(a$(t.inputs))}}),o$,l$,Mr,W4,H4,q4,G4,K4,Y4,Q4,X4,J4,Z4,Vee=se(()=>{ve(),Ee(),Se(),o$=(t,e,n,r,i,s,a,o,l,u,c,d)=>{let h,m;typeof o=="string"?h=m=(y,E)=>`${o}((${y}),(${E}))`:typeof o=="function"?h=m=o:(h=o.scalar,m=o.vector);let g=me("outputData",c,r.length,4),w=X("aData",l,e.length,4),x=X("bData",u,n.length,4),v;if(i)if(s){let y=q.size(e)===1,E=q.size(n)===1,$=e.length>0&&e[e.length-1]%4===0,R=n.length>0&&n[n.length-1]%4===0;y||E?v=g.setByOffset("global_idx",m(y?`${w.type.value}(${w.getByOffset("0")}.x)`:w.getByOffset("global_idx"),E?`${x.type.value}(${x.getByOffset("0")}.x)`:x.getByOffset("global_idx"))):v=`
            let outputIndices = ${g.offsetToIndices("global_idx * 4u")};
            let offsetA = ${w.broadcastedIndicesToOffset("outputIndices",g)};
            let offsetB = ${x.broadcastedIndicesToOffset("outputIndices",g)};
            ${g.setByOffset("global_idx",m(a||$?w.getByOffset("offsetA / 4u"):`${w.type.value}(${w.getByOffset("offsetA / 4u")}[offsetA % 4u])`,a||R?x.getByOffset("offsetB / 4u"):`${x.type.value}(${x.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else v=g.setByOffset("global_idx",m(w.getByOffset("global_idx"),x.getByOffset("global_idx")));else{if(!s)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let y=(E,$,R="")=>{let D=`aData[indexA${$}][componentA${$}]`,k=`bData[indexB${$}][componentB${$}]`;return`
            let outputIndices${$} = ${g.offsetToIndices(`global_idx * 4u + ${$}u`)};
            let offsetA${$} = ${w.broadcastedIndicesToOffset(`outputIndices${$}`,g)};
            let offsetB${$} = ${x.broadcastedIndicesToOffset(`outputIndices${$}`,g)};
            let indexA${$} = offsetA${$} / 4u;
            let indexB${$} = offsetB${$} / 4u;
            let componentA${$} = offsetA${$} % 4u;
            let componentB${$} = offsetB${$} % 4u;
            ${E}[${$}] = ${R}(${h(D,k)});
          `};c===9?v=`
            var data = vec4<u32>(0);
            ${y("data",0,"u32")}
            ${y("data",1,"u32")}
            ${y("data",2,"u32")}
            ${y("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:v=`
            ${y("outputData[global_idx]",0)}
            ${y("outputData[global_idx]",1)}
            ${y("outputData[global_idx]",2)}
            ${y("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(w,x,g)}

        ${d??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${v}
      }`},l$=(t,e,n,r,i,s,a=n.dataType)=>{let o=n.dims.map(Number),l=r.dims.map(Number),u=!q.areEqual(o,l),c=o,d=q.size(o),h=!1,m=!1,g=[u];if(u){let w=Su.calcShape(o,l,!1);if(!w)throw new Error("Can't perform binary op on the given tensors");c=w.slice(),d=q.size(c);let x=q.size(o)===1,v=q.size(l)===1,y=o.length>0&&o[o.length-1]%4===0,E=l.length>0&&l[l.length-1]%4===0;g.push(x),g.push(v),g.push(y),g.push(E);let $=1;for(let R=1;R<c.length;R++){let D=o[o.length-R],k=l[l.length-R];if(D===k)$*=D;else break}$%4===0?(m=!0,h=!0):(x||v||y||E)&&(h=!0)}else h=!0;return g.push(h),{name:t,shaderCache:{hint:e+g.map(w=>w.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:w=>o$(w,o,l,c,h,u,m,i,n.dataType,r.dataType,a,s),getRunData:()=>({outputs:[{dims:c,dataType:a}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:Math.ceil(q.size(c)/4)},..._e(o,l,c)]})}},Mr=(t,e,n,r,i,s)=>{t.compute(l$(e,i??"",t.inputs[0],t.inputs[1],n,r,s))},W4=t=>{Mr(t,"Add",(e,n)=>`${e}+${n}`)},H4=t=>{Mr(t,"Div",(e,n)=>`${e}/${n}`)},q4=t=>{Mr(t,"Equal",{scalar:(e,n)=>`u32(${e}==${n})`,vector:(e,n)=>`vec4<u32>(${e}==${n})`},void 0,void 0,9)},G4=t=>{Mr(t,"Mul",(e,n)=>`${e}*${n}`)},K4=t=>{let e=X("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;Mr(t,"Pow",{scalar:(n,r)=>`pow_custom(${n},${r})`,vector:(n,r)=>`pow_vector_custom(${n},${r})`},`
    fn pow_custom(a : ${e}, b : ${e}) -> ${e} {
      if (b == ${e}(0.0)) {
        return ${e}(1.0);
      } else if (a < ${e}(0.0) && f32(b) != floor(f32(b))) {
        return ${e}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${e}(1.0), round(f32(abs(b) % ${e}(2.0))) != 1.0) * ${e}(${e==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${e}>, b : vec4<${e}>) -> vec4<${e}> {
      // TODO: implement vectorized pow
      return vec4<${e}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Y4=t=>{Mr(t,"Sub",(e,n)=>`${e}-${n}`)},Q4=t=>{Mr(t,"Greater",{scalar:(e,n)=>`u32(${e}>${n})`,vector:(e,n)=>`vec4<u32>(${e}>${n})`},void 0,void 0,9)},X4=t=>{Mr(t,"Less",{scalar:(e,n)=>`u32(${e}<${n})`,vector:(e,n)=>`vec4<u32>(${e}<${n})`},void 0,void 0,9)},J4=t=>{Mr(t,"GreaterOrEqual",{scalar:(e,n)=>`u32(${e}>=${n})`,vector:(e,n)=>`vec4<u32>(${e}>=${n})`},void 0,void 0,9)},Z4=t=>{Mr(t,"LessOrEqual",{scalar:(e,n)=>`u32(${e}<=${n})`,vector:(e,n)=>`vec4<u32>(${e}<=${n})`},void 0,void 0,9)}}),u$,c$,d$,h$,eL,tL,Fee=se(()=>{ve(),Ee(),It(),Se(),u$=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");let n=0,r=t[n],i=r.dataType,s=r.dims.length;t.forEach((a,o)=>{if(o!==n){if(a.dataType!==i)throw new Error("input tensors should be one type");if(a.dims.length!==s)throw new Error("input tensors should have the same shape");a.dims.forEach((l,u)=>{if(u!==e&&l!==r.dims[u])throw new Error("non concat dimensions must match")})}})},c$=(t,e)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${e});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,d$=(t,e)=>{let n=t.length,r=[];for(let i=0;i<n;++i){let s=e.setByOffset("global_idx",t[i].getByIndices("indices"));n===1?r.push(s):i===0?r.push(`if (inputIndex == ${i}u) { ${s} }`):i===n-1?r.push(`else { ${s} }`):r.push(`else if (inputIndex == ${i}) { ${s} }`)}return r.join(`
`)},h$=(t,e,n,r)=>{let i=q.size(n),s=new Array(t.length),a=new Array(t.length),o=0,l=[],u=[],c=[{type:12,data:i}];for(let w=0;w<t.length;++w)o+=t[w].dims[e],s[w]=o,u.push(t[w].dims.length),a[w]=X(`input${w}`,r,u[w]),l.push("rank"),c.push({type:12,data:s[w]});for(let w=0;w<t.length;++w)c.push(..._e(t[w].dims));c.push(..._e(n));let d=me("output",r,n.length),h=d.indicesGet("indices",e),m=Array.from(Array(s.length).keys()).map(w=>`uniforms.sizeInConcatAxis${w}`).join(","),g=w=>`

  ${(()=>{w.registerUniform("outputSize","u32");for(let x=0;x<t.length;x++)w.registerUniform(`sizeInConcatAxis${x}`,"u32");return w.declareVariables(...a,d)})()}

  ${c$(s.length,m)}

  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${d.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${h});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${s.length}u>(${m});
      ${h} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${d$(a,d)}
  }`;return{name:"Concat",shaderCache:{hint:`${e}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:n,dataType:r}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:c}),getShaderSource:g}},eL=(t,e)=>{let n=t.inputs,r=n[0].dims,i=q.normalizeAxis(e.axis,r.length);u$(n,i);let s=r.slice();s[i]=n.reduce((o,l)=>o+(l.dims.length>i?l.dims[i]:0),0);let a=n.filter(o=>q.size(o.dims)>0);t.compute(h$(a,i,s,n[0].dataType),{inputs:a})},tL=t=>qe({axis:t.axis})}),Uo,jo,Wo,e1,nl=se(()=>{ve(),Ee(),Uo=(t,e,n="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${e}(0.0));`;case"Sigmoid":return`value = (${e}(1.0) / (${e}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${e}(${n}(uniforms.clip_min)), ${e}(${n}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${e}(0.0), min(${e}(1.0), ${n}(uniforms.alpha) * value + ${n}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${n}(uniforms.alpha) * value, value, value >= ${e}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${t.activation}`)}},jo=(t,e)=>{t.activation==="Clip"?e.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):t.activation==="HardSigmoid"?e.push({type:1,data:t.alpha},{type:1,data:t.beta}):t.activation==="LeakyRelu"&&e.push({type:1,data:t.alpha})},Wo=(t,e)=>{t.activation==="Clip"?e.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):t.activation==="HardSigmoid"?e.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):t.activation==="LeakyRelu"&&e.push({name:"alpha",type:"f32"})},e1=t=>{let e=(t==null?void 0:t.activation)||"";if(e==="HardSigmoid"){let[n,r]=(t==null?void 0:t.activation_params)||[.2,.5];return{activation:e,alpha:n,beta:r}}else if(e==="Clip"){let[n,r]=(t==null?void 0:t.activation_params)||[kM,$M];return{activation:e,clipMax:r,clipMin:n}}else if(e==="LeakyRelu"){let[n]=(t==null?void 0:t.activation_params)||[.01];return{activation:e,alpha:n}}return{activation:e}}}),Jt,nL,t1=se(()=>{Jt=(t,e)=>{switch(t){case 1:return e;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component is not supported.`)}},nL=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),rL,Bee=se(()=>{rL=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),kd,n1,r1=se(()=>{ve(),Ee(),Se(),nl(),kd=(t,e,n,r,i)=>{let s=r-n;return`
      ${Array.from({length:n}).map((a,o)=>`
      if (${ye(e.shape,o,e.rank)} != 1) {
        ${e.indicesSet(t,o,ye(i,o+s,r))}
      } else {
        ${e.indicesSet(t,o,0)}
      }`).join("")}
`},n1=(t,e,n,r,i=!1,s)=>{let a=t[0].dims,o=t[1].dims,l=a[a.length-2],u=o[o.length-1],c=a[a.length-1],d=yt(u),h=yt(c),m=yt(l),g=q.size(n)/d/m,w=t.length>2,x=r?r.slice(0,-2):n.slice(0,-2),v=[q.size(x),l,u],y=[{type:12,data:g},{type:12,data:l},{type:12,data:u},{type:12,data:c}];jo(e,y),y.push(..._e(x,a,o)),w&&y.push(..._e(t[2].dims)),y.push(..._e(v));let E=$=>{let R=Qx("batch_dims",t[0].dataType,x.length),D=X("a",t[0].dataType,a.length,h),k=X("b",t[1].dataType,o.length,d),_=me("output",t[0].dataType,v.length,d),A=Yt(_.type.tensor),N=Uo(e,_.type.value,A),L=[D,k],V="";if(w){let Z=i?d:1;L.push(X("bias",t[2].dataType,t[2].dims.length,Z)),V=`${i?`value += bias[col / ${Z}];`:`value += ${_.type.value}(bias[row + i]);`}`}let M=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Wo(e,M);let B=()=>{let Z=`var a_data: ${D.type.value};`;for(let ie=0;ie<h;ie++)Z+=`
              let b_data${ie} = b[(b_offset + (k + ${ie}) * uniforms.N + col) / ${d}];`;for(let ie=0;ie<m;ie++){Z+=`a_data = a[(a_offset + (row + ${ie}) * uniforms.K + k) / ${h}];`;for(let de=0;de<h;de++)Z+=`
            values[${ie}] = fma(${k.type.value}(a_data${h===1?"":`[${de}]`}), b_data${de}, values[${ie}]);
`}return Z};return`
  ${$.registerUniforms(M).registerInternalVariables(R).declareVariables(...L,_)}
  ${$.mainStart()}
    ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${d})) * ${d};
    var index1 = global_idx / (uniforms.N / ${d});
    let stride1 = uniforms.M / ${m};
    let row = (index1 % stride1) * ${m};
    let batch = index1 / stride1;

    ${n.length===2?"":`let batch_indices = ${R.offsetToIndices("batch")};`}

    var a_indices: ${D.type.indices};
    ${kd("a_indices",D,D.rank-2,R.rank,"batch_indices")}
    ${D.indicesSet("a_indices",D.rank-2,0)}
    ${D.indicesSet("a_indices",D.rank-1,0)}
    let a_offset = ${D.indicesToOffset("a_indices")};

    var b_indices: ${k.type.indices};
    ${kd("b_indices",k,k.rank-2,R.rank,"batch_indices")}
    ${k.indicesSet("b_indices",k.rank-2,0)}
    ${k.indicesSet("b_indices",k.rank-1,0)}
    let b_offset = ${k.indicesToOffset("b_indices")};
    var values: array<${_.type.value}, ${m}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${h}) {
      ${B()}
    }
    for (var i = 0u; i < ${m}u; i++) {
      var value = values[i];
      ${V}
      ${N}
      let cur_indices = ${_.type.indices}(batch, row + i, col);
      let offset = ${_.indicesToOffset("cur_indices")};
      ${_.setByOffset(`offset / ${d}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${e.activation};${d};${h};${m};${i}`,inputDependencies:w?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(g/64)},programUniforms:y}),getShaderSource:E}}}),f$,p$,uv,L_,m$,cv,g$,Ym,i1=se(()=>{ve(),Ee(),Se(),nl(),r1(),t1(),f$=(t,e)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${e?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${e?", batchIndices":""});
        `,p$=(t,e)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${e===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${e===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,uv=(t,e,n="f32",r,i=!1,s=32,a=!1,o=32)=>{let l=e[1]*t[1],u=e[0]*t[0],c=i?l:s,d=i?s:l,h=c/e[0],m=s/e[1];if(!((i&&h===4&&t[1]===4||!i&&(h===3||h===4))&&c%e[0]===0&&s%e[1]===0&&t[0]===4))throw new Error(`If transposeA ${i} is true, innerElementSize ${h} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${h} must be 3 or 4.
  tileAWidth ${c} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${h}<${n}>, ${c/h}>, ${d}>;
var<workgroup> mm_Bsub: array<array<vec4<${n}>, ${u/t[0]}>, ${s}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${h};
const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${a?"0":"i32(globalId.z)"};
  ${r?`let batchIndices = ${r.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${l};

  let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

  var acc: array<vec4<${n}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${m};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${f$(i,r)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${r?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${h===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${p$(i,h)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},L_=(t,e)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${e?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${e?", batchIndices":""});
            `,m$=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",cv=(t,e,n="f32",r,i=!1,s=32,a=!1,o=32,l=!1)=>{let u=t[1]*e[1],c=t[0]*e[0],d=i?u:s,h=i?s:u;if(!(h%e[1]===0&&d%e[0]===0&&s%e[1]===0))throw new Error(`tileAHight ${h} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${d} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);let m=h/e[1],g=d/e[0],w=s/e[1],x=l?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${u};
    let globalColStart = i32(workgroupId.x) * ${c};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${h}; inputRow = inputRow + ${e[1]}) {
        for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${e[0]}) {
          ${L_(i,r)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {
            for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${e[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${r?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${n}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${e[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${e[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${u};

let tileRowA = i32(localId.y) * ${m};
let tileColA = i32(localId.x) * ${g};
let tileRowB = i32(localId.y) * ${w};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${m}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${g}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${L_(i,r)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${w}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${r?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${n}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${m$(i)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${n}, ${d}>, ${h}>;
  var<workgroup> mm_Bsub : array<array<${n}, ${c}>, ${s}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${s};

@compute @workgroup_size(${e[0]}, ${e[1]}, ${e[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${a?"0":"i32(globalId.z)"};
    ${r?`let batchIndices = ${r.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${a?`${Math.ceil(o/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${a?`i32(globalId.z) * ${o}`:"0"};

    var acc : array<array<${n}, colPerThread>, rowPerThread>;
    ${x}
  }
`},g$=(t,e,n,r,i=!1)=>{let[s,a,o,l]=r,u=Yt(r[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${Jt(t,u)} {
      var value = ${Jt(t,u)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${a.type.indices};
        ${kd("aIndices",a,a.rank-2,s.rank,"batchIndices")}
        ${a.indicesSet("aIndices",a.rank-2,"u32(row)")}
        ${a.indicesSet("aIndices",a.rank-1,"u32(colIn)")}
        value = ${a.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${Jt(t,u)} {
      var value = ${Jt(t,u)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${o.type.indices};
        ${kd("bIndices",o,o.rank-2,s.rank,"batchIndices")}
        ${o.indicesSet("bIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("bIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Jt(t,u)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${e?`value = value + ${i?"bias[colIn]":`${Jt(t,u)}(bias[row])`};`:""}
        ${n}
        ${l.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},Ym=(t,e,n,r,i=!1,s)=>{let a=t[0].dims,o=t[1].dims,l=a.slice(0,-2),u=o.slice(0,-2),c=r?r.slice(0,-2):n.slice(0,-2),d=q.size(c),h=a[a.length-2],m=a[a.length-1],g=o[o.length-1],w=m%4===0&&g%4===0,x=h<=8?[4,1,1]:[4,4,1],v=[8,8,1],y=[Math.ceil(g/v[0]/x[0]),Math.ceil(h/v[1]/x[1]),Math.ceil(d/v[2]/x[2])],E=w?4:1,$=[...l,h,m/E],R=$.length,D=[...u,m,g/E],k=D.length,_=[d,h,g/E],A=[{type:6,data:h},{type:6,data:g},{type:6,data:m}];jo(e,A),A.push(..._e(c,$,D));let N=["rank","rank"],L=t.length>2;L&&(A.push(..._e(t[2].dims)),N.push("rank")),A.push(..._e(_));let V=M=>{let B=c.length,Z=Qx("batchDims",t[0].dataType,B,1),ie=Yt(t[0].dataType),de=X("a",t[0].dataType,R,E),ee=X("b",t[1].dataType,k,E),Y=me("result",t[0].dataType,_.length,E),J=[de,ee];if(L){let Ne=i?E:1;J.push(X("bias",t[2].dataType,t[2].dims.length,Ne))}let G=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Wo(e,G);let H=Yt(Y.type.tensor),oe=Uo(e,Y.type.value,H),ue=g$(E,L,oe,[Z,de,ee,Y],i);return`
  ${M.registerUniforms(G).registerInternalVariables(Z).declareVariables(...J,Y)}
  ${ue}
  ${w?uv(x,v,ie,Z):cv(x,v,ie,Z)}
                   `};return{name:"MatMul",shaderCache:{hint:`${x};${e.activation};${w};${i}`,inputDependencies:N},getRunData:()=>({outputs:[{dims:s?s(n):n,dataType:t[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:A}),getShaderSource:V}}}),y$,iL,Uee=se(()=>{ve(),xs(),Se(),nl(),t1(),Bee(),i1(),y$=(t,e,n,r,i=!1,s,a=4,o=4,l=4,u="f32")=>{let c=A=>{switch(A){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${u}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${A} is not supported.`)}},d=A=>{switch(A){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${A} is not supported.`)}},h=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,m=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,g=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",w=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",x=t?"row":"col",v=t?"col":"row",y=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${x} / outWidth;
    let outCol = ${x} % outWidth;

    let WRow = ${v} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${v} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${v} % inChannels;
    var resData = ${Jt(a,u)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${g} && xCol >= 0 && xCol < ${w}) {
      ${h}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${c(a)}
    }
    return resData;`,E=t?e&&r?`
    let col = colIn * ${a};
    ${y}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${y}
    }
    return ${Jt(a,u)}(0.0);`:r&&n?`
    let col = colIn * ${a};
    ${y}`:`
    let col = colIn * ${a};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${y}
    }
    return ${Jt(a,u)}(0.0);`,$=t?r&&n?d(o):`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${d(o)}
    }
    return ${Jt(o,u)}(0.0);`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${d(o)}
    }
    return ${Jt(o,u)}(0.0);`,R=Jt(l,u),D=Jt(t?a:o,u),k=Jt(t?o:a,u),_=Uo(s,R,u);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${D} {
      ${t?E:$}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${k} {
      ${t?$:E}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${R}) {
      let col = colIn * ${l};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${m}
      ${nL(i)}
      ${_}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},iL=(t,e,n,r,i,s,a,o,l)=>{let u=e.format==="NHWC",c=u?t[0].dims[3]:t[0].dims[1],d=n[0],h=u?n[2]:n[3],m=u?n[1]:n[2],g=u?n[3]:n[1],w=u&&(c%4===0||c%3===0)&&g%4===0,x=u?g:h*m,v=u?h*m:g,y=[8,8,1],E=r<=8?[4,1,1]:[4,4,1],$=[Math.ceil(x/y[0]/E[0]),Math.ceil(v/y[1]/E[1]),Math.ceil(d/y[2]/E[2])];De("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${$}`);let R=w?u&&c%4!==0?3:4:1,D=y[1]*E[1],k=y[0]*E[0],_=Math.max(y[0]*R,y[1]),A=r%D===0,N=i%k===0,L=s%_===0,V=w?[R,4,4]:[1,1,1],M=[{type:6,data:r},{type:6,data:i},{type:6,data:s},{type:6,data:[e.pads[0],e.pads[1]]},{type:6,data:e.strides},{type:6,data:e.dilations}];jo(e,M),M.push(..._e(t[0].dims,t[1].dims));let B=["rank","rank"];a&&(M.push(..._e(t[2].dims)),B.push("rank")),M.push(..._e(n));let Z=ie=>{let de=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Wo(e,de);let ee=w?4:1,Y=Yt(t[0].dataType),J=`
      fn setOutputAtIndex(flatIndex : i32, value : ${w?`vec4<${Y}>`:Y}) {
        result[flatIndex] = ${w?`vec4<${Y}>`:Y}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${w?`vec4<${Y}>`:Y}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${w?"/ 4":""}, value);
      }`,G=X("x",t[0].dataType,t[0].dims.length,R===3?1:R),H=X("w",t[1].dataType,t[1].dims.length,ee),oe=[G,H],ue=me("result",t[0].dataType,n.length,ee);if(a){let Ne=X("bias",t[2].dataType,t[2].dims.length,ee);oe.push(Ne),J+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${w?`vec4<${Y}>`:Y} {
          return bias[coords.${u?"w":"y"}${w?"/ 4":""}];
        }`}return`
        ${rL("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${ie.registerUniforms(de).declareVariables(...oe,ue)}
        ${J}
        ${y$(u,A,N,L,a,e,V[0],V[1],V[2],Y)}
        ${w?uv(E,y,Y,void 0,!u,_):cv(E,y,Y,void 0,!u,_,!1,void 0,o)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${e.cacheKey};${R};${w};${A};${N};${L};${D};${k};${_}`,inputDependencies:B},getRunData:()=>({outputs:[{dims:l?l(n):n,dataType:t[0].dataType}],dispatchGroup:{x:$[0],y:$[1],z:$[2]},programUniforms:M}),getShaderSource:Z}}}),_$,z_,Dc,w$,V_,v$,sL,aL,jee=se(()=>{ve(),xs(),Ee(),Se(),nl(),t1(),_$=t=>{let e=1;for(let n=0;n<t.length;n++)e*=t[n];return e},z_=t=>typeof t=="number"?[t,t,t]:t,Dc=(t,e)=>e<=1?t:t+(t-1)*(e-1),w$=(t,e,n,r=1)=>{let i=Dc(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)},V_=(t,e,n,r,i)=>{i==null&&(i=w$(t,e[0],r[0]));let s=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*i>=e[a]&&(s[a]=Math.trunc((t[a]-e[a]+2*i)/r[a]+1));return s},v$=(t,e,n,r,i,s,a,o,l,u)=>{let c,d,h,m;if(t==="VALID"&&(t=0),typeof t=="number"){c={top:t,bottom:t,left:t,right:t,front:t,back:t};let g=V_([e,n,r,1],[o,l,u],1,[i,s,a],t);d=g[0],h=g[1],m=g[2]}else if(Array.isArray(t)){if(!t.every((w,x,v)=>w===v[0]))throw Error(`Unsupported padding parameter: ${t}`);c={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let g=V_([e,n,r,1],[o,l,u],1,[i,s,a],t[0]);d=g[0],h=g[1],m=g[2]}else if(t==="SAME_UPPER"){d=Math.ceil(e/i),h=Math.ceil(n/s),m=Math.ceil(r/a);let g=(d-1)*i+o-e,w=(h-1)*s+l-n,x=(m-1)*a+u-r,v=Math.floor(g/2),y=g-v,E=Math.floor(w/2),$=w-E,R=Math.floor(x/2),D=x-R;c={top:E,bottom:$,left:R,right:D,front:v,back:y}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outDepth:d,outHeight:h,outWidth:m}},sL=(t,e,n,r,i,s=!1,a="channelsLast")=>{let o,l,u,c,d;if(a==="channelsLast")[o,l,u,c,d]=t;else if(a==="channelsFirst")[o,d,l,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);let[h,,m,g,w]=e,[x,v,y]=z_(n),[E,$,R]=z_(r),D=Dc(m,E),k=Dc(g,$),_=Dc(w,R),{padInfo:A,outDepth:N,outHeight:L,outWidth:V}=v$(i,l,u,c,x,v,y,D,k,_),M=s?h*d:h,B=[0,0,0,0,0];return a==="channelsFirst"?B=[o,M,N,L,V]:a==="channelsLast"&&(B=[o,N,L,V,M]),{batchSize:o,dataFormat:a,inDepth:l,inHeight:u,inWidth:c,inChannels:d,outDepth:N,outHeight:L,outWidth:V,outChannels:M,padInfo:A,strideDepth:x,strideHeight:v,strideWidth:y,filterDepth:m,filterHeight:g,filterWidth:w,effectiveFilterDepth:D,effectiveFilterHeight:k,effectiveFilterWidth:_,dilationDepth:E,dilationHeight:$,dilationWidth:R,inShape:t,outShape:B,filterShape:e}},aL=(t,e,n,r,i,s)=>{let a=s==="channelsLast";a?t[0].dims[3]:t[0].dims[1];let o=[64,1,1],l={x:n.map((x,v)=>v)},u=[Math.ceil(_$(l.x.map(x=>n[x]))/o[0]),1,1];De("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${u}`);let c=1,d=q.size(n),h=[{type:12,data:d},{type:12,data:r},{type:12,data:i},{type:12,data:e.strides},{type:12,data:e.dilations}];jo(e,h),h.push(..._e(t[0].dims,t[1].dims));let m=["rank","rank"],g=t.length===3;g&&(h.push(..._e(t[2].dims)),m.push("rank")),h.push(..._e(n));let w=x=>{let v=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:r.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:e.strides.length},{name:"dilations",type:"u32",length:e.dilations.length}];Wo(e,v);let y=1,E=Yt(t[0].dataType),$=X("x",t[0].dataType,t[0].dims.length,c),R=X("W",t[1].dataType,t[1].dims.length,y),D=[$,R],k=me("result",t[0].dataType,n.length,y),_="";if(g){let L=X("bias",t[2].dataType,t[2].dims.length,y);D.push(L),_+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${E} {
          return bias[${a?ye("coords",4,5):ye("coords",1,5)}];
        }`}let A=Jt(c,E),N=Uo(e,A,E);return`
            ${_}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${$.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${R.getByIndices("aIndices")};
            }
          ${x.registerUniforms(v).declareVariables(...D,k)}
          ${x.mainStart()}
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${k.offsetToIndices("global_idx")};
              let batch = ${ye("coords",0,$.rank)};
              let d2 = ${a?ye("coords",$.rank-1,$.rank):ye("coords",1,$.rank)};
              let xFRCCorner = vec3<u32>(${a?ye("coords",1,$.rank):ye("coords",2,$.rank)},
              ${a?ye("coords",2,$.rank):ye("coords",3,$.rank)},
              ${a?ye("coords",3,$.rank):ye("coords",4,$.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${a?ye("uniforms.x_shape",1,$.rank):ye("uniforms.x_shape",2,$.rank)};
              let xShapeZ = ${a?ye("uniforms.x_shape",2,$.rank):ye("uniforms.x_shape",3,$.rank)};
              let xShapeW = ${a?ye("uniforms.x_shape",3,$.rank):ye("uniforms.x_shape",4,$.rank)};
              let xShapeU = ${a?ye("uniforms.x_shape",4,$.rank):ye("uniforms.x_shape",1,$.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${a?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${a?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${a?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${a?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${g?"value = value + getBiasByOutputCoords(coords)":""};
              ${N}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${e.cacheKey};${a};${c};${g}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:u[0],y:u[1],z:u[2]},programUniforms:h}),getShaderSource:w}}}),oL,lL,Wee=se(()=>{ve(),Ee(),Se(),nl(),oL=(t,e,n,r)=>{let i=t.length>2,s=i?"value += b[output_channel];":"",a=t[0].dims,o=t[1].dims,l=e.format==="NHWC",u=l?n[3]:n[1],c=u/e.group,d=l&&c>=4?yt(u):1,h=q.size(n)/d,m=[{type:12,data:h},{type:12,data:e.dilations},{type:12,data:[e.strides[0],e.strides[1]]},{type:12,data:[e.pads[0],e.pads[1]]},{type:12,data:c}];jo(e,m),m.push(..._e(a,[o[0],o[1],o[2],o[3]/d]));let g=i?["rank","rank","rank"]:["rank","rank"];m.push(..._e([n[0],n[1],n[2],n[3]/d]));let w=x=>{let v=me("output",t[0].dataType,n.length,d),y=Yt(v.type.tensor),E=Uo(e,v.type.value,y),$=X("x",t[0].dataType,a.length),R=X("w",t[1].dataType,o.length,d),D=[$,R];i&&D.push(X("b",t[2].dataType,t[2].dims,d));let k=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:e.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Wo(e,k);let _=l?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${$.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${R.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${$.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${R.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${x.registerUniforms(k).declareVariables(...D,v)}

  ${x.mainStart()}
    ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${v.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${l?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${l?1:2}], outputIndices[${l?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${d} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${l?2:1}];

    var value: ${v.type.value} = ${v.type.value}(0);
    ${_}
    ${s}
    ${E}
    ${v.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${e.cacheKey}_${d}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:r?r(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:m}),getShaderSource:w}},lL=(t,e,n,r)=>{let i=t.length>2,s=yt(n[3]),a=yt(n[2]),o=q.size(n)/s/a,l=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/s],u=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/s],c=[n[0],n[1],n[2],n[3]/s],d=[{type:12,data:o},{type:6,data:[e.strides[0],e.strides[1]]},{type:6,data:[e.pads[0],e.pads[1]]}];jo(e,d),d.push(..._e(l,u,c));let h=(a-1)*e.strides[1]+u[1],m=g=>{let w=me("output",t[0].dataType,c.length,s),x=Yt(w.type.tensor),v=Uo(e,w.type.value,x),y=X("x",t[0].dataType,l.length,s),E=X("w",t[1].dataType,u.length,s),$=[y,E];i&&$.push(X("b",t[2].dataType,t[2].dims,s));let R=i?"value += b[output_channel];":"",D=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Wo(e,D),`
  ${g.registerUniforms(D).declareVariables(...$,w)}
  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${a}u;
    let col = (index1 % width1) * ${a}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${y.type.value}, ${h}>;
    var values: array<${w.type.value}, ${a}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${u[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${h}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${y.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${y.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${u[1]}; w_width++) {
          let w_val = ${E.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${a}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${a}u; i++) {
      var value = values[i];
      ${R}
      ${v}
      ${w.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${e.cacheKey};${s};${a};${h};${u[0]};${u[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:r?r(n):n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:d}),getShaderSource:m}}}),b$,op,x$,lp,dv,F_,T$,E$,hv,Hee=se(()=>{Ee(),Uee(),jee(),i1(),Wee(),nl(),r1(),Fa(),b$=(t,e,n,r,i,s)=>{let a=t[0],o=t.slice(s?1:2,s?3:4),l=o.length,u=e[0],c=e.slice(2).map((h,m)=>h+(h-1)*(n[m]-1)),d=o.map((h,m)=>h+r[m]+r[m+l]).map((h,m)=>Math.floor((h-c[m]+i[m])/i[m]));return d.splice(0,0,a),d.splice(s?3:1,0,u),d},op=[2,3,1,0],x$=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw new Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let n=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],r=t[1].dims[1]*e.group;if(n!==r)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(t.length===3&&(t[2].dims.length!==1||t[1].dims[0]!==t[2].dims[0]))throw new Error("invalid bias");let i=t[0].dims.length-2;if(e.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(e.strides.length!==i)throw new Error(`strides should be ${i}D`);if(e.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape")},lp=(t,e)=>{let n=t.kernelShape.slice();n.length<e[1].dims.length-2&&n.push(...Array(e[1].dims.length-2-n.length).fill(0));for(let s=2;s<e[1].dims.length;++s)n[s-2]===0&&(n[s-2]=e[1].dims[s]);let r=t.pads.slice();Gm.adjustPadsBasedOnAutoPad(e[0].dims,t.strides,t.dilations,n,r,t.format==="NHWC",t.autoPad);let i=Object.assign({},t);return Object.assign(i,{kernelShape:n,pads:r}),i},dv=t=>{let e=e1(t),n=t.format,r=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],i=t.dilations,s=t.group,a=t.kernel_shape,o=t.pads,l=t.strides,u=t.w_is_const();return{autoPad:r,format:n,dilations:i,group:s,kernelShape:a,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${t.format};${e.activation};`}},F_=(t,e,n,r)=>{let i=n.format==="NHWC",s=b$(e[0].dims,e[1].dims,n.dilations,n.pads,n.strides,i);if(n.group!==1){let D=[e[0]];if(i){let k=t.kernelCustomData.wT??t.compute(ar(e[1],op),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=k),D.push(k)}else D.push(e[1]);e.length===3&&D.push(e[2]),!t.adapterInfo.isArchitecture("ampere")&&i&&e[1].dims[0]===n.group&&e[1].dims[1]===1&&n.dilations[0]===1&&n.dilations[1]===1?t.compute(lL(D,n,s,r),{inputs:D}):t.compute(oL(D,n,s,r),{inputs:D});return}let a=e.length===3,o=e[0].dims[i?1:2],l=e[0].dims[i?2:3],u=e[0].dims[i?3:1],c=e[1].dims[2],d=e[1].dims[3],h=s[i?1:2],m=s[i?2:3],g=s[i?3:1],w=i&&c===o&&d===l&&n.pads[0]===0&&n.pads[1]===0;if(w||c===1&&d===1&&n.dilations[0]===1&&n.dilations[1]===1&&n.strides[0]===1&&n.strides[1]===1&&n.pads[0]===0&&n.pads[1]===0){let D=s[0],k,_,A,N=[];if(i){let M=t.kernelCustomData.wT??t.compute(ar(e[1],op),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];if(n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=M),w){let B=o*l*u;k=e[0].reshape([1,D,B]),_=M.reshape([1,B,g]),A=[1,D,g]}else k=e[0].reshape([D,o*l,u]),_=M.reshape([1,u,g]),A=[D,h*m,g];N.push(k),N.push(_)}else k=e[0].reshape([D,u,o*l]),_=e[1].reshape([1,g,u]),A=[D,g,h*m],N.push(_),N.push(k);a&&N.push(e[2]);let L=A[2],V=N[0].dims[N[0].dims.length-1];L<8&&V<8?t.compute(n1(N,n,s,A,i,r),{inputs:N}):t.compute(Ym(N,n,s,A,i,r),{inputs:N});return}let x=!0,v=t.kernelCustomData.wT??t.compute(ar(e[1],op),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=v);let y=[e[0],v];a&&y.push(e[2]);let E=i?h*m:g,$=i?g:h*m,R=c*d*u;t.compute(iL(y,n,s,E,$,R,a,x,r),{inputs:y})},T$=(t,e)=>{let n=e.format==="NHWC",r=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&r.push(t.inputs[2]);let i=[0,e.pads[0],0,e.pads[1]],s=[1].concat(e.strides),a=[1].concat(e.dilations),o=[1].concat(e.kernelShape),l=lp({...e,pads:i,strides:s,dilations:a,kernelShape:o},r);F_(t,r,l,u=>n?[u[0],u[2],u[3]]:[u[0],u[1],u[3]])},E$=(t,e,n)=>{let r=n.format==="NHWC"?"channelsLast":"channelsFirst",i=lp(n,e),s=n.autoPad==="NOTSET"?n.pads:n.autoPad,a=sL(e[0].dims,e[1].dims,n.strides,n.dilations,s,!1,r);t.compute(aL(e,i,a.outShape,[a.filterDepth,a.filterHeight,a.filterWidth],[a.padInfo.front,a.padInfo.top,a.padInfo.left],r))},hv=(t,e)=>{if(x$(t.inputs,e),t.inputs[0].dims.length===3)T$(t,e);else if(t.inputs[0].dims.length===5)E$(t,t.inputs,e);else{let n=lp(e,t.inputs);F_(t,t.inputs,n)}}}),uL,qee=se(()=>{ve(),xs(),Ee(),Se(),uL=(t,e,n)=>{let r=t.length>2,i=e.outputShape,s=e.format==="NHWC",a=e.group,o=t[1].dims,l=o[2]/a,u=o[3],c=s?yt(l):1,d=s&&u===1&&l>=4,h=d?Math.floor(l/4)*4:Math.floor(l/c)*c,m=l-h,g=s?yt(u):1,w=s?u===1?c:g:1,x=q.size(i)/g,v=[Math.ceil(x/64),1,1];De("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${v}`);let y=["rank","rank"],E=[e.strides[0],e.strides[1]],$=[e.kernelShape[s?1:2],e.kernelShape[s?2:3]],R=[e.dilations[0],e.dilations[1]],D=[$[0]+(e.dilations[0]<=1?0:(e.kernelShape[s?1:2]-1)*(e.dilations[0]-1)),$[1]+(e.dilations[1]<=1?0:(e.kernelShape[s?2:3]-1)*(e.dilations[1]-1))],k=[D[0]-1-Math.floor((e.pads[0]+e.pads[2])/2),D[1]-1-Math.floor((e.pads[1]+e.pads[3])/2)],_=[{type:12,data:x},{type:12,data:E},{type:12,data:$},{type:12,data:R},{type:12,data:D},{type:6,data:k},{type:12,data:h},{type:12,data:l},{type:12,data:u},..._e(t[0].dims,t[1].dims)];r&&(_.push(..._e(t[2].dims)),y.push("rank")),_.push(..._e(i));let A=N=>{let L=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:E.length},{name:"filter_dims",type:"u32",length:$.length},{name:"dilations",type:"u32",length:$.length},{name:"effective_filter_dims",type:"u32",length:D.length},{name:"pads",type:"i32",length:k.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],V=Yt(t[0].dataType),M=s?1:2,B=s?2:3,Z=s?3:1,ie=X("W",t[1].dataType,t[1].dims.length,w),de=X("Dy",t[0].dataType,t[0].dims.length,c),ee=[de,ie];r&&ee.push(X("bias",t[2].dataType,[i[Z]].length,g));let Y=me("result",t[0].dataType,i.length,g),J=()=>{let oe="";if(d)c===4?oe+=`
        let xValue = ${de.getByOffset("x_offset")};
        let wValue = ${ie.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:c===2?oe+=`
          dotProd = dotProd + dot(vec4<${V}>(${de.getByOffset("x_offset")}, ${de.getByOffset("x_offset + 1u")}), vec4<${V}>(${ie.getByOffset("w_offset")}, ${ie.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:c===1&&(oe+=`
          dotProd = dotProd + dot(vec4<${V}>(${de.getByOffset("x_offset")}, ${de.getByOffset("x_offset + 1u")}, ${de.getByOffset("x_offset + 2u")}, ${de.getByOffset("x_offset + 3u")}), vec4<${V}>(${ie.getByOffset("w_offset")}, ${ie.getByOffset("w_offset + 1u")}, ${ie.getByOffset("w_offset + 2u")}, ${ie.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(oe+=`
                  let xValue = ${s?de.getByOffset(`${de.indicesToOffset(`${de.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c}`):de.get("batch","inputChannel","idyR","idyC")};
        `,c===1)oe+=`
          let w_offset = ${ie.indicesToOffset(`${ie.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${ie.getByOffset(`w_offset / ${w}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let ue=0;ue<c;ue++)oe+=`
            let wValue${ue} = ${ie.getByOffset(`${ie.indicesToOffset(`${ie.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${ue}, wOutChannel)`)} / ${w}`)};
            dotProd = dotProd + xValue[${ue}] * wValue${ue};`;return oe},G=()=>{if(m===0)return"";if(!d)throw new Error(`packInputAs4 ${d} is not true.`);let oe="";if(c===1){oe+="dotProd = dotProd";for(let ue=0;ue<m;ue++)oe+=`
            + ${de.getByOffset(`x_offset + ${ue}`)} * ${ie.getByOffset(`w_offset + ${ue}`)}`;oe+=";"}else if(c===2){if(m!==2)throw new Error(`Invalid inputChannelsRemainder ${m}.`);oe+=`
          let xValue = ${de.getByOffset("x_offset")};
          let wValue = ${ie.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return oe},H=`
            let outputIndices = ${Y.offsetToIndices(`global_idx * ${g}`)};
            let batch = ${Y.indicesGet("outputIndices",0)};
            let d1 = ${Y.indicesGet("outputIndices",Z)};
            let r = ${Y.indicesGet("outputIndices",M)};
            let c = ${Y.indicesGet("outputIndices",B)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${Y.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${V}(dyRCorner) + ${V}(wR)) / ${V}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${V}(uniforms.Dy_shape[${M}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${V}(dyCCorner) + ${V}(wC)) / ${V}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${V}(uniforms.Dy_shape[${B}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${d?`
                var x_offset = ${de.indicesToOffset(`${de.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${c};
                var w_offset = ${ie.indicesToOffset(`${ie.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${w};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${d?4:c}) {
                  ${J()}
                  inputChannel = inputChannel + ${d?4:c};
                }
                ${G()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${r?` + bias[d1 / ${g}]`:""};
            ${Y.setByOffset("global_idx","value")};
          `;return`
    ${N.registerUniforms(L).declareVariables(...ee,Y)}
      ${N.mainStart()}
      ${N.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${H}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${e.cacheKey};${c}${w}${g}${d}${m}`,inputDependencies:y},getRunData:()=>({dispatchGroup:{x:v[0],y:v[1],z:v[2]},outputs:[{dims:n?n(i):i,dataType:t[0].dataType}],programUniforms:_}),getShaderSource:A}}}),S$,I$,k$,B_,cL,$$,U_,C$,dL,Gee=se(()=>{qee(),nl(),Fa(),S$=(t,e,n,r,i,s)=>(t-1)*e+n+(r-1)*i+1-s,I$=(t,e,n,r,i)=>{let s=Math.floor(t/2);e==="SAME_UPPER"?(n[r]=s,n[i]=t-s):e==="SAME_LOWER"&&(n[r]=t-s,n[i]=s)},k$=(t,e,n,r,i,s,a,o,l,u)=>{let c=t.length-2,d=u.length===0;l.length<c&&l.push(...Array(c-l.length).fill(0));let h=t[0],m=e[o?3:1]*i;for(let g=0,w=t.length-c-(o?1:0);g<c;++g,++w){let x=t[w],v=d?x*a[g]:u[g],y=S$(x,a[g],s[g],e[w],n[g],v);I$(y,r,s,g,g+c),d&&u.push(a[g]*(x-1)+l[g]+(e[w]-1)*n[g]+1-s[g]-s[g+c])}u.splice(0,0,h),u.splice(o?3:1,0,m)},B_=(t,e)=>{let n=t.kernelShape.slice();if(t.kernelShape.length===0||t.kernelShape.reduce((d,h)=>d*h,1)===0){n.length=0;for(let d=2;d<e[1].dims.length;++d)n.push(e[1].dims[d])}let r=t.format==="NHWC";n.splice(0,0,e[1].dims[0]),n.splice(r?3:1,0,e[1].dims[1]);let i=t.pads.slice(),s=t.outputShape.slice(),a=t.outputPadding.slice(),o=e[0].dims,l=t.dilations.slice();if(l.reduce((d,h)=>d+h,0)===0){let d=e[0].dims.length-2;l=new Array(d).fill(1)}let u=t.strides.slice();if(u.reduce((d,h)=>d+h,0)===0){let d=e[0].dims.length-2;u=new Array(d).fill(1)}k$(o,n,l,t.autoPad,t.group,i,u,r,a,s);let c=Object.assign({},t);return Object.assign(c,{kernelShape:n,pads:i,outputPadding:a,outputShape:s,dilations:l,strides:u}),c},cL=t=>{let e=e1(t),n=t.format,r=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],i=t.dilations,s=t.group,a=t.kernelShape,o=t.pads,l=t.strides,u=t.wIsConst(),c=t.outputPadding,d=t.outputShape;return{autoPad:r,format:n,dilations:i,group:s,kernelShape:a,outputPadding:c,outputShape:d,pads:o,strides:l,wIsConst:u,...e,cacheKey:`${t.format};${e.activation};`}},$$=(t,e)=>{if(!t||t.length!==2&&t.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(t[0].dims.length!==4&&t[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw new Error("filter does not have same dimension as input");let n=t[0].dims[e.format==="NHWC"?t[0].dims.length-1:1],r=t[1].dims[0];if(n!==r)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=t[1].dims[1]*e.group;if(t.length===3&&(t[2].dims.length!==1||t[2].dims[0]!==i))throw new Error("invalid bias");let s=t[0].dims.length-2;if(e.dilations.reduce((a,o)=>a+o,0)>0&&e.dilations.length!==s)throw new Error(`dilations should be ${s}D`);if(e.strides.reduce((a,o)=>a+o,0)>0&&e.strides.length!==s)throw new Error(`strides should be ${s}D`);if(e.pads.reduce((a,o)=>a+o,0)>0&&e.pads.length!==s*2)throw new Error(`pads should be ${s*2}D`);if(e.outputPadding.length!==s&&e.outputPadding.length!==0)throw new Error(`output_padding should be ${s}D`);if(e.kernelShape.reduce((a,o)=>a+o,0)>0&&e.kernelShape.length!==0&&e.kernelShape.length!==t[1].dims.length-2)throw new Error("invalid kernel shape");if(e.outputShape.length!==0&&e.outputShape.length!==t[0].dims.length-2)throw new Error("invalid output shape")},U_=(t,e,n,r)=>{let i=t.kernelCustomData.wT??t.compute(ar(e[1],[2,3,0,1]),{inputs:[1],outputs:[n.wIsConst?-2:-1]})[0];n.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=i);let s=[e[0],i];e.length===3&&s.push(e[2]),t.compute(uL(s,n,r),{inputs:s})},C$=(t,e)=>{let n=e.format==="NHWC",r=[t.inputs[0].reshape(n?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];t.inputs.length===3&&r.push(t.inputs[2]);let i=e.kernelShape;(i.length===0||i[0]===0)&&(i=[t.inputs[1].dims[2]]);let s=e.dilations;(s.length===0||s[0]===0)&&(s=[1]);let a=e.strides;(a.length===0||a[0]===0)&&(a=[1]);let o=e.pads;o.length===0&&(o=[0,0]),o=[0,o[0],0,o[1]],a=[1].concat(a),s=[1].concat(s),i=[1].concat(i);let l=e.outputPadding;l=[0].concat(l);let u=B_({...e,pads:o,strides:a,dilations:s,kernelShape:i,outputPadding:l},r);U_(t,r,u,c=>n?[c[0],c[2],c[3]]:[c[0],c[1],c[3]])},dL=(t,e)=>{if($$(t.inputs,e),t.inputs[0].dims.length===3)C$(t,e);else{let n=B_(e,t.inputs);U_(t,t.inputs,n)}}}),A$,hL,fL,Kee=se(()=>{ve(),Ee(),It(),Se(),A$=(t,e,n,r)=>{let i=q.size(e),s=e.length,a=X("input",t,s),o=me("output",t,s),l=n.dataType===6?n.getInt32Array()[0]:Number(n.getBigInt64Array()[0]),u=q.normalizeAxis(l,s),c=d=>{let h=` i32(${a.indicesGet("inputIndices","uniforms.axis")}) `,m=ye("uniforms.input_shape","uniforms.axis",s),g=r.reverse?h+(r.exclusive?" + 1":""):"0",w=r.reverse?m:h+(r.exclusive?"":" + 1");return`
                ${d.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(a,o)}
                ${d.mainStart()}
                  ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${o.offsetToIndices("global_idx")};
                  var sum = ${o.type.value}(0);
                  let first : i32 = ${g};
                  let last : i32 = ${w};
                  for (var i : i32 = first; i < last; i++) {
                    ${a.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${a.getByIndices("inputIndices")};
                  }
                  ${o.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:r.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:e,dataType:t}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:u},..._e(e,e)]}),getShaderSource:c}},hL=(t,e)=>{let n=t.inputs[0].dims,r=t.inputs[0].dataType,i=t.inputs[1];t.compute(A$(r,n,i,e),{inputs:[0]})},fL=t=>{let e=t.exclusive===1,n=t.reverse===1;return qe({exclusive:e,reverse:n})}}),R$,P$,N$,pL,mL,Yee=se(()=>{ve(),Ee(),It(),Se(),R$=t=>{if(!t||t.length!==1)throw new Error("DepthToSpace requires 1 input.");if(t[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},P$=(t,e,n,r)=>{let i=[];i.push(`fn perm(i: ${r.type.indices}) -> ${n.type.indices} {
    var a: ${n.type.indices};`);for(let s=0;s<e;++s)i.push(n.indicesSet("a",t[s],`i[${s}]`));return i.push("return a;}"),i.join(`
`)},N$=(t,e)=>{let n,r,i,s,a,o,l=e.format==="NHWC",u=e.blocksize,c=e.mode==="DCR";l?([n,r,i,s]=t.dims,a=c?[n,r,i,u,u,s/u**2]:[n,r,i,s/u**2,u,u],o=c?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([n,r,i,s]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],a=c?[n,u,u,s/u**2,r,i]:[n,s/u**2,u,u,r,i],o=c?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let d=t.reshape(a),h=d.dims.length,m=t.dataType,g=X("a",m,h),w=me("output",m,h),x=v=>`
  ${v.registerUniform("output_size","u32").declareVariables(g,w)}

  ${P$(o,h,g,w)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${w.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${w.setByOffset("global_idx",g.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${e.blocksize};${e.mode}`,inputDependencies:["rank"]},getRunData:v=>{let y=l?[n,r*u,i*u,s/u**2]:[n,s/u**2,r*u,i*u],E=q.size(y),$=d.dims,R=q.sortBasedOnPerm($,o);return{outputs:[{dims:y,dataType:v[0].dataType}],dispatchGroup:{x:Math.ceil(E/64)},programUniforms:[{type:12,data:E},..._e($,R)]}},getShaderSource:x}},pL=(t,e)=>{R$(t.inputs),t.compute(N$(t.inputs[0],e))},mL=t=>qe({blocksize:t.blocksize,mode:t.mode,format:t.format})}),up,Mc,j_,O$,D$,M$,L$,W_,z$,gL,yL,Qee=se(()=>{ve(),Ee(),It(),Se(),up="[a-zA-Z]|\\.\\.\\.",Mc="("+up+")+",j_="^"+Mc+"$",O$="("+Mc+",)*"+Mc,D$="^"+O$+"$",M$=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,e){let n=this.symbolToIndices.get(t);n===void 0?n=[e]:n.push(e),this.symbolToIndices.set(t,n)}},L$=class{constructor(t,e){var i;this.equation=e,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[n,r]=e.includes("->")?e.split("->",2):[e,""];if(!n.match(RegExp(D$)))throw new Error("Invalid LHS term");if(n.split(",").forEach((s,a)=>{let o=t[a].dims.slice();if(!s.match(RegExp(j_)))throw new Error("Invalid LHS term");let l=this.processTerm(s,!0,o,a);this.lhs.push(l)}),r==="")r+=[...this.symbolToInfo.entries()].filter(([s,a])=>a.count===1||s==="...").map(([s])=>s).join("");else if(!r.match(RegExp(Mc)))throw new Error("Invalid RHS");(i=r.match(RegExp(up,"g")))==null||i.forEach(s=>{if(s==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let a=this.symbolToInfo.get(s);if(a===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(a.dimValue)}}),this.rhs=this.processTerm(r,!1,this.outputDims)}addSymbol(t,e,n){let r=this.symbolToInfo.get(t);if(r!==void 0){if(r.dimValue!==e&&r.count!==1)throw new Error("Dimension mismatch");r.count++,r.inputIndices.push(n)}else r={count:1,dimValue:e,inputIndices:[n]};this.symbolToInfo.set(t,r)}processTerm(t,e,n,r=-1){let i=n.length,s=!1,a=[],o=0;if(!t.match(RegExp(j_))&&!e&&t!=="")throw new Error("Invalid LHS term");let l=t.match(RegExp(up,"g")),u=new M$(r);return l==null||l.forEach((c,d)=>{if(c==="..."){if(s)throw new Error("Only one ellipsis is allowed per input term");s=!0;let h=i-l.length+1;if(h<0)throw new Error("Ellipsis out of bounds");if(a=n.slice(o,o+h),this.hasEllipsis){if(this.ellipsisDims.length!==a.length||this.ellipsisDims.toString()!==a.toString())throw new Error("Ellipsis dimensions mismatch")}else if(e)this.hasEllipsis=!0,this.ellipsisDims=a;else throw new Error("Ellipsis must be specified in the LHS");for(let m=0;m<a.length;m++){let g=String.fromCharCode(48+m);u.addSymbol(g,d+m),this.addSymbol(g,n[o++],r)}}else u.addSymbol(c,d+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(c,n[o++],r)}),u}},W_=t=>t+"_max",z$=(t,e,n,r)=>{let i=t.map(u=>u.length).map((u,c)=>X(`input${c}`,e,u)),s=q.size(r),a=me("output",e,r.length),o=[...n.symbolToInfo.keys()].filter(u=>!n.rhs.symbolToIndices.has(u)),l=u=>{let c=[],d="var prod = 1.0;",h="var sum = 0.0;",m="sum += prod;",g=[],w=[],x=[],v=[],y=n.symbolToInfo.size===n.rhs.symbolToIndices.size;n.symbolToInfo.forEach(($,R)=>{var D;if(n.rhs.symbolToIndices.has(R)){let k=(D=n.rhs.symbolToIndices.get(R))==null?void 0:D[0];k!==void 0&&n.lhs.forEach((_,A)=>{if($.inputIndices.includes(A)){let N=_.symbolToIndices.get(R);if(N===void 0)throw new Error("Invalid symbol error");N.forEach(L=>{c.push(`${i[A].indicesSet(`input${A}Indices`,L,a.indicesGet("outputIndices",k))}`)})}})}else n.lhs.forEach((k,_)=>{if($.inputIndices.includes(_)){let A=k.symbolToIndices.get(R);if(A===void 0)throw new Error("Invalid symbol error");A.forEach(N=>{g.push(`${i[_].indicesSet(`input${_}Indices`,N,`${R}`)}`)}),v.push(`prod *= ${i[_].getByIndices(`input${_}Indices`)};`)}}),w.push(`for(var ${R}: u32 = 0; ${R} < uniforms.${W_(R)}; ${R}++) {`),x.push("}")});let E=y?[...c,`let sum = ${i.map(($,R)=>$.getByIndices(`input${R}Indices`)).join(" * ")};`]:[...c,h,...w,...g,d,...v,m,...x];return`
            ${u.registerUniforms(o.map($=>({name:`${W_($)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,a)}

            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${a.offsetToIndices("global_idx")};
            ${i.map(($,R)=>`var input${R}Indices: ${i[R].type.indices};`).join(`
`)}
            ${E.join(`
`)};
            ${a.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:n.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let u=o.filter(d=>n.symbolToInfo.has(d)).map(d=>{var h;return{type:12,data:((h=n.symbolToInfo.get(d))==null?void 0:h.dimValue)||0}});u.push({type:12,data:s});let c=t.map((d,h)=>[..._e(d)]).reduce((d,h)=>d.concat(h),u);return c.push(..._e(r)),{outputs:[{dims:r,dataType:e}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:c}},getShaderSource:l}},gL=(t,e)=>{let n=new L$(t.inputs,e.equation),r=n.outputDims,i=t.inputs.map((s,a)=>s.dims);t.compute(z$(i,t.inputs[0].dataType,n,r))},yL=t=>{let e=t.equation.replace(/\s+/g,"");return qe({equation:e})}}),V$,H_,F$,B$,_L,Xee=se(()=>{ve(),Ee(),Se(),V$=t=>{if(!t||t.length!==2)throw new Error("Expand requires 2 input.");let e=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),r=n.length<e.length?0:n.length-e.length,i=e.length<n.length?0:e.length-n.length;for(;r<n.length&&i<e.length;++r,++i)if(n[r]!==e[i]&&n[r]!==1&&e[i]!==1)throw new Error("Expand requires shape to be broadcastable to input")},H_=(t,e)=>{let n=t.length-e.length,r=[];for(let i=0;i<n;++i)r.push(t[i]);for(let i=0;i<e.length;++i)r.push(e[i]===1?t[i+n]:e[i]);return r},F$=(t,e)=>t.length>e.length?H_(t,e):H_(e,t),B$=t=>{let e=t[0].dims,n=Array.from(t[1].getBigInt64Array(),Number),r=F$(e,n),i=t[0].dataType,s=i===9||q.size(e)===1,a=i===9||e.length>0&&e[e.length-1]%4===0?4:1,o=s||r.length>0&&r[r.length-1]%4===0?4:1,l=Math.ceil(q.size(r)/o),u=d=>{let h=X("input",i,e.length,a),m=me("output",i,r.length,o),g;if(i===9){let w=(x,v,y="")=>`
          let outputIndices${v} = ${m.offsetToIndices(`outputOffset + ${v}u`)};
          let offset${v} = ${h.broadcastedIndicesToOffset(`outputIndices${v}`,m)};
          let index${v} = offset${v} / 4u;
          let component${v} = offset${v} % 4u;
          ${x}[${v}] = ${y}(${h.getByOffset(`index${v}`)}[component${v}]);
        `;g=`
        let outputOffset = global_idx * ${o};
        var data = vec4<u32>(0);
        ${w("data",0,"u32")}
        ${w("data",1,"u32")}
        ${w("data",2,"u32")}
        ${w("data",3,"u32")}
        ${m.setByOffset("global_idx","data")}
      }`}else g=`
        let outputIndices = ${m.offsetToIndices(`global_idx * ${o}`)};
        let inputOffset = ${h.broadcastedIndicesToOffset("outputIndices",m)};
        let data = ${m.type.value}(${h.getByOffset(`inputOffset / ${a}`)});
        ${m.setByOffset("global_idx","data")}
      }`;return`
    ${d.registerUniform("vec_size","u32").declareVariables(h,m)}
    ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${g}`},c=[{type:12,data:l},..._e(e,r)];return{name:"Expand",shaderCache:{hint:`${r.length};${a}${o}`,inputDependencies:["rank"]},getShaderSource:u,getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:c})}},_L=t=>{V$(t.inputs),t.compute(B$(t.inputs),{inputs:[0]})}}),U$,wL,Jee=se(()=>{ve(),Ee(),Se(),Zx(),U$=t=>{let e=t[0].dataType,n=q.size(t[0].dims),r=q.size(t[1].dims),i=r%4===0,s=a=>{let o=X("x",e,[1],4),l=X("bias",e,[1],4),u=me("y",e,[1],4),c=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],d=m=>`
      let bias${m}_offset: u32 = (global_idx * 4 + ${m}) % uniforms.bias_size;
      let bias${m} = ${l.getByOffset(`bias${m}_offset / 4`)}[bias${m}_offset % 4];`,h=i?`
      let bias = ${l.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${d(0)}${d(1)}${d(2)}${d(3)}
      let bias = ${o.type.value}(bias0, bias1, bias2, bias3);`;return`${a.registerUniforms(c).declareVariables(o,l,u)}

    ${ov(gn(e))}

    ${a.mainStart(Iu)}
      ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${o.getByOffset("global_idx")};
      ${h}
      let x_in = x + bias;
      ${u.setByOffset("global_idx",lv("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${i}`,inputDependencies:["type","type"]},getShaderSource:s,getRunData:a=>({outputs:[{dims:a[0].dims,dataType:a[0].dataType}],programUniforms:[{type:12,data:Math.ceil(n/4)},{type:12,data:r}],dispatchGroup:{x:Math.ceil(n/Iu/4)}})}},wL=t=>{t.inputs.length<2||q.size(t.inputs[1].dims)===0?V4(t):t.compute(U$(t.inputs))}}),j$,W$,vL,bL,Zee=se(()=>{ve(),Ee(),It(),Se(),j$=t=>{if(!t||t.length!==2)throw new Error("Gather requires 2 inputs.")},W$=(t,e)=>{let n=t[0].dims,r=t[1].dims,i=n.length,s=q.normalizeAxis(e.axis,i),a=n.slice(0);a.splice(s,1,...r);let o=n[s],l=t[0].dataType===9?4:1,u=Math.ceil(q.size(a)/l),c=[{type:12,data:u},{type:6,data:o},{type:12,data:s},..._e(t[0].dims,t[1].dims,a)],d=h=>{let m=X("data",t[0].dataType,t[0].dims.length,l),g=X("inputIndices",t[1].dataType,t[1].dims.length),w=me("output",t[0].dataType,a.length,l),x=y=>{let E=r.length,$=`var indicesIndices${y}  = ${g.type.indices}(0);`;for(let R=0;R<E;R++)$+=`${E>1?`indicesIndices${y}[${R}]`:`indicesIndices${y}`} = ${a.length>1?`outputIndices${y}[uniforms.axis + ${R}]`:`outputIndices${y}`};`;$+=`
          var idx${y} = ${g.getByIndices(`indicesIndices${y}`)};
          if (idx${y} < 0) {
            idx${y} = idx${y} + uniforms.axisDimLimit;
          }
          var dataIndices${y} : ${m.type.indices};
        `;for(let R=0,D=0;R<i;R++)R===s?($+=`${i>1?`dataIndices${y}[${R}]`:`dataIndices${y}`} = u32(idx${y});`,D+=E):($+=`${i>1?`dataIndices${y}[${R}]`:`dataIndices${y}`} = ${a.length>1?`outputIndices${y}[${D}]`:`outputIndices${y}`};`,D++);return $},v;if(t[0].dataType===9){let y=(E,$,R="")=>`
          let outputIndices${$} = ${w.offsetToIndices(`outputOffset + ${$}u`)};
          ${x($)};
          let offset${$} = ${m.indicesToOffset(`dataIndices${$}`)};
          let index${$} = offset${$} / 4u;
          let component${$} = offset${$} % 4u;
          ${E}[${$}] = ${R}(${m.getByOffset(`index${$}`)}[component${$}]);
        `;v=`
        let outputOffset = global_idx * ${l};
        var value = vec4<u32>(0);
        ${y("value",0,"u32")}
        ${y("value",1,"u32")}
        ${y("value",2,"u32")}
        ${y("value",3,"u32")}
        ${w.setByOffset("global_idx","value")}
      `}else v=`
      let outputIndices = ${w.offsetToIndices("global_idx")};
      ${x("")};
      let value = ${m.getByIndices("dataIndices")};
      ${w.setByOffset("global_idx","value")};
      `;return`
      ${h.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(m,g,w)}
      ${h.mainStart()}
        ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${v}
      }`};return{name:"Gather",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:d}},vL=t=>qe({axis:t.axis}),bL=(t,e)=>{let n=t.inputs;j$(n),t.compute(W$(t.inputs,e))}}),H$,xL,TL,ete=se(()=>{ve(),Ee(),Se(),H$=(t,e,n,r,i,s,a,o,l)=>{let u=[{type:12,data:s},{type:12,data:r},{type:12,data:i},{type:12,data:n},{type:12,data:a},{type:12,data:o},{type:12,data:l}],c=[s];u.push(..._e(e.dims,c));let d=h=>{let m=X("indices_data",e.dataType,e.dims.length),g=me("input_slice_offsets_data",12,1,1),w=[m,g],x=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:n.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${h.registerUniforms(x).declareVariables(...w)}
  ${h.mainStart()}
    ${h.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${i.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${n.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${i.length}_${n.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:c,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:u}),getShaderSource:d},{inputs:[e],outputs:[-1]})[0]},xL=(t,e)=>{let n=t.inputs,r=n[0].dims,i=n[0].dataType,s=n[1].dims,a=s[s.length-1],o=q.sizeToDimension(s,s.length-1),l=q.sizeFromDimension(r,e.batchDims+a),u=q.sizeToDimension(r,e.batchDims),c=q.sizeFromDimension(r,e.batchDims),d=o/u,h=new Array(a),m=l;for(let $=0;$<a;++$)h[a-1-$]=m,m*=r[e.batchDims+a-1-$];let g=H$(t,n[1],h,e.batchDims,r,o,d,c,a),w=e.batchDims+a;if(w>r.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let x=s.slice(0,-1).concat(r.slice(w)),v=q.size(x),y=[{type:12,data:v},{type:12,data:l},..._e(n[0].dims,g.dims,x)],E=$=>{let R=X("data",n[0].dataType,n[0].dims.length),D=X("slice_offsets",12,g.dims.length),k=me("output",n[0].dataType,x.length);return`
          ${$.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(R,D,k)}
            ${$.mainStart()}
            ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:e.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:x,dataType:i}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:y}),getShaderSource:E},{inputs:[n[0],g]})},TL=t=>({batchDims:t.batch_dims,cacheKey:""})}),q$,G$,EL,SL,tte=se(()=>{ve(),Ee(),It(),Se(),q$=(t,e)=>{if(t.length<3||t.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let n=q.normalizeAxis(e.quantizeAxis,t[0].dims.length),r=e.blockSize,i=t[0],s=t[2],a=t.length===4?t[3]:void 0;if(s.dims.length!==i.dims.length||!i.dims.map((o,l)=>l===n?Math.ceil(o/r)===s.dims[l]:o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(a){if(a.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(a.dims.length!==s.dims.length||!a.dims.map((o,l)=>o===s.dims[l]).reduce((o,l)=>o&&l,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},G$=(t,e)=>{let n=t[0].dims,r=t[1].dims,i=n.length,s=q.normalizeAxis(e.gatherAxis,i),a=q.normalizeAxis(e.quantizeAxis,i),o=n.slice(0);o.splice(s,1,...r);let l=q.size(o),u=t[2].dataType,c=t[0].dataType===22,d=[{type:12,data:l},{type:12,data:a},{type:12,data:s},{type:12,data:e.blockSize},..._e(...t.map((m,g)=>m.dims),o)],h=m=>{let g=X("data",t[0].dataType,t[0].dims.length),w=X("inputIndices",t[1].dataType,t[1].dims.length),x=X("scales",t[2].dataType,t[2].dims.length),v=t.length>3?X("zeroPoint",t[3].dataType,t[3].dims.length):void 0,y=me("output",u,o.length),E=[g,w,x];v&&E.push(v);let $=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${m.registerUniforms($).declareVariables(...E,y)}
        ${m.mainStart()}
        let output_indices = ${y.offsetToIndices("global_idx")};
        var indices_indices = ${w.type.indices}(0);
        ${r.length>1?`
          for (var i: u32 = 0; i < ${r.length}; i++) {
            let index = ${y.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${w.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${y.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${g.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${y.indicesGet("output_indices","i")};
          ${g.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${w.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${n[s]};
        }
        ${g.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${o.length}; i++) {
          let index = ${y.indicesGet("output_indices",`i + ${r.length} - 1`)};
          ${g.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${g.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${g.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${x.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${x.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${x.getByIndices("scale_indices")};
        ${v?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${v.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${v.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${c?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${gn(u)}(quantized_data - zero_point) * scale;
        ${y.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${e.cacheKey};${t.filter((m,g)=>g!==1).map(m=>m.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(m,g)=>"rank")},getRunData:()=>({outputs:[{dims:o,dataType:u}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:d}),getShaderSource:h}},EL=(t,e)=>{let n=t.inputs;q$(n,e),t.compute(G$(t.inputs,e))},SL=t=>qe({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),K$,Y$,IL,kL,nte=se(()=>{ve(),Ee(),It(),Se(),K$=t=>{if(!t||t.length!==2)throw new Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},Y$=(t,e)=>{let n=t[0].dims,r=t[0].dataType,i=n.length,s=t[1].dims,a=t[1].dataType,o=q.normalizeAxis(e.axis,i),l=n[o],u=s.slice(0),c=q.size(u),d=X("input",r,i),h=X("indicesInput",a,s.length),m=me("output",r,u.length),g=[{type:12,data:c},{type:6,data:l},{type:12,data:o}];return g.push(..._e(n,s,u)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:u,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:g}),getShaderSource:w=>`
      ${w.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,h,m)}
      ${w.mainStart()}
      ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${m.offsetToIndices("global_idx")};

      var idx = ${h.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${d.type.indices}(outputIndices);
      ${d.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${d.getByIndices("inputIndices")};

      ${m.setByOffset("global_idx","value")};
  }`}},IL=t=>qe({axis:t.axis}),kL=(t,e)=>{let n=t.inputs;K$(n),t.compute(Y$(t.inputs,e))}}),Q$,X$,$L,CL,rte=se(()=>{ve(),Ee(),Se(),Q$=t=>{if(!t)throw new Error("Input is missing");if(t.length<2||t.length>3)throw new Error("Invaid input number.");if(t.length===3&&t[2].dims.length>2)throw new Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("Input types are mismatched")},X$=(t,e)=>{let n=t[0].dims.slice(),r=t[1].dims.slice(),[i,s,a]=IM.getShapeOfGemmResult(n,e.transA,r,e.transB,t.length===3?t[2].dims:void 0),o=[i,s];if(!o)throw new Error("Can't use gemm on the given tensors");let l=16,u=Math.ceil(s/l),c=Math.ceil(i/l),d=!0,h=q.size(o),m=[{type:12,data:d?u:h},{type:12,data:i},{type:12,data:s},{type:12,data:a},{type:1,data:e.alpha},{type:1,data:e.beta}],g=["type","type"];t.length===3&&(m.push(..._e(t[2].dims)),g.push("rank")),m.push(..._e(o));let w=v=>{let y="";e.transA&&e.transB?y="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":e.transA&&!e.transB?y="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!e.transA&&e.transB?y="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!e.transA&&!e.transB&&(y="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let E=e.alpha===1?"":"value *= uniforms.alpha;",$=X("a",t[0].dataType,t[0].dims),R=X("b",t[1].dataType,t[1].dims),D=$.type.value,k=null,_=[$,R];t.length===3&&(k=X("c",t[2].dataType,t[2].dims.length),_.push(k));let A=me("output",t[0].dataType,o.length);_.push(A);let N=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${v.registerUniforms(N).declareVariables(..._)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${D}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${y}
    }

    ${E}
    ${k!=null?`let cOffset = ${k.broadcastedIndicesToOffset("vec2(m, n)",A)}; value += ${D}(uniforms.beta) * ${k.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},x=v=>{let y=X("a",t[0].dataType,t[0].dims),E=X("b",t[1].dataType,t[1].dims),$=null,R=[y,E];t.length===3&&($=X("c",t[2].dataType,t[2].dims.length),R.push($));let D=me("output",t[0].dataType,o.length);R.push(D);let k=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],_="",A="";e.transA&&e.transB?(A=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,_="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):e.transA&&!e.transB?(A=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,_="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!e.transA&&e.transB?(A=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,_="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!e.transA&&!e.transB&&(A=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${y.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${E.type.value}(0);
      }
      `,_="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let N=e.alpha===1?"":"value *= uniforms.alpha;";return`
  ${v.registerUniforms(k).declareVariables(...R)}
  var<workgroup> tile_a: array<array<${y.type.storage}, ${l}>, ${l}>;
  var<workgroup> tile_b: array<array<${E.type.storage}, ${l}>, ${l}>;
  ${v.mainStart([l,l,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${l};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${l};
    let num_tiles = (uniforms.K - 1) / ${l} + 1;
    var k_start = 0u;
    var value = ${D.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${A}
      k_start = k_start + ${l};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${l}; k++) {
        ${_}
      }
      workgroupBarrier();
    }

    ${N}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${$!=null?`let cOffset = ${$.broadcastedIndicesToOffset("vec2(m, n)",D)}; value += ${D.type.value}(uniforms.beta) * ${$.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return d?{name:"GemmShared",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:u*c},programUniforms:m}),getShaderSource:x}:{name:"Gemm",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:m}),getShaderSource:w}},$L=t=>{let e=t.transA,n=t.transB,r=t.alpha,i=t.beta;return{transA:e,transB:n,alpha:r,beta:i,cacheKey:`${t.transA};${t.transB};${t.alpha===1}`}},CL=(t,e)=>{Q$(t.inputs),t.compute(X$(t.inputs,e))}}),mi,Ji,ro,io,J$,Z$,eC,tC,nC,rC,iC,sC,AL,RL,ite=se(()=>{ve(),Ee(),It(),Se(),[mi,Ji,ro,io]=[0,1,2,3],J$=t=>{if(t[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw new Error("grid batch size must match input batch size")},Z$=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,eC=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,tC=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${t.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,nC=t=>`
  ${t.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,rC=(t,e,n)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${e} {
     var pixel = ${e}(0);
     var indices = vec4<u32>(0);
     indices[${mi}] = batch;
     indices[${Ji}] = channel;`+(()=>{switch(n.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${ro}] = u32(r);
            indices[${io}] = u32(c);
          } else {
            return ${e}(0);
          }
        `;case"border":return`
          indices[${ro}] = u32(clamp(r, 0, H - 1));
          indices[${io}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${ro}] = gs_reflect(r, border[1], border[3]);
          indices[${io}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${n.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,iC=(t,e,n)=>(()=>{switch(n.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${mi}], indices[${Ji}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${mi}], indices[${Ji}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${mi}], indices[${Ji}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${mi}], indices[${Ji}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${mi}], indices[${Ji}], border);

          let dx2 = ${e}(f32(x2) - x);
          let dx1 = ${e}(x - f32(x1));
          let dy2 = ${e}(f32(y2) - y);
          let dy1 = ${e}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${e}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${mi}], indices[${Ji}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${n.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,sC=(t,e)=>{let n=X("x",t[0].dataType,t[0].dims.length),r=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],i=X("grid",t[1].dataType,r.length,2),s=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];e.format==="NHWC"&&(s=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[mi,Ji,ro,io]=[0,3,1,2]);let a=me("output",t[0].dataType,s.length),o=n.type.value,l=q.size(s),u=[{type:12,data:l},..._e(t[0].dims,r,s)],c=d=>`
  ${d.registerUniform("output_size","u32").declareVariables(n,i,a)}
  ${Z$}
  ${eC(o)}
  ${tC(e)}
  ${nC(e)}
  ${rC(n,o,e)}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${ro}]);
      let W_in = i32(uniforms.x_shape[${io}]);

      ${e.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${a.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${mi}], indices[${ro}], indices[${io}]);
      let nxy = ${i.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${iC(a,o,e)}
  }`;return{name:"GridSample",shaderCache:{hint:`${e.cacheKey}`,inputDependencies:["type","type"]},getRunData:d=>{let h=q.size(s);return{outputs:[{dims:s,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:u}},getShaderSource:c}},AL=(t,e)=>{J$(t.inputs),t.compute(sC(t.inputs,e))},RL=t=>qe({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),Rn,aC,PL,q_,oC,nd,NL,OL=se(()=>{ve(),Ee(),It(),Yx(),Jx(),Se(),Fa(),Rn=(t,e)=>t.length>e&&t[e].dims.length>0?t[e]:void 0,aC=(t,e)=>{let n=t[0],r=Rn(t,1),i=Rn(t,2),s=Rn(t,3),a=Rn(t,4),o=Rn(t,5),l=Rn(t,6),u=Rn(t,7);if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let c=n.dims[0],d=n.dims[1],h=n.dims.length===3?n.dims[2]:e.numHeads*n.dims[4],m=d,g=0,w=0,x=Math.floor(h/e.numHeads);if(l&&u&&q.size(l.dims)&&q.size(u.dims)){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(l.dims[0]!==c||l.dims[1]!==e.numHeads||l.dims[3]!==x)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(u.dims[0]!==c||u.dims[1]!==e.numHeads||u.dims[3]!==x)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(l.dims[2]!==u.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(u.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');g=l.dims[2],w=l.dims[2]}else if(l&&q.size(l.dims)||u&&q.size(u.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let v;if(r&&q.size(r.dims)>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(r.dims.length<3||r.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(r.dims.length===3){if(r.dims[2]!==n.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');v=2,m=r.dims[1]}else if(r.dims.length===5){if(r.dims[2]!==e.numHeads||r.dims[3]!==2||r.dims[4]!==x)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');v=5,m=r.dims[1]}else{if(r.dims[1]!==e.numHeads||r.dims[3]!==x)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');v=0,m=r.dims[2]}}else{if(n.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==e.numHeads||n.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');v=3}if(s&&q.size(s.dims)>0){if(s.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(r&&r.dims.length===5&&r.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let y=g+m,E=0;if(a&&q.size(a.dims)>0){E=8;let k=a.dims;throw k.length===1?k[0]===c?E=1:k[0]===3*c+2&&(E=3):k.length===2&&k[0]===c&&k[1]===y&&(E=5),E===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let $=!1,R=h;if(i&&q.size(i.dims)>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(m!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');R=i.dims[2]}else{if(m!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');R=i.dims[1]*i.dims[3],$=!0}}let D=!1;if(a&&q.size(a.dims)>0)throw new Error("Key padding mask is not supported");if(o&&q.size(o.dims)>0){if(o.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(o.dims[0]!==c||o.dims[1]!==e.numHeads||o.dims[2]!==d||o.dims[3]!==y)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:c,sequenceLength:d,pastSequenceLength:g,kvSequenceLength:m,totalSequenceLength:y,maxSequenceLength:w,inputHiddenSize:0,hiddenSize:h,vHiddenSize:R,headSize:x,vHeadSize:Math.floor(R/e.numHeads),numHeads:e.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:e.maskFilterValue,maskType:E,scale:e.scale,broadcastResPosBias:D,passPastInKv:$,qkvFormat:v}},PL=t=>qe({...t}),q_=qe({perm:[0,2,1,3]}),oC=(t,e,n,r,i,s,a)=>{let o=[r,i,s],l=q.size(o),u=[{type:12,data:l},{type:12,data:a},{type:12,data:s}],c=d=>{let h=me("qkv_with_bias",e.dataType,o),m=X("qkv",e.dataType,o),g=X("bias",n.dataType,o),w=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${d.registerUniforms(w).declareVariables(m,g,h)}
  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:o,dataType:e.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:u}),getShaderSource:c},{inputs:[e,n],outputs:[-1]})[0]},nd=(t,e,n,r,i,s,a,o)=>{let l=s;if(a&&q.size(a.dims)>0){if(r===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return l=oC(t,s,a,e,r,n*i,o),l=l.reshape([e,r,n,i]),n===1||r===1?l:t.compute(ar(l,q_.perm),{inputs:[l],outputs:[-1]})[0]}else return s.dims.length===3&&(l=s.reshape([e,r,n,i])),n===1||r===1?l:t.compute(ar(l,q_.perm),{inputs:[l],outputs:[-1]})[0]},NL=(t,e)=>{let n=aC(t.inputs,e),r=t.inputs[0],i=Rn(t.inputs,1),s=Rn(t.inputs,2),a=Rn(t.inputs,3),o=Rn(t.inputs,4),l=Rn(t.inputs,5),u=Rn(t.inputs,6),c=Rn(t.inputs,7);if(r.dims.length===5)throw new Error("Packed QKV is not implemented");if((i==null?void 0:i.dims.length)===5)throw new Error("Packed KV is not implemented");let d=i&&s&&i.dims.length===4&&s.dims.length===4,h=nd(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,r,a,0);if(d)return hh(t,h,i,s,o,void 0,u,c,l,n);if(!i||!s)throw new Error("key and value must be provided");let m=nd(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.headSize,i,a,n.hiddenSize),g=nd(t,n.batchSize,n.numHeads,n.kvSequenceLength,n.vHeadSize,s,a,2*n.hiddenSize);hh(t,h,m,g,o,void 0,u,c,l,n)}}),lC,uC,cC,dC,fv,DL,ML,LL=se(()=>{ve(),Ee(),It(),Se(),lC=t=>{if(!t||t.length<1)throw new Error("too few inputs")},uC=(t,e)=>{let n=[],r=e.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(i=>n.push(Number(i))),r=n.length),qe({numOutputs:r,axis:e.axis,splitSizes:n})},cC=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${ye("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,dC=t=>{let e=t.length,n=[];for(let r=0;r<e;++r){let i=t[r].setByIndices("indices","input[global_idx]");e===1?n.push(i):r===0?n.push(`if (output_number == ${r}u) { ${i} }`):r===e-1?n.push(`else { ${i} }`):n.push(`else if (output_number == ${r}) { ${i} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${n.join(`
`)}
      }`},fv=(t,e)=>{let n=t[0].dims,r=q.size(n),i=t[0].dataType,s=q.normalizeAxis(e.axis,n.length),a=new Array(e.numOutputs),o=X("input",i,n.length),l=new Array(e.numOutputs),u=[],c=[],d=0,h=[{type:12,data:r}];for(let g=0;g<e.numOutputs;g++){d+=e.splitSizes[g],l[g]=d;let w=n.slice();w[s]=e.splitSizes[g],c.push(w),a[g]=me(`output${g}`,i,w.length),u.push({dims:c[g],dataType:t[0].dataType})}h.push({type:12,data:l},..._e(n,...c));let m=g=>`
  ${g.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",l.length).declareVariables(o,...a)}
  ${cC(l.length)}
  ${dC(a)}

  ${g.mainStart()}
    ${g.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${o.offsetToIndices("global_idx")};
    var index = ${o.indicesGet("indices",s)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${ye("uniforms.size_in_split_axis","output_number - 1u",l.length)};
      ${o.indicesSet("indices",s,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:e.cacheKey,inputDependencies:["rank"]},getShaderSource:m,getRunData:()=>({outputs:u,dispatchGroup:{x:Math.ceil(r/64)},programUniforms:h})}},DL=(t,e)=>{lC(t.inputs);let n=t.inputs.length===1?e:uC(t.inputs,e);t.compute(fv(t.inputs,n),{inputs:[0]})},ML=t=>{let e=t.axis,n=t.splitSizes,r=t.numOutputs<0?n.length:t.numOutputs;if(r!==n.length)throw new Error("numOutputs and splitSizes length must be equal");return qe({axis:e,numOutputs:r,splitSizes:n})}}),hC,Qm,zL,VL=se(()=>{ve(),Ee(),It(),Se(),hC=(t,e)=>{let[n,r,i,s]=t,{numHeads:a,rotaryEmbeddingDim:o}=e;if(n.dims.length!==3&&n.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${n.dims.length}`);if(!q.areEqual(r.dims,[])&&!q.areEqual(r.dims,[1])&&r.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${r.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(s.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(!q.areEqual(i.dims,s.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(o>0&&a===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let l=n.dims[0],u=n.dims[n.dims.length-2],c=i.dims[0],d=q.sizeFromDimension(n.dims,1)/u,h=o===0?i.dims[1]*2:d/a;if(o>h)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(r.dims.length===2){if(l!==r.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${r.dims[0]}`);if(u!==r.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${r.dims[1]}`)}if(h/2!==i.dims[1]&&o/2!==i.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${i.dims[1]}`);if(u>c)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},Qm=(t,e)=>{let{interleaved:n,numHeads:r,rotaryEmbeddingDim:i,scale:s}=e,a=t[0].dims[0],o=q.sizeFromDimension(t[0].dims,1),l=t[0].dims[t[0].dims.length-2],u=o/l,c=t[2].dims[1],d=i===0?c*2:u/r,h=new Array(a,l,u/d,d-c),m=q.computeStrides(h),g=[{type:1,data:s},{type:12,data:h},{type:12,data:m},...t[0].dims.length===3?new Array({type:12,data:[o,u,d,1]}):[],...t[0].dims.length===4?new Array({type:12,data:[o,d,l*d,1]}):[],..._e(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],w=x=>{let v=X("input",t[0].dataType,t[0].dims.length),y=X("position_ids",t[1].dataType,t[1].dims.length),E=X("cos_cache",t[2].dataType,t[2].dims.length),$=X("sin_cache",t[3].dataType,t[3].dims.length),R=me("output",t[0].dataType,t[0].dims.length);return x.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:h.length},{name:"global_strides",type:"u32",length:m.length},{name:"input_output_strides",type:"u32",length:m.length}]),`
        ${x.declareVariables(v,y,E,$,R)}

        ${x.mainStart(Iu)}
          let half_rotary_emb_dim = uniforms.${E.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${x.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${y.broadcastedIndicesToOffset("bsnh.xy",me("",y.type.tensor,2))};
            let position_id =
                u32(${y.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${n});
            let j = i + select(half_rotary_emb_dim, 1, ${n});
            let re = ${v.getByOffset("i")} * ${E.get("position_id","bsnh[3]")} -
                ${v.getByOffset("j")} * ${$.get("position_id","bsnh[3]")};
            ${R.setByOffset("i","re")}
            let im = ${v.getByOffset("i")} * ${$.get("position_id","bsnh[3]")} +
                ${v.getByOffset("j")} * ${E.get("position_id","bsnh[3]")};
            ${R.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${R.setByOffset("k",v.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:qe({interleaved:n}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:w,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(q.size(h)/Iu)},programUniforms:g})}},zL=(t,e)=>{hC(t.inputs,e),t.compute(Qm(t.inputs,e))}}),fC,pC,G_,mC,FL,ste=se(()=>{It(),ve(),Jx(),OL(),LL(),Fa(),VL(),Se(),fC=(t,e)=>{if(e.doRotary&&t.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let n=t[0],r=t[1],i=t[2],s=t[3],a=t[4];if(e.doRotary!==0&&t.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(e.localWindowSize!==-1)throw new Error("Local attention is not supported");if(e.softcap!==0)throw new Error("Softcap is not supported");if(e.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(e.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(n.dims.length!==3&&n.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let o=!1,l=n.dims[0],u=n.dims[1],c=n.dims.length===3?o?n.dims[2]/3:n.dims[2]:e.numHeads*n.dims[4],d=u,h=0,m=!r||r.dims.length===0,g=Math.floor(m?c/(e.numHeads+2*e.kvNumHeads):c/e.numHeads);m&&(c=g*e.numHeads);let w=s&&s.dims.length!==0,x=a&&a.dims.length!==0;if(w&&s.dims.length===4&&s.dims[0]===l&&s.dims[1]!==e.kvNumHeads&&s.dims[2]===e.kvNumHeads&&s.dims[3]===g)throw new Error("BSNH pastKey/pastValue is not supported");if(w&&x){if(s.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(a.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');h=s.dims[2]}else if(w||x)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let v=1;if(r&&r.dims.length>0){if(n.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(r.dims.length<3||r.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==r.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(r.dims.length===3){if(n.dims[2]%r.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');d=r.dims[1]}else if(r.dims.length===5){if(r.dims[2]!==e.numHeads||r.dims[3]!==2||r.dims[4]!==g)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');d=r.dims[1]}else{if(r.dims[1]!==e.numHeads||r.dims[3]!==g)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');d=r.dims[2]}}else{if(n.dims.length!==3&&n.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(n.dims.length===5&&(n.dims[2]!==e.numHeads||n.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');v=3}let y=0,E=!1,$=e.kvNumHeads?g*e.kvNumHeads:c;if(i&&i.dims.length>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(d!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');$=i.dims[2]}else{if(d!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');$=i.dims[1]*i.dims[3],E=!0}}let R=t.length>4?t[5]:void 0;if(R&&R.dims.length!==1&&R.dims[0]!==l)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:u,pastSequenceLength:h,kvSequenceLength:d,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:c,vHiddenSize:$,headSize:g,vHeadSize:Math.floor($/e.kvNumHeads),numHeads:e.numHeads,kvNumHeads:e.kvNumHeads,nReps:e.numHeads/e.kvNumHeads,pastPresentShareBuffer:!1,maskType:y,scale:e.scale,broadcastResPosBias:!1,passPastInKv:E,qkvFormat:v}},pC=qe({perm:[0,2,1,3]}),G_=(t,e,n)=>{let r=e,i=n.kvNumHeads;return e.dims.length===3&&n.kvSequenceLength!==0&&(r=e.reshape([n.batchSize,n.kvSequenceLength,i,n.headSize]),r=t.compute(ar(r,pC.perm),{inputs:[r],outputs:[-1]})[0]),r},mC=(t,e,n,r)=>{let i=7,s=["type","type"],a=[t*e],o=t*e,l=[{type:12,data:o},{type:12,data:e},{type:12,data:t}],u=c=>{let d=X("seq_lens",n.dataType,n.dims),h=X("total_seq_lens",r.dataType,r.dims),m=me("pos_ids",i,a),g=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${c.registerUniforms(g).declareVariables(d,h,m)}
  ${c.mainStart()}
    ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${h.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${d.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${m.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${m.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${m.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${e}`,inputDependencies:s},getRunData:()=>({outputs:[{dims:a,dataType:i}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:u}},FL=(t,e)=>{var $;let n=fC(t.inputs,e);if(t.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if((($=t.inputs[1])==null?void 0:$.dims.length)===5)throw new Error("Packed KV is not implemented");let r=t.inputs[0],i=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,s=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,a=t.inputs[3]&&t.inputs[3].dims.length!==0?t.inputs[3]:void 0,o=t.inputs[4]&&t.inputs[4].dims.length!==0?t.inputs[4]:void 0,l=t.inputs.length>4?t.inputs[5]:void 0,u=t.inputs.length>5?t.inputs[6]:void 0,c=n.kvNumHeads?n.kvNumHeads:n.numHeads,d=qe({axis:2,numOutputs:3,splitSizes:[n.numHeads*n.headSize,c*n.headSize,c*n.headSize]}),[h,m,g]=!i&&!s?t.compute(fv([r],d),{inputs:[r],outputs:[-1,-1,-1]}):[r,i,s],w,x;if(e.doRotary){let R=t.compute(mC(n.batchSize,n.sequenceLength,l,u),{inputs:[l,u],outputs:[-1]})[0],D=t.inputs[7],k=t.inputs[8],_=qe({interleaved:e.rotaryInterleaved!==0,numHeads:n.numHeads,rotaryEmbeddingDim:0,scale:e.scale}),A=[h,R,D,k],N=[-1];w=t.compute(Qm(A,_),{inputs:A,outputs:N})[0],A.splice(0,1,m);let L=qe({interleaved:e.rotaryInterleaved!==0,numHeads:n.kvNumHeads,rotaryEmbeddingDim:0,scale:e.scale});x=t.compute(Qm(A,L),{inputs:A,outputs:N})[0]}let v=nd(t,n.batchSize,n.numHeads,n.sequenceLength,n.headSize,e.doRotary?w:h,void 0,0),y=G_(t,e.doRotary?x:m,n),E=G_(t,g,n);hh(t,v,y,E,void 0,void 0,a,o,void 0,n,l,u)}}),K_,gC,yC,BL,ate=se(()=>{ve(),Ee(),Fa(),Se(),K_=(t,e,n,r,i,s,a,o)=>{let l=yt(s),u=l===1?"f32":`vec${l}f`,c=l===1?"vec2f":`mat2x${l}f`,d=i*a,h=64;d===1&&(h=256);let m=[i,a,s/l],g=[i,a,2],w=["rank","type","type"],x=[];x.push(..._e(m,g));let v=y=>{let E=X("x",e.dataType,3,l),$=X("scale",n.dataType,n.dims),R=X("bias",r.dataType,r.dims),D=me("output",1,3,2),k=[E,$,R,D];return`
  var<workgroup> workgroup_shared : array<${c}, ${h}>;
  const workgroup_size = ${h}u;
  ${y.declareVariables(...k)}
  ${y.mainStart(h)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${u}(0);
    var squared_sum = ${u}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${u}(${E.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${c}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Ra("workgroup_shared[0][0]",l)} / f32(hight * ${l});
      let squared_sum_final = ${Ra("workgroup_shared[0][1]",l)} / f32(hight * ${l});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${o}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${l};${o};${h}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:g,dataType:1}],dispatchGroup:{x:d},programUniforms:x}),getShaderSource:v},{inputs:[e,n,r],outputs:[-1]})[0]},gC=(t,e,n)=>{let r=e[0].dims,i=r,s=2,a=r[0],o=r[1],l=q.sizeFromDimension(r,s),u=yt(l),c=q.size(i)/u,d=K_(t,e[0],e[1],e[2],a,l,o,n.epsilon),h=[a,o,l/u],m=[a,o],g=["type","none"],w=x=>{let v=X("x",e[0].dataType,h.length,u),y=X("scale_shift",1,m.length,2),E=me("output",e[0].dataType,h.length,u),$=[v,y,E];return`
  ${x.registerUniform("output_size","u32").declareVariables(...$)}
  ${x.mainStart()}
  ${x.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${E.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${y.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${v.getByOffset("global_idx")} * ${E.type.value}(scale_shift.x) + ${E.type.value}(scale_shift.y);
      ${E.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${u}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:[{type:12,data:c},..._e(h,m,h)]}),getShaderSource:w},{inputs:[e[0],d]})},yC=(t,e,n)=>{let r=e[0].dims,i=r,s=r[0],a=r[r.length-1],o=q.sizeFromDimension(r,1)/a,l=yt(a),u=q.size(i)/l,c=[{type:12,data:o},{type:12,data:Math.floor(a/l)}],d=["type","type"],h=!1,m=[0,r.length-1];for(let v=0;v<r.length-2;v++)h=h||r[v+1]!==1,m.push(v+1);h=h&&r[r.length-1]!==1;let g=h?t.compute(ar(t.inputs[0],m),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:r.length},(v,y)=>r[m[y]])),w=K_(t,g,e[1],e[2],s,o,a,n.epsilon),x=v=>{let y=Yt(e[0].dataType),E=l===1?"vec2f":`mat${l}x2f`,$=k=>{let _=k===0?"x":"y",A=l===1?"f32":`vec${l}f`;switch(l){case 1:return`${y}(${A}(scale.${_}))`;case 2:return`vec2<${y}>(${A}(scale[0].${_}, scale[1].${_}))`;case 4:return`vec4<${y}>(${A}(scale[0].${_}, scale[1].${_}, scale[2].${_}, scale[3].${_}))`;default:throw new Error(`Not supported compoents ${l}`)}},R=X("input",e[0].dataType,e[0].dims,l),D=me("output",e[0].dataType,i,l);return`
  @group(0) @binding(0) var<storage, read> input : array<${R.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${E}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${D.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${v.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${$(0)}, ${$(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${l}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:c}),getShaderSource:x},{inputs:[e[0],w]})},BL=(t,e)=>{e.format==="NHWC"?yC(t,t.inputs,e):gC(t,t.inputs,e)}}),_C,wC,UL,ote=se(()=>{ve(),Ee(),Se(),_C=t=>{if(!t||t.length<2)throw new Error("layerNorm requires at least 2 inputs.")},wC=(t,e,n)=>{let r=e.simplified,i=t[0].dims,s=t[1],a=!r&&t[2],o=i,l=q.normalizeAxis(e.axis,i.length),u=q.sizeToDimension(i,l),c=q.sizeFromDimension(i,l),d=q.size(s.dims),h=a?q.size(a.dims):0;if(d!==c||a&&h!==c)throw new Error(`Size of X.shape()[axis:] == ${c}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${d} and bias size of ${h}`);let m=[];for(let R=0;R<i.length;++R)R<l?m.push(i[R]):m.push(1);let g=yt(c),w=["type","type"],x=[{type:12,data:u},{type:1,data:c},{type:12,data:Math.floor(c/g)},{type:1,data:e.epsilon}];a&&w.push("type");let v=n>1,y=n>2,E=R=>{let D=Yt(t[0].dataType),k=[X("x",t[0].dataType,t[0].dims,g),X("scale",s.dataType,s.dims,g)];a&&k.push(X("bias",a.dataType,a.dims,g)),k.push(me("output",t[0].dataType,o,g)),v&&k.push(me("mean_data_output",1,m)),y&&k.push(me("inv_std_output",1,m));let _=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${R.registerUniforms(_).declareVariables(...k)}
  ${R.mainStart()}
    ${R.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${iv("f32",g)};
    var mean_square_vector = ${iv("f32",g)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${ql(D,g,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Ra("mean_vector",g)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Ra("mean_square_vector",g)} / uniforms.norm_size ${r?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${ql(D,g,"x[j + offset]")};
      let f32scale = ${ql(D,g,"scale[j]")};
      output[j + offset] = ${k[0].type.value}((f32input ${r?"":"- mean"}) * inv_std_dev * f32scale
        ${a?`+ ${ql(D,g,"bias[j]")}`:""}
      );
    }

    ${v?"mean_data_output[global_idx] = mean":""};
    ${y?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},$=[{dims:o,dataType:t[0].dataType}];return v&&$.push({dims:m,dataType:1}),y&&$.push({dims:m,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${g};${n};${r}`,inputDependencies:w},getRunData:()=>({outputs:$,dispatchGroup:{x:Math.ceil(u/64)},programUniforms:x}),getShaderSource:E}},UL=(t,e)=>{_C(t.inputs),t.compute(wC(t.inputs,e,t.outputCount))}}),vC,jL,lte=se(()=>{Ee(),r1(),i1(),vC=t=>{if(!t||t.length!==2)throw new Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw new Error("shared dimension does not match.")},jL=t=>{vC(t.inputs);let e=Su.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!e)throw new Error("Can't use matmul on the given tensors");let n=e[e.length-1],r=t.inputs[0].dims[t.inputs[0].dims.length-1];if(n<8&&r<8)t.compute(n1(t.inputs,{activation:""},e));else{let i=e[e.length-2],s=q.size(t.inputs[0].dims.slice(0,-2)),a=q.size(t.inputs[1].dims.slice(0,-2));if(s!==1&&i===1&&a===1){let o=t.inputs[0].reshape([1,s,r]),l=t.inputs[1].reshape([1,r,n]),u=[1,s,n],c=[o,l];t.compute(Ym(c,{activation:""},e,u),{inputs:c})}else t.compute(Ym(t.inputs,{activation:""},e))}}}),bC,xC,TC,WL,HL,ute=se(()=>{ve(),Ee(),It(),Se(),bC=(t,e)=>{if(t.length<3||t.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let n=t[0],r=n.dims.length;if(n.dims[r-1]!==e.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((e.k+e.blockSize-1)/e.blockSize),s=e.blockSize/8*e.bits,a=t[1];if(!q.areEqual(a.dims,[e.n,i,s]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let o=t[2].dims;if(q.size(o)!==e.n*i)throw new Error("scales input size error.");if(t.length===4){let l=t[3].dims,u=e.n*(e.bits===8?i:Math.floor((i*e.bits+7)/8));if(q.size(l)!==u)throw new Error("zeroPoints input size error.")}},xC=(t,e)=>{let n=t[0].dims,r=n.length,i=n[r-2],s=e.k,a=e.n,o=n.slice(0,r-2),l=q.size(o),u=t[1].dims[2]/4,c=t[0].dataType,d=yt(e.k),h=yt(u),m=yt(a),g=o.concat([i,a]),w=i>1&&a/m%2===0?2:1,x=q.size(g)/m/w,v=64,y=[],E=[l,i,s/d],$=q.convertShape(t[1].dims).slice();$.splice(-1,1,u/h),y.push(..._e(E)),y.push(..._e($)),y.push(..._e(t[2].dims)),t.length===4&&y.push(..._e(q.convertShape(t[3].dims)));let R=[l,i,a/m];y.push(..._e(R));let D=k=>{let _=E.length,A=X("a",t[0].dataType,_,d),N=X("b",12,$.length,h),L=X("scales",t[2].dataType,t[2].dims.length),V=[A,N,L],M=t.length===4?X("zero_points",12,t[3].dims.length):void 0;M&&V.push(M);let B=R.length,Z=me("output",t[0].dataType,B,m),ie=Yt(t[0].dataType),de=(()=>{switch(d){case 1:return`array<${ie}, 8>`;case 2:return`mat4x2<${ie}>`;case 4:return`mat2x4<${ie}>`;default:throw new Error(`${d}-component is not supported.`)}})(),ee=()=>{let G=`
          // reuse a data
            var input_offset = ${A.indicesToOffset(`${A.type.indices}(batch, row, word_offset)`)};
            var a_data: ${de};
            for (var j: u32 = 0; j < ${8/d}; j++) {
              a_data[j] = ${A.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let H=0;H<m*w;H++)G+=`
            b_value = ${h===1?`b${H}_data`:`b${H}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${de}(${Array.from({length:4},(oe,ue)=>`${ie}(b_value_lower[${ue}]), ${ie}(b_value_upper[${ue}])`).join(", ")});
            b_dequantized_values = ${d===1?`${de}(${Array.from({length:8},(oe,ue)=>`(b_quantized_values[${ue}] - ${M?`zero_point${H}`:"zero_point"}) * scale${H}`).join(", ")});`:`(b_quantized_values - ${de}(${Array(8).fill(`${M?`zero_point${H}`:"zero_point"}`).join(",")})) * scale${H};`};
            workgroup_shared[local_id.x * ${w} + ${Math.floor(H/m)}]${m>1?`[${H%m}]`:""} += ${Array.from({length:8/d},(oe,ue)=>`${d===1?`a_data[${ue}] * b_dequantized_values[${ue}]`:`dot(a_data[${ue}], b_dequantized_values[${ue}])`}`).join(" + ")};
          `;return G},Y=()=>{let G=`
            var col_index = col * ${m};
            ${M?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${ie}(8);`}
            `;for(let H=0;H<m*w;H++)G+=`
            let scale${H} = ${L.getByOffset("col_index * nBlocksPerCol + block")};
            ${M?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${M.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${H} = ${ie}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return G},J=()=>{let G=`col_index = col * ${m};`;for(let H=0;H<m*w;H++)G+=`
            let b${H}_data = ${N.getByIndices(`${N.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return G+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${de};
            var b_dequantized_values: ${de};`,G};return`
        var<workgroup> workgroup_shared: array<${Z.type.value}, ${w*v}>;
        ${k.declareVariables(...V,Z)}
        ${k.mainStart([v,1,1])}
          let output_indices = ${Z.offsetToIndices(`(global_idx / ${v}) * ${w}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${v}) {
            //process one block
            var word_offset: u32 = block * ${e.blockSize/d};
            ${Y()}
            for (var word: u32 = 0; word < ${u}; word += ${h}) {
              ${J()}
              for (var i: u32 = 0; i < ${h}; i++) {
                ${ee()}
                word_offset += ${8/d};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${w}) {
            var output_value: ${Z.type.value} = ${Z.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${v}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${w};
            }
            ${Z.setByIndices(`${Z.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${e.blockSize};${e.bits};${d};${h};${m};${w};${v}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:g,dataType:c}],dispatchGroup:{x},programUniforms:y}),getShaderSource:D}},TC=(t,e)=>{let n=t[0].dims,r=n.length,i=n[r-2],s=e.k,a=e.n,o=n.slice(0,r-2),l=q.size(o),u=t[1].dims[2]/4,c=t[0].dataType,d=yt(e.k),h=yt(u),m=o.concat([i,a]),g=128,w=a%8===0?8:a%4===0?4:1,x=g/w,v=x*h*8,y=v/d,E=v/e.blockSize,$=q.size(m)/w,R=[],D=[l,i,s/d],k=q.convertShape(t[1].dims).slice();k.splice(-1,1,u/h),R.push(..._e(D)),R.push(..._e(k)),R.push(..._e(t[2].dims)),t.length===4&&R.push(..._e(q.convertShape(t[3].dims)));let _=[l,i,a];R.push(..._e(_));let A=N=>{let L=D.length,V=X("a",t[0].dataType,L,d),M=X("b",12,k.length,h),B=X("scales",t[2].dataType,t[2].dims.length),Z=[V,M,B],ie=t.length===4?X("zero_points",12,t[3].dims.length):void 0;ie&&Z.push(ie);let de=_.length,ee=me("output",t[0].dataType,de),Y=Yt(t[0].dataType),J=()=>{switch(d){case 1:return`
          let a_data0 = vec4<${Y}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${Y}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${Y}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${Y}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${d}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${V.type.value}, ${y}>;
        var<workgroup> inter_results: array<array<${ee.type.value}, ${x}>, ${w}>;
        ${N.declareVariables(...Z,ee)}
        ${N.mainStart([x,w,1])}
          let output_indices = ${ee.offsetToIndices(`workgroup_index * ${w}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${E} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${y};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${y}; a_offset += ${g})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${V.getByIndices(`${V.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${V.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${E} + local_id.x;
            ${ie?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${ie.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${Y}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Y}(8);`}
            let scale = ${B.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${M.getByIndices(`${M.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${e.blockSize/d};
            for (var i: u32 = 0; i < ${h}; i++) {
              ${J()}
              let b_value = ${h===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${Y}>(${Array.from({length:4},(G,H)=>`${Y}(b_value_lower[${H}]), ${Y}(b_value_upper[${H}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${Y}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(G,H)=>`${`dot(a_data${H}, b_dequantized_values[${H}])`}`).join(" + ")};
              word_offset += ${8/d};
            }
            workgroupBarrier();
          }

          if (local_idx < ${w}) {
            var output_value: ${ee.type.value} = ${ee.type.value}(0);
            for (var b = 0u; b < ${x}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${ee.setByIndices(`${ee.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${e.blockSize};${d};${h};${x};${w}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:m,dataType:c}],dispatchGroup:{x:$},programUniforms:R}),getShaderSource:A}},WL=(t,e)=>{bC(t.inputs,e),e.blockSize===32&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(TC(t.inputs,e)):t.compute(xC(t.inputs,e))},HL=t=>qe(t)}),EC,SC,IC,kC,$C,CC,AC,RC,qL,cte=se(()=>{ve(),Ee(),Se(),EC=t=>{if(!t||t.length<1)throw new Error("Too few inputs");if(t[0].dataType!==1&&t[0].dataType!==10)throw new Error("Input type must be float or float16.");if(t.length>=2){let e=t[0].dims.length*2===t[1].dims[0];if(t.length===4&&(e=t[3].dims[0]*2===t[1].dims[0]),!e)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},SC=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
            k = i32(${t.indicesGet("indices",i)}) - ${ye("uniforms.pads",i,n)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${ye("uniforms.x_shape",i,e)})) {
              break;
            }
            offset += k * i32(${ye("uniforms.x_strides",i,e)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${r}
            value = x[offset];
          }
      `},IC=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
                k = i32(${t.indicesGet("indices",i)}) - ${ye("uniforms.pads",i,n)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${ye("uniforms.x_shape",i,e)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${ye("uniforms.x_shape",i,e)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${ye("uniforms.x_strides",i,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${r}
              value = x[offset];
          `},kC=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
                k = i32(${t.indicesGet("indices",i)}) - ${ye("uniforms.pads",i,n)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${ye("uniforms.x_shape",i,e)})) {
                  k = i32(${ye("uniforms.x_shape",i,e)}) - 1;
                }
                offset += k * i32(${ye("uniforms.x_strides",i,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${r}
              value = x[offset];
          `},$C=(t,e,n)=>{let r="";for(let i=e-1;i>=0;--i)r+=`
                k = i32(${t.indicesGet("indices",i)}) - ${ye("uniforms.pads",i,n)};
                if (k < 0)  {
                  k += i32(${ye("uniforms.x_shape",i,e)}]);
                }
                if (k >= i32(${ye("uniforms.x_shape",i,e)})) {
                  k -= i32(${ye("uniforms.x_shape",i,e)});
                }
                offset += k * i32(${ye("uniforms.x_strides",i,e)});
            `;return`
              var offset = 0;
              var k = 0;
              ${r}
              value = x[offset];
          `},CC=(t,e,n)=>{switch(n.mode){case 0:return SC(t,e,n.pads.length);case 1:return IC(t,e,n.pads.length);case 2:return kC(t,e,n.pads.length);case 3:return $C(t,e,n.pads.length);default:throw new Error("Invalid mode")}},AC=(t,e)=>{let n=q.padShape(t[0].dims.slice(),e.pads),r=t[0].dims,i=q.size(n),s=[{type:12,data:i},{type:6,data:e.pads}],a=t.length>=3&&t[2].data;e.mode===0&&s.push({type:a?t[2].dataType:1,data:e.value}),s.push(..._e(t[0].dims,n));let o=["rank"],l=u=>{let c=me("output",t[0].dataType,n.length),d=X("x",t[0].dataType,r.length),h=d.type.value,m=CC(c,r.length,e),g=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:e.pads.length}];return e.mode===0&&g.push({name:"constant_value",type:a?h:"f32"}),`
            ${u.registerUniforms(g).declareVariables(d,c)}
            ${u.mainStart()}
            ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${c.offsetToIndices("global_idx")};

            var value = ${h}(0);
            ${m}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${e.mode}${a}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:n,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(q.size(n)/64)},programUniforms:s}),getShaderSource:l}},RC=(t,e)=>{if(t.length>1){let n=t[1].getBigInt64Array(),r=t.length>=3&&t[2].data?t[2].dataType===10?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,i=t[0].dims.length,s=new Int32Array(2*i).fill(0);if(t.length>=4){let o=t[3].getBigInt64Array();for(let l=0;l<o.length;l++)s[Number(o[l])]=Number(n[l]),s[Number(o[l])+i]=Number(n[l+o.length])}else n.forEach((o,l)=>s[Number(l)]=Number(o));let a=[];return s.forEach(o=>a.push(o)),{mode:e.mode,value:r,pads:a}}else return e},qL=(t,e)=>{EC(t.inputs);let n=RC(t.inputs,e);t.compute(AC(t.inputs,n),{inputs:[0]})}}),Lc,Y_,Q_,X_,J_,PC,NC,Z_,e0,GL,KL,t0,YL,QL,n0,XL,JL,ZL,ez,dte=se(()=>{Sr(),ve(),Ee(),Se(),Lc=t=>{if(et.webgpu.validateInputContent&&(!t||t.length!==1))throw new Error("Pool ops requires 1 input.")},Y_=(t,e,n)=>{let r=e.format==="NHWC",i=t.dims.slice();r&&i.splice(1,0,i.pop());let s=Object.hasOwnProperty.call(e,"dilations"),a=e.kernelShape.slice(),o=e.strides.slice(),l=s?e.dilations.slice():[],u=e.pads.slice();Gm.adjustPoolAttributes(n,i,a,o,l,u);let c=Gm.computePoolOutputShape(n,i,o,l,a,u,e.autoPad),d=Object.assign({},e);s?Object.assign(d,{kernelShape:a,strides:o,pads:u,dilations:l,cacheKey:e.cacheKey}):Object.assign(d,{kernelShape:a,strides:o,pads:u,cacheKey:e.cacheKey});let h=c.slice();return h.push(h.splice(1,1)[0]),[d,r?h:c]},Q_=(t,e)=>{let n=e.format==="NHWC",r=q.size(t),i=q.size(e.kernelShape),s=[{type:12,data:r},{type:12,data:i}],a=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(e.kernelShape.length<=2){let o=e.kernelShape[e.kernelShape.length-1],l=e.strides[e.strides.length-1],u=e.pads[e.pads.length/2-1],c=e.pads[e.pads.length-1],d=!!(u+c);s.push({type:12,data:o},{type:12,data:l},{type:12,data:u},{type:12,data:c}),a.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let h=!1;if(e.kernelShape.length===2){let m=e.kernelShape[e.kernelShape.length-2],g=e.strides[e.strides.length-2],w=e.pads[e.pads.length/2-2],x=e.pads[e.pads.length-2];h=!!(w+x),s.push({type:12,data:m},{type:12,data:g},{type:12,data:w},{type:12,data:x}),a.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[s,a,!0,d,h]}else{if(n)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let o=q.computeStrides(e.kernelShape);s.push({type:12,data:o},{type:12,data:e.pads},{type:12,data:e.strides}),a.push({name:"kernelStrides",type:"u32",length:o.length},{name:"pads",type:"u32",length:e.pads.length},{name:"strides",type:"u32",length:e.strides.length});let l=e.pads.reduce((u,c)=>u+c);return[s,a,!!l,!1,!1]}},X_=(t,e,n,r,i,s,a,o,l,u,c,d)=>{let h=i.format==="NHWC",m=e.type.value,g=me("output",e.type.tensor,r);if(i.kernelShape.length<=2){let w="",x="",v="",y=n-(h?2:1);if(c?w=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${y}] < 0 || xIndices[${y}]
                      >= uniforms.x_shape[${y}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`:w=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${y}] = indices[${y}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${e.indicesToOffset("xIndices")}];
                  ${s}
                }`,i.kernelShape.length===2){let E=n-(h?3:2);d?x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${E}] < 0 || xIndices[${E}] >= uniforms.x_shape[${E}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:x=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${E}] = indices[${E}] * uniforms.sh - uniforms.phStart + j;
                `,v=`
              }
            `}return`
            ${t.registerUniforms(l).declareVariables(e,g)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${g.offsetToIndices("global_idx")};
              var xIndices = ${g.offsetToIndices("global_idx")};

              var value = ${m}(${o});
              var pad = 0;
              ${x}
              ${w}
              ${v}
              ${a}

              output[global_idx] = value;
            }`}else{if(h)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let w=i.kernelShape.length,x=i.pads.length,v="";return u?v=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${e.indicesToOffset("xIndices")}];
                ${s}
              }`:v=`
              }
              let x_val = x[${e.indicesToOffset("xIndices")}];
              ${s}
            `,`
            ${t.registerUniforms(l).declareVariables(e,g)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${g.offsetToIndices("global_idx")};
              var xIndices = ${g.offsetToIndices("global_idx")};

              var offsets: array<u32, ${w}>;

              var value = ${m}(${o});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${w-1}u; j++) {
                  offsets[j] = offset / ${ye("uniforms.kernelStrides","j",w)};
                  offset -= offsets[j] * ${ye("uniforms.kernelStrides","j",w)};
                }
                offsets[${w-1}] = offset;

                isPad = false;
                for (var j = ${n-w}u; j < ${n}u; j++) {
                  xIndices[j] = indices[j] * ${ye("uniforms.strides",`j - ${n-w}u`,w)}
                    + offsets[j - ${n-w}u] - ${ye("uniforms.pads","j - 2u",x)};
                  ${v}
              }
              ${a}

              output[global_idx] = value;
            }`}},J_=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,PC=t=>`${J_(t)};${t.countIncludePad}`,NC=t=>`${J_(t)};${t.storageOrder};${t.dilations}`,Z_=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),e0=(t,e,n,r)=>{let[i,s]=Y_(e,r,n),a=X("x",e.dataType,e.dims.length),o=a.type.value,l="value += x_val;",u="";i.countIncludePad?u+=`value /= ${o}(uniforms.kernelSize);`:u+=`value /= ${o}(i32(uniforms.kernelSize) - pad);`;let[c,d,h,m,g]=Q_(s,i);c.push(..._e(e.dims,s));let w=["rank"];return{name:t,shaderCache:{hint:`${r.cacheKey};${h};${m};${g}`,inputDependencies:w},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(q.size(s)/64)},programUniforms:c}),getShaderSource:x=>X_(x,a,e.dims.length,s.length,i,l,u,0,d,h,m,g)}},GL=t=>{let e=t.count_include_pad!==0,n=Z_(t);if(n.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let r={countIncludePad:e,...n,cacheKey:""};return{...r,cacheKey:PC(r)}},KL=(t,e)=>{Lc(t.inputs),t.compute(e0("AveragePool",t.inputs[0],!1,e))},t0={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},YL=t=>{let e=t.format;return{format:e,...t0,cacheKey:e}},QL=(t,e)=>{Lc(t.inputs),t.compute(e0("GlobalAveragePool",t.inputs[0],!0,e))},n0=(t,e,n,r)=>{let[i,s]=Y_(e,r,n),a=`
      value = max(x_val, value);
    `,o="",l=X("x",e.dataType,e.dims.length),u=["rank"],[c,d,h,m,g]=Q_(s,i);return c.push(..._e(e.dims,s)),{name:t,shaderCache:{hint:`${r.cacheKey};${h};${m};${g}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:s,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(q.size(s)/64)},programUniforms:c}),getShaderSource:w=>X_(w,l,e.dims.length,s.length,i,a,o,e.dataType===10?-65504:-1e5,d,h,m,g)}},XL=(t,e)=>{Lc(t.inputs),t.compute(n0("MaxPool",t.inputs[0],!1,e))},JL=t=>{let e=t.storage_order,n=t.dilations,r=Z_(t);if(e!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(r.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:e,dilations:n,...r,cacheKey:""};return{...i,cacheKey:NC(i)}},ZL=t=>{let e=t.format;return{format:e,...t0,cacheKey:e}},ez=(t,e)=>{Lc(t.inputs),t.compute(n0("GlobalMaxPool",t.inputs[0],!0,e))}}),OC,DC,tz,nz,hte=se(()=>{ve(),Ee(),It(),Se(),OC=(t,e)=>{if(t.length<2||t.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(t.length===3&&t[1].dims===t[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(t.length===3&&t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[0].dataType===6&&t.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(t[1].dims.length!==0&&t[1].dims.length!==1&&t[1].dims.length!==t[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((n,r)=>n===t[2].dims[r]).reduce((n,r)=>n&&r,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(e.blockSize>0){if(t[1].dims.length===0||t[1].dims.length===1&&t[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((i,s)=>s===e.axis||i===t[0].dims[s]).reduce((i,s)=>i&&s,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let n=t[0].dims[e.axis],r=t[1].dims[e.axis];if(e.blockSize<Math.ceil(n/r)||e.blockSize>Math.ceil(n/(r-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},DC=(t,e)=>{let n=q.normalizeAxis(e.axis,t[0].dims.length),r=t[0].dataType,i=r===3,s=t[0].dims,a=t[1].dataType,o=q.size(s),l=r===3||r===2,u=l?[Math.ceil(q.size(t[0].dims)/4)]:t[0].dims,c=t[1].dims,d=t.length>2?t[2]:void 0,h=d?l?[Math.ceil(q.size(d.dims)/4)]:d.dims:void 0,m=c.length===0||c.length===1&&c[0]===1,g=m===!1&&c.length===1,w=yt(o),x=m&&(!l||w===4),v=x?w:1,y=x&&!l?w:1,E=X("input",l?12:r,u.length,y),$=X("scale",a,c.length),R=d?X("zero_point",l?12:r,h.length):void 0,D=me("output",a,s.length,v),k=[E,$];R&&k.push(R);let _=[u,c];d&&_.push(h);let A=[{type:12,data:o/v},{type:12,data:n},{type:12,data:e.blockSize},..._e(..._,s)],N=L=>{let V=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${L.registerUniforms(V).declareVariables(...k,D)}
      ${L.mainStart()}
          ${L.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${D.offsetToIndices("global_idx")};

          // Set input x
          ${l?`
            let input = ${E.getByOffset("global_idx / 4")};
            let x_vec = ${i?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${v===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${E.getByOffset("global_idx")};`};

          // Set scale input
          ${m?`let scale_value= ${$.getByOffset("0")}`:g?`
            let scale_index = ${D.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${$.getByOffset("scale_index")};`:`
            var scale_indices: ${$.type.indices} = output_indices;
            let index = ${$.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${$.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${$.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${R?m?l?`
                let zero_point_input = ${R.getByOffset("0")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${R.getByOffset("0")}`:g?l?`
                let zero_point_index = ${D.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${R.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${D.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${R.getByOffset("zero_point_index")};`:l?`
                let zero_point_offset = ${$.indicesToOffset("scale_indices")};
                let zero_point_input = ${R.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${R.getByIndices("scale_indices")};`:`let zero_point_value = ${l?i?"i32":"u32":E.type.value}(0);`};
      // Compute and write output
      ${D.setByOffset("global_idx",`${D.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:e.cacheKey,inputDependencies:R?["rank","rank","rank"]:["rank","rank"]},getShaderSource:N,getRunData:()=>({outputs:[{dims:s,dataType:a}],dispatchGroup:{x:Math.ceil(o/v/64),y:1,z:1},programUniforms:A})}},tz=(t,e)=>{OC(t.inputs,e),t.compute(DC(t.inputs,e))},nz=t=>qe({axis:t.axis,blockSize:t.blockSize})}),MC,LC,rz,fte=se(()=>{Sr(),ve(),Se(),MC=(t,e,n)=>{let r=t===e,i=t<e&&n<0,s=t>e&&n>0;if(r||i||s)throw new Error("Range these inputs' contents are invalid.")},LC=(t,e,n,r)=>{let i=Math.abs(Math.ceil((e-t)/n)),s=[i],a=i,o=[{type:12,data:a},{type:r,data:t},{type:r,data:n},..._e(s)],l=u=>{let c=me("output",r,s.length),d=c.type.value,h=[{name:"outputSize",type:"u32"},{name:"start",type:d},{name:"delta",type:d}];return`
        ${u.registerUniforms(h).declareVariables(c)}
        ${u.mainStart()}
        ${u.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${d}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${r}`},getShaderSource:l,getRunData:()=>({outputs:[{dims:s,dataType:r}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:o})}},rz=t=>{let e=0,n=0,r=0;t.inputs[0].dataType===6?(e=t.inputs[0].getInt32Array()[0],n=t.inputs[1].getInt32Array()[0],r=t.inputs[2].getInt32Array()[0]):t.inputs[0].dataType===1&&(e=t.inputs[0].getFloat32Array()[0],n=t.inputs[1].getFloat32Array()[0],r=t.inputs[2].getFloat32Array()[0]),et.webgpu.validateInputContent&&MC(e,n,r),t.compute(LC(e,n,r,t.inputs[0].dataType),{inputs:[]})}}),zC,VC,iz,sz,pte=se(()=>{ve(),Ee(),It(),Se(),zC=(t,e,n,r)=>{if(t!=="none"&&r!=="i32"&&r!=="u32"&&r!=="f32")throw new Error(`Input ${r} is not supported with reduction ${t}.`);let i=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,s=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${e}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${e}=${n};`;case"add":return r==="i32"||r==="u32"?`atomicAdd(&${e}, bitcast<${r}>(${n}));`:`
              ${i}bitcast<${r}>(oldValue) + (${n})${s}`;case"max":return r==="i32"||r==="u32"?`atomicMax(&${e}, bitcast<${r}>(${n}));`:`
                ${i}max(bitcast<f32>(oldValue), (${n}))${s}`;case"min":return r==="i32"||r==="u32"?`atomicMin(&${e}, bitcast<${r}>(${n}));`:`${i}min(bitcast<${r}>(oldValue), (${n}))${s}`;case"mul":return`${i}(bitcast<${r}>(oldValue) * (${n}))${s}`;default:throw new Error(`Reduction ${t} is not supported.`)}},VC=(t,e)=>{let n=t[0].dims,r=t[1].dims,i=n,s=1,a=Math.ceil(q.sizeToDimension(r,r.length-1)/s),o=r[r.length-1],l=q.sizeFromDimension(n,o),u=[{type:12,data:a},{type:12,data:o},{type:12,data:l},..._e(t[1].dims,t[2].dims,i)],c=d=>{let h=X("indices",t[1].dataType,t[1].dims.length),m=X("updates",t[2].dataType,t[2].dims.length,s),g=e.reduction!=="none"&&e.reduction!==""?NM("output",t[0].dataType,i.length):me("output",t[0].dataType,i.length,s);return`
      ${d.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(h,m,g)}
      ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${t[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${zC(e.reduction,"output[data_offset + i]","value",g.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${e.cacheKey}_${e.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:u}),getShaderSource:c}},iz=t=>qe({reduction:t.reduction}),sz=(t,e)=>{t.compute(VC(t.inputs,e),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),FC,BC,UC,r0,jC,WC,HC,qC,GC,KC,YC,QC,i0,XC,JC,ZC,eA,tA,az,oz,mte=se(()=>{ve(),Ee(),It(),Se(),FC=(t,e)=>{if(t.every(n=>n>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),t.length>0){if(e.mode==="linear"){if(!(t.length===2||t.length===3||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1||t.length===5&&t[0]===1&&t[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(e.mode==="cubic"&&!(t.length===2||t.length===4&&t[0]===1&&t[1]===1||t.length===4&&t[0]===1&&t[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},BC=(t,e,n)=>{e.every(i=>i>=0&&i<n||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let r=new Array(n).fill(1);return e.forEach((i,s)=>r[i]=t[s]),r},UC=(t,e,n,r,i,s)=>{let[a,o,l]=n>10?[1,2,3]:[-1,t.length>1?1:-1,-1],u=t[0].dims.length;if(a>0&&t.length>a&&t[a].dims.length>0)t[a].getFloat32Array().forEach(c=>s.push(c));else if(e.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(o>0&&t.length>o&&t[o].dims.length===1&&t[o].dims[0]>0){if(t[o].getFloat32Array().forEach(c=>r.push(c)),r.length!==0&&r.length!==u&&n>=18&&r.length!==e.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");FC(r,e),e.axes.length>0&&BC(r,e.axes,u).forEach((c,d)=>r[d]=c)}if(l>0&&t.length>l&&t[l].dims.length===1&&t[l].dims[0]>0&&(t[l].getBigInt64Array().forEach(c=>i.push(Number(c))),i.length!==0&&i.length!==u&&n>=18&&i.length!==e.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(e.axes.length>0){if(r.length!==0&&r.length!==e.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==0&&i.length!==e.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof r<"u"&&typeof i<"u"&&r.length>0&&i.length>u)throw new Error("Resize requires only of scales or sizes to be specified")},r0=(t,e,n,r)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${e});
  let whole = ${r}(big / (${n}));
  let fract = ${r}(big % (${n})) / ${r}(${n});
  return whole + fract;
`,jC=(t,e)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${e} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${e}(xResized) / ${e}(xScale);
          } else {
            ${r0("xResized","lengthOriginal","lengthResized",e)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${e}(xResized) + 0.5) / ${e}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${e}(xResized) + 0.5) / ${e}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${r0("xResized","lengthOriginal - 1","lengthResized - 1",e)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${e}(roiStart) * ${e}(lengthOriginal - 1) +
                        (${e}(xResized) * ${e}(roiEnd - roiStart) * ${e}(lengthOriginal - 1)) /
                        ${e}(lengthResized - 1);
                  } else {
                    return 0.5 * ${e}(roiStart + roiEnd) * ${e}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${e}xScale * ${e}(lengthResized);
                  const adjustment = ${e}(lengthResized) / outputWidth;
                  const center = ${e}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;case"half_pixel":return`return ((${e}(xResized) + 0.5) / ${e}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",WC=(t,e,n)=>`fn getNearestPixelFromOriginal(xOriginal: ${n}, isDownSample: bool) -> ${n} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(e<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${t} is not supported`)}})()+"}",HC=(t,e,n)=>{let r=new Array(n).fill(0).concat(new Array(n).fill(1)),i=t.length===0?r:t.slice();return e.length>0?(e.forEach((s,a)=>{r[s]=i[a],r[a+n]=i[e.length+a]}),r):i},qC=(t,e,n,r)=>{let i=[];if(n.length>0)if(r.length>0){if(t.forEach(s=>i.push(s)),Math.max(...r)>t.length)throw new Error("axes is out of bound");r.forEach((s,a)=>i[s]=n[a])}else n.forEach(s=>i.push(s));else{if(e.length===0)throw new Error("Resize requires either scales or sizes.");i=t.map((s,a)=>Math.round(s*e[a]))}return i},GC=(t,e,n)=>{let r=(()=>{switch(n.keepAspectRatioPolicy){case"not_larger":return n.axes.length>0?Math.min(...n.axes.map(s=>e[s]),Number.MAX_VALUE):Math.min(...e,Number.MAX_VALUE);case"not_smaller":return n.axes.length>0?Math.max(...n.axes.map(s=>e[s]),Number.MIN_VALUE):Math.max(...e,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${n.keepAspectRatioPolicy} is not supported`)}})();e.fill(1,0,e.length);let i=t.slice();return n.axes.length>0?(n.axes.forEach(s=>e[s]=r),n.axes.forEach(s=>i[s]=Math.round(t[s]*e[s]))):(e.fill(r,0,e.length),i.forEach((s,a)=>i[a]=Math.round(s*e[a]))),i},KC=(t,e,n,r,i)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${n.length}> {
      var original_indices: array<${t.type.value}, ${n.length}>;
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${ye("uniforms.scales","i",r)};
        var roi_low = ${ye("uniforms.roi","i",i)};
        var roi_hi = ${ye("uniforms.roi",`i + ${e.length}`,i)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${ye("uniforms.input_shape","i",e.length)};
          var output_shape_i = ${ye("uniforms.output_shape","i",n.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,YC=(t,e,n,r,i,s,a)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${ye("uniforms.scales","i",i)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${ye("uniforms.roi","i",s)};
          var roi_hi = ${ye("uniforms.roi",`i + ${n.length}`,s)};
          var input_shape_i = ${ye("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${ye("uniforms.output_shape","i",r.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${a} || (original_idx >= 0 && original_idx < ${e.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${e.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,QC=(t,e)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${e.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${ye("uniforms.input_shape","i",e.length)}) {
          return false;
        }
      }
      return true;
    }`,i0=(t,e,n,r)=>t.rank>r?`
    ${t.indicesSet("input_indices",e,"channel")};
    ${t.indicesSet("input_indices",n,"batch")};
`:"",XC=(t,e,n,r,i)=>{let[s,a,o,l]=n.length===2?[-1,0,1,-1]:[0,2,3,1],u=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${u} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",a,`max(0, min(row, ${n[a]} - 1))`)};
      ${t.indicesSet("input_indices",o,`max(0, min(col, ${n[o]} - 1))`)};
      ${i0(t,l,s,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${e.type.indices}) -> ${u} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${u} = originalIndices[${a}];
      var col:${u} = originalIndices[${o}];
      ${r?`if (row < 0 || row > (${n[a]} - 1) || col < 0 || col > (${n[o]} - 1)) {
        return ${i};
      }`:""};
      row = max(0, min(row, ${n[a]} - 1));
      col = max(0, min(col, ${n[o]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${n.length>2?`u32(originalIndices[${l}])`:"0"};
      var batch: u32 =  ${n.length>2?`u32(originalIndices[${s}])`:"0"};
      var x11: ${u} = getInputValue(batch, channel, row1, col1);
      var x12: ${u} = getInputValue(batch, channel, row1, col2);
      var x21: ${u} = getInputValue(batch, channel, row2, col1);
      var x22: ${u} = getInputValue(batch, channel, row2, col2);
      var dx1: ${u} = abs(row - ${u}(row1));
      var dx2: ${u} = abs(${u}(row2) - row);
      var dy1: ${u} = abs(col - ${u}(col1));
      var dy2: ${u} = abs(${u}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},JC=(t,e,n,r,i,s,a,o,l,u)=>{let c=n.length===2,[d,h]=c?[0,1]:[2,3],m=t.type.value,g=w=>{let x=w===d?"row":"col";return`
      fn ${x}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${e.type.indices}) -> ${m} {
        var output_index = ${e.indicesGet("output_indices",w)};
        var originalIdx: ${m} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[w]},
        ${r[w]}, ${n[w]}, ${s[w]}, ${s[w]} + ${n.length});
        var fractOriginalIdx: ${m} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${o} && (originalIdx < 0 || originalIdx > (${n[w]} - 1))) {
          return ${l};
        }
        var data: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${x}: ${m} = originalIdx + ${m}(i);
          if (${x} < 0 || ${x} >= ${n[w]}) {
            ${u?`coefs[i + 1] = 0.0;
                        continue;`:o?`return ${l};`:`${x} = max(0, min(${x}, ${n[w]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",w,`u32(${x})`)};
          data[i + 1] = ${w===d?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${g(d)};
    ${g(h)};
  fn getCubicInterpolationCoefs(s: ${m}) -> array<${m}, 4> {
    var absS = abs(s);
    var coeffs: array<${m}, 4> = array<${m}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${m} = 1.0 - absS;
    var twoMinusAbsS: ${m} = 2.0 - absS;
    var onePlusAbsS: ${m} = 1.0 + absS;
    coeffs[0] = ((${a} * onePlusAbsS - 5 * ${a}) * onePlusAbsS + 8 * ${a}) * onePlusAbsS - 4 * ${a};
    coeffs[1] = ((${a} + 2) * absS - (${a} + 3)) * absS * absS + 1;
    coeffs[2] = ((${a} + 2) * oneMinusAbsS - (${a} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${a} * twoMinusAbsS - 5 * ${a}) * twoMinusAbsS + 8 * ${a}) * twoMinusAbsS - 4 * ${a};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${m}, 4>, coefs: array<${m}, 4>) -> ${m} {
    var coefsSum: ${m} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${e.type.indices}) -> ${m} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},ZC=(t,e,n,r,i)=>{let[s,a,o,l,u]=n.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],c=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${c} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",a,`max(0, min(depth, ${n[a]} - 1))`)};
      ${t.indicesSet("input_indices",o,`max(0, min(height, ${n[o]} - 1))`)};
      ${t.indicesSet("input_indices",l,`max(0, min(width, ${n[l]} - 1))`)};
      ${i0(t,u,s,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${e.type.indices}) -> ${c} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${c} = originalIndices[${a}];
      var height:${c} = originalIndices[${o}];
      var width:${c} = originalIndices[${l}];
      ${r?`if (depth < 0 || depth > (${n[a]} - 1) || height < 0 || height > (${n[o]} - 1) || width < 0 || (width > ${n[l]} - 1)) {
      return ${i};
        }`:""};

    depth = max(0, min(depth, ${n[a]} - 1));
      height = max(0, min(height, ${n[o]} - 1));
      width = max(0, min(width, ${n[l]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${n.length>3?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${n.length>3?`u32(originalIndices[${s}])`:"0"};

      var x111: ${c} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${c} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${c} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${c} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${c} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${c} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${c} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${c} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${c} = abs(depth - ${c}(depth1));
      var dx2: ${c} = abs(${c}(depth2) - depth);
      var dy1: ${c} = abs(height - ${c}(height1));
      var dy2: ${c} = abs(${c}(height2) - height);
      var dz1: ${c} = abs(width - ${c}(width1));
      var dz2: ${c} = abs(${c}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},eA=(t,e,n,r,i,s)=>{let a=t.dims,o=HC(s,e.axes,a.length),l=qC(a,r,i,e.axes),u=r.slice();r.length===0&&(u=a.map((y,E)=>y===0?1:l[E]/y),e.keepAspectRatioPolicy!=="stretch"&&(l=GC(a,u,e)));let c=me("output",t.dataType,l.length),d=X("input",t.dataType,a.length),h=q.size(l),m=a.length===l.length&&a.every((y,E)=>y===l[E]),g=e.coordinateTransformMode==="tf_crop_and_resize",w=e.extrapolationValue,x=d.type.value,v=y=>`
      ${m?"":`
      ${jC(e.coordinateTransformMode,x)};
      ${(()=>{switch(e.mode){case"nearest":return`
              ${QC(d,a)};
              ${WC(e.nearestMode,n,x)};
              ${YC(d,c,a,l,u.length,o.length,g)};
              `;case"linear":return`
              ${KC(c,a,l,u.length,o.length)};
              ${(()=>{if(a.length===2||a.length===4)return`${XC(d,c,a,g,w)}`;if(a.length===3||a.length===5)return`${ZC(d,c,a,g,w)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(a.length===2||a.length===4)return`${JC(d,c,a,l,u,o,e.cubicCoeffA,g,e.extrapolationValue,e.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${y.registerUniform("output_size","u32").registerUniform("scales","f32",u.length).registerUniform("roi","f32",o.length).declareVariables(d,c)}
      ${y.mainStart()}
        ${y.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${m?"output[global_idx] = input[global_idx];":`
        let output_indices = ${c.offsetToIndices("global_idx")};
        var input_indices: ${d.type.indices};
        ${(()=>{switch(e.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${d.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${e.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${a.length===2||a.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${e.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${e.cacheKey}|${n}|${u.length>0?e.mode==="cubic"?u:u.length:""}|${i.length>0?i:""}|${o.length>0?o:""}|${m}|${e.mode==="nearest"?a.length:a}`,inputDependencies:["rank"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:l,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:[{type:12,data:h},{type:1,data:u},{type:1,data:o},..._e(a,l)]})}},tA=t=>{let e=t.customDataBuffer;return new Uint32Array(e,e.byteOffset,1)[0]},az=(t,e)=>{let n=[],r=[],i=[],s=tA(t);if(e.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");UC(t.inputs,e,s,n,r,i),t.compute(eA(t.inputs[0],e,s,n,r,i),{inputs:[0]})},oz=t=>{let e=t.antialias,n=t.axes,r=t.coordinateTransformMode,i=t.cubicCoeffA,s=t.excludeOutside!==0,a=t.extrapolationValue,o=t.keepAspectRatioPolicy,l=t.mode,u=t.nearestMode===""?"simple":t.nearestMode;return qe({antialias:e,axes:n,coordinateTransformMode:r,cubicCoeffA:i,excludeOutside:s,extrapolationValue:a,keepAspectRatioPolicy:o,mode:l,nearestMode:u})}}),nA,rA,lz,gte=se(()=>{ve(),Ee(),Se(),nA=t=>{if(!t||t.length<3)throw new Error("layerNorm requires at least 3 inputs.");let e=t[0],n=t[1],r=t[2];if(e.dataType!==n.dataType||e.dataType!==r.dataType)throw new Error("All inputs must have the same data type");if(e.dims.length!==3&&e.dims.length!==2)throw new Error("Input must be 2D or 3D");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Skip must be 2D or 3D");let i=e.dims[e.dims.length-1],s=e.dims[e.dims.length-2];if(n.dims[n.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(n.dims[n.dims.length-2]!==s)throw new Error("Skip must have the same sequence length as input");if(r.dims.length!==1)throw new Error("Gamma must be 1D");if(r.dims[r.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(t.length>3){let a=t[3];if(a.dims.length!==1)throw new Error("Beta must be 1D");if(a.dims[a.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(t.length>4){let a=t[4];if(a.dims.length!==1)throw new Error("Bias must be 1D");if(a.dims[a.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},rA=(t,e,n,r)=>{let i=e.simplified,s=t[0].dims,a=q.size(s),o=s,l=a,u=s.slice(-1)[0],c=r?s.slice(0,-1).concat(1):[],d=!i&&t.length>3,h=t.length>4,m=r&&n>1,g=r&&n>2,w=n>3,x=64,v=yt(u),y=[{type:12,data:l},{type:12,data:v},{type:12,data:u},{type:1,data:e.epsilon}],E=R=>{let D=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],k=[X("x",t[0].dataType,t[0].dims,v),X("skip",t[1].dataType,t[1].dims,v),X("gamma",t[2].dataType,t[2].dims,v)];d&&k.push(X("beta",t[3].dataType,t[3].dims,v)),h&&k.push(X("bias",t[4].dataType,t[4].dims,v)),k.push(me("output",t[0].dataType,o,v)),m&&k.push(me("mean_output",1,c)),g&&k.push(me("inv_std_output",1,c)),w&&k.push(me("input_skip_bias_sum",t[0].dataType,o,v));let _=Yt(t[0].dataType),A=Yt(1,v);return`

      ${R.registerUniforms(D).declareVariables(...k)}
      var<workgroup> sum_shared : array<${A}, ${x}>;
      var<workgroup> sum_squared_shared : array<${A}, ${x}>;

      ${R.mainStart([x,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${x};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${x};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${x-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${h?"bias[offset1d + i]":_+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${w?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${ql(_,v,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${x};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Ra("sum",v)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Ra("square_sum",v)} / f32(uniforms.hidden_size) ${i?"":"- mean * mean"} + uniforms.epsilon);
        ${m?"mean_output[global_idx] = mean;":""}
        ${g?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${i?"":`- ${_}(mean)`}) *
            ${_}(inv_std_dev) * gamma[offset1d + i]
            ${d?"+ beta[offset1d + i]":""};
        }
      }`},$=[{dims:o,dataType:t[0].dataType}];return n>1&&$.push({dims:c,dataType:1}),n>2&&$.push({dims:c,dataType:1}),n>3&&$.push({dims:s,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${v};${m};${g};${w}`,inputDependencies:t.map((R,D)=>"type")},getShaderSource:E,getRunData:()=>({outputs:$,dispatchGroup:{x:Math.ceil(l/u)},programUniforms:y})}},lz=(t,e)=>{nA(t.inputs);let n=[0];t.outputCount>1&&n.push(-3),t.outputCount>2&&n.push(-3),t.outputCount>3&&n.push(3),t.compute(rA(t.inputs,e,t.outputCount,!1),{outputs:n})}}),iA,zc,sA,s0,aA,oA,uz,cz,yte=se(()=>{ve(),Ee(),It(),Se(),iA=(t,e)=>{if(!t||t.length<1)throw new Error("too few inputs");if(e.axes.length!==0){if(e.axes.length!==e.starts.length||e.axes.length!==e.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(e.starts.length!==e.ends.length)throw new Error("starts and ends must have the same length");t.slice(1).forEach((n,r)=>{if(t[r+1].dataType!==6&&t[r+1].dataType!==7)throw new Error(`Input ${r} must be an array of int32 or int64`)})},zc=(t,e)=>{let n=[];if(t.length>e)if(t[e].dataType===7)t[e].getBigInt64Array().forEach(r=>n.push(Number(r)));else if(t[e].dataType===6)t[e].getInt32Array().forEach(r=>n.push(Number(r)));else throw new Error(`Input ${e} must be an array of int32 or int64`);return n},sA=(t,e)=>{if(t.length>1){let n=zc(t,1),r=zc(t,2),i=zc(t,3);return i.length===0&&(i=[...Array(t[0].dims.length).keys()]),qe({starts:n,ends:r,axes:i})}else return e},s0=(t,e,n,r,i)=>{let s=t;return t<0&&(s+=n[r[e]]),i[e]<0?Math.max(0,Math.min(s,n[r[e]]-1)):Math.max(0,Math.min(s,n[r[e]]))},aA=(t,e,n)=>`fn calculateInputIndices(output_indices: ${e.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${n.length-1}; i >= 0; i--) {
            let input_shape_i = ${ye("uniforms.input_shape","i",n.length)};
            let steps_i = ${ye("uniforms.steps","i",n.length)};
            let signs_i = ${ye("uniforms.signs","i",n.length)};
            let starts_i = ${ye("uniforms.starts","i",n.length)};
            var output_index = ${e.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,oA=(t,e)=>{let n=t[0].dims,r=q.size(n),i=e.axes.length>0?q.normalizeAxes(e.axes,n.length):[...Array(n.length).keys()],s=zc(t,4);s.forEach(v=>v!==0||(()=>{throw new Error("step cannot be 0")})),s.length===0&&(s=Array(i.length).fill(1));let a=e.starts.map((v,y)=>s0(v,y,n,i,s)),o=e.ends.map((v,y)=>s0(v,y,n,i,s));if(i.length!==a.length||i.length!==o.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==n.length)for(let v=0;v<n.length;++v)i.includes(v)||(a.splice(v,0,0),o.splice(v,0,n[v]),s.splice(v,0,1));let l=s.map(v=>Math.sign(v));s.forEach((v,y,E)=>{if(v<0){let $=(o[y]-a[y])/v,R=a[y],D=R+$*s[y];a[y]=D,o[y]=R,E[y]=-v}});let u=n.slice(0);i.forEach((v,y)=>{u[v]=Math.ceil((o[v]-a[v])/s[v])});let c={dims:u,dataType:t[0].dataType},d=me("output",t[0].dataType,u.length),h=X("input",t[0].dataType,t[0].dims.length),m=q.size(u),g=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:a.length},{name:"signs",type:"i32",length:l.length},{name:"steps",type:"u32",length:s.length}],w=[{type:12,data:m},{type:12,data:a},{type:6,data:l},{type:12,data:s},..._e(t[0].dims,u)],x=v=>`
      ${v.registerUniforms(g).declareVariables(h,d)}
        ${aA(h,d,n)}
        ${v.mainStart()}
          ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${d.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${d.setByOffset("global_idx",h.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${l.length}_${a.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:x,getRunData:()=>({outputs:[c],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:w})}},uz=(t,e)=>{iA(t.inputs,e);let n=sA(t.inputs,e);t.compute(oA(t.inputs,n),{inputs:[0]})},cz=t=>{let e=t.starts,n=t.ends,r=t.axes;return qe({starts:e,ends:n,axes:r})}}),lA,uA,dz,hz,_te=se(()=>{ve(),Ee(),It(),Fa(),Se(),lA=t=>{if(!t||t.length!==1)throw new Error("Softmax op requires 1 input.")},uA=(t,e)=>{let n=t.inputs[0],r=n.dims,i=q.size(r),s=r.length,a=q.normalizeAxis(e.axis,s),o=a<r.length-1,l,u=[];o?(u=Array.from({length:s},(k,_)=>_),u[a]=s-1,u[s-1]=a,l=t.compute(ar(n,u),{inputs:[n],outputs:[-1]})[0]):l=n;let c=l.dims,d=c[s-1],h=i/d,m=yt(d),g=d/m,w=64;h===1&&(w=256);let x=(k,_)=>_===4?`max(max(${k}.x, ${k}.y), max(${k}.z, ${k}.w))`:_===2?`max(${k}.x, ${k}.y)`:_===3?`max(max(${k}.x, ${k}.y), ${k}.z)`:k,v=X("x",l.dataType,l.dims,m),y=me("result",l.dataType,l.dims,m),E=v.type.value,$=Yt(l.dataType)==="f32"?`var threadMax = ${E}(-3.4028234663852886e+38f);`:`var threadMax = ${E}(-65504.0h);`,R=k=>`
      var<workgroup> rowMaxShared : ${E};
      var<workgroup> rowSumShared : ${E};
      var<workgroup> threadShared : array<${E}, ${w}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${E} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${E}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${k.registerUniform("packedCols","i32").declareVariables(v,y)}
      ${k.mainStart(w)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${w};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${$}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${E}(${x("threadShared[0]",m)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${E}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${E}(${Ra("threadShared[0]",m)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${E}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,D=t.compute({name:"Softmax",shaderCache:{hint:`${m};${w}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:c,dataType:l.dataType}],dispatchGroup:{x:h},programUniforms:[{type:6,data:g}]}),getShaderSource:R},{inputs:[l],outputs:[o?-1:0]})[0];o&&t.compute(ar(D,u),{inputs:[D]})},dz=(t,e)=>{lA(t.inputs),uA(t,e)},hz=t=>qe({axis:t.axis})}),a0,cA,dA,hA,fz,wte=se(()=>{ve(),Ee(),Se(),a0=t=>Array.from(t.getBigInt64Array(),Number),cA=t=>{if(!t||t.length!==2)throw new Error("Tile requires 2 inputs.");if(t[0].dataType!==1&&t[0].dataType!==10&&t[0].dataType!==6&&t[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(t[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(t[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(a0(t[1]).length!==t[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},dA=(t,e)=>{let n=[];for(let r=0;r<t.length;++r)n.push(t[r]*e[r]);return n},hA=(t,e)=>{let n=t[0].dims,r=e??a0(t[1]),i=dA(n,r),s=q.size(i),a=t[0].dataType,o=X("input",a,n.length),l=me("output",a,i.length),u=c=>`
      const inputShape = ${o.indices(...n)};
      ${c.registerUniform("output_size","u32").declareVariables(o,l)}
      ${c.mainStart()}
      ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${l.offsetToIndices("global_idx")};
      var input_indices: ${o.type.indices};
      for (var i = 0; i < ${n.length}; i++) {
        let input_dim_i = ${o.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${l.indicesGet("output_indices","i")}  % input_dim_i;

        ${o.indicesSet("input_indices","i","input_dim_value")}
      }
      ${l.setByOffset("global_idx",o.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},..._e(t[0].dims,i)]}),getShaderSource:u}},fz=t=>{cA(t.inputs),t.compute(hA(t.inputs),{inputs:[0]})}}),fA,pA,pz,vte=se(()=>{ve(),Ee(),Se(),fA=(t,e,n,r,i)=>{let s=me("output_data",i,n.length,4),a=X("a_data",e[1].dataType,e[1].dims.length,4),o=X("b_data",e[2].dataType,e[2].dims.length,4),l=X("c_data",e[0].dataType,e[0].dims.length,4),u,c=(d,h,m)=>`select(${h}, ${d}, ${m})`;if(!r)u=s.setByOffset("global_idx",c(a.getByOffset("global_idx"),o.getByOffset("global_idx"),l.getByOffset("global_idx")));else{let d=(h,m,g="")=>{let w=`a_data[index_a${m}][component_a${m}]`,x=`b_data[index_b${m}][component_b${m}]`,v=`bool(c_data[index_c${m}] & (0xffu << (component_c${m} * 8)))`;return`
            let output_indices${m} = ${s.offsetToIndices(`global_idx * 4u + ${m}u`)};
            let offset_a${m} = ${a.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let offset_b${m} = ${o.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let offset_c${m} = ${l.broadcastedIndicesToOffset(`output_indices${m}`,s)};
            let index_a${m} = offset_a${m} / 4u;
            let index_b${m} = offset_b${m} / 4u;
            let index_c${m} = offset_c${m} / 4u;
            let component_a${m} = offset_a${m} % 4u;
            let component_b${m} = offset_b${m} % 4u;
            let component_c${m} = offset_c${m} % 4u;
            ${h}[${m}] = ${g}(${c(w,x,v)});
          `};i===9?u=`
            var data = vec4<u32>(0);
            ${d("data",0,"u32")}
            ${d("data",1,"u32")}
            ${d("data",2,"u32")}
            ${d("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:u=`
            ${d("output_data[global_idx]",0)}
            ${d("output_data[global_idx]",1)}
            ${d("output_data[global_idx]",2)}
            ${d("output_data[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(l,a,o,s)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${u}
      }`},pA=t=>{let e=t[1].dims,n=t[2].dims,r=t[0].dims,i=t[1].dataType,s=!(q.areEqual(e,n)&&q.areEqual(n,r)),a=e,o=q.size(e);if(s){let u=Su.calcShape(Su.calcShape(e,n,!1),r,!1);if(!u)throw new Error("Can't perform where op on the given tensors");a=u,o=q.size(a)}let l=Math.ceil(o/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:u=>fA(u,t,a,s,i),getRunData:()=>({outputs:[{dims:a,dataType:i}],dispatchGroup:{x:Math.ceil(o/64/4)},programUniforms:[{type:12,data:l},..._e(r,e,n,a)]})}},pz=t=>{t.compute(pA(t.inputs))}}),mz,bte=se(()=>{Dee(),Jx(),Mee(),Lee(),zee(),Vee(),Fee(),Hee(),Gee(),Kee(),Yee(),Qee(),Xee(),Jee(),Zee(),ete(),tte(),nte(),rte(),ite(),ste(),ate(),ote(),lte(),ute(),OL(),cte(),dte(),hte(),fte(),pte(),Xx(),mte(),VL(),gte(),yte(),_te(),LL(),wte(),Fa(),Zx(),vte(),mz=new Map([["Abs",[l4]],["Acos",[u4]],["Acosh",[c4]],["Add",[W4]],["ArgMax",[i4,av]],["ArgMin",[r4,av]],["Asin",[d4]],["Asinh",[h4]],["Atan",[f4]],["Atanh",[p4]],["Attention",[s4]],["AveragePool",[KL,GL]],["BatchNormalization",[a4]],["BiasAdd",[o4]],["BiasSplitGelu",[j4]],["Cast",[g4,m4]],["Ceil",[_4]],["Clip",[y4]],["Concat",[eL,tL]],["Conv",[hv,dv]],["ConvTranspose",[dL,cL]],["Cos",[w4]],["Cosh",[v4]],["CumSum",[hL,fL]],["DepthToSpace",[pL,mL]],["DequantizeLinear",[tz,nz]],["Div",[H4]],["Einsum",[gL,yL]],["Elu",[b4,td]],["Equal",[q4]],["Erf",[x4]],["Exp",[T4]],["Expand",[_L]],["FastGelu",[wL]],["Floor",[E4]],["FusedConv",[hv,dv]],["Gather",[bL,vL]],["GatherElements",[kL,IL]],["GatherBlockQuantized",[EL,SL]],["GatherND",[xL,TL]],["Gelu",[S4]],["Gemm",[CL,$L]],["GlobalAveragePool",[QL,YL]],["GlobalMaxPool",[ez,ZL]],["Greater",[Q4]],["GreaterOrEqual",[J4]],["GridSample",[AL,RL]],["GroupQueryAttention",[FL]],["HardSigmoid",[N4,P4]],["InstanceNormalization",[BL]],["LayerNormalization",[UL]],["LeakyRelu",[I4,td]],["Less",[X4]],["LessOrEqual",[Z4]],["Log",[B4]],["MatMul",[jL]],["MatMulNBits",[WL,HL]],["MaxPool",[XL,JL]],["Mul",[G4]],["MultiHeadAttention",[NL,PL]],["Neg",[$4]],["Not",[k4]],["Pad",[qL]],["Pow",[K4]],["QuickGelu",[U4,td]],["Range",[rz]],["Reciprocal",[C4]],["ReduceMin",[JM]],["ReduceMean",[GM]],["ReduceMax",[XM]],["ReduceSum",[e4]],["ReduceProd",[ZM]],["ReduceL1",[KM]],["ReduceL2",[YM]],["ReduceLogSum",[n4]],["ReduceLogSumExp",[QM]],["ReduceSumSquare",[t4]],["Relu",[A4]],["Resize",[az,oz]],["RotaryEmbedding",[zL]],["ScatterND",[sz,iz]],["Sigmoid",[R4]],["Sin",[O4]],["Sinh",[D4]],["Slice",[uz,cz]],["SkipLayerNormalization",[lz]],["Split",[DL,ML]],["Sqrt",[M4]],["Softmax",[dz,hz]],["Sub",[Y4]],["Tan",[L4]],["Tanh",[z4]],["ThresholdedRelu",[F4,td]],["Tile",[fz]],["Transpose",[DM,MM]],["Where",[pz]]])}),gz,xte=se(()=>{Sr(),xs(),Se(),gz=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,e){this.repo.set(t,e)}run(t,e,n,r,i){zi(t.programInfo.name);let s=this.backend.device,a=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let o=[];for(let u of e)o.push({binding:o.length,resource:{buffer:u.buffer}});for(let u of n)o.push({binding:o.length,resource:{buffer:u.buffer}});i&&o.push({binding:o.length,resource:i});let l=s.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:o,label:t.programInfo.name});if(this.backend.sessionStatus==="capturing"){let u={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:l,dispatchGroup:r};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(u)}a.setPipeline(t.computePipeline),a.setBindGroup(0,l),a.dispatchWorkgroups(...r),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Yr(t.programInfo.name)}dispose(){}build(t,e){zi(t.name);let n=this.backend.device,r=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(u=>{n.features.has(u.feature)&&r.push(`enable ${u.extension};`)});let i=OM(e,this.backend.device.limits),s=t.getShaderSource(i),a=`${r.join(`
`)}
${i.additionalImplementations}
${s}`,o=n.createShaderModule({code:a,label:t.name});De("verbose",()=>`[WebGPU] ${t.name} shader code: ${a}`);let l=n.createComputePipeline({compute:{module:o,entryPoint:"main"},layout:"auto",label:t.name});return Yr(t.name),{programInfo:t,computePipeline:l,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(t){let e=typeof t=="number"?t:t.x,n=typeof t=="number"?1:t.y||1,r=typeof t=="number"?1:t.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(e<=i&&n<=i&&r<=i)return[e,n,r];let s=e*n*r,a=Math.ceil(Math.sqrt(s));if(a>i){if(a=Math.ceil(Math.cbrt(s)),a>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[a,a,a]}else return[a,a,1]}}}),yz={};Uu(yz,{WebGpuBackend:()=>_z});var mA,gA,yA,_z,Tte=se(()=>{Sr(),ve(),xs(),CM(),Nee(),bte(),xte(),mA=(t,e)=>{if(e.length!==t.length)throw new Error(`inputDependencies length ${e.length} is not equal to inputTensors length ${t.length}.`);let n=[];for(let r=0;r<t.length;++r){let i=t[r].dataType;switch(e[r]){case"none":{n.push("");break}case"type":{n.push(`${i}`);break}case"rank":{let s=t[r].dims.length;n.push(`${i};${s}`);break}case"dims":{let s=t[r].dims.join(",");n.push(`${i};${s}`);break}default:throw new Error(`unsupported input dependency: ${e[r]}`)}}return n.join("|")},gA=(t,e,n)=>{var i,s;let r=t.name;return(i=t.shaderCache)!=null&&i.hint&&(r+="["+t.shaderCache.hint+"]"),r+=":"+n+`:${mA(e,((s=t.shaderCache)==null?void 0:s.inputDependencies)??new Array(e.length).fill("dims"))}`,r},yA=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},_z=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,e){this.env=t;let n=[],r={requiredLimits:{maxComputeWorkgroupStorageSize:e.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:e.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:e.limits.maxStorageBufferBindingSize,maxBufferSize:e.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:e.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:e.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:e.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:e.limits.maxComputeWorkgroupSizeZ},requiredFeatures:n},i=s=>e.features.has(s)&&n.push(s)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups"),this.device=await e.requestDevice(r),this.adapterInfo=new yA(e.info||await e.requestAdapterInfo()),this.gpuDataManager=PM(this),this.programManager=new gz(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Gx(t.logLevel,!!t.debug),this.device.onuncapturederror=s=>{s.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${s.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),e={};this.queryType==="at-passes"&&(e.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=t.beginComputePass(e)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;zi(),this.endComputePass();let t;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),t=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&t.mapAsync(GPUMapMode.READ).then(()=>{var r;let e=new BigUint64Array(t.getMappedRange()),n=this.pendingQueries.get(t);for(let i=0;i<e.length/2;i++){let s=n[i],a=s.kernelId,o=this.kernels.get(a),l=o.kernelType,u=o.kernelName,c=s.programName,d=s.inputTensorViews,h=s.outputTensorViews,m=e[i*2],g=e[i*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=m);let w=Number(m-this.queryTimeBase),x=Number(g-this.queryTimeBase);if(!Number.isSafeInteger(w)||!Number.isSafeInteger(x))throw new RangeError("incorrect timestamp range");if((r=this.env.webgpu.profiling)!=null&&r.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:d.map(v=>({dims:v.dims,dataType:is(v.dataType)})),outputsMetadata:h.map(v=>({dims:v.dims,dataType:is(v.dataType)})),kernelId:a,kernelType:l,kernelName:u,programName:c,startTime:w,endTime:x});else{let v="";d.forEach((E,$)=>{v+=`input[${$}]: [${E.dims}] | ${is(E.dataType)}, `});let y="";h.forEach((E,$)=>{y+=`output[${$}]: [${E.dims}] | ${is(E.dataType)}, `}),console.log(`[profiling] kernel "${a}|${l}|${u}|${c}" ${v}${y}start time: ${w} ns, execution time: ${x-w} ns`)}Wm("GPU",`${c}::${m}::${g}`)}t.unmap(),this.pendingQueries.delete(t)}),Yr()}run(t,e,n,r,i,s){zi(t.name);let a=[];for(let y=0;y<e.length;++y){let E=e[y].data;if(E===0)continue;let $=this.gpuDataManager.get(E);if(!$)throw new Error(`no GPU data for input: ${E}`);a.push($)}let{outputs:o,dispatchGroup:l,programUniforms:u}=t.getRunData(e),c=n.length===0?o.map((y,E)=>E):n;if(c.length!==o.length)throw new Error(`Output size ${c.length} must be equal to ${o.length}.`);let d=[],h=[];for(let y=0;y<o.length;++y){if(!Number.isInteger(c[y])||c[y]<-3||c[y]>=s)throw new Error(`Invalid output index: ${c[y]}`);if(c[y]===-3)continue;let E=c[y]===-1,$=c[y]===-2,R=E||$?i(o[y].dataType,o[y].dims):r(c[y],o[y].dataType,o[y].dims);if(d.push(R),R.data===0)continue;let D=this.gpuDataManager.get(R.data);if(!D)throw new Error(`no GPU data for output: ${R.data}`);if(E&&this.temporaryData.push(D),$){let k=this.kernelPersistentData.get(this.currentKernelId);k||(k=[],this.kernelPersistentData.set(this.currentKernelId,k)),k.push(D)}h.push(D)}if(a.length!==e.length||h.length!==d.length){if(h.length===0)return Yr(t.name),d;throw new Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let m;if(u){let y=0,E=[];u.forEach(k=>{let _=typeof k.data=="number"?[k.data]:k.data;if(_.length===0)return;let A=k.type===10?2:4,N,L;k.type===10?(L=_.length>4?16:_.length>2?8:_.length*A,N=_.length>4?16:A*_.length):(L=_.length<=2?_.length*A:16,N=16),y=Math.ceil(y/L)*L,E.push(y);let V=k.type===10?8:4;y+=_.length>4?Math.ceil(_.length/V)*N:_.length*A});let $=16;y=Math.ceil(y/$)*$;let R=new ArrayBuffer(y);u.forEach((k,_)=>{let A=E[_],N=typeof k.data=="number"?[k.data]:k.data;if(k.type===6)new Int32Array(R,A,N.length).set(N);else if(k.type===12)new Uint32Array(R,A,N.length).set(N);else if(k.type===10)new Uint16Array(R,A,N.length).set(N);else if(k.type===1)new Float32Array(R,A,N.length).set(N);else throw new Error(`Unsupported uniform type: ${is(k.type)}`)});let D=this.gpuDataManager.create(y,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(D.buffer,0,R,0,y),this.gpuDataManager.release(D.id),m={offset:0,size:y,buffer:D.buffer}}let g=this.programManager.normalizeDispatchGroupSize(l),w=g[1]===1&&g[2]===1,x=gA(t,e,w),v=this.programManager.getArtifact(x);if(v||(v=this.programManager.build(t,g),this.programManager.setArtifact(x,v),De("info",()=>`[artifact] key: ${x}, programName: ${t.name}`)),u&&v.uniformVariablesInfo){if(u.length!==v.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${v.uniformVariablesInfo.length}, got ${u.length} in program "${v.programInfo.name}".`);for(let y=0;y<u.length;y++){let E=u[y],$=E.type,R=typeof E.data=="number"?1:E.data.length,[D,k]=v.uniformVariablesInfo[y];if($!==D||R!==k)throw new Error(`Uniform variable ${y} mismatch: expect type ${D} with size ${k}, got type ${$} with size ${R} in program "${v.programInfo.name}".`)}}if(De("info",()=>`[ProgramManager] run "${t.name}" (key=${x}) with ${g[0]}x${g[1]}x${g[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let y={kernelId:this.currentKernelId,programName:v.programInfo.name,inputTensorViews:e,outputTensorViews:d};this.pendingKernels.push(y),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(y)}return this.programManager.run(v,a,h,g,m),Yr(t.name),d}upload(t,e){this.gpuDataManager.upload(t,e)}memcpy(t,e){this.gpuDataManager.memcpy(t,e)}async download(t,e){await this.gpuDataManager.download(t,e)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,e,n,r){let i=mz.get(t);if(!i)throw new Error(`kernel not implemented: ${t}`);let s={kernelType:t,kernelName:r,kernelEntry:i[0],attributes:[i[1],n]};this.kernels.set(e,s)}releaseKernel(t){let e=this.kernelPersistentData.get(t);if(e){for(let n of e)this.gpuDataManager.release(n.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,e,n){let r=this.kernels.get(t);if(!r)throw new Error(`kernel not created: ${t}`);let i=r.kernelType,s=r.kernelName,a=r.kernelEntry,o=r.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${i}] ${s}" is not allowed to be called recursively`);this.currentKernelId=t,o[0]&&(o[1]=o[0](o[1]),o[0]=void 0),De("info",()=>`[WebGPU] Start to run kernel "[${i}] ${s}"...`);let l=this.env.debug;this.temporaryData=[];try{return l&&this.device.pushErrorScope("validation"),a(e,o[1]),0}catch(u){return n.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${s}" failed. ${u}`)),1}finally{l&&n.push(this.device.popErrorScope().then(u=>u?`GPU validation error for kernel "[${i}] ${s}": ${u.message}`:null));for(let u of this.temporaryData)this.gpuDataManager.release(u.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,e,n,r){let i=this.sessionExternalDataMapping.get(t);i||(i=new Map,this.sessionExternalDataMapping.set(t,i));let s=i.get(e),a=this.gpuDataManager.registerExternalBuffer(n,r,s);return i.set(e,[a,n]),a}unregisterBuffers(t){let e=this.sessionExternalDataMapping.get(t);e&&(e.forEach(n=>this.gpuDataManager.unregisterExternalBuffer(n[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let e=this.gpuDataManager.get(t);if(!e)throw new Error(`no GPU data for buffer: ${t}`);return e.buffer}createDownloader(t,e,n){return async()=>{let r=await rv(this,t,e);return Kx(r.buffer,n)}}writeTimestamp(t){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){var t;this.queryType="none",(((t=this.env.webgpu.profiling)==null?void 0:t.mode)==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){De("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){De("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){De("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),e=this.capturedPendingKernels.get(this.currentSessionId),n=t.length;this.pendingKernels=[];for(let r=0;r<n;r++){let i=this.getComputePassEncoder(),s=t[r];this.writeTimestamp(this.pendingDispatchNumber*2),i.setPipeline(s.computePipeline),i.setBindGroup(0,s.bindGroup),i.dispatchWorkgroups(...s.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(e[r]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),wz={};Uu(wz,{init:()=>vz});var cp,_A,vz,Ete=se(()=>{ve(),xs(),Ee(),Pee(),cp=class bz{constructor(e,n,r,i){this.module=e,this.dataType=n,this.data=r,this.dims=i}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let e=q.size(this.dims);return e===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,e)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let e=q.size(this.dims);return e===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,e)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let e=q.size(this.dims);return e===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,e)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let e=q.size(this.dims);return e===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,e)}reshape(e){if(q.size(e)!==q.size(this.dims))throw new Error("Invalid new shape");return new bz(this.module,this.dataType,this.data,e)}},_A=class{constructor(t,e,n){this.module=t,this.backend=e,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=e.adapterInfo;let r=t.PTR_SIZE,i=n/t.PTR_SIZE,s=r===4?"i32":"i64";this.opKernelContext=Number(t.getValue(r*i++,s));let a=Number(t.getValue(r*i++,s));this.outputCount=Number(t.getValue(r*i++,s)),this.customDataOffset=Number(t.getValue(r*i++,"*")),this.customDataSize=Number(t.getValue(r*i++,s));let o=[];for(let l=0;l<a;l++){let u=Number(t.getValue(r*i++,s)),c=Number(t.getValue(r*i++,"*")),d=Number(t.getValue(r*i++,s)),h=[];for(let m=0;m<d;m++)h.push(Number(t.getValue(r*i++,s)));o.push(new cp(t,u,c,h))}this.inputs=o}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,e){var a;let n=((a=e==null?void 0:e.inputs)==null?void 0:a.map(o=>typeof o=="number"?this.inputs[o]:o))??this.inputs,r=(e==null?void 0:e.outputs)??[],i=(o,l,u)=>new cp(this.module,l,this.output(o,u),u),s=(o,l)=>{let u=go(o,l);if(!u)throw new Error(`Unsupported data type: ${o}`);let c=u>0?this.backend.gpuDataManager.create(u).id:0;return new cp(this.module,o,c,l)};return this.backend.run(t,n,r,i,s,this.outputCount)}output(t,e){let n=this.module.stackSave();try{let r=this.module.PTR_SIZE,i=r===4?"i32":"i64",s=this.module.stackAlloc((1+e.length)*r);this.module.setValue(s,e.length,i);for(let a=0;a<e.length;a++)this.module.setValue(s+r*(a+1),e[a],i);return this.module._JsepOutput(this.opKernelContext,t,s)}catch(r){throw new Error(`Failed to generate kernel's output[${t}] with dims [${e}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${r}`)}finally{this.module.stackRestore(n)}}},vz=async(t,e,n,r)=>{let i=e.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(t==="webgpu"){let s=(Tte(),dh(yz)).WebGpuBackend,a=new s;await a.initialize(n,r),i("webgpu",[a,o=>a.alloc(Number(o)),o=>a.free(o),(o,l,u,c=!1)=>{if(c)De("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(o)}, dst=${Number(l)}, size=${Number(u)}`),a.memcpy(Number(o),Number(l));else{De("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(o)}, gpuDataId=${Number(l)}, size=${Number(u)}`);let d=e.HEAPU8.subarray(Number(o>>>0),Number(o>>>0)+Number(u));a.upload(Number(l),d)}},async(o,l,u)=>{De("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${o}, dataOffset=${l}, size=${u}`),await a.download(Number(o),()=>e.HEAPU8.subarray(Number(l)>>>0,Number(l+u)>>>0))},(o,l,u)=>a.createKernel(o,Number(l),u,e.UTF8ToString(e._JsepGetNodeName(Number(l)))),o=>a.releaseKernel(o),(o,l,u,c)=>{De("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${u}, kernel=${o}, contextDataOffset=${l}`);let d=new _A(e,a,Number(l));return a.computeKernel(Number(o),d,c)},()=>a.captureBegin(),()=>a.captureEnd(),()=>a.replay()])}else{let s=new RM(n);i("webnn",[s,()=>s.reserveTensorId(),a=>s.releaseTensorId(a),async(a,o,l,u,c)=>s.ensureTensor(a,o,l,u,c),(a,o)=>{s.uploadTensor(a,o)},async(a,o)=>s.downloadTensor(a,o),(a,o)=>s.registerMLContext(a,o),!!n.trace])}}}),wA,s1,a1,Vs,vA,o0,Xm,o1,l1,l0,u1,c1,d1,xz=se(()=>{Sr(),Cee(),Aee(),ve(),tl(),jx(),SM(),wA=(t,e)=>{st()._OrtInit(t,e)!==0&&Ge("Can't initialize onnxruntime.")},s1=async t=>{wA(t.wasm.numThreads,qm(t.logLevel))},a1=async(t,e)=>{var r,i;(i=(r=st()).asyncInit)==null||i.call(r);let n=t.webgpu.adapter;if(e==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(n){if(typeof n.limits!="object"||typeof n.features!="object"||typeof n.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let s=t.webgpu.powerPreference;if(s!==void 0&&s!=="low-power"&&s!=="high-performance")throw new Error(`Invalid powerPreference setting: "${s}"`);let a=t.webgpu.forceFallbackAdapter;if(a!==void 0&&typeof a!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${a}"`);if(n=await navigator.gpu.requestAdapter({powerPreference:s,forceFallbackAdapter:a}),!n)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(e==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let s=(Ete(),dh(wz)).init;e==="webgpu"&&await s("webgpu",st(),t,n),e==="webnn"&&await s("webnn",st(),t)}},Vs=new Map,vA=t=>{let e=st(),n=e.stackSave();try{let r=e.PTR_SIZE,i=e.stackAlloc(2*r);e._OrtGetInputOutputCount(t,i,i+r)!==0&&Ge("Can't get session input/output count.");let s=r===4?"i32":"i64";return[Number(e.getValue(i,s)),Number(e.getValue(i+r,s))]}finally{e.stackRestore(n)}},o0=(t,e)=>{let n=st(),r=n.stackSave(),i=0;try{let s=n.PTR_SIZE,a=n.stackAlloc(2*s);n._OrtGetInputOutputMetadata(t,e,a,a+s)!==0&&Ge("Can't get session input/output metadata.");let o=Number(n.getValue(a,"*"));i=Number(n.getValue(a+s,"*"));let l=n.HEAP32[i/4];if(l===0)return[o,0];let u=n.HEAPU32[i/4+1],c=[];for(let d=0;d<u;d++){let h=Number(n.getValue(i+8+d*s,"*"));c.push(h!==0?n.UTF8ToString(h):Number(n.getValue(i+8+(d+u)*s,"*")))}return[o,l,c]}finally{n.stackRestore(r),i!==0&&n._OrtFree(i)}},Xm=t=>{let e=st(),n=e._malloc(t.byteLength);if(n===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return e.HEAPU8.set(t,n),[n,t.byteLength]},o1=async(t,e)=>{var d,h,m,g;let n,r,i=st();Array.isArray(t)?[n,r]=t:t.buffer===i.HEAPU8.buffer?[n,r]=[t.byteOffset,t.byteLength]:[n,r]=Xm(t);let s=0,a=0,o=0,l=[],u=[],c=[];try{if([a,l]=await EM(e),(e==null?void 0:e.externalData)&&i.mountExternalData){let _=[];for(let A of e.externalData){let N=typeof A=="string"?A:A.path;_.push(qx(typeof A=="string"?A:A.data).then(L=>{i.mountExternalData(N,L)}))}await Promise.all(_)}for(let _ of(e==null?void 0:e.executionProviders)??[])if((typeof _=="string"?_:_.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof _!="string"){let A=_,N=A==null?void 0:A.context,L=A==null?void 0:A.gpuDevice,V=A==null?void 0:A.deviceType,M=A==null?void 0:A.powerPreference;N?i.currentContext=N:L?i.currentContext=await i.webnnCreateMLContext(L):i.currentContext=await i.webnnCreateMLContext({deviceType:V,powerPreference:M})}else i.currentContext=await i.webnnCreateMLContext();break}s=await i._OrtCreateSession(n,r,a),(d=i.webgpuOnCreateSession)==null||d.call(i,s),s===0&&Ge("Can't create a session."),(h=i.jsepOnCreateSession)==null||h.call(i),i.currentContext&&(i.webnnRegisterMLContext(s,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[w,x]=vA(s),v=!!(e!=null&&e.enableGraphCapture),y=[],E=[],$=[],R=[],D=[];for(let _=0;_<w;_++){let[A,N,L]=o0(s,_);A===0&&Ge("Can't get an input name."),u.push(A);let V=i.UTF8ToString(A);y.push(V),$.push(N===0?{name:V,isTensor:!1}:{name:V,isTensor:!0,type:is(N),shape:L})}for(let _=0;_<x;_++){let[A,N,L]=o0(s,_+w);A===0&&Ge("Can't get an output name."),c.push(A);let V=i.UTF8ToString(A);E.push(V),R.push(N===0?{name:V,isTensor:!1}:{name:V,isTensor:!0,type:is(N),shape:L});{if(v&&(e==null?void 0:e.preferredOutputLocation)===void 0){D.push("gpu-buffer");continue}let M=typeof(e==null?void 0:e.preferredOutputLocation)=="string"?e.preferredOutputLocation:((m=e==null?void 0:e.preferredOutputLocation)==null?void 0:m[V])??"cpu",B=i.webnnIsGraphOutput;if(M==="cpu"&&B&&B(s,V)){D.push("ml-tensor-cpu-output");continue}if(M!=="cpu"&&M!=="cpu-pinned"&&M!=="gpu-buffer"&&M!=="ml-tensor")throw new Error(`Not supported preferred output location: ${M}.`);if(v&&M!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${M}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);D.push(M)}}let k=null;return D.some(_=>_==="gpu-buffer"||_==="ml-tensor"||_==="ml-tensor-cpu-output")&&(o=i._OrtCreateBinding(s),o===0&&Ge("Can't create IO binding."),k={handle:o,outputPreferredLocations:D,outputPreferredLocationsEncoded:D.map(_=>_==="ml-tensor-cpu-output"?"ml-tensor":_).map(_=>tv(_))}),Vs.set(s,[s,u,c,k,v,!1]),[s,y,E,$,R]}catch(w){throw u.forEach(x=>i._OrtFree(x)),c.forEach(x=>i._OrtFree(x)),o!==0&&i._OrtReleaseBinding(o)!==0&&Ge("Can't release IO binding."),s!==0&&i._OrtReleaseSession(s)!==0&&Ge("Can't release session."),w}finally{i._free(n),a!==0&&i._OrtReleaseSessionOptions(a)!==0&&Ge("Can't release session options."),l.forEach(w=>i._free(w)),(g=i.unmountExternalData)==null||g.call(i)}},l1=t=>{var l,u,c;let e=st(),n=Vs.get(t);if(!n)throw new Error(`cannot release session. invalid session id: ${t}`);let[r,i,s,a,o]=n;a&&(o&&e._OrtClearBoundOutputs(a.handle)!==0&&Ge("Can't clear bound outputs."),e._OrtReleaseBinding(a.handle)!==0&&Ge("Can't release IO binding.")),(l=e.jsepOnReleaseSession)==null||l.call(e,t),(u=e.webnnOnReleaseSession)==null||u.call(e,t),(c=e.webgpuOnReleaseSession)==null||c.call(e,t),i.forEach(d=>e._OrtFree(d)),s.forEach(d=>e._OrtFree(d)),e._OrtReleaseSession(r)!==0&&Ge("Can't release session."),Vs.delete(t)},l0=async(t,e,n,r,i,s,a=!1)=>{if(!t){e.push(0);return}let o=st(),l=o.PTR_SIZE,u=t[0],c=t[1],d=t[3],h=d,m,g;if(u==="string"&&(d==="gpu-buffer"||d==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(a&&d!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${s} when enableGraphCapture is true.`);if(d==="gpu-buffer"){let v=t[2].gpuBuffer;g=go(mo(u),c);{let y=o.jsepRegisterBuffer;if(!y)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');m=y(r,s,v,g)}}else if(d==="ml-tensor"){let v=t[2].mlTensor;g=go(mo(u),c);let y=o.webnnRegisterMLTensor;if(!y)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');m=y(r,v,mo(u),c)}else{let v=t[2];if(Array.isArray(v)){g=l*v.length,m=o._malloc(g),n.push(m);for(let y=0;y<v.length;y++){if(typeof v[y]!="string")throw new TypeError(`tensor data at index ${y} is not a string`);o.setValue(m+y*l,Br(v[y],n),"*")}}else{let y=o.webnnIsGraphInput,E=o.webnnIsGraphOutput;if(u!=="string"&&y&&E){let $=o.UTF8ToString(i);if(y(r,$)||E(r,$)){let R=mo(u);g=go(R,c),h="ml-tensor";let D=o.webnnCreateTemporaryTensor,k=o.webnnUploadTensor;if(!D||!k)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let _=await D(r,R,c);k(_,new Uint8Array(v.buffer,v.byteOffset,v.byteLength)),m=_}else g=v.byteLength,m=o._malloc(g),n.push(m),o.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,g),m)}else g=v.byteLength,m=o._malloc(g),n.push(m),o.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,g),m)}}let w=o.stackSave(),x=o.stackAlloc(4*c.length);try{c.forEach((y,E)=>o.setValue(x+E*l,y,l===4?"i32":"i64"));let v=o._OrtCreateTensor(mo(u),m,g,x,c.length,tv(h));v===0&&Ge(`Can't create tensor for input/output. session=${r}, index=${s}.`),e.push(v)}finally{o.stackRestore(w)}},u1=async(t,e,n,r,i,s)=>{var V,M,B,Z;let a=st(),o=a.PTR_SIZE,l=Vs.get(t);if(!l)throw new Error(`cannot run inference. invalid session id: ${t}`);let u=l[0],c=l[1],d=l[2],h=l[3],m=l[4],g=l[5],w=e.length,x=r.length,v=0,y=[],E=[],$=[],R=[],D=[],k=a.stackSave(),_=a.stackAlloc(w*o),A=a.stackAlloc(w*o),N=a.stackAlloc(x*o),L=a.stackAlloc(x*o);try{[v,y]=TM(s),ko("wasm prepareInputOutputTensor");for(let Y=0;Y<w;Y++)await l0(n[Y],E,R,t,c[e[Y]],e[Y],m);for(let Y=0;Y<x;Y++)await l0(i[Y],$,R,t,d[r[Y]],w+r[Y],m);$o("wasm prepareInputOutputTensor");for(let Y=0;Y<w;Y++)a.setValue(_+Y*o,E[Y],"*"),a.setValue(A+Y*o,c[e[Y]],"*");for(let Y=0;Y<x;Y++)a.setValue(N+Y*o,$[Y],"*"),a.setValue(L+Y*o,d[r[Y]],"*");if(h&&!g){let{handle:Y,outputPreferredLocations:J,outputPreferredLocationsEncoded:G}=h;if(c.length!==w)throw new Error(`input count from feeds (${w}) is expected to be always equal to model's input count (${c.length}).`);ko("wasm bindInputsOutputs");for(let H=0;H<w;H++){let oe=e[H];await a._OrtBindInput(Y,c[oe],E[H])!==0&&Ge(`Can't bind input[${H}] for session=${t}.`)}for(let H=0;H<x;H++){let oe=r[H];(V=i[H])!=null&&V[3]?(D.push($[H]),a._OrtBindOutput(Y,d[oe],$[H],0)!==0&&Ge(`Can't bind pre-allocated output[${H}] for session=${t}.`)):a._OrtBindOutput(Y,d[oe],0,G[oe])!==0&&Ge(`Can't bind output[${H}] to ${J[H]} for session=${t}.`)}$o("wasm bindInputsOutputs"),Vs.set(t,[u,c,d,h,m,!0])}(M=a.jsepOnRunStart)==null||M.call(a,u),(B=a.webnnOnRunStart)==null||B.call(a,u);let ie;h?ie=await a._OrtRunWithBinding(u,h.handle,x,N,v):ie=await a._OrtRun(u,A,_,w,L,x,N,v),ie!==0&&Ge("failed to call OrtRun().");let de=[],ee=[];ko("wasm ProcessOutputTensor");for(let Y=0;Y<x;Y++){let J=Number(a.getValue(N+Y*o,"*"));if(J===$[Y]||D.includes($[Y])){de.push(i[Y]),J!==$[Y]&&a._OrtReleaseTensor(J)!==0&&Ge("Can't release tensor.");continue}let G=a.stackSave(),H=a.stackAlloc(4*o),oe=!1,ue,Ne=0;try{a._OrtGetTensorData(J,H,H+o,H+2*o,H+3*o)!==0&&Ge(`Can't access output tensor data on index ${Y}.`);let rt=o===4?"i32":"i64",rn=Number(a.getValue(H,rt));Ne=a.getValue(H+o,"*");let Ui=a.getValue(H+o*2,"*"),Ba=Number(a.getValue(H+o*3,rt)),En=[];for(let Ke=0;Ke<Ba;Ke++)En.push(Number(a.getValue(Ui+Ke*o,rt)));a._OrtFree(Ui)!==0&&Ge("Can't free memory for tensor dims.");let hn=En.reduce((Ke,be)=>Ke*be,1);ue=is(rn);let Ir=h==null?void 0:h.outputPreferredLocations[r[Y]];if(ue==="string"){if(Ir==="gpu-buffer"||Ir==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Ke=[];for(let be=0;be<hn;be++){let Sn=a.getValue(Ne+be*o,"*"),Ts=a.getValue(Ne+(be+1)*o,"*"),ji=be===hn-1?void 0:Ts-Sn;Ke.push(a.UTF8ToString(Sn,ji))}de.push([ue,En,Ke,"cpu"])}else if(Ir==="gpu-buffer"&&hn>0){let Ke=a.jsepGetBuffer;if(!Ke)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let be=Ke(Ne),Sn=go(rn,hn);if(Sn===void 0||!Wx(ue))throw new Error(`Unsupported data type: ${ue}`);oe=!0,de.push([ue,En,{gpuBuffer:be,download:a.jsepCreateDownloader(be,Sn,ue),dispose:()=>{a._OrtReleaseTensor(J)!==0&&Ge("Can't release tensor.")}},"gpu-buffer"])}else if(Ir==="ml-tensor"&&hn>0){let Ke=a.webnnEnsureTensor,be=a.webnnIsGraphInputOutputTypeSupported;if(!Ke||!be)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(go(rn,hn)===void 0||!Hx(ue))throw new Error(`Unsupported data type: ${ue}`);if(!be(t,ue,!1))throw new Error(`preferredLocation "ml-tensor" for ${ue} output is not supported by current WebNN Context.`);let Sn=await Ke(t,Ne,rn,En,!1);oe=!0,de.push([ue,En,{mlTensor:Sn,download:a.webnnCreateMLTensorDownloader(Ne,ue),dispose:()=>{a.webnnReleaseTensorId(Ne),a._OrtReleaseTensor(J)}},"ml-tensor"])}else if(Ir==="ml-tensor-cpu-output"&&hn>0){let Ke=a.webnnCreateMLTensorDownloader(Ne,ue)(),be=de.length;oe=!0,ee.push((async()=>{let Sn=[be,await Ke];return a.webnnReleaseTensorId(Ne),a._OrtReleaseTensor(J),Sn})()),de.push([ue,En,[],"cpu"])}else{let Ke=qg(ue),be=new Ke(hn);new Uint8Array(be.buffer,be.byteOffset,be.byteLength).set(a.HEAPU8.subarray(Ne,Ne+be.byteLength)),de.push([ue,En,be,"cpu"])}}finally{a.stackRestore(G),ue==="string"&&Ne&&a._free(Ne),oe||a._OrtReleaseTensor(J)}}h&&!m&&(a._OrtClearBoundOutputs(h.handle)!==0&&Ge("Can't clear bound outputs."),Vs.set(t,[u,c,d,h,m,!1]));for(let[Y,J]of await Promise.all(ee))de[Y][2]=J;return $o("wasm ProcessOutputTensor"),de}finally{(Z=a.webnnOnRunEnd)==null||Z.call(a,u),a.stackRestore(k),E.forEach(ie=>a._OrtReleaseTensor(ie)),$.forEach(ie=>a._OrtReleaseTensor(ie)),R.forEach(ie=>a._free(ie)),v!==0&&a._OrtReleaseRunOptions(v),y.forEach(ie=>a._free(ie))}},c1=t=>{let e=st(),n=Vs.get(t);if(!n)throw new Error("invalid session id");let r=n[0],i=e._OrtEndProfiling(r);i===0&&Ge("Can't get an profile file name."),e._OrtFree(i)},d1=t=>{let e=[];for(let n of t){let r=n[2];!Array.isArray(r)&&"buffer"in r&&e.push(r.buffer)}return e}}),Fs,Fn,Sl,Vc,Fc,dp,u0,hp,so,ao,bA,Tz,Ez,Sz,Iz,kz,$z,Cz,Az=se(()=>{Sr(),xz(),tl(),Bx(),Fs=()=>!!et.wasm.proxy&&typeof document<"u",Sl=!1,Vc=!1,Fc=!1,hp=new Map,so=(t,e)=>{let n=hp.get(t);n?n.push(e):hp.set(t,[e])},ao=()=>{if(Sl||!Vc||Fc||!Fn)throw new Error("worker not ready")},bA=t=>{switch(t.data.type){case"init-wasm":Sl=!1,t.data.err?(Fc=!0,u0[1](t.data.err)):(Vc=!0,u0[0]()),dp&&(URL.revokeObjectURL(dp),dp=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let e=hp.get(t.data.type);t.data.err?e.shift()[1](t.data.err):e.shift()[0](t.data.out);break}}},Tz=async()=>{if(!Vc){if(Sl)throw new Error("multiple calls to 'initWasm()' detected.");if(Fc)throw new Error("previous call to 'initWasm()' failed.");if(Sl=!0,Fs())return new Promise((t,e)=>{Fn==null||Fn.terminate(),bM().then(([n,r])=>{try{Fn=r,Fn.onerror=s=>e(s),Fn.onmessage=bA,u0=[t,e];let i={type:"init-wasm",in:et};!i.in.wasm.wasmPaths&&(n||ev)&&(i.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.jsep-6MnTkKum.wasm",import.meta.url).href}),Fn.postMessage(i),dp=n}catch(i){e(i)}},e)});try{await Ux(et.wasm),await s1(et),Vc=!0}catch(t){throw Fc=!0,t}finally{Sl=!1}}},Ez=async t=>{if(Fs())return ao(),new Promise((e,n)=>{so("init-ep",[e,n]);let r={type:"init-ep",in:{epName:t,env:et}};Fn.postMessage(r)});await a1(et,t)},Sz=async t=>Fs()?(ao(),new Promise((e,n)=>{so("copy-from",[e,n]);let r={type:"copy-from",in:{buffer:t}};Fn.postMessage(r,[t.buffer])})):Xm(t),Iz=async(t,e)=>{if(Fs()){if(e!=null&&e.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return ao(),new Promise((n,r)=>{so("create",[n,r]);let i={type:"create",in:{model:t,options:{...e}}},s=[];t instanceof Uint8Array&&s.push(t.buffer),Fn.postMessage(i,s)})}else return o1(t,e)},kz=async t=>{if(Fs())return ao(),new Promise((e,n)=>{so("release",[e,n]);let r={type:"release",in:t};Fn.postMessage(r)});l1(t)},$z=async(t,e,n,r,i,s)=>{if(Fs()){if(n.some(a=>a[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(a=>a))throw new Error("pre-allocated output tensor is not supported for proxy.");return ao(),new Promise((a,o)=>{so("run",[a,o]);let l=n,u={type:"run",in:{sessionId:t,inputIndices:e,inputs:l,outputIndices:r,options:s}};Fn.postMessage(u,d1(l))})}else return u1(t,e,n,r,i,s)},Cz=async t=>{if(Fs())return ao(),new Promise((e,n)=>{so("end-profiling",[e,n]);let r={type:"end-profiling",in:t};Fn.postMessage(r)});c1(t)}}),c0,xA,Rz,Ste=se(()=>{Sr(),Az(),ve(),Fx(),SM(),c0=(t,e)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${t.location} for ${e()}`)}},xA=t=>{switch(t[3]){case"cpu":return new yr(t[0],t[2],t[1]);case"gpu-buffer":{let e=t[0];if(!Wx(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:n,download:r,dispose:i}=t[2];return yr.fromGpuBuffer(n,{dataType:e,dims:t[1],download:r,dispose:i})}case"ml-tensor":{let e=t[0];if(!Hx(e))throw new Error(`not supported data type: ${e} for deserializing MLTensor tensor`);let{mlTensor:n,download:r,dispose:i}=t[2];return yr.fromMLTensor(n,{dataType:e,dims:t[1],download:r,dispose:i})}default:throw new Error(`invalid data location: ${t[3]}`)}},Rz=class{async fetchModelAndCopyToWasmMemory(t){return Sz(await qx(t))}async loadModel(t,e){zi();let n;typeof t=="string"?n=await this.fetchModelAndCopyToWasmMemory(t):n=t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Iz(n,e),Yr()}async dispose(){return kz(this.sessionId)}async run(t,e,n){zi();let r=[],i=[];Object.entries(t).forEach(d=>{let h=d[0],m=d[1],g=this.inputNames.indexOf(h);if(g===-1)throw new Error(`invalid input '${h}'`);r.push(m),i.push(g)});let s=[],a=[];Object.entries(e).forEach(d=>{let h=d[0],m=d[1],g=this.outputNames.indexOf(h);if(g===-1)throw new Error(`invalid output '${h}'`);s.push(m),a.push(g)});let o=r.map((d,h)=>c0(d,()=>`input "${this.inputNames[i[h]]}"`)),l=s.map((d,h)=>d?c0(d,()=>`output "${this.outputNames[a[h]]}"`):null),u=await $z(this.sessionId,i,o,a,l,n),c={};for(let d=0;d<u.length;d++)c[this.outputNames[a[d]]]=s[d]??xA(u[d]);return Yr(),c}startProfiling(){}endProfiling(){Cz(this.sessionId)}}}),Pz={};Uu(Pz,{OnnxruntimeWebAssemblyBackend:()=>mv,initializeFlags:()=>pv,wasmBackend:()=>Nz});var pv,mv,Nz,Ite=se(()=>{Sr(),Az(),Ste(),pv=()=>{(typeof et.wasm.initTimeout!="number"||et.wasm.initTimeout<0)&&(et.wasm.initTimeout=0);let t=et.wasm.simd;if(typeof t!="boolean"&&t!==void 0&&t!=="fixed"&&t!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),et.wasm.simd=!1),typeof et.wasm.proxy!="boolean"&&(et.wasm.proxy=!1),typeof et.wasm.trace!="boolean"&&(et.wasm.trace=!1),typeof et.wasm.numThreads!="number"||!Number.isInteger(et.wasm.numThreads)||et.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)et.wasm.numThreads=1;else{let e=typeof navigator>"u"?dee("node:os").cpus().length:navigator.hardwareConcurrency;et.wasm.numThreads=Math.min(4,Math.ceil((e||1)/2))}},mv=class{async init(t){pv(),await Tz(),await Ez(t)}async createInferenceSessionHandler(t,e){let n=new Rz;return await n.loadModel(t,e),n}},Nz=new mv});Sr();Sr();Sr();var kte="1.24.1";{let t=(Ite(),dh(Pz)).wasmBackend;Hl("webgpu",t,5),Hl("webnn",t,5),Hl("cpu",t,10),Hl("wasm",t,10)}Object.defineProperty(et.versions,"web",{value:kte,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te=[void 0,"/models/raft-small.onnx","https://huggingface.co/onnx-community/raft-small/resolve/main/raft-small.onnx","https://huggingface.co/onnx-community/raft-small/resolve/main/raft-small.onnx?download=1","https://cdn.jsdelivr.net/gh/huggingface/onnx-community@main/raft-small/raft-small.onnx"].filter(Boolean),Cte="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.24.1/dist/";et.wasm.wasmPaths=Cte;const Ate=1;et.wasm.numThreads=Math.max(1,Ate);et.wasm.simd=!0;let d0=null;const Rte=async()=>{let t;for(const e of $te)try{const n=await Vx.create(e,{executionProviders:["wasm"],graphOptimizationLevel:"all",executionMode:"parallel",enableMemPattern:!0,enableCpuMemArena:!0});return console.info("[RAFT] loaded model from",e),n}catch(n){console.warn("[RAFT] failed to load",e,n),t=n}throw t||new Error("RAFT model load failed. Provide VITE_RAFT_MODEL_URL or place raft-small.onnx in public/models")},gv=(t,e)=>{if(!t.length)return 0;const n=[...t].sort((i,s)=>i-s),r=Math.min(n.length-1,Math.max(0,Math.floor(e*(n.length-1))));return n[r]},TA=t=>{const{data:e,width:n,height:r}=t,i=n*r,s=new Float32Array(3*i);for(let a=0;a<i;a++){const o=a*4,l=e[o]/255,u=e[o+1]/255,c=e[o+2]/255;s[a]=l,s[i+a]=u,s[2*i+a]=c}return new yr("float32",s,[1,3,r,n])},Pte=(t,e)=>{const[,,n,r]=t.dims,i=new Float32Array(t.data.length+e.data.length);return i.set(t.data,0),i.set(e.data,t.data.length),new yr("float32",i,[1,6,n,r])},Oz=async()=>(d0||(d0=Rte()),d0),Nte=async(t,e)=>{const n=await Oz(),r=TA(t),i=TA(e),s={};n.inputNames.length>=2?(s[n.inputNames[0]]=r,s[n.inputNames[1]]=i):s[n.inputNames[0]]=Pte(r,i);const a=n.outputNames[0];return(await n.run(s))[a]},Ote=t=>{const e=t.dims,n=e[e.length-2],r=e[e.length-1],i=n*r,s=t.data,a=Math.max(1,Math.floor(r/32)),o=[];for(let l=0;l<n;l+=a)for(let u=0;u<r;u+=a){const c=l*r+u,d=s[c],h=s[i+c];o.push(Math.hypot(d,h))}return{median:gv(o,.5),p90:gv(o,.9),max:o.length?Math.max(...o):0}},Dte=(t,e,n=6)=>{if(!e)return;const r=e.getContext("2d");if(!r)return;const i=t.dims,s=i[i.length-2],a=i[i.length-1],o=s*a,l=t.data;r.clearRect(0,0,e.width,e.height);const u=Math.max(1,Math.floor(a/28));for(let c=0;c<s;c+=u)for(let d=0;d<a;d+=u){const h=c*a+d,m=l[h],g=l[o+h],w=Math.hypot(m,g);if(w<.01)continue;const x=d/a*e.width,v=c/s*e.height,y=x+m*n,E=v+g*n;r.strokeStyle=w>1.5?"rgba(244, 63, 94, 0.85)":"rgba(56, 189, 248, 0.9)",r.lineWidth=w>1.5?2:1.25,r.beginPath(),r.moveTo(x,v),r.lineTo(y,E),r.stroke()}},Mte=t=>new Promise((e,n)=>{const r=()=>{t.removeEventListener("seeked",r),clearTimeout(s),e()},i=()=>{t.removeEventListener("seeked",r),clearTimeout(s),n(new Error("Video seek timeout"))};t.addEventListener("seeked",r,{once:!0});const s=window.setTimeout(i,4e3)}),Lte=t=>new Promise(e=>{if(!Number.isNaN(t.duration)&&t.duration>0){e();return}const n=()=>{t.removeEventListener("loadedmetadata",n),e()};t.addEventListener("loadedmetadata",n,{once:!0})}),zte=async t=>{const{video:e,overlay:n,metersPerPixel:r=.01,fpsHint:i=24,sampleEveryMs:s=120,maxPairs:a=24,targetWidth:o=384}=t;if(!e)throw new Error("Video element not available");await Lte(e),await Oz();const l=Math.max(1,Math.round((e.videoHeight||720)*(o/(e.videoWidth||1280)))),u=document.createElement("canvas");u.width=o,u.height=l;const c=u.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("Canvas context unavailable");if(n){n.width=n.clientWidth||n.width,n.height=n.clientHeight||n.height;const D=n.getContext("2d");D==null||D.clearRect(0,0,n.width,n.height)}const d=e.currentTime,h=e.paused;e.pause();const m=Math.max(s/1e3,1/Math.max(1,i)),g=Number.isFinite(e.duration)&&e.duration>0?e.duration:m*(a+2),w=async D=>(e.currentTime=Math.min(g,D),await Mte(e),c.drawImage(e,0,0,o,l),c.getImageData(0,0,o,l));let x=null,v=0;const y=[],E=[];for(let D=0;D<a+1;D++){const k=Math.min(g,D*m),_=await w(k);if(x){const A=Math.max(1/Math.max(1,i),k-v),N=await Nte(x,_),{p90:L}=Ote(N),V=L*r/A;y.push(V),E.push(A),Dte(N,n,6)}x=_,v=k}if(!h)try{await e.play()}catch{}e.currentTime=d;const $=y.length?y.reduce((D,k)=>D+k,0)/y.length:0,R=E.length?E.reduce((D,k)=>D+k,0)/E.length:0;return{velocities:y,average:$,p95:gv(y,.95),max:y.length?Math.max(...y):0,framesUsed:y.length,dtStats:{mean:R,min:E.length?Math.min(...E):0,max:E.length?Math.max(...E):0}}},Vte=()=>{const[t,e]=j.useState([]),[n,r]=j.useState(!1),[i,s]=j.useState(null),[a,o]=j.useState(""),[l,u]=j.useState(""),[c,d]=j.useState(!1),[h,m]=j.useState(!1),[g,w]=j.useState(null),[x,v]=j.useState("0.01"),[y,E]=j.useState("30"),[$,R]=j.useState("120"),D=j.useRef(null),k=j.useRef(null),_=async()=>{try{const M=(await UI.list()).data.data||[];e(M),s(M[0]||null)}catch(V){console.error(V)}};j.useEffect(()=>{_()},[]),j.useEffect(()=>{const V=k.current,M=D.current;if(!V||!M)return;const B=()=>{V.width=M.clientWidth||M.videoWidth,V.height=M.clientHeight||M.videoHeight;const ie=V.getContext("2d");ie==null||ie.clearRect(0,0,V.width,V.height)};B();const Z=()=>B();return window.addEventListener("resize",Z),()=>{window.removeEventListener("resize",Z)}},[i]);const A=async V=>{var M,B;o(""),u(""),r(!0);try{await UI.upload(V);const Z=Math.min(6,Math.max(.3,V.size/1e6));await Id.velocity(Z,"video-upload"),await _(),u("Uploaded and analyzed. Check alerts/notifications if thresholds were hit.")}catch(Z){o((Z==null?void 0:Z.message)||((B=(M=Z==null?void 0:Z.response)==null?void 0:M.data)==null?void 0:B.message)||"Upload failed")}finally{r(!1)}},N=async()=>{var V,M;if(!i||!D.current){o("Select a video first.");return}m(!0),o(""),u("");try{const B=await zte({video:D.current,overlay:k.current,metersPerPixel:Number(x)||.01,fpsHint:Number(y)||24,sampleEveryMs:Number($)||120,maxPairs:28,targetWidth:416});w(B);const Z=B.p95||B.average||0;Z>0&&await Id.velocity(Number(Z.toFixed(3)),"raft-onnx"),u(`RAFT-small flow velocity ~${Z.toFixed(2)} m/s (p95). Alerts updated.`)}catch(B){const Z=(B==null?void 0:B.message)||((M=(V=B==null?void 0:B.response)==null?void 0:V.data)==null?void 0:M.message);Z!=null&&Z.toString().includes("model load")?o("RAFT model missing/blocked. Set VITE_RAFT_MODEL_URL or place raft-small.onnx (+ .onnx_data) in public/models."):o(Z||"RAFT analysis failed")}finally{m(!1)}},L=async()=>{var V,M;if(i){d(!0),o("");try{const B=Math.max(.1,Math.random()*4.5);await Id.velocity(B,"neuromorphic-camera-demo")}catch(B){o(((M=(V=B==null?void 0:B.response)==null?void 0:V.data)==null?void 0:M.message)||"Inference failed")}finally{d(!1)}}};return P.jsxs("div",{className:"space-y-6",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Live Feed"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Manage video inputs and playback"})]}),P.jsx("span",{className:"text-xs text-slate-400",children:"// TODO: Camera stream integration"})]}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsx("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-black aspect-video overflow-hidden",children:i?P.jsxs("div",{className:"relative w-full h-full",children:[P.jsx("video",{ref:D,src:i.url,controls:!0,className:"w-full h-full object-contain bg-black"}),P.jsx("canvas",{ref:k,className:"absolute inset-0 pointer-events-none mix-blend-screen"})]}):P.jsx("div",{className:"h-full flex items-center justify-center text-slate-200",children:"No video selected"})}),P.jsxs("div",{className:"space-y-4",children:[P.jsx(Mx,{label:n?"Uploading...":"Upload video (mp4/avi)",accept:"video/mp4,video/x-msvideo,video/avi",onChange:A}),a&&P.jsx("p",{className:"text-sm text-rose-600",children:a}),l&&P.jsx("p",{className:"text-sm text-emerald-600",children:l}),P.jsx("button",{disabled:!i||c,onClick:L,className:"w-full rounded-md border-2 border-slate-900 bg-amber-200 text-slate-900 py-2 text-sm font-semibold hover:shadow-[4px_4px_0_#0f172a] disabled:opacity-50",children:c?"Estimating...":"Estimate velocity (neuromorphic demo)"}),P.jsxs("div",{className:"space-y-2 rounded-lg border border-slate-200 bg-white p-3 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-700",children:[P.jsx("span",{className:"font-semibold text-slate-900",children:"RAFT-small (ONNX) analysis"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Optical flow"})]}),P.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[P.jsxs("label",{className:"space-y-1",children:[P.jsx("span",{className:"block text-slate-500",children:"Meters/pixel"}),P.jsx("input",{value:x,onChange:V=>v(V.target.value),className:"w-full rounded-md border border-slate-200 px-2 py-1",type:"number",step:"0.0001"})]}),P.jsxs("label",{className:"space-y-1",children:[P.jsx("span",{className:"block text-slate-500",children:"FPS hint"}),P.jsx("input",{value:y,onChange:V=>E(V.target.value),className:"w-full rounded-md border border-slate-200 px-2 py-1",type:"number",step:"1"})]}),P.jsxs("label",{className:"space-y-1",children:[P.jsx("span",{className:"block text-slate-500",children:"Sample ms"}),P.jsx("input",{value:$,onChange:V=>R(V.target.value),className:"w-full rounded-md border border-slate-200 px-2 py-1",type:"number",step:"10"})]})]}),P.jsx("button",{disabled:!i||h,onClick:N,className:"w-full rounded-md border-2 border-slate-900 bg-sky-200 text-slate-900 py-2 text-sm font-semibold hover:shadow-[4px_4px_0_#0f172a] disabled:opacity-50",children:h?"Analyzing with RAFT":"Analyze with RAFT-small (ONNX)"}),g&&P.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-slate-700",children:[P.jsxs("div",{className:"rounded-md bg-slate-50 border border-slate-200 p-2",children:[P.jsx("div",{className:"text-slate-500",children:"p95 velocity"}),P.jsxs("div",{className:"text-lg font-semibold text-slate-900",children:[g.p95.toFixed(2)," m/s"]})]}),P.jsxs("div",{className:"rounded-md bg-slate-50 border border-slate-200 p-2",children:[P.jsx("div",{className:"text-slate-500",children:"Mean / Max"}),P.jsxs("div",{className:"text-lg font-semibold text-slate-900",children:[g.average.toFixed(2)," / ",g.max.toFixed(2)," m/s"]})]}),P.jsxs("div",{className:"rounded-md bg-slate-50 border border-slate-200 p-2",children:[P.jsx("div",{className:"text-slate-500",children:"Samples"}),P.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:[g.framesUsed," pairs"]})]}),P.jsxs("div",{className:"rounded-md bg-slate-50 border border-slate-200 p-2",children:[P.jsx("div",{className:"text-slate-500",children:"t mean"}),P.jsxs("div",{className:"text-sm font-semibold text-slate-900",children:[(g.dtStats.mean*1e3).toFixed(0)," ms"]})]})]})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white divide-y divide-slate-100",children:[t.map(V=>P.jsxs("button",{className:`w-full text-left px-4 py-3 text-sm hover:bg-slate-50 ${(i==null?void 0:i.id)===V.id?"bg-slate-100":""}`,onClick:()=>{s(V),w(null)},children:[P.jsx("div",{className:"font-medium text-slate-900",children:V.name}),P.jsx("div",{className:"text-xs text-slate-500",children:new Date(V.createdAt).toLocaleString()})]},V.id)),t.length===0&&P.jsx("p",{className:"p-4 text-sm text-slate-500",children:"No uploads yet"})]})]})]})]})},Fte=()=>{const[t,e]=j.useState([]),[n,r]=j.useState("0"),[i,s]=j.useState("sensor"),[a,o]=j.useState(""),[l,u]=j.useState("0.0"),[c,d]=j.useState("0.0"),[h,m]=j.useState(""),g=async()=>{try{const v=await Jw.list();e(v.data.data||[])}catch(v){console.error(v)}};j.useEffect(()=>{g()},[]);const w=async v=>{var E,$;v.preventDefault(),o("");const y=Number(n);if(Number.isNaN(y)){o("Velocity must be numeric");return}try{await Jw.create(y,i),r("0"),await g()}catch(R){o((($=(E=R==null?void 0:R.response)==null?void 0:E.data)==null?void 0:$.message)||"Failed to record")}},x=async v=>{var $,R;v.preventDefault(),m("");const y=Number(l),E=Number(c);if(Number.isNaN(y)||Number.isNaN(E)){m("Values must be numeric");return}try{await Promise.all([QD.create(y),XD.create(E)]),u("0.0"),d("0.0"),await g()}catch(D){m(((R=($=D==null?void 0:D.response)==null?void 0:$.data)==null?void 0:R.message)||"Failed to record sensor data")}};return P.jsxs("div",{className:"space-y-6",children:[P.jsx("div",{className:"flex items-center justify-between",children:P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Velocity Analytics"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Track readings and trends"})]})}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsx("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:P.jsx(YD,{data:t.slice(0,100).reverse()})}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-3",children:"Add reading"}),P.jsxs("form",{className:"space-y-3",onSubmit:w,children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Velocity (m/s)"}),P.jsx("input",{value:n,onChange:v=>r(v.target.value),type:"number",step:"0.01",className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Source"}),P.jsxs("select",{value:i,onChange:v=>s(v.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",children:[P.jsx("option",{value:"sensor",children:"Sensor"}),P.jsx("option",{value:"camera",children:"Camera"}),P.jsx("option",{value:"upload",children:"Upload"})]})]}),a&&P.jsx("p",{className:"text-sm text-rose-600",children:a}),P.jsx("button",{type:"submit",className:"w-full bg-sky-600 text-white rounded-md py-2 font-medium hover:bg-sky-700",children:"Save reading"})]})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-3",children:"Sensor fusion inputs"}),P.jsxs("form",{className:"space-y-3",onSubmit:x,children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Water level (m)"}),P.jsx("input",{value:l,onChange:v=>u(v.target.value),type:"number",step:"0.01",className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Rainfall (mm/hr)"}),P.jsx("input",{value:c,onChange:v=>d(v.target.value),type:"number",step:"0.1",className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),h&&P.jsx("p",{className:"text-sm text-rose-600",children:h}),P.jsx("button",{type:"submit",className:"w-full bg-emerald-600 text-white rounded-md py-2 font-medium hover:bg-emerald-700",children:"Save sensor data"})]})]})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Reading log"}),P.jsxs("span",{className:"text-xs text-slate-500",children:["Latest ",t.length]})]}),P.jsx(Bu,{columns:[{header:"Timestamp",accessor:v=>new Date(v.timestamp).toLocaleString()},{header:"Velocity",accessor:v=>`${v.velocity} m/s`},{header:"Source",accessor:v=>v.source}],rows:t})]})]})},Bte=()=>{const[t,e]=j.useState([]),[n,r]=j.useState("2.5"),[i,s]=j.useState("0"),[a,o]=j.useState("warning"),[l,u]=j.useState(""),c=async()=>{try{const h=await ch.list();e(h.data.data||[])}catch(h){console.error(h)}};j.useEffect(()=>{c()},[]);const d=async h=>{var m,g;h.preventDefault(),u("");try{await ch.create(Number(n),Number(i),a),await c()}catch(w){u(((g=(m=w==null?void 0:w.response)==null?void 0:m.data)==null?void 0:g.message)||"Failed to save alert")}};return P.jsxs("div",{className:"space-y-6",children:[P.jsx("div",{className:"flex items-center justify-between",children:P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Alerts"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Threshold management and alert history"})]})}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsxs("div",{className:"lg:col-span-1 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-3",children:"Set threshold"}),P.jsxs("form",{className:"space-y-3",onSubmit:d,children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Velocity threshold (m/s)"}),P.jsx("input",{type:"number",step:"0.1",value:n,onChange:h=>r(h.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Sample velocity (optional)"}),P.jsx("input",{type:"number",step:"0.1",value:i,onChange:h=>s(h.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Status"}),P.jsxs("select",{value:a,onChange:h=>o(h.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",children:[P.jsx("option",{value:"normal",children:"Normal"}),P.jsx("option",{value:"warning",children:"Warning"}),P.jsx("option",{value:"danger",children:"Danger"})]})]}),l&&P.jsx("p",{className:"text-sm text-rose-600",children:l}),P.jsx("button",{type:"submit",className:"w-full bg-sky-600 text-white rounded-md py-2 font-medium hover:bg-sky-700",children:"Save alert"})]})]}),P.jsxs("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"History"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Recent entries"})]}),P.jsx(Bu,{columns:[{header:"Triggered",accessor:h=>new Date(h.triggeredAt).toLocaleString()},{header:"Velocity",accessor:h=>`${h.velocity} m/s`},{header:"Threshold",accessor:h=>`${h.threshold} m/s`},{header:"Status",accessor:h=>h.status}],rows:t})]})]})]})},Ute=()=>{const[t,e]=j.useState([]),[n,r]=j.useState(!1),[i,s]=j.useState(!1),[a,o]=j.useState(""),l=async()=>{try{const d=await Vp.list();e(d.data.data||[])}catch(d){console.error(d)}};j.useEffect(()=>{l()},[]);const u=async d=>{var h,m;o(""),r(!0);try{await Vp.upload(d),await l()}catch(g){o(((m=(h=g==null?void 0:g.response)==null?void 0:h.data)==null?void 0:m.message)||"Upload failed")}finally{r(!1)}},c=async()=>{o(""),s(!0);try{const d="hf-internal-testing/fixtures_image_utils",h=`https://huggingface.co/api/datasets/${d}/tree/main`,m=await fetch(h).then(E=>{if(!E.ok)throw new Error("Failed to fetch dataset tree");return E.json()}),w=(Array.isArray(m)?m:[]).find(E=>E.type==="file"&&/\.(png|jpg|jpeg)$/i.test(E.path));if(!w)throw new Error("No image asset found in dataset");const x=`https://huggingface.co/datasets/${d}/resolve/main/${w.path}`,v=await fetch(x).then(E=>{if(!E.ok)throw new Error("Failed to fetch sample file");return E.blob()}),y=new File([v],w.path.split("/").pop()||"sample.png",{type:v.type});await Vp.upload(y),await l()}catch(d){o((d==null?void 0:d.message)||"Import failed")}finally{s(!1)}};return P.jsxs("div",{className:"space-y-6",children:[P.jsx("div",{className:"flex items-center justify-between",children:P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Datasets"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Upload and manage training datasets"})]})}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsxs("div",{className:"lg:col-span-1 space-y-3",children:[P.jsx(Mx,{label:n?"Uploading...":"Upload CSV / ZIP / video",accept:".csv,text/csv,.zip,video/*",onChange:u}),a&&P.jsx("p",{className:"text-sm text-rose-600",children:a}),P.jsx("button",{disabled:i,onClick:c,className:"w-full rounded-md border-2 border-slate-900 bg-amber-200 text-slate-900 py-2 text-sm font-semibold hover:shadow-[4px_4px_0_#0f172a] disabled:opacity-50",children:i?"Importing":"Import HF sample dataset"}),P.jsxs("div",{className:"rounded-lg border-2 border-slate-900 bg-white p-3 shadow-[4px_4px_0_#0f172a] text-sm text-slate-800 space-y-1",children:[P.jsx("div",{className:"font-semibold text-slate-900",children:"Public resources"}),P.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs text-slate-700",children:[P.jsx("li",{children:P.jsx("a",{className:"underline",href:"https://github.com/neuromorphs/ATIS-data",target:"_blank",rel:"noreferrer",children:"ATIS neuromorphic water sequences"})}),P.jsx("li",{children:P.jsx("a",{className:"underline",href:"https://data.mendeley.com/datasets/7d24kz8x6c",target:"_blank",rel:"noreferrer",children:"Flooded river video set (Mendeley)"})}),P.jsx("li",{children:P.jsx("a",{className:"underline",href:"https://huggingface.co/datasets/hf-internal-testing/fixtures_image_utils",target:"_blank",rel:"noreferrer",children:"Hugging Face sample image fixtures (for testing loaders)"})})]}),P.jsx("p",{className:"text-xs text-slate-600",children:"Download externally, then upload here to keep everything in Firebase Storage."})]})]}),P.jsxs("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Uploaded datasets"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Stored in Firebase Storage"})]}),P.jsx(Bu,{columns:[{header:"Name",accessor:d=>d.name},{header:"Size",accessor:d=>d.size?`${(d.size/1024/1024).toFixed(2)} MB`:"n/a"},{header:"Added",accessor:d=>new Date(d.createdAt).toLocaleString()}],rows:t})]})]})]})},jte=()=>{var de,ee,Y;const[t,e]=j.useState("0"),[n,r]=j.useState("sensor"),[i,s]=j.useState(null),[a,o]=j.useState(!1),[l,u]=j.useState(""),[c,d]=j.useState([]),[h,m]=j.useState(""),[g,w]=j.useState(!1),[x,v]=j.useState(""),[y,E]=j.useState(""),[$,R]=j.useState([]),[D,k]=j.useState(""),[_,A]=j.useState(""),[N,L]=j.useState(!1),V=async J=>{var H,oe;J.preventDefault(),u(""),s(null);const G=Number(t);if(Number.isNaN(G)){u("Velocity must be numeric");return}o(!0);try{const ue=await Id.velocity(G,n);s(ue.data.data)}catch(ue){u(((oe=(H=ue==null?void 0:ue.response)==null?void 0:H.data)==null?void 0:oe.message)||"Inference failed")}finally{o(!1)}},M=async()=>{var J,G;try{const H=await p_.list();d(H.data.data||[]),m("")}catch(H){console.error(H),m(((G=(J=H==null?void 0:H.response)==null?void 0:J.data)==null?void 0:G.message)||"Failed to load models")}},B=async()=>{try{const J=await Vp.list();R(J.data.data||[])}catch(J){console.error(J)}};j.useEffect(()=>{M(),B()},[]);const Z=async J=>{var G,H;if(u(""),J.length!==0){w(!0);try{J.length===1?await p_.upload(J[0],x||void 0,y||void 0):await p_.uploadBundle(J,x||void 0,y||void 0),v(""),E(""),await M()}catch(oe){u(((H=(G=oe==null?void 0:oe.response)==null?void 0:G.data)==null?void 0:H.message)||"Model upload failed")}finally{w(!1)}}},ie=async()=>{var G,H;if(!D){A("Pick a dataset first.");return}const J=$.find(oe=>oe.id===D);if(!J){A("Dataset not found.");return}A(""),L(!0);try{const oe=Math.max(.5,(J.size||5e5)/1e6*2.5);await Id.velocity(oe,"dataset-analysis"),await Zw.create(`Dataset ${J.name} analyzed: est velocity ${oe.toFixed(2)} m/s`,"simulated","dataset_report"),A("Report logged (inference + notification).")}catch(oe){A(((H=(G=oe==null?void 0:oe.response)==null?void 0:G.data)==null?void 0:H.message)||"Analysis failed")}finally{L(!1)}};return P.jsxs("div",{className:"space-y-6",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Model"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Manage models and run inference (heuristic fallback)"})]}),P.jsx("span",{className:"text-xs text-slate-400",children:"// TODO: Replace with trained ONNX model"})]}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-3",children:"Run inference"}),P.jsxs("form",{className:"space-y-3",onSubmit:V,children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Velocity (m/s)"}),P.jsx("input",{type:"number",step:"0.01",value:t,onChange:J=>e(J.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Source"}),P.jsxs("select",{value:n,onChange:J=>r(J.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",children:[P.jsx("option",{value:"sensor",children:"Sensor"}),P.jsx("option",{value:"camera",children:"Camera"}),P.jsx("option",{value:"upload",children:"Upload"})]})]}),l&&P.jsx("p",{className:"text-sm text-rose-600",children:l}),P.jsx("button",{type:"submit",disabled:a,className:"w-full bg-sky-600 text-white rounded-md py-2 font-medium hover:bg-sky-700 disabled:opacity-50",children:a?"Running...":"Run inference"})]})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm space-y-3",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Model status"}),P.jsxs("ul",{className:"space-y-1 text-sm text-slate-700",children:[P.jsxs("li",{children:[P.jsx("span",{className:"font-medium",children:"Active:"})," ",((de=c[0])==null?void 0:de.name)||"Heuristic"]}),P.jsxs("li",{children:[P.jsx("span",{className:"font-medium",children:"Version:"})," ",((ee=c[0])==null?void 0:ee.version)||"0.1.0 (heuristic)"]}),P.jsxs("li",{children:[P.jsx("span",{className:"font-medium",children:"Source:"})," ",(Y=c[0])!=null&&Y.sourceUrl?"Uploaded":"Heuristic rules"]})]}),i&&P.jsxs("div",{className:"rounded-md border border-slate-200 bg-slate-50 p-3 text-sm text-slate-800",children:[P.jsx("div",{className:"font-semibold text-slate-900 mb-1",children:"Latest inference"}),P.jsxs("div",{children:["Label: ",P.jsx("span",{className:"font-medium uppercase",children:i.label})]}),P.jsxs("div",{children:["Velocity: ",i.velocity," m/s (source: ",i.source,")"]}),P.jsxs("div",{children:["Score: ",(i.score*100).toFixed(1),"%"]}),P.jsxs("div",{children:["Thresholds: warn ",i.thresholds.warn," / danger ",i.thresholds.danger," m/s"]}),P.jsx("div",{className:"text-xs text-slate-500 mt-1",children:i.explanation})]})]})]}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsxs("div",{className:"space-y-3 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Upload model artifact"}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Version (optional)"}),P.jsx("input",{value:x,onChange:J=>v(J.target.value),placeholder:"v1.0.0",className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Notes (optional)"}),P.jsx("textarea",{value:y,onChange:J=>E(J.target.value),rows:3,className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsx(Mx,{label:g?"Uploading...":"Upload model file or folder",accept:".onnx,.json,.bin,.zip,.tflite",multiple:!0,allowDirectory:!0,onChangeFiles:Z})]}),P.jsxs("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Model registry"}),P.jsxs("div",{className:"flex items-center space-x-2 text-xs text-slate-500",children:[P.jsx("span",{children:"Newest first"}),P.jsx("button",{onClick:M,className:"rounded-md border border-slate-300 px-2 py-1 text-xs hover:bg-slate-100",children:"Refresh"})]})]}),h&&P.jsx("p",{className:"text-sm text-rose-600 mb-2",children:h}),P.jsx(Bu,{columns:[{header:"Name",accessor:J=>J.name},{header:"Version",accessor:J=>J.version},{header:"Status",accessor:J=>J.status},{header:"Uploaded",accessor:J=>new Date(J.uploadedAt).toLocaleString()},{header:"Main file",accessor:J=>J.mainFilePath||"n/a"},{header:"Files",accessor:J=>J.files?J.files.length:J.sourceUrl?1:0},{header:"Source",accessor:J=>J.sourceUrl?"Storage":"Heuristic"}],rows:c})]}),P.jsxs("div",{className:"rounded-lg border-2 border-slate-900 bg-white p-4 shadow-[4px_4px_0_#0f172a] space-y-2 text-sm text-slate-800",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Public model references"}),P.jsx("p",{children:"Start with lightweight demos; download externally then upload:"}),P.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[P.jsx("li",{children:P.jsx("a",{className:"underline",href:"https://github.com/isl-org/MiDaS",target:"_blank",rel:"noreferrer",children:"MiDaS depth (for water surface cues)"})}),P.jsx("li",{children:P.jsx("a",{className:"underline",href:"https://github.com/google-research/google-research/tree/master/optical_flow",target:"_blank",rel:"noreferrer",children:"Lightweight optical flow demos"})}),P.jsx("li",{children:P.jsx("a",{className:"underline",href:"https://huggingface.co/spaces/akhaliq/raft-small-onnx",target:"_blank",rel:"noreferrer",children:"RAFT-small ONNX demo (optical flow)"})})]}),P.jsx("p",{className:"text-xs text-slate-600",children:"Tip: export to ONNX/TFJS, then upload to register in Firebase."})]})]}),P.jsxs("div",{className:"rounded-lg border-2 border-slate-900 bg-white p-4 shadow-[4px_4px_0_#0f172a] space-y-3",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Dataset-driven analysis"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Logs inference + notification"})]}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[P.jsxs("div",{className:"lg:col-span-2",children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Dataset"}),P.jsxs("select",{value:D,onChange:J=>k(J.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",children:[P.jsx("option",{value:"",children:"Select a dataset"}),$.map(J=>P.jsxs("option",{value:J.id,children:[J.name," ",J.size?`(${(J.size/1024/1024).toFixed(2)} MB)`:""]},J.id))]})]}),P.jsx("div",{className:"flex items-end",children:P.jsx("button",{onClick:ie,disabled:N,className:"w-full rounded-md border-2 border-slate-900 bg-emerald-200 text-slate-900 py-2 text-sm font-semibold hover:shadow-[4px_4px_0_#0f172a] disabled:opacity-50",children:N?"Analyzing":"Run analysis"})})]}),_&&P.jsx("p",{className:"text-sm text-slate-700",children:_})]})]})},Wte=()=>{const{login:t,register:e}=yx(),n=pb(),[r,i]=j.useState("login"),[s,a]=j.useState(""),[o,l]=j.useState(""),[u,c]=j.useState("user"),[d,h]=j.useState(""),[m,g]=j.useState(!1),w=async x=>{var v,y;x.preventDefault(),h(""),g(!0);try{r==="login"?await t(s,o):await e(s,o,u),n("/")}catch(E){h(((y=(v=E==null?void 0:E.response)==null?void 0:v.data)==null?void 0:y.message)||"Authentication failed")}finally{g(!1)}};return P.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",style:{background:"repeating-linear-gradient(45deg, #fef4dd, #fef4dd 10px, #f9e0ff 10px, #f9e0ff 20px)"},children:P.jsxs("div",{className:"bg-white border-4 border-slate-900 shadow-[8px_8px_0_#0f172a] rounded-xl p-8 w-full max-w-md",children:[P.jsx("h1",{className:"text-2xl font-semibold text-slate-900 mb-1",children:"Water Velocity"}),P.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"Secure dashboard access"}),P.jsxs("div",{className:"flex mb-6 border-2 border-slate-900 rounded-md overflow-hidden text-sm",children:[P.jsx("button",{className:`flex-1 py-2 font-semibold ${r==="login"?"bg-sky-200 text-slate-900":"bg-white"}`,onClick:()=>i("login"),children:"Login"}),P.jsx("button",{className:`flex-1 py-2 font-semibold ${r==="register"?"bg-sky-200 text-slate-900":"bg-white"}`,onClick:()=>i("register"),children:"Register"})]}),P.jsxs("form",{className:"space-y-4",onSubmit:w,children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Email"}),P.jsx("input",{value:s,onChange:x=>a(x.target.value),type:"email",required:!0,className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Password"}),P.jsx("input",{value:o,onChange:x=>l(x.target.value),type:"password",required:!0,className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300"})]}),r==="register"&&P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Role"}),P.jsxs("select",{value:u,onChange:x=>c(x.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",children:[P.jsx("option",{value:"user",children:"User"}),P.jsx("option",{value:"admin",children:"Admin"})]})]}),d&&P.jsx("p",{className:"text-sm text-red-600",children:d}),P.jsx("button",{type:"submit",disabled:m,className:"w-full bg-sky-600 text-white rounded-md py-2 font-medium hover:bg-sky-700 disabled:opacity-50",children:m?"Working...":r==="login"?"Login":"Register"})]})]})})},Hte=()=>{const[t,e]=j.useState([]),[n,r]=j.useState("Simulated alert to municipality"),[i,s]=j.useState("simulated"),[a,o]=j.useState(!1),[l,u]=j.useState(""),c=async()=>{try{const h=await Zw.list();e(h.data.data||[])}catch(h){console.error(h)}};j.useEffect(()=>{c()},[]);const d=async h=>{var m,g;h.preventDefault(),u(""),o(!0);try{await Zw.create(n,i,"manual"),await c()}catch(w){u(((g=(m=w==null?void 0:w.response)==null?void 0:m.data)==null?void 0:g.message)||"Failed to send")}finally{o(!1)}};return P.jsxs("div",{className:"space-y-6",children:[P.jsx("div",{className:"flex items-center justify-between",children:P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Notifications"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Simulated municipality dispatch log"})]})}),P.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[P.jsxs("div",{className:"lg:col-span-1 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-3",children:"Simulate send"}),P.jsxs("form",{className:"space-y-3",onSubmit:d,children:[P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Message"}),P.jsx("textarea",{value:n,onChange:h=>r(h.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",rows:3})]}),P.jsxs("div",{children:[P.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Channel"}),P.jsxs("select",{value:i,onChange:h=>s(h.target.value),className:"w-full rounded-md border border-slate-200 px-3 py-2 focus:ring-2 focus:ring-sky-300",children:[P.jsx("option",{value:"simulated",children:"Simulated"}),P.jsx("option",{value:"webhook",children:"Webhook"}),P.jsx("option",{value:"email",children:"Email"}),P.jsx("option",{value:"sms",children:"SMS"})]})]}),l&&P.jsx("p",{className:"text-sm text-rose-600",children:l}),P.jsx("button",{type:"submit",disabled:a,className:"w-full bg-sky-600 text-white rounded-md py-2 font-medium hover:bg-sky-700 disabled:opacity-50",children:a?"Sending...":"Send simulated notification"})]})]}),P.jsxs("div",{className:"lg:col-span-2 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Dispatch history"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Newest first"})]}),P.jsx(Bu,{columns:[{header:"Created",accessor:h=>new Date(h.createdAt).toLocaleString()},{header:"Type",accessor:h=>h.type},{header:"Channel",accessor:h=>h.channel},{header:"Delivered",accessor:h=>h.delivered?"Yes":"No"},{header:"Message",accessor:h=>h.message}],rows:t})]})]})]})},qte=t=>{const e=t*37%100;return{top:`${20+e%60}%`,left:`${10+e*3%80}%`}},Gte=()=>{const[t,e]=j.useState([]),[n,r]=j.useState(!1),[i,s]=j.useState(""),a=async()=>{try{const u=await jI.list();e(u.data.data||[])}catch(u){console.error(u)}};j.useEffect(()=>{a()},[]);const o=async()=>{var u,c;s(""),r(!0);try{await jI.seed(),await a()}catch(d){s(((c=(u=d==null?void 0:d.response)==null?void 0:u.data)==null?void 0:c.message)||"Failed to seed")}finally{r(!1)}},l=j.useMemo(()=>{const u=t.length,c=t.filter(h=>h.status==="online").length,d=t.filter(h=>h.alertStatus==="danger").length;return{total:u,online:c,danger:d}},[t]);return P.jsxs("div",{className:"space-y-6",children:[P.jsxs("div",{className:"flex items-center justify-between",children:[P.jsxs("div",{children:[P.jsx("h2",{className:"text-2xl font-semibold text-slate-900",children:"Sites & Health"}),P.jsx("p",{className:"text-sm text-slate-500",children:"Locations, status, and freshness"})]}),P.jsxs("div",{className:"space-x-2",children:[P.jsx("button",{onClick:a,className:"rounded-md border border-slate-300 px-3 py-2 text-sm hover:bg-slate-100",children:"Refresh"}),P.jsx("button",{onClick:o,disabled:n,className:"rounded-md border border-sky-500 px-3 py-2 text-sm text-white bg-sky-600 hover:bg-sky-700 disabled:opacity-50",children:n?"Seeding...":"Add sample site"})]})]}),i&&P.jsx("p",{className:"text-sm text-rose-600",children:i}),P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("div",{className:"text-sm text-slate-500",children:"Total sites"}),P.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:l.total})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("div",{className:"text-sm text-slate-500",children:"Online"}),P.jsx("div",{className:"text-2xl font-semibold text-slate-900",children:l.online})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsx("div",{className:"text-sm text-slate-500",children:"Danger alerts"}),P.jsx("div",{className:"text-2xl font-semibold text-rose-600",children:l.danger})]})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-gradient-to-br from-slate-800 via-slate-900 to-slate-800 p-4 shadow-sm text-white relative overflow-hidden",style:{minHeight:"320px"},children:[P.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"radial-gradient(circle at 1px 1px, rgba(255,255,255,0.3) 1px, transparent 0)",backgroundSize:"24px 24px"}}),P.jsxs("div",{className:"relative z-10",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold",children:"Map view (schematic)"}),P.jsx("span",{className:"text-xs text-slate-300",children:"Markers sized by velocity"})]}),P.jsxs("div",{className:"relative w-full",style:{height:"260px"},children:[t.map((u,c)=>{const d=qte(c+u.id.length),h=12+Math.min(20,(u.lastVelocity||0)*6),m=u.alertStatus==="danger"?"bg-rose-500":u.alertStatus==="warning"?"bg-amber-400":"bg-emerald-400";return P.jsx("div",{className:`absolute rounded-full border border-white/70 shadow-lg text-[10px] text-white flex items-center justify-center ${m}`,style:{width:`${h}px`,height:`${h}px`,top:d.top,left:d.left},title:`${u.name} | ${u.alertStatus}`},u.id)}),t.length===0&&P.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-slate-300 text-sm",children:"No sites yet. Add a sample site."})]})]})]}),P.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Site details"}),P.jsx("span",{className:"text-xs text-slate-500",children:"Most recent heartbeat first"})]}),P.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[t.map(u=>{var c,d,h;return P.jsxs("div",{className:"rounded-md border border-slate-200 p-3 bg-slate-50",children:[P.jsxs("div",{className:"flex items-center justify-between mb-1",children:[P.jsx("div",{className:"font-semibold text-slate-900",children:u.name}),P.jsx("span",{className:`text-xs px-2 py-1 rounded-md ${u.alertStatus==="danger"?"bg-rose-100 text-rose-700":u.alertStatus==="warning"?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700"}`,children:u.alertStatus})]}),P.jsx("div",{className:"text-xs text-slate-600 mb-2",children:u.location}),P.jsxs("div",{className:"text-sm text-slate-800",children:["Velocity: ",((c=u.lastVelocity)==null?void 0:c.toFixed(2))??""," m/s"]}),P.jsxs("div",{className:"text-sm text-slate-800",children:["Water level: ",((d=u.lastWaterLevel)==null?void 0:d.toFixed(2))??""," m"]}),P.jsxs("div",{className:"text-sm text-slate-800",children:["Rain: ",((h=u.lastRainRate)==null?void 0:h.toFixed(1))??""," mm/hr"]}),P.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Last heartbeat: ",u.lastHeartbeat?new Date(u.lastHeartbeat).toLocaleString():"n/a"]})]},u.id)}),t.length===0&&P.jsx("div",{className:"text-sm text-slate-500",children:"No sites yet."})]})]})]})},Kte=()=>P.jsxs(YU,{children:[P.jsx(Lr,{path:"/auth",element:P.jsx(Wte,{})}),P.jsxs(Lr,{element:P.jsx(tG,{}),children:[P.jsx(Lr,{path:"/",element:P.jsx(oee,{})}),P.jsx(Lr,{path:"/live",element:P.jsx(Vte,{})}),P.jsx(Lr,{path:"/velocity",element:P.jsx(Fte,{})}),P.jsx(Lr,{path:"/alerts",element:P.jsx(Bte,{})}),P.jsx(Lr,{path:"/notifications",element:P.jsx(Hte,{})}),P.jsx(Lr,{path:"/datasets",element:P.jsx(Ute,{})}),P.jsx(Lr,{path:"/model",element:P.jsx(jte,{})}),P.jsx(Lr,{path:"/sites",element:P.jsx(Gte,{})})]})]});h0.createRoot(document.getElementById("root")).render(P.jsx(OA.StrictMode,{children:P.jsx(r6,{children:P.jsx(J7,{children:P.jsx(Kte,{})})})}));
